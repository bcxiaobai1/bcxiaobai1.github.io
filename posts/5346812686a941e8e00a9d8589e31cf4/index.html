<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>使用 OpenCV 和 Python 识别数字 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用 OpenCV 和 Python 识别数字</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    
                        
                    
                    <h2>
<a id="_OpenCV__Python__0"></a>使用 OpenCV 和 Python 识别数字</h2> 
<p>本文演示如何使用 OpenCV 和 Python 识别图像中的数字。</p> 
<p>在本教程的第一部分，我们将讨论什么是七段显示器，以及我们如何应用计算机视觉和图像处理操作来识别这些类型的数字（不需要机器学习！）</p> 
<h1>
<a id="_6"></a>七段显示</h1> 
<p>您可能已经熟悉七段显示器，即使您不认识特定术语。 这种显示的一个很好的例子是您的经典数字闹钟：</p> 
<p><img src="https://images2.imgbox.com/84/d8/IFmTzXQ7_o.png" alt="image-20211108135630394"></p> 
<p>闹钟上的每个数字都由一个七段组件表示，如下所示：</p> 
<p><img src="https://images2.imgbox.com/fa/ee/tXO3f7Uk_o.png" alt="image-20211108140852713"></p> 
<p>七段显示器总共可以呈现 128 种可能的状态：</p> 
<p><img src="https://images2.imgbox.com/0c/45/5JkGweBQ_o.png" alt="image-20211108140904381"></p> 
<p>我们只对其中的 10 个感兴趣——数字 0 到 9：</p> 
<p><img src="https://images2.imgbox.com/fe/c4/9T3ln9Q9_o.png" alt="image-20211108140913319"></p> 
<p>我们的目标是编写 OpenCV 和 Python 代码来识别图像中的这十个数字状态中的每一个。</p> 
<h1>
<a id="OpenCV__26"></a>设计OpenCV 数字识别器</h1> 
<p>我们将使用恒温器图像作为输入：</p> 
<p><img src="https://images2.imgbox.com/e7/c3/9Hcc7PV5_o.png" alt="image-20211108140921872"></p> 
<p>识别的步骤：</p> 
<p>步骤 1：定位恒温器上的 LCD。 这可以使用边缘检测来完成，因为塑料外壳和 LCD 之间有足够的对比度。</p> 
<p>步骤2：提取 LCD。 给定一个输入边缘图，我可以找到轮廓并寻找矩形的轮廓——最大的矩形区域应该对应于 LCD。 透视变换会给我一个很好的 LCD 提取。</p> 
<p>步骤3：提取数字区域。 一旦我有了 LCD 本身，我就可以专注于提取数字。 由于数字区域和 LCD 背景之间似乎存在对比，我相信阈值和形态操作可以实现这一点。</p> 
<p>步骤4：识别数字。 使用 OpenCV 识别实际数字将涉及将数字 ROI 划分为七个部分。 从那里我可以在阈值图像上应用像素计数来确定给定的片段是“开”还是“关”。</p> 
<p>所以看看我们如何使用 OpenCV 和 Python 完成这个四步过程来进行数字识别，继续阅读。</p> 
<h1>
<a id="_OpenCV__44"></a>使用计算机视觉和 OpenCV 识别数字</h1> 
<p>让我们继续开始这个例子。新建一个文件，将其命名为 identify_digits.py ，并插入以下代码：</p> 
<pre><code class="prism language-python"><span class="token comment"># import the necessary packages</span>
<span class="token keyword">from</span> imutils<span class="token punctuation">.</span>perspective <span class="token keyword">import</span> four_point_transform
<span class="token keyword">from</span> imutils <span class="token keyword">import</span> contours
<span class="token keyword">import</span> imutils
<span class="token keyword">import</span> cv2
<span class="token comment"># define the dictionary of digit segments so we can identify</span>
<span class="token comment"># each digit on the thermostat</span>
DIGITS_LOOKUP <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">9</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>导入我们所需的 Python 包。 引入mutils，这是我的一系列便利函数，可以更轻松地使用 OpenCV + Python。 如果您还没有安装 imutils，现在应该花一点时间使用 pip 在您的系统上安装该软件包： 使用 OpenCV 和 Python 识别数字</p> 
<pre><code class="prism language-python">pip install imutils
</code></pre> 
<p>定义一个名为 DIGITS_LOOKUP 的 Python 字典。 他们对表的关键是七段数组。 数组中的 1 表示给定的段已打开，零表示该段已关闭。 该值是实际数字本身：0-9。</p> 
<p>一旦我们识别了恒温器显示器中的段，我们就可以将数组传递到我们的 DIGITS_LOOKUP 表中并获得数字值。 作为参考，该词典使用与上面图 2 中相同的段顺序。 让我们继续我们的例子：</p> 
<pre><code class="prism language-python"><span class="token comment"># load the example image</span>
image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"example.jpg"</span><span class="token punctuation">)</span>
<span class="token comment"># pre-process the image by resizing it, converting it to</span>
<span class="token comment"># graycale, blurring it, and computing an edge map</span>
image <span class="token operator">=</span> imutils<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>image<span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
blurred <span class="token operator">=</span> cv2<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
edged <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>blurred<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
</code></pre> 
<p>加载我们的图像。</p> 
<p>然后我们通过以下方式预处理图像：-</p> 
<ul>
<li>调整大小。</li>
<li>将图像转换为灰度。</li>
<li>使用 5×5 内核应用高斯模糊以减少高频噪声。</li>
<li>通过 Canny 边缘检测器计算边缘图。</li>
</ul> 
<p>应用这些预处理步骤后，我们的边缘图如下所示：</p> 
<p><img src="https://images2.imgbox.com/4a/b5/KrO1fP5z_o.png" alt="image-20211108140933252"></p> 
<p>注意 LCD 的轮廓是如何清晰可见的——这完成了步骤 #1。 我们现在可以继续第 2 步，提取 LCD 本身：</p> 
<pre><code class="prism language-python"><span class="token comment"># find contours in the edge map, then sort them by their</span>
<span class="token comment"># size in descending order</span>
cnts <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>edged<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_EXTERNAL<span class="token punctuation">,</span>
	cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
cnts <span class="token operator">=</span> imutils<span class="token punctuation">.</span>grab_contours<span class="token punctuation">(</span>cnts<span class="token punctuation">)</span>
cnts <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>cnts<span class="token punctuation">,</span> key<span class="token operator">=</span>cv2<span class="token punctuation">.</span>contourArea<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
displayCnt <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token comment"># loop over the contours</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> cnts<span class="token punctuation">:</span>
	<span class="token comment"># approximate the contour</span>
	peri <span class="token operator">=</span> cv2<span class="token punctuation">.</span>arcLength<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
	approx <span class="token operator">=</span> cv2<span class="token punctuation">.</span>approxPolyDP<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0.02</span> <span class="token operator">*</span> peri<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
	<span class="token comment"># if the contour has four vertices, then we have found</span>
	<span class="token comment"># the thermostat display</span>
	<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>approx<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
		displayCnt <span class="token operator">=</span> approx
		<span class="token keyword">break</span>
</code></pre> 
<p>为了找到 LCD 区域，我们需要提取边缘图中区域的轮廓（即轮廓）。</p> 
<p>然后我们按面积对等高线进行排序，确保将面积较大的等高线放在列表的前面。</p> 
<p>给定我们排序的轮廓列表，逐个循环它们并应用轮廓近似。</p> 
<p>如果我们的近似轮廓有四个顶点，那么我们假设我们已经找到了恒温器显示。 这是一个合理的假设，因为我们输入图像中最大的矩形区域应该是 LCD 本身。</p> 
<p>获得四个顶点后，我们可以通过四点透视变换提取 LCD：</p> 
<pre><code># extract the thermostat display, apply a perspective transform
# to it
warped = four_point_transform(gray, displayCnt.reshape(4, 2))
output = four_point_transform(image, displayCnt.reshape(4, 2))
</code></pre> 
<p>应用这种透视变换为我们提供了一个自上而下的 LCD 鸟瞰图：</p> 
<p><img src="https://images2.imgbox.com/3e/61/Kl5Z5N6s_o.png" alt="image-20211108140948248"></p> 
<p>获得 LCD 的这个视图满足第 2 步——我们现在准备从 LCD 中提取数字：</p> 
<pre><code class="prism language-python"><span class="token comment"># threshold the warped image, then apply a series of morphological</span>
<span class="token comment"># operations to cleanup the thresholded image</span>
thresh <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>warped<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	cv2<span class="token punctuation">.</span>THRESH_BINARY_INV <span class="token operator">|</span> cv2<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
kernel <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_ELLIPSE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
thresh <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>thresh<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_OPEN<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>
</code></pre> 
<p>为了获得数字本身，我们需要对扭曲图像进行阈值处理，以在较亮的背景（即 LCD 显示屏的背景）中显示暗区（即数字）：</p> 
<p><img src="https://images2.imgbox.com/53/8f/KMfA8dJb_o.png" alt="image-20211108140956034"></p> 
<p>然后我们应用一系列形态学操作来清理阈值图像：</p> 
<p><img src="https://images2.imgbox.com/ba/5f/ewU4BiSP_o.png" alt="image-20211108141005262"></p> 
<p>现在我们有一个很好的分割图像，我们再次需要应用轮廓过滤，只是这次我们正在寻找实际的数字：</p> 
<pre><code># find contours in the thresholded image, then initialize the
# digit contours lists
cnts = cv2.findContours(thresh.copy(), cv2.RETR_EXTERNAL,
	cv2.CHAIN_APPROX_SIMPLE)
cnts = imutils.grab_contours(cnts)
digitCnts = []
# loop over the digit area candidates
for c in cnts:
	# compute the bounding box of the contour
	(x, y, w, h) = cv2.boundingRect(c)
	# if the contour is sufficiently large, it must be a digit
	if w &gt;= 15 and (h &gt;= 30 and h &lt;= 40):
		digitCnts.append(c)
</code></pre> 
<p>为此，我们在阈值图像中找到轮廓。 初始化digitsCnts 列表——这个列表将存储数字本身的轮廓。</p> 
<p>在每个轮廓上循环。</p> 
<p>对于每个轮廓，我们计算边界框，确保宽度和高度是可接受的大小，如果是，则更新digitsCnts 列表。</p> 
<p>如果我们循环遍历digitsCnts内部的轮廓并在图像上绘制边界框，结果将如下所示：</p> 
<p><img src="https://images2.imgbox.com/5a/b8/bAvBKhLf_o.png" alt="image-20211108141017066"></p> 
<p>果然，我们在液晶显示屏上找到了数字！ 最后一步是实际识别每个数字：</p> 
<pre><code># sort the contours from left-to-right, then initialize the
# actual digits themselves
digitCnts = contours.sort_contours(digitCnts,
	method="left-to-right")[0]
digits = []
</code></pre> 
<p>在这里，我们只是根据 (x, y) 坐标从左到右对数字轮廓进行排序。</p> 
<p>这个排序步骤是必要的，因为不能保证轮廓已经从左到右排序（与我们读取数字的方向相同）。</p> 
<p>接下来是实际的数字识别过程：</p> 
<pre><code class="prism language-python"><span class="token comment"># loop over each of the digits</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> digitCnts<span class="token punctuation">:</span>
	<span class="token comment"># extract the digit ROI</span>
	<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token operator">=</span> cv2<span class="token punctuation">.</span>boundingRect<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
	roi <span class="token operator">=</span> thresh<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span>
	<span class="token comment"># compute the width and height of each of the 7 segments</span>
	<span class="token comment"># we are going to examine</span>
	<span class="token punctuation">(</span>roiH<span class="token punctuation">,</span> roiW<span class="token punctuation">)</span> <span class="token operator">=</span> roi<span class="token punctuation">.</span>shape
	<span class="token punctuation">(</span>dW<span class="token punctuation">,</span> dH<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>roiW <span class="token operator">*</span> <span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>roiH <span class="token operator">*</span> <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	dHC <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>roiH <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">)</span>
	<span class="token comment"># define the set of 7 segments</span>
	segments <span class="token operator">=</span> <span class="token punctuation">[</span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> dH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># top</span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>dW<span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># top-left</span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span>w <span class="token operator">-</span> dW<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># top-right</span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> dHC<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token punctuation">(</span>h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> dHC<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># center</span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>dW<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># bottom-left</span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span>w <span class="token operator">-</span> dW<span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment"># bottom-right</span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> h <span class="token operator">-</span> dH<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment"># bottom</span>
	<span class="token punctuation">]</span>
	on <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>segments<span class="token punctuation">)</span>
</code></pre> 
<p>遍历每个数字轮廓。</p> 
<p>对于这些区域中的每一个，我们计算边界框并提取数字 ROI。</p> 
<p>我在下面包含了每个数字 ROI 的 GIF 动画：</p> 
<p><img src="https://images2.imgbox.com/ba/a2/C7CRZqRh_o.gif" alt="在这里插入图片描述"></p> 
<p>给定数字 ROI，我们现在需要定位和提取数字显示的七个部分。</p> 
<p>根据 ROI 尺寸计算每个段的大致宽度和高度。 然后我们定义一个 (x, y) 坐标列表，这些坐标对应七个线段。 此列表遵循与上面图 2 相同的段顺序。 这是一个示例 GIF 动画，它在正在调查的当前片段上绘制一个绿色框：</p> 
<p><img src="https://images2.imgbox.com/06/bc/uU4Cv7Cc_o.gif" alt="Figure 12: An example of drawing the segment ROI for each of the seven segments of the digit."></p> 
<p>最后，初始化我们的 on 列表——该列表中的值 1 表示给定的段是“打开”的，而值为零表示该段是“关闭的”。 给定七个显示段的 (x, y) 坐标，识别一个段是打开还是关闭是相当容易的：</p> 
<pre><code class="prism language-python"><span class="token comment"># loop over the segments</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xA<span class="token punctuation">,</span> yA<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>xB<span class="token punctuation">,</span> yB<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>segments<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># extract the segment ROI, count the total number of</span>
		<span class="token comment"># thresholded pixels in the segment, and then compute</span>
		<span class="token comment"># the area of the segment</span>
		segROI <span class="token operator">=</span> roi<span class="token punctuation">[</span>yA<span class="token punctuation">:</span>yB<span class="token punctuation">,</span> xA<span class="token punctuation">:</span>xB<span class="token punctuation">]</span>
		total <span class="token operator">=</span> cv2<span class="token punctuation">.</span>countNonZero<span class="token punctuation">(</span>segROI<span class="token punctuation">)</span>
		area <span class="token operator">=</span> <span class="token punctuation">(</span>xB <span class="token operator">-</span> xA<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>yB <span class="token operator">-</span> yA<span class="token punctuation">)</span>
		<span class="token comment"># if the total number of non-zero pixels is greater than</span>
		<span class="token comment"># 50% of the area, mark the segment as "on"</span>
		<span class="token keyword">if</span> total <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">:</span>
			on<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">1</span>
	<span class="token comment"># lookup the digit and draw it on the image</span>
	digit <span class="token operator">=</span> DIGITS_LOOKUP<span class="token punctuation">[</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>on<span class="token punctuation">)</span><span class="token punctuation">]</span>
	digits<span class="token punctuation">.</span>append<span class="token punctuation">(</span>digit<span class="token punctuation">)</span>
	cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> y <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.65</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p>我们开始循环遍历每个线段的 (x, y) 坐标。</p> 
<p>我们提取片段 ROI，然后计算非零像素数（即片段中“开启”的像素数）。</p> 
<p>如果非零像素与段总面积的比率大于 50%，那么我们可以假设该段是“on”并相应地更新我们的 on 列表。 在循环七段之后，我们可以将列表传递给 DIGITS_LOOKUP 以获取数字本身。</p> 
<p>然后我们在数字周围绘制一个边界框并在输出图像上显示数字。 最后，我们的最后一个代码块将数字打印到我们的屏幕上并显示输出图像：</p> 
<pre><code class="prism language-python"><span class="token comment"># display the digits</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">u"{}{}.{} u00b0C"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token operator">*</span>digits<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Input"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Output"</span><span class="token punctuation">,</span> output<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>请注意我们如何使用 Python 和 OpenCV 正确识别 LCD 屏幕上的数字：</p> 
<p><img src="https://images2.imgbox.com/91/06/PMbOtrHP_o.png" alt="image-20211108141044971"></p> 
<h1>
<a id="_293"></a>总结</h1> 
<p>在今天的博客文章中，我演示了如何利用 OpenCV 和 Python 来识别图像中的数字。</p> 
<p>这种方法专门用于七段显示器（即您通常会在数字闹钟上看到的数字显示器）。</p> 
<p>通过提取七个段中的每一个并应用基本的阈值和形态学操作，我们可以确定哪些段是“开”的，哪些是“关”的。</p> 
<p>从那里，我们可以在 Python 字典数据结构中查找开/关段以快速确定实际数字——无需机器学习！</p> 
<p>正如我在这篇博文的开头提到的，应用计算机视觉来识别恒温器图像中的数字往往会使问题本身过于复杂——使用数据记录温度计会更可靠，并且需要的工作量要少得多。</p> 
<p>我希望你喜欢今天的博文！<br> 代码：<br> https://download.csdn.net/download/hhhhhhhhhhwwwwwwwwww/38496915</p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>【论文阅读笔记】CycleISP: Real Image Restoration via Improved Data Synthesis - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【论文阅读笔记】CycleISP: Real Image Restoration via Improved Data Synthesis</h1>
			
		</header>
		<div class="content post__content clearfix">
			


        
                <div id="content_views" class="markdown_views prism-atom-one-light">
                    
                        
                    
                    <p>论文地址：<a href="https://arxiv.org/abs/2003.07761">https://arxiv.org/abs/2003.07761</a><br> 代码地址：<a href="https://github.com/swz30/CycleISP">https://github.com/swz30/CycleISP</a></p> 
<h2>
<a id="_3"></a>论文小结</h2> 
<p>  总的来说，就是现实世界中无法获取有效的图像对。且之前合成噪声的方式是在sRGB上添加高斯白噪声，但对于相机传感器成像管道来说，经过一系列的处理，噪声早已不是高斯白噪声了，所以之前的论文方法在相机图像中效果不好。<br>   所以作者设计了一种模式，实现sRGB图像-&gt;RAW图像-&gt;添加噪声-&gt;sRGB图像的一个循环过程，所以整个架构成为CycleISP。<br>   在训练的时候，sRGB图像-&gt;RAW图像的子网络，与RAW图像-&gt;sRGB图像的子网络使用干净图像单独训练。在RAW图像-&gt;sRGB图像的子网训练完成后，对RAW图像添加噪声，则能得到对应的有噪声的sRGB图像。通过完成的管道，可以得到sRGB去噪图像对。</p> 
<h2>
<a id="_8"></a>论文简介</h2> 
<p>  真实世界中，由于数据不容易制作。所以图像去噪算法主要是在合成数据上开发和评估的。这些合成数据通常在广泛假设加性高斯白噪声 (AWGN) 的情况下生成的。<br>   但正如最近的基准数据集所报告的那样，它们在应用于真实相机图像时表现不佳。这主要是因为 <b>AWGN 不足以模拟真实的相机噪声，它是信号相关的并且由相机成像管道经过大量转换得到的</b>。在本文中，作者提出了一个<b>框架，可以在正向和反向方向上对相机成像管道进行建模。 它允许我们生成任意数量的真实图像对，用于在 RAW 和 sRGB 空间中进行去噪</b>。<br>   本文模型中的参数比以前最好的 RAW 降噪方法少 5 倍。</p> 
<p>  在本文中，作者提出了一种<b>数据合成方式方法</b>，可以在RAW和sRGB空间中生成真实的噪声图像。主要思想，是<b>将噪声注入到我们学习到的设备位置变换获得的RAW图像中，而不是直接注入到sRGB图像中。</b>这种框架背后的关键见解是：<b>sRGB图像中存在的真实噪声被常规图像信号处理（ISP）管道中执行的一系列步骤所扭曲[6, 46]。所以，与原始传感器数据[35]相比，在sRGB中建模真实相机噪声是一项固有的艰巨任务</b>。例如，RAW传感器空间是信号相关（signal-dependent）的，在经过去马赛克后，它变成空间-色彩相关。再通过其余的管道后，它概率分布不一定仍然保持高斯分布。这表示着相机ISP将传感器噪声进行了严重的转换。因此，相较于统一的AWGN模型，我们需要对图像管道对真实合成噪声的影响进行更详细的建模过程。（therefore more sophisticated models that take into account the influence of imaging pipeline are needed to synthesize realistic noise than uniform AWGN model [1, 26, 44].）</p> 
<p>  为了利用互联网上可用的sRGB照片的丰富性和多样性，所提出的合成方法的主要挑战是如何将他们转换回原始测量值。[7]提出了一种技术，可用逐步反转相机ISP，因此可用转换sRGB数据到RAW数据。然而，这种方法需要关于目标相机设备的先验信息(例如，颜色校正矩阵和白平衡增益)，这使得它特定于给定的设备，因此缺乏普遍性。此外，相机管道中的一些操作是专有的，这样的黑盒很难进行逆向工程。<br>   为了解决这些挑战，在本文中，我们提出了一个<b>CycleISP框架，它可以将sRGB图像转换为RAW数据，然后再转换回sRGB图像，而不需要任何相机参数的知识。</b>这个属性允许我们<b>在RAW和sRGB空间中合成任意数量的干净和真实的噪声图像对</b>。</p> 
<p>  作者的主要贡献有：</p> 
<ol>
<li>学习一种设备无关的转换，称为CycleISP，它允许我们在sRGB和RAW图像空间之间来回移动。</li>
<li>真实图像噪声合成器，用于在RAW和sRGB空间中生成干净/噪声配对数据。</li>
<li>一个具有双重注意机制的深度CNN，在各种任务中都有效:学习CycleISP，合成真实噪声和图像去噪。</li>
<li>从RAW和sRGB图像中去除噪声的算法，在DND[44]和SIDD[1]的真实噪声基准上设置了最新的技术(见下图1)。此外，我们的去噪网络的参数(2.6M)比之前的最佳模型(11.8M)[7]少得多。</li>
<li>CycleISP框架的推广超越了去噪，作者通过一个额外的应用，即立体电影中的颜色匹配来证明这一点。</li>
</ol> 
<p><img src="https://images2.imgbox.com/7d/23/GgjNuM7O_o.png" alt="在这里插入图片描述"></p> 
<p>  一个更精确的真实RAW传感器噪声模型既包含信号相关的噪声分量(射击噪声)，也包含信号无关的加性高斯分量(读噪声)[22,23,24]。</p> 
<h2>
<a id="CycleISP_31"></a>CycleISP</h2> 
<p>  为了合成真实的噪声数据集，作者在这项工作中使用了两阶段方案。首先，开发了一个框架，在正向和反向两个方向上对相机ISP建模，因此命名为CycleISP。其次，利用CycleISP合成真实噪声数据集用于RAW图像去噪和sRGB图像去噪。</p> 
<p>  CycleISP模型的模块如下图所示，（a） RGB2RAW网络分支；（b）RAW2RGB网络分支。此外，作者还引入了一个额外的颜色校正网络分支，为RAW2RGB网络提供显式的颜色attention，以正确恢复原始sRGB图像。<br> <img src="https://images2.imgbox.com/71/f2/1AzQE5IN_o.png" alt="在这里插入图片描述"></p> 
<p>  上图中的噪声注入，只有在合成噪声数据阶段时才需要。<b>CycleISP的训练过程分为两步：（1）独立训练RGB2RAW和RAW2RGB网络（2）进行联合微调。</b></p> 
<h4>
<a id="RGB2RAW_39"></a>RGB2RAW网络分支</h4> 
<p>  数码相机对RAW传感器数据进行一系列操作，以生成可用于监控的sRGB图像[46]。本文的RGB2RAW网络分支旨在扭转摄像机ISP的影响。与[7]的非处理技术相比，RGB2RAW分支不需要任何相机参数。</p> 
<p>  RGB图像<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         I
        
        
         
          r
         
         
          g
         
         
          b
         
        
       
       
        ∈
       
       
        
         R
        
        
         
          H
         
         
          ∗
         
         
          W
         
         
          ∗
         
         
          3
         
        
       
      
      
       I_{rgb}inmathbb{R}^{H*W*3}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9694em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.8413em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span><span class="mbin mtight">∗</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span></span>作为输入，经过一个卷积层<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         M
        
        
         0
        
       
      
      
       M_0
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>得到特征<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         T
        
        
         0
        
       
       
        ∈
       
       
        
         R
        
        
         
          H
         
         
          ∗
         
         
          W
         
         
          ∗
         
         
          C
         
        
       
      
      
       T_0inmathbb{R}^{H*W*C}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.8413em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.0715em">C</span></span></span></span></span></span></span></span></span></span></span></span></span>，再通过N个循环残差组（RRGs，recursive residual groups）提取深层特征<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         T
        
        
         d
        
       
       
        ∈
       
       
        
         R
        
        
         
          H
         
         
          ∗
         
         
          W
         
         
          ∗
         
         
          C
         
        
       
      
      
       T_dinmathbb{R}^{H*W*C}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.8413em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.0715em">C</span></span></span></span></span></span></span></span></span></span></span></span></span>，起重每个RRG包含多个多重注意块。<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
         
          
           
            
             T
            
            
             d
            
           
           
            =
           
           
            R
           
           
            R
           
           
            
             G
            
            
             N
            
           
           
            (
           
           
            .
           
           
            .
           
           
            .
           
           
            (
           
           
            R
           
           
            R
           
           
            
             G
            
            
             1
            
           
           
            (
           
           
            
             T
            
            
             0
            
           
           
            )
           
           
            )
           
           
            )
           
          
         
         
         
          
           (1)
          
         
        
       
       
        T_d=RRG_N(...(RRG_1(T_0)))tag{1}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord mathnormal" style="margin-right: 0.0077em">RR</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.109em">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">...</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0077em">RR</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">)))</span></span><span class="tag"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></span></p> 
<p>  然后再通过一个最后的卷积操作<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         M
        
        
         1
        
       
      
      
       M_1
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>获得去马赛克图像<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         
          I
         
         
          ^
         
        
        
         
          d
         
         
          e
         
         
          m
         
        
       
       
        ∈
       
       
        
         R
        
        
         
          H
         
         
          ∗
         
         
          W
         
         
          ∗
         
         
          3
         
        
       
      
      
       hat{I}_{dem}inmathbb{R}^{H*W*3}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0968em;vertical-align: -0.15em"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.8413em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span><span class="mbin mtight">∗</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span></span>。这里让<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         M
        
        
         1
        
       
      
      
       M_1
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>的channel为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        3
       
      
      
       3
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">3</span></span></span></span></span>是有意为之的，是想让其尽量与原图有一样的结构信息。且实验结果也表明，channel为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        3
       
      
      
       3
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">3</span></span></span></span></span>有助于网络更快、更准确地学习从sRGB到RAW的映射。<b>在这一点上，该网络能够反转色调映射、伽马校正、颜色校正、白平衡和其他转换的效果，并为我们提供图像<span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
          
           I
          
          
           ^
          
         
         
          
           d
          
          
           e
          
          
           m
          
         
        
       
       
        hat{I}_{dem}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0968em;vertical-align: -0.15em"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>，其值与场景亮度线性相关。</b>最后，为了生成有马赛克的RAW输出<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         
          I
         
         
          ^
         
        
        
         
          r
         
         
          a
         
         
          w
         
        
       
       
        ∈
       
       
        
         R
        
        
         
          H
         
         
          ∗
         
         
          W
         
         
          ∗
         
         
          1
         
        
       
      
      
       hat{I}_{raw}inmathbb{R}^{H*W*1}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0968em;vertical-align: -0.15em"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.8413em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span><span class="mbin mtight">∗</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span>。将拜耳采样函数<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         f
        
        
         
          B
         
         
          a
         
         
          y
         
         
          e
         
         
          r
         
        
       
      
      
       f_{Bayer}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9805em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em"><span class="" style="margin-left: -0.1076em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0502em">B</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em">yer</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span></span></span></span></span>应用到<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         
          I
         
         
          ^
         
        
        
         
          d
         
         
          e
         
         
          m
         
        
       
      
      
       hat{I}_{dem}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0968em;vertical-align: -0.15em"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>，依据拜耳模式，每个像素省略两个颜色通道。<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
         
          
           
            
             
              I
             
             
              ^
             
            
            
             
              r
             
             
              a
             
             
              w
             
            
           
           
            =
           
           
            
             f
            
            
             
              B
             
             
              a
             
             
              y
             
             
              e
             
             
              r
             
            
           
           
            (
           
           
            
             M
            
            
             1
            
           
           
            (
           
           
            
             T
            
            
             d
            
           
           
            )
           
           
            )
           
          
         
         
         
          
           (2)
          
         
        
       
       
        hat{I}_{raw}=f_{Bayer}(M_1(T_d))tag{2}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0968em;vertical-align: -0.15em"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em"><span class="" style="margin-left: -0.1076em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0502em">B</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em">yer</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">))</span></span><span class="tag"><span class="strut" style="height: 1.2329em;vertical-align: -0.2861em"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></span></p> 
<p>  看来，图上的马赛克层，就是<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         f
        
        
         
          B
         
         
          a
         
         
          y
         
         
          e
         
         
          r
         
        
       
      
      
       f_{Bayer}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9805em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em"><span class="" style="margin-left: -0.1076em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0502em">B</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em">yer</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span></span></span></span></span>了，拜耳函数。</p> 
<p>  RGB2RAW网络使用线性域和对数域的<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         L
        
        
         1
        
       
      
      
       L_1
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>损失进行优化，下公式中的<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        ϵ
       
      
      
       epsilon
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em"></span><span class="mord mathnormal">ϵ</span></span></span></span></span>是小数值的常量，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         I
        
        
         
          r
         
         
          a
         
         
          w
         
        
       
      
      
       I_{raw}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>是ground truth RAW图像，也像[21]一样，<b>加入了对数损失项以强制对所有像素值进行近似相等的处理，否则网络将更多的注意力用于恢复突出区域。</b><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
         
          
           
            
             L
            
            
             
              s
             
             
              →
             
             
              r
             
            
           
           
            (
           
           
            
             
              y
             
             
              ^
             
            
            
             
              r
             
             
              a
             
             
              w
             
            
           
           
            ,
           
           
            
             I
            
            
             
              r
             
             
              a
             
             
              w
             
            
           
           
            )
           
           
            =
           
           
            ∥
           
           
            
             
              I
             
             
              ^
             
            
            
             
              r
             
             
              a
             
             
              w
             
            
           
           
            −
           
           
            
             I
            
            
             
              r
             
             
              a
             
             
              w
             
            
           
           
            
             ∥
            
            
             1
            
           
           
            +
           
           
            ∥
           
           
            l
           
           
            o
           
           
            g
           
           
            (
           
           
            m
           
           
            a
           
           
            x
           
           
            (
           
           
            
             
              I
             
             
              ^
             
            
            
             
              r
             
             
              a
             
             
              w
             
            
           
           
            ,
           
           
            ϵ
           
           
            )
           
           
            )
           
           
            −
           
           
            l
           
           
            o
           
           
            g
           
           
            (
           
           
            m
           
           
            a
           
           
            x
           
           
            (
           
           
            
             I
            
            
             
              r
             
             
              a
             
             
              w
             
            
           
           
            ,
           
           
            ϵ
           
           
            )
           
           
            )
           
           
            
             ∥
            
            
             1
            
           
          
         
         
         
          
           (3)
          
         
        
       
       
        mathcal{L}_{srightarrow r}(hat{y}_{raw},I_{raw})=|hat{I}_{raw}-I_{raw}|_1 + |log(max(hat{I}_{raw}, epsilon))-log(max(I_{raw}, epsilon))|_1tag{3}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord"><span class="mord mathcal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mrel mtight">→</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.6944em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0359em">y</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.1944em"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0359em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1.1968em;vertical-align: -0.25em"></span><span class="mord">∥</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1.1968em;vertical-align: -0.25em"></span><span class="mord">∥</span><span class="mord mathnormal" style="margin-right: 0.0197em">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.0359em">g</span><span class="mopen">(</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord mathnormal">ϵ</span><span class="mclose">))</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord mathnormal" style="margin-right: 0.0197em">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.0359em">g</span><span class="mopen">(</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord mathnormal">ϵ</span><span class="mclose">))</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 1.1968em;vertical-align: -0.25em"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></span></p> 
<h4>
<a id="RAW2RGB_50"></a>RAW2RGB网络分支</h4> 
<p>  RAW2RGB网络的最终目标是为sRGB图像去噪问题生成合成的真实噪声数据。本节的内容还是先描述如何将干净的RAW图像映射到干净的sRGB图像（即图2中让噪声注入模块保持"OFF"状态）。</p> 
<p>  为了减少计算消耗，将<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         I
        
        
         
          r
         
         
          a
         
         
          w
         
        
       
      
      
       I_{raw}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>装成<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        2
       
       
        ∗
       
       
        2
       
      
      
       2*2
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">2</span></span></span></span></span>的块，变为4个channel（<b>RGGB</b>）。也因为输入的RAW图像可能来自于不同的相机，有不同的拜耳模式，所以我们需要注意channel的顺序，利用拜耳模式统一技术，保持图像的通道顺序为RGGB。再然后，通过一个卷积层<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         M
        
        
         2
        
       
      
      
       M_2
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>后，接着<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        K
       
       
        −
       
       
        1
       
      
      
       K-1
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7667em;vertical-align: -0.0833em"></span><span class="mord mathnormal" style="margin-right: 0.0715em">K</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1</span></span></span></span></span>个RRG模块对堆叠的RAW图像<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         I
        
        
         
          p
         
         
          a
         
         
          c
         
         
          k
         
        
       
       
        ∈
       
       
        
         R
        
        
         
          
           H
          
          
           2
          
         
         
          ∗
         
         
          2
         
         
          
           W
          
          
           2
          
         
         
          ∗
         
         
          4
         
        
       
      
      
       I_{pack}inmathbb{R}^{frac H2*2frac W2*4}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9694em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.0315em">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.9735em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9735em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8721em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="frac-line mtight" style="border-bottom-width: 0.049em"></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.344em"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">∗</span><span class="mord mtight">2</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8721em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="frac-line mtight" style="border-bottom-width: 0.049em"></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.344em"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">∗</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span></span>进行编码，得到深层特征tensor<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         T
        
        
         
          d
         
         
          ′
         
        
       
       
        ∈
       
       
        
         R
        
        
         
          
           H
          
          
           2
          
         
         
          ∗
         
         
          
           W
          
          
           2
          
         
         
          ∗
         
         
          C
         
        
       
      
      
       T_{d'}in mathbb{R}^{frac H2 * frac W2 * C}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.6828em"><span class="" style="margin-right: 0.0714em"><span class="pstrut" style="height: 2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.9735em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9735em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8721em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="frac-line mtight" style="border-bottom-width: 0.049em"></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.344em"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">∗</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8721em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="frac-line mtight" style="border-bottom-width: 0.049em"></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.344em"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.0715em">C</span></span></span></span></span></span></span></span></span></span></span></span></span>。<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
         
          
           
            
             T
            
            
             
              d
             
             
              ′
             
            
           
           
            =
           
           
            R
           
           
            R
           
           
            
             G
            
            
             
              K
             
             
              −
             
             
              1
             
            
           
           
            (
           
           
            .
           
           
            .
           
           
            .
           
           
            (
           
           
            R
           
           
            R
           
           
            
             G
            
            
             1
            
           
           
            (
           
           
            
             M
            
            
             2
            
           
           
            (
           
           
            P
           
           
            a
           
           
            c
           
           
            k
           
           
            (
           
           
            
             I
            
            
             
              r
             
             
              a
             
             
              w
             
            
           
           
            )
           
           
            )
           
           
            )
           
           
            )
           
           
            )
           
          
         
         
         
          
           (4)
          
         
        
       
       
        T_{d'}=RRG_{K-1}(...(RRG_1(M_2(Pack(I_{raw})))))tag{4}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.6828em"><span class="" style="margin-right: 0.0714em"><span class="pstrut" style="height: 2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord mathnormal" style="margin-right: 0.0077em">RR</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em">K</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">...</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0077em">RR</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.1389em">P</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right: 0.0315em">k</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">)))))</span></span><span class="tag"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">4</span></span><span class="mord">)</span></span></span></span></span></span></span></p> 
<p>  需要注意的是，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         I
        
        
         
          r
         
         
          a
         
         
          w
         
        
       
      
      
       I_{raw}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>是原始的相机RAW图像，而不是RGB2RAW图像的输出。因为这里的首要目标是先独立地学习RAW到sRGB的映射。</p> 
<h5>
<a id="attention_57"></a>颜色attention单元</h5> 
<p>  使用MIT-Adobe FiveK数据集[10]训练CycleISP。MIT-Adobe FiveK数据集包含数个不同相机的图像，这些相机有不同而复杂的ISP系统。</p> 
<p>  CNN很难准确地学习所有不同类型相机的RAW到sRGB映射函数(<b>因为一个RAWimage可以映射到许多sRGB图像</b>)。<font color="00bbff">一种解决方案是为每个摄像头ISP训练一个网络[13,51,62]</font>。然而，这样的解决方案是不可扩展的，性能可能无法推广到其他相机。为了解决这个问题，我们建议在RAW2RGB网络中包含一个颜色注意单元，它通过一个颜色校正分支提供显式的颜色注意。<br>   颜色校正分支是一个CNN，以sRGB图像<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         I
        
        
         
          r
         
         
          g
         
         
          b
         
        
       
      
      
       I_{rgb}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9694em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span></span></span></span></span>作为输入，生成颜色编码的深层特征tensor <span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         T
        
        
         
          c
         
         
          o
         
         
          l
         
         
          o
         
         
          r
         
        
       
       
        ∈
       
       
        
         R
        
        
         
          
           H
          
          
           2
          
         
         
          ∗
         
         
          
           W
          
          
           2
          
         
         
          ∗
         
         
          C
         
        
       
      
      
       T_{color}inmathbb{R}^{frac H2 * frac W2 * C}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight" style="margin-right: 0.0197em">l</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em">or</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.9735em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9735em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8721em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="frac-line mtight" style="border-bottom-width: 0.049em"></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.344em"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">∗</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8721em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="frac-line mtight" style="border-bottom-width: 0.049em"></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.344em"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.0715em">C</span></span></span></span></span></span></span></span></span></span></span></span></span>。在颜色校正分支中，先对<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         I
        
        
         
          r
         
         
          g
         
         
          b
         
        
       
      
      
       I_{rgb}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9694em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span></span></span></span></span>应用高斯模糊，再接着一个卷积层<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         M
        
        
         3
        
       
      
      
       M_3
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>，接着两个RRGs，以及一个门机制的sigmoid激活函数<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        σ
       
      
      
       sigma
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em"></span><span class="mord mathnormal" style="margin-right: 0.0359em">σ</span></span></span></span></span>：<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
         
          
           
            
             T
            
            
             
              c
             
             
              o
             
             
              l
             
             
              o
             
             
              r
             
            
           
           
            =
           
           
            σ
           
           
            (
           
           
            
             M
            
            
             4
            
           
           
            (
           
           
            R
           
           
            R
           
           
            
             G
            
            
             2
            
           
           
            (
           
           
            R
           
           
            R
           
           
            
             G
            
            
             1
            
           
           
            (
           
           
            
             M
            
            
             3
            
           
           
            (
           
           
            K
           
           
            ∗
           
           
            
             I
            
            
             
              r
             
             
              g
             
             
              b
             
            
           
           
            )
           
           
            )
           
           
            )
           
           
            )
           
           
            )
           
          
         
         
         
          
           (5)
          
         
        
       
       
        T_{color}=sigma(M_4(RRG_2(RRG_1(M_3(K*I_{rgb})))))tag{5}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight" style="margin-right: 0.0197em">l</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em">or</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord mathnormal" style="margin-right: 0.0359em">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0077em">RR</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0077em">RR</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0715em">K</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mclose">)))))</span></span><span class="tag"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">5</span></span><span class="mord">)</span></span></span></span></span></span></span></p> 
<p>  公式(5)中，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        ∗
       
      
      
       *
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4653em"></span><span class="mord">∗</span></span></span></span></span>表示卷积，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        K
       
      
      
       K
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em"></span><span class="mord mathnormal" style="margin-right: 0.0715em">K</span></span></span></span></span>表示标准差经验性设为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        12
       
      
      
       12
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">12</span></span></span></span></span>的高斯核。这种强模糊操作确保了只有颜色信息可以流经这个分支，而结构内容和精细纹理主要来自RAW2RGB网络。使用较弱的模糊处理会削弱公式(4)的特征张量<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         T
        
        
         
          d
         
         
          ′
         
        
       
      
      
       T_{d'}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.6828em"><span class="" style="margin-right: 0.0714em"><span class="pstrut" style="height: 2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>的有效性。<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
         
          
           
            
             T
            
            
             
              a
             
             
              t
             
             
              t
             
             
              e
             
             
              n
             
            
           
           
            =
           
           
            
             T
            
            
             
              d
             
             
              ′
             
            
           
           
            +
           
           
            (
           
           
            
             T
            
            
             
              d
             
             
              ′
             
            
           
           
            ⊗
           
           
            
             T
            
            
             
              c
             
             
              o
             
             
              l
             
             
              o
             
             
              r
             
            
           
           
            )
           
          
         
         
         
          
           (6)
          
         
        
       
       
        T_{atten}=T_{d'}+(T_{d'}otimes T_{color})tag{6}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.6828em"><span class="" style="margin-right: 0.0714em"><span class="pstrut" style="height: 2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.6828em"><span class="" style="margin-right: 0.0714em"><span class="pstrut" style="height: 2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">⊗</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight" style="margin-right: 0.0197em">l</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em">or</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">6</span></span><span class="mord">)</span></span></span></span></span></span></span></p> 
<p>  公式（6）中的<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        ⊗
       
      
      
       otimes
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6667em;vertical-align: -0.0833em"></span><span class="mord">⊗</span></span></span></span></span>是哈达玛积（Hadamard product），即点乘。然后再通过一个RRG模块，一个卷积层<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         M
        
        
         4
        
       
      
      
       M_4
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>，一个上采样层<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         M
        
        
         
          u
         
         
          p
         
        
       
      
      
       M_{up}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9694em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span></span></span></span></span>将颜色注意力单元输出的特征<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         T
        
        
         
          a
         
         
          t
         
         
          t
         
         
          e
         
         
          n
         
        
       
      
      
       T_{atten}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>转换为最后的sRGB图像<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         
          I
         
         
          ^
         
        
        
         
          r
         
         
          g
         
         
          b
         
        
       
      
      
       hat{I}_{rgb}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.2329em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span></span></span></span></span>。<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
          
           I
          
          
           ^
          
         
         
          
           r
          
          
           g
          
          
           b
          
         
        
        
         =
        
        
         
          M
         
         
          
           u
          
          
           p
          
         
        
        
         (
        
        
         
          M
         
         
          5
         
        
        
         (
        
        
         R
        
        
         R
        
        
         
          G
         
         
          K
         
        
        
         (
        
        
         
          T
         
         
          
           a
          
          
           t
          
          
           t
          
          
           e
          
          
           n
          
         
        
        
         )
        
        
         )
        
        
         )
        
       
       
        hat{I}_{rgb}=M_{up}(M_5(RRG_K(T_{atten})))
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.2329em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0077em">RR</span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0715em">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">)))</span></span></span></span></span></span></p> 
<p>  为优化RAW2RGB网络，使用<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         L
        
        
         1
        
       
      
      
       L_1
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>损失进行优化。<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
          L
         
         
          
           r
          
          
           →
          
          
           s
          
         
        
        
         (
        
        
         
          
           I
          
          
           ^
          
         
         
          
           r
          
          
           g
          
          
           b
          
         
        
        
         ,
        
        
         
          I
         
         
          
           r
          
          
           g
          
          
           b
          
         
        
        
         )
        
        
         =
        
        
         ∥
        
        
         
          
           I
          
          
           ^
          
         
         
          
           r
          
          
           g
          
          
           b
          
         
        
        
         −
        
        
         
          I
         
         
          
           r
          
          
           g
          
          
           b
          
         
        
        
         
          ∥
         
         
          1
         
        
       
       
        mathcal{L}_{rrightarrow s}(hat{I}_{rgb},I_{rgb})=|hat{I}_{rgb}-I_{rgb}|_1
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.2329em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathcal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mrel mtight">→</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1.2329em;vertical-align: -0.2861em"></span><span class="mord">∥</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span></span></p> 
<h4>
<a id="RRG_69"></a>RRG：循环残差组</h4> 
<p>  RRG模块如下图3所示：RRG包含<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        P
       
      
      
       P
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em"></span><span class="mord mathnormal" style="margin-right: 0.1389em">P</span></span></span></span></span>个双重注意块（DAB），每个DAB的目标是抑制不太重要的特性，只允许传播更有信息的特性。DAB通过使用两种注意机制：（1）通道级注意（CA）和（2）空间级注意（SA）进行特征的再校准。<br> <img src="https://images2.imgbox.com/b3/d2/zaTEX0Za_o.png" alt="在这里插入图片描述"></p> 
<p>  上面管道可以通过如下公式(9)表示：其中<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        U
       
       
        ∈
       
       
        
         R
        
        
         
          H
         
         
          ∗
         
         
          W
         
         
          ∗
         
         
          C
         
        
       
      
      
       Uin mathbb{R}^{H*W*C}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7224em;vertical-align: -0.0391em"></span><span class="mord mathnormal" style="margin-right: 0.109em">U</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.8413em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.0715em">C</span></span></span></span></span></span></span></span></span></span></span></span></span>表示着输入tensor <span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         T
        
        
         
          i
         
         
          n
         
        
       
       
        ∈
       
       
        
         R
        
        
         
          H
         
         
          ∗
         
         
          W
         
         
          ∗
         
         
          C
         
        
       
      
      
       T_{in}in mathbb{R}^{H*W*C}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.8413em"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em">H</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.1389em">W</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight" style="margin-right: 0.0715em">C</span></span></span></span></span></span></span></span></span></span></span></span></span>通过DAB前端的两层卷积层得到的特征图。而<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         M
        
        
         c
        
       
      
      
       M_c
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>是经过最后一个卷积核大小为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        1
       
       
        ∗
       
       
        1
       
      
      
       1*1
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1</span></span></span></span></span>的卷积层。 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
         
          
           
            
             T
            
            
             
              D
             
             
              A
             
             
              B
             
            
           
           
            =
           
           
            
             T
            
            
             
              i
             
             
              n
             
            
           
           
            +
           
           
            
             M
            
            
             c
            
           
           
            (
           
           
            [
           
           
            C
           
           
            A
           
           
            (
           
           
            U
           
           
            )
           
           
            ,
           
           
            S
           
           
            A
           
           
            (
           
           
            U
           
           
            )
           
           
            ]
           
           
            )
           
          
         
         
         
          
           (9)
          
         
        
       
       
        T_{DAB}=T_{in}+M_c([CA(U), SA(U)])tag{9}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">D</span><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right: 0.0502em">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.109em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">([</span><span class="mord mathnormal" style="margin-right: 0.0715em">C</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.109em">U</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord mathnormal" style="margin-right: 0.0576em">S</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.109em">U</span><span class="mclose">)])</span></span><span class="tag"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">9</span></span><span class="mord">)</span></span></span></span></span></span></span></p> 
<h4>
<a id="CycleISP_75"></a>CycleISP的联合训练</h4> 
<p>  在RGB2RAW网络和RAW2RGB网络单独训练后，进行联合训练，即将RGB2RAW的输出变成RAW2RGB的输入。联合优化的损失函数如下公式所示，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        β
       
      
      
       beta
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em;vertical-align: -0.1944em"></span><span class="mord mathnormal" style="margin-right: 0.0528em">β</span></span></span></span></span>是一个正常量：<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
          L
         
         
          
           j
          
          
           o
          
          
           i
          
          
           n
          
          
           t
          
         
        
        
         =
        
        
         β
        
        
         
          L
         
         
          
           s
          
          
           →
          
          
           r
          
         
        
        
         (
        
        
         
          
           I
          
          
           ^
          
         
         
          
           r
          
          
           a
          
          
           w
          
         
        
        
         ,
        
        
         
          I
         
         
          
           r
          
          
           a
          
          
           w
          
         
        
        
         +
        
        
         (
        
        
         1
        
        
         −
        
        
         β
        
        
         )
        
        
         
          L
         
         
          
           r
          
          
           →
          
          
           s
          
         
        
        
         (
        
        
         
          
           I
          
          
           ^
          
         
         
          
           r
          
          
           g
          
          
           b
          
         
        
        
         ,
        
        
         
          I
         
         
          
           r
          
          
           g
          
          
           b
          
         
        
        
         )
        
        
         )
        
       
       
        mathcal{L}_{joint}=betamathcal{L}_{srightarrow r}(hat{I}_{raw}, I_{raw} + (1-beta)mathcal{L}_{rrightarrow s}(hat{I}_{rgb}, I_{rgb}))
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9694em;vertical-align: -0.2861em"></span><span class="mord"><span class="mord mathcal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0572em">j</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1.1968em;vertical-align: -0.25em"></span><span class="mord mathnormal" style="margin-right: 0.0528em">β</span><span class="mord"><span class="mord mathcal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mrel mtight">→</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1.2329em;vertical-align: -0.2861em"></span><span class="mord mathnormal" style="margin-right: 0.0528em">β</span><span class="mclose">)</span><span class="mord"><span class="mord mathcal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mrel mtight">→</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0785em">I</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">g</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mclose">))</span></span></span></span></span></span></p> 
<h2>
<a id="_78"></a>合成真实噪声数据生成</h2> 
<h4>
<a id="RAW_79"></a>RAW去噪数据</h4> 
<p>  CycleISP方法的RGB2RAW网络分支使用干净的sRGB图像作为输入，并将其转换为干净的RAW图像。就像下图的顶部分支。在训练CycleISP时，原本为“OFF”状态的噪声注入模块就需要变成“ON”状态。<font color="00bbff">噪声注入模块在RGB2RAW网络的输出中添加不同级别的射频噪声和读噪声（shot and read noise）</font>。作者使用和[7]中相同的程序来采样射频/读取（shot/read）噪声因子。因此，我们可以从任何sRGB图像生成干净及其对应的图像对<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        {
       
       
        R
       
       
        A
       
       
        
         W
        
        
         
          c
         
         
          l
         
         
          e
         
         
          a
         
         
          n
         
        
       
       
        ，
       
       
        R
       
       
        A
       
       
        
         W
        
        
         
          n
         
         
          o
         
         
          i
         
         
          s
         
         
          e
         
        
       
       
        }
       
      
      
       {RAW_{clean}，RAW_{noise}}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mopen">{<!-- --></span><span class="mord mathnormal" style="margin-right: 0.0077em">R</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.0197em">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">an</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right: 0.0077em">R</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">se</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>。<br> <img src="https://images2.imgbox.com/71/f2/1AzQE5IN_o.png" alt="在这里插入图片描述"></p> 
<h4>
<a id="sRGB_82"></a>sRGB去噪数据</h4> 
<p>  给定合成的RAW噪声数据作为输入，RAW2RGB网络将其映射到一个噪声的sRGB图像（上图的底部分支）。因此，我们能够为sRGB去噪问题生成一个图像对<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        {
       
       
        s
       
       
        R
       
       
        G
       
       
        
         B
        
        
         
          c
         
         
          l
         
         
          e
         
         
          a
         
         
          r
         
        
       
       
        ，
       
       
        s
       
       
        R
       
       
        G
       
       
        
         B
        
        
         
          n
         
         
          o
         
         
          i
         
         
          s
         
         
          e
         
        
       
       
        }
       
      
      
       {sRGB_{clear}，sRGB_{noise}}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mopen">{<!-- --></span><span class="mord mathnormal">s</span><span class="mord mathnormal">RG</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0502em">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.0502em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.0197em">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">，</span><span class="mord mathnormal">s</span><span class="mord mathnormal">RG</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0502em">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.0502em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">se</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>。</p> 
<p>  虽然这些合成图像对已经足以训练去噪网络，但我们可以通过以下步骤进一步提高质量。使用真实相机捕获的SIDD数据集[1]对CycleISP模型进行微调。对于每个静态场景，SIDD在RAW和sRGB空间中都包含干净和有噪声的图像对。微调过程如下图4所示。注意，添加随机噪声的噪声注入模块被（仅用于微调）逐像素噪声残留（<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        n
       
       
        o
       
       
        i
       
       
        s
       
       
        e
       
       
        =
       
       
        R
       
       
        A
       
       
        
         W
        
        
         
          n
         
         
          o
         
         
          i
         
         
          s
         
         
          y
         
        
       
       
        −
       
       
        R
       
       
        A
       
       
        
         W
        
        
         
          c
         
         
          l
         
         
          e
         
         
          a
         
         
          n
         
        
       
      
      
       noise=RAW_{noisy}-RAW_{clean}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6595em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">i</span><span class="mord mathnormal">se</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.9694em;vertical-align: -0.2861em"></span><span class="mord mathnormal" style="margin-right: 0.0077em">R</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">sy</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord mathnormal" style="margin-right: 0.0077em">R</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.0197em">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">an</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>）所代替，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        R
       
       
        A
       
       
        
         W
        
        
         
          n
         
         
          o
         
         
          i
         
         
          s
         
         
          y
         
        
       
      
      
       RAW_{noisy}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9694em;vertical-align: -0.2861em"></span><span class="mord mathnormal" style="margin-right: 0.0077em">R</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em">sy</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        R
       
       
        A
       
       
        
         W
        
        
         
          c
         
         
          l
         
         
          e
         
         
          a
         
         
          n
         
        
       
      
      
       RAW_{clean}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord mathnormal" style="margin-right: 0.0077em">R</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: -0.1389em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right: 0.0197em">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">an</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span></span></span></span></span>的都是真实图像获得的。<font color="00bbff">一旦微调过程完成，我们可以通过给CycleISP模型提供干净的sRGB图像来合成真实的噪声图像</font>。<br> <img src="https://images2.imgbox.com/b6/27/TF5apHfO_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="_88"></a>去噪框架</h2> 
<p>  如下图5所示，作者提出了一个使用多个RRG的图像去噪网络，并将所提出的下面这个网络用语两组不同设置中：（1）RAW图像去噪；（2）sRGB图像去噪。在这两种设置下，使用相同的网络结构，唯一的区别在于输入和输出的处理。<b>对于sRGB空间的去噪，网络的输入和输出是3通道的sRGB图像。对于RAW图像去噪，网络将4通道噪声填充图像与一个4通道噪声级别图连接作为输入，提供的是一个4通道压缩去噪输出。</b>（For denoising the RAW images, our network takes as input a 4-channel noisy packed image concatenated with a <b>4-channel noise level map</b>, and provides us with a 4-channel packed denoised output.）。<b>噪声级别图提供了输入图像中存在的噪声的标准偏差的估计，基于其拍摄和读取噪声参数[7]。</b><br> <img src="https://images2.imgbox.com/ec/57/fzetdSRT_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="_92"></a>论文实验</h2> 
<h4>
<a id="_93"></a>真实图像数据集</h4> 
<p>  <b>DND</b>数据集，是由4款消费级相机捕获的50个去噪图像对。由于原图是超高分辨率的，所以提供者为每张图片提供了<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        20
       
      
      
       20
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">20</span></span></span></span></span> 个 <span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        512
       
       
        ∗
       
       
        512
       
      
      
       512*512
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">512</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">512</span></span></span></span></span>的切片（crop），所以一共有<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        20
       
       
        ∗
       
       
        50
       
       
        =
       
       
        1000
       
      
      
       20*50=1000
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">20</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">50</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1000</span></span></span></span></span>个patches。由于ground-truth的无噪声图片没有公开，所以这个数据集通常用于测试。测试途径是在线服务可以计算得到PSNR和SSIM，RAW空间和sRGB空间均可。</p> 
<p>  <b>SIDD</b>数据集。由于小的sensor size和高分辨率，相比较于那些DSLRs，智能手机图像要有更多的噪声。这个数据集用五个智能手机相机手机而成。SIDD有320个图片对可以用于训练，1280个图片对可以用于验证。该数据集也提供了RAW空间和sRGB空间图像。</p> 
<h4>
<a id="_98"></a>实现细节</h4> 
<p>  使用Adam优化器，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         β
        
        
         1
        
       
       
        =
       
       
        0.9
       
      
      
       beta_1=0.9
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em;vertical-align: -0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.0528em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">0.9</span></span></span></span></span>，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         β
        
        
         2
        
       
       
        =
       
       
        0.999
       
      
      
       beta_2=0.999
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em;vertical-align: -0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em"><span class="" style="margin-left: -0.0528em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">0.999</span></span></span></span></span>，patchSize为128。使用拜耳统一（Bayer unification）和增强技术（水平翻转和垂直翻转）。DAB除了最后一个卷积层为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        1
       
       
        ∗
       
       
        1
       
      
      
       1*1
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1</span></span></span></span></span>，其他的卷积层均为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        3
       
       
        ∗
       
       
        3
       
      
      
       3*3
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">3</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">3</span></span></span></span></span>。</p> 
<h5>
<a id="CycleISP_101"></a>CycleISP的初始训练</h5> 
<p>  用MIT-Adobe FiveK数据集训练CycleISP模型。MIT-Adobe FiveK有<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        5000
       
      
      
       5000
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">5000</span></span></span></span></span>张RAW图像。作者使用LibRaw 库处理RAW图像，生成sRGB图像。拆分4850张图像用于训练，150张图像用于验证。<br>   RGB2RAW网络和RAW2RGB网络均使用<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        3
       
      
      
       3
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">3</span></span></span></span></span>个RRGs和<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        5
       
      
      
       5
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">5</span></span></span></span></span>个DABs构建，使用<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        2
       
      
      
       2
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">2</span></span></span></span></span>个RRGs和<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        3
       
      
      
       3
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">3</span></span></span></span></span>个DABs用于颜色校正网络。CycleISP的RGB2RAW和RAW2RGB分支都独立训练<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        1200
       
      
      
       1200
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1200</span></span></span></span></span>个epochs。batch size为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        4
       
      
      
       4
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">4</span></span></span></span></span>，初始学习率为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        1
       
       
        
         0
        
        
         
          −
         
         
          4
         
        
       
      
      
       10^{-4}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8141em"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span></span>，在<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        800
       
      
      
       800
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">800</span></span></span></span></span>个epoch后降到<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        1
       
       
        
         0
        
        
         
          −
         
         
          5
         
        
       
      
      
       10^{-5}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8141em"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></span></span>。</p> 
<h5>
<a id="CycleISP_Finetuning_105"></a>CycleISP Fine-tuning</h5> 
<p>  先用无噪声图像对CycleISP进行finetune，然后使用合成的噪声图像再次进行finetune。在前者中，CycleISP模型的输出是无噪声的；在后者中，输出是有噪声的。对于每个fine-tuning阶段，训练<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        600
       
      
      
       600
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">600</span></span></span></span></span>个epochs，batchSize设为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        1
       
      
      
       1
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1</span></span></span></span></span>，学习率为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        1
       
       
        
         0
        
        
         
          −
         
         
          5
         
        
       
      
      
       10^{-5}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8141em"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></span></span>。</p> 
<h5>
<a id="_108"></a>去噪网络的训练</h5> 
<p>  在四个训练集中，分别训练了四个网络，数据集分别为：（1）DND RAW 数据；（2）DND sRGB图像；（3）SIDD RAW 数据；（4）SIDD sRGB图像。四个网络，都使用<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        4
       
      
      
       4
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">4</span></span></span></span></span>个RRGs和<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        8
       
      
      
       8
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">8</span></span></span></span></span>个DABs，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        65
       
      
      
       65
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">65</span></span></span></span></span>个epoch，batchSize为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        16
       
      
      
       16
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">16</span></span></span></span></span>，初始学习率为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        1
       
       
        
         0
        
        
         
          −
         
         
          4
         
        
       
      
      
       10^{-4}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8141em"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span></span>，每<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        25
       
      
      
       25
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">25</span></span></span></span></span>个epoch学习率衰减<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        10
       
      
      
       10
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">10</span></span></span></span></span>倍。</p> 
<p>  从MIR flickr扩展数据集（MIR flickr extended dataset）去了<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        1000000
       
      
      
       1000000
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1000000</span></span></span></span></span>张图像，依据<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        90
       
       
        :
       
       
        5
       
       
        :
       
       
        5
       
      
      
       90:5:5
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">90</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">5</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">5</span></span></span></span></span>的比例划分用于训练、验证和测试。所有图像都使用标准差<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        σ
       
       
        =
       
       
        1
       
      
      
       sigma=1
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em"></span><span class="mord mathnormal" style="margin-right: 0.0359em">σ</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1</span></span></span></span></span>的高斯核进行预处理，以减少噪声和其他伪影的影响。然后使用前面得到干净/噪声图像对的方式获得数据用于训练。</p> 
<h4>
<a id="RAW_113"></a>RAW去噪结果</h4> 
<p>  下表展示了所有竞争方法在评估服务器[16]网站上获得的<b>DND数据集的量化结果</b>（PSNR/SSIM）。下表中有两个指标，RAW是在RAW空间去噪后的对比结果，sRGB列是服务器使用图像元数据将去噪后的RAW图像通过摄像机成像管道传递后提供的。本文模型的参数比之前最好的方法[7]（2019.）要少5倍的参数。<br> <img src="https://images2.imgbox.com/49/b0/X8iT9i7O_o.png" alt="在这里插入图片描述"></p> 
<p>  下表是在<b>SIDD数据集上RAW空间</b>的去噪结果，表现和DND趋势基本一致。<br> <img src="https://images2.imgbox.com/94/cc/l6FOEnKF_o.png" alt="在这里插入图片描述"></p> 
<p>  下图是当时最先进网络的视觉对比效果。本文模型能有效地去除真实噪声，特别是低频色度噪声和缺陷像素噪声。<br> <img src="https://images2.imgbox.com/e1/80/aR7royov_o.jpg" alt="在这里插入图片描述"></p> 
<h4>
<a id="sRGB_123"></a>sRGB去噪结果</h4> 
<p>  虽然<b>建议对RAW数据(其中噪声不相关且不太复杂)[26]应用去噪</b>，但去噪通常在sRGB域进行研究。下面两表展示了在<b>DND和SIDD数据集上sRGB图像的去噪结果</b>。<br> <img src="https://images2.imgbox.com/9b/e3/5Lf38VjL_o.png" alt="在这里插入图片描述"></p> 
<p>  下面两图是在DND和SIDD上sRGB去噪的结果。<font color="00bbff">为了去除噪声，大多数评估算法要么产生过平滑的图像(并牺牲图像细节)，要么生成带有斑点纹理和色度伪影的图像。相比之下，<b>本文的方法生成干净和无伪影的结果，同时忠实地保存图像细节</b>。</font><br> <img src="https://images2.imgbox.com/f5/e0/Amt65CNv_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0a/e8/nP0tzbxY_o.png" alt="在这里插入图片描述"></p> 
<p>  为了比较<b>用我们的方法生成的合成数据训练</b>的去噪模型与[7]的<b>去噪模型的泛化能力</b>，作者进行了以下实验。作者采用(公开的)为DND训练的[7]去噪模型，并直接在SIDD数据集的RAW图像上评估它。作者对去噪模型也重复相同的过程。为了公平的比较，作者使用与[7]相同的网络架构(U-Net)和噪声模型。<b>唯一的区别是从sRGB到RAW的数据转换</b>。表5的结果表明<b>用本文的方法训练的去噪网络不仅在DND数据集上表现良好，而且对SIDD集也有很好的泛化效果(相较于[7]而言，增益大约 <span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         1
        
       
       
        1
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">1</span></span></span></span></span> dB)。</b><br> <img src="https://images2.imgbox.com/04/8e/h7vdyUfy_o.png" alt="在这里插入图片描述"></p> 
<h4>
<a id="_134"></a>消融学习</h4> 
<p>  从小表可以看出，短的skip connections是最重要的一部分，其次是颜色校正分支。<br> <img src="https://images2.imgbox.com/f7/d7/qkt0qk7P_o.png" alt="在这里插入图片描述"></p> 
<h3>
<a id="_137"></a>立体电影的色彩匹配</h3> 
<p>  <br> <img src="https://images2.imgbox.com/e3/2b/9UT1FGxK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/50/a0/jx97gC1I_o.png" alt="在这里插入图片描述"></p> 
<p>  </p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
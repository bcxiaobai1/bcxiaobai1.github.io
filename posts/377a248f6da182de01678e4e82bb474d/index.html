<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Redis大总结，要言不烦，字字珠玑 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis大总结，要言不烦，字字珠玑</h1>
			
		</header>
		<div class="content post__content clearfix">
			


        
                <div id="content_views" class="markdown_views prism-github-gist">
                    
                        
                    
                    <blockquote> 
 <p>??????<br> 哈喽！大家好，我是【IT邦德】，江湖人称jeames007，10年DBA工作经验<br> 一位上进心十足的【大数据领域博主】！???<br> 中国DBA联盟(ACDU)成员，目前从事DBA及程序编程<br> 擅长主流数据Oracle、MySQL、PG 运维开发，备份恢复，安装迁移，性能优化、故障应急处理等。<br> ✨ 如果有对【数据库】感兴趣的【小可爱】，欢迎关注【IT邦德】???<br> ❤️❤️❤️感谢各位大可爱小可爱！❤️❤️❤️</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h3>文章目录</h3> 
 <ul><li>
<ul>
<li><a href="#_Redis_10">? 一、Redis配置</a></li>
<li>
<ul>
<li><a href="#_11_redis_11">? 1.1 搭redis环境</a></li>
<li><a href="#_12__64">? 1.2 常用命令</a></li>
</ul> 
   </li>
<li><a href="#__redis_66">? 二、redis的数据类型</a></li>
<li>
<ul>
<li><a href="#_21_String_67">? 2.1 String</a></li>
<li><a href="#_22_List_100">? 2.2 List</a></li>
<li><a href="#__23_Set_158">? 2.3 Set</a></li>
<li><a href="#__24_Hash_228">? 2.4 Hash（哈希）</a></li>
<li><a href="#__25_Zset_278">? 2.5 Zset（有序集合）</a></li>
<li><a href="#_26_geospatital_331">? 2.6 geospatital（地理位置）</a></li>
<li><a href="#_27_Hyperloglog_359">? 2.7 Hyperloglog</a></li>
<li><a href="#_28_Bitmap_376">? 2.8 Bitmap(位储存)</a></li>
</ul> 
   </li>
<li><a href="#__396">? 三、事务</a></li>
<li><a href="#_Jedis_429">? 四、Jedis</a></li>
<li>
<ul>
<li><a href="#_41_String_484">? 4.1 String</a></li>
<li><a href="#__42_List_528">? 4.2 List</a></li>
<li><a href="#_43_Set_567">? 4.3 Set</a></li>
<li><a href="#_44_Hash_613">? 4.4 Hash</a></li>
</ul> 
   </li>
<li><a href="#_SpringBoot_648">? 五、SpringBoot整合</a></li>
<li>
<ul>
<li><a href="#_51__649">? 5.1 源码分析</a></li>
<li><a href="#_52_RedisConfig_717">? 5.2 RedisConfig</a></li>
<li><a href="#_53_RedisUtil_753">? 5.3 RedisUtil</a></li>
</ul> 
   </li>
<li><a href="#_redisconf_1246">? 六、redis.conf详解</a></li>
<li><a href="#_Redis_1365">? 七、Redis持久化</a></li>
<li>
<ul>
<li><a href="#_71_RDB_1366">? 7.1 RDB</a></li>
<li><a href="#_72_AOFAppend_Only_File_1401">? 7.2 AOF(Append Only File)</a></li>
</ul> 
   </li>
<li><a href="#__1421">? 八、发布和订阅消息</a></li>
<li><a href="#__1446">? 九、主从复制</a></li>
<li>
<ul>
<li><a href="#_91__1447">? 9.1 主从复制</a></li>
<li><a href="#_92__1527">? 9.2 哨兵模式</a></li>
</ul> 
   </li>
<li><a href="#_Redis_1669">? 十、Redis缓存穿透和雪崩</a></li>
<li>
<ul>
<li><a href="#_101__1673">? 10.1 缓存穿透(查不到)</a></li>
<li><a href="#_102__1691">? 10.2 缓存击穿(量太大)</a></li>
<li><a href="#_103__1699">? 10.3 缓存雪崩</a></li>
</ul> 
   </li>
<li><a href="#_redis__1720">? 十一、redis 在项目中的应用</a></li>
<li>
<ul>
<li><a href="#__111_redis_1722">? 11.1 redis缓存注解</a></li>
<li><a href="#_112__1742">? 11.2 环境配置</a></li>
<li><a href="#_113_banner_1814">? 11.3 banner接口改造</a></li>
</ul> 
  </li>
</ul> 
 </li></ul> 
</div> 
<p></p> 
<h2>
<a id="_Redis_10"></a>? 一、Redis配置</h2> 
<h3>
<a id="_11_redis_11"></a>? 1.1 搭redis环境</h3> 
<blockquote> 
 <p>#解压tar包 /opt<br> tar -zxvf redis-5.0.7.tar.gz<br> #基本环境搭建，gcc是Gnu的C语言编译bai器<br> yum install gcc-c++<br> make<br> make install<br> #默认安装路径 /usr/local/bin<br> #创建配置文件地址 /usr/local/bin/qconfig<br> #拷贝配置文件<br> cp /opt/redis-5.0.7/redis.conf qconfig<br> #修改为后台启用，修改配置文件<br> daemonize yes</p> 
</blockquote> 
<p>??? 启动redis</p> 
<pre><code class="prism language-bash"><span class="token comment">#进入启动目录</span>
<span class="token builtin class-name">cd</span> /usr/local/bin
<span class="token comment">#启动server</span>
redis-server qconfig/redis.conf
<span class="token comment">#启动cli</span>
redis-cli -p <span class="token number">6379</span>
<span class="token comment">#查看和设置redis密码</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config get requirepass
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"requirepass"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">""</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config <span class="token builtin class-name">set</span> requirepass <span class="token string">"1234"</span>
OK
<span class="token comment">#登录redis</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> auth <span class="token number">1234</span>
OK
<span class="token comment">#查看redis是否启动，另起一个窗口</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> redis
<span class="token comment">#关闭redis服务</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">shutdown</span>
not connected<span class="token operator">&gt;</span> <span class="token builtin class-name">exit</span>
<span class="token comment">#再次查看redis是否启动</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> redis

<span class="token comment">#切换数据库，默认为0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token keyword">select</span> <span class="token number">3</span>
OK
<span class="token comment">#查看数据库大小</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> dbsize
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token comment">#清除当前数据库</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> flushdb
OK
<span class="token comment">#清除所有数据库</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> flushall
OK
</code></pre> 
<h3>
<a id="_12__64"></a>? 1.2 常用命令</h3> 
<p><img src="https://images2.imgbox.com/2e/ee/zYGd4OH2_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="__redis_66"></a>? 二、redis的数据类型</h2> 
<h3>
<a id="_21_String_67"></a>? 2.1 String</h3> 
<blockquote> 
 <p>#追加字符串，没有的话就新建<br> append name “wangqin”<br> #字符串长度<br> strlen name<br> #i++<br> set count 0<br> incr count<br> #i–<br> decr count<br> #指定增量 count = count + 10<br> incrby count 10<br> #指定减量 count = count - 10<br> decrby count 10<br> #截取字符串 wangqin<br> getrange key 0 3<br> “wang”<br> #替换<br> setrange key 1 qq<br> “wqqgqin”<br> #设置过期时间<br> setex key 30 “hello”<br> #不存在再设置，往往在分布式中使用,如果key1不存在就创建，存在就创建失败<br> setnx key1 “redis”<br> #批量设置<br> mset k1 v1 k2 v2 k3 v3<br> #批量获取<br> mget k1 k2<br> #要么一起成功，要么一起失败，保持原子性<br> msetnx k1 v1 k2 v2<br> #先获取在写入，不存在值为nil，存在的话获取原来的值在设置新的值<br> getset</p> 
</blockquote> 
<h3>
<a id="_22_List_100"></a>? 2.2 List</h3> 
<pre><code class="prism language-bash"><span class="token comment">#将一个值或者多个值插入list的头部</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lpush list one
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lpush list two
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lpush list three
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token comment">#查看list，头-&gt;尾</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrange list <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrange list <span class="token number">0</span> <span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> rpush list right
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token comment">#将一个值或者多个值插入list的尾部</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrange list <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"right"</span>
<span class="token comment">#移除list第一个元素</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lpop list
<span class="token string">"three"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrange list <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"right"</span>
<span class="token comment">#移除list最后一个元素</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> rpop list
<span class="token string">"right"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrange list <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token comment">#根据下标获取值</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lindex list <span class="token number">0</span>
<span class="token comment">#获取list长度</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> llen list
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrange list <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token comment">#从上至下删除一个 two</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrem list <span class="token number">1</span> two
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lrange list <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre> 
<h3>
<a id="__23_Set_158"></a>? 2.3 Set</h3> 
<pre><code class="prism language-bash"><span class="token comment">#添加Set元素</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd myset v1 v2 v3 v4
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token comment">#显示所有myset集合中的元素</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> smembers myset
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"v4"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
<span class="token comment">#查询v1是否存在myset集合中，存在就返回1，不存在就返回0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sismember myset v1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sismember myset v6
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd uset k1 k2 k3 v1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token comment">#合并集合myset和uset到集合set中，set重复的取一个就行</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sunionstore <span class="token builtin class-name">set</span> myset uset
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span>
<span class="token comment">#合并显示集合myset和uset</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sunion myset uset
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"k1"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"k3"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"v4"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"k2"</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
<span class="token comment">#set集合的长度</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> scard <span class="token builtin class-name">set</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span>
<span class="token comment">#随机删除set中的元素</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> spop <span class="token builtin class-name">set</span>
<span class="token string">"v4"</span>
<span class="token comment">#移动指定的一个值到其他的集合中set-&gt;myset</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> smove <span class="token builtin class-name">set</span> myset k1
<span class="token comment">#两个集合的差集</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> smembers <span class="token builtin class-name">set</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v3"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"k3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"k2"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> smembers myset
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"v4"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"k1"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">sdiff</span> myset <span class="token builtin class-name">set</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"k1"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"v4"</span>
<span class="token comment">#两个集合的交集</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sinter myset <span class="token builtin class-name">set</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v3"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
<span class="token comment">#两个集合的并集</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sunion myset <span class="token builtin class-name">set</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"k1"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"k3"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"v4"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"k2"</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
</code></pre> 
<h3>
<a id="__24_Hash_228"></a>? 2.4 Hash（哈希）</h3> 
<pre><code class="prism language-bash"><span class="token comment">#set一个具体的 key-value</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hset myhash name wangqin
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment">#获取一个字段值</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hget myhash name
<span class="token string">"wangqin"</span>
<span class="token comment">#set一组 key-value</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hmset myhash name wangqin1 age <span class="token number">18</span>
OK
<span class="token comment">#获取一组 key-value</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hmget myhash name age
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"wangqin1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"18"</span>
<span class="token comment">#获取全部数据</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hgetall myhash
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"wangqin1"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"age"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"18"</span>
<span class="token comment">#删除指定的key</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hdel myhash name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hgetall myhash
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"age"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"18"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hmset myhash name wangqin <span class="token builtin class-name">set</span> male
OK
<span class="token comment">#获取hash表的字段数量</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hlen myhash
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token comment">#hash表中是否存在key</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hexists myhash name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hexists myhash name1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token comment">#获取hash表的key</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hkeys myhash
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"age"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"name"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"set"</span>
<span class="token comment">#获取hash表的值</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hvals myhash
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"18"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"wangqin"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"male"</span>
</code></pre> 
<h3>
<a id="__25_Zset_278"></a>? 2.5 Zset（有序集合）</h3> 
<pre><code class="prism language-bash"><span class="token comment">#添加zset元素</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zadd zset <span class="token number">1</span> one
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment">#批量添加zset元素</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zadd zset <span class="token number">2</span> two <span class="token number">3</span> three
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token comment">#获取zset中所有元素</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange zset <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token comment">#倒序查询</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrevrange zset <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zadd zset -1 -one
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zadd zset -2 -two
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment">#正序排序，从-∞到+∞</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrangebyscore zset -inf +inf
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"-two"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"-one"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrangebyscore zset -1 +inf
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"-one"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token comment">#倒序排序，从+∞到-∞</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrevrangebyscore zset +inf -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"one"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"-one"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrem zset one
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zrange zset <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"-two"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"-one"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"two"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"three"</span>
<span class="token comment">#集合的长度</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> zcard zset
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
</code></pre> 
<h3>
<a id="_26_geospatital_331"></a>? 2.6 geospatital（地理位置）</h3> 
<pre><code class="prism language-bash"><span class="token comment">#添加地理位置</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd China:city <span class="token number">116.42</span> <span class="token number">29.90</span> home
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd China:city <span class="token number">117.30</span> <span class="token number">31.79</span> hefei
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd China:city <span class="token number">120.21</span>  <span class="token number">30.20</span> hangzhou
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd China:city <span class="token number">121.48</span> <span class="token number">31.40</span> shenzhen
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd China:city <span class="token number">106.54</span> <span class="token number">29.40</span> chongqing
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment">#获取纬度和经度</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geopos China:city home
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"116.41999751329421997"</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"29.90000043079877656"</span>
<span class="token comment">#获取两地距离</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist China:city home hefei
<span class="token string">"226388.9875"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist China:city home hefei km
<span class="token string">"226.3890"</span>
<span class="token comment"># 距离115 30范围300km的地方</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadius China:city <span class="token number">115</span> <span class="token number">30</span> <span class="token number">300</span> km
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"home"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"hefei"</span>
</code></pre> 
<h3>
<a id="_27_Hyperloglog_359"></a>? 2.7 Hyperloglog</h3> 
<blockquote> 
 <p>如果可以允许容错的话可以使用Hyperloglog，0.81%的容错率<br> #创建元素<br> 127.0.0.1:6379&gt; pfadd mykey a b c d e f g<br> (integer) 1<br> #统计mykey元素的基数数量<br> 127.0.0.1:6379&gt; pfcount mykey<br> (integer) 7<br> 127.0.0.1:6379&gt; pfadd ukey q w e r t y u i o p<br> (integer) 1<br> #合并两组 mkey ukey-&gt;key，会去重<br> 127.0.0.1:6379&gt; pfmerge key mykey ukey<br> OK<br> 127.0.0.1:6379&gt; pfcount key<br> (integer) 15</p> 
</blockquote> 
<h3>
<a id="_28_Bitmap_376"></a>? 2.8 Bitmap(位储存)</h3> 
<blockquote> 
 <p>位图，只有两种状态的，操作二进制来进行记录，只有0 1两个状态<br> #添加元素<br> 127.0.0.1:6379&gt; setbit sign 0 1<br> (integer) 0<br> 127.0.0.1:6379&gt; setbit sign 1 1<br> (integer) 0<br> 127.0.0.1:6379&gt; setbit sign 2 0<br> (integer) 0<br> 127.0.0.1:6379&gt; setbit sign 3 0<br> (integer) 0<br> #查询元素<br> 127.0.0.1:6379&gt; getbit sign 3<br> (integer) 0<br> 127.0.0.1:6379&gt; getbit sign 1<br> (integer) 1<br> #统计次数<br> 127.0.0.1:6379&gt; bitcount sign<br> (integer) 3</p> 
</blockquote> 
<h2>
<a id="__396"></a>? 三、事务</h2> 
<pre><code class="prism language-bash"><span class="token comment">#开启一组事务</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k2 v2
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k2
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k3 v3
QUEUED
<span class="token comment">#执行事务</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> OK
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
<span class="token number">4</span><span class="token punctuation">)</span> OK
<span class="token comment">#放弃事务</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k4 v4
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k5 v5
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> discard
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get v4
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre> 
<h2>
<a id="_Jedis_429"></a>? 四、Jedis</h2> 
<p>??? 导入依赖</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span>-- https://mvnrepository.com/artifact/redis.clients/jedis --<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>redis.clients<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>jedis<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">3.2</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/version<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com.alibaba<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>fastjson<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.2</span>.5<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/version<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/dependencies<span class="token operator">&gt;</span>
</code></pre> 
<p>???测试连接</p> 
<pre><code class="prism language-bash">public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  Jedis jedis <span class="token operator">=</span> new Jedis<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span>, <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  System.out.println<span class="token punctuation">(</span><span class="token string">"连接成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  //查看服务是否运行
  System.out.println<span class="token punctuation">(</span><span class="token string">"服务正在运行: "</span>+ jedis.ping<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>???Jedis的API</p> 
<pre><code class="prism language-bash">Jedis jedis <span class="token operator">=</span> new Jedis<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span>, <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"清空数据："</span>+jedis.flushDB<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"判断某个键是否存在："</span>+jedis.exists<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"新增&lt;'username','wangqin'&gt;的键值对："</span>+jedis.set<span class="token punctuation">(</span><span class="token string">"username"</span>,
<span class="token string">"wangqin"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>

System.out.println<span class="token punctuation">(</span><span class="token string">"新增&lt;'password','password'&gt;的键值对："</span>+jedis.set<span class="token punctuation">(</span><span class="token string">"password"</span>,
<span class="token string">"password"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.print<span class="token punctuation">(</span><span class="token string">"系统中所有的键如下："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Set<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> keys <span class="token operator">=</span> jedis.keys<span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"删除键password:"</span>+jedis.del<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"判断键password是否存在："</span>+jedis.exists<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"查看键username所存储的值的类型："</span>+jedis.type<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"随机返回key空间的一个："</span>+jedis.randomKey<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"重命名key："</span>+jedis.rename<span class="token punctuation">(</span><span class="token string">"username"</span>,<span class="token string">"name"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"取出改后的name："</span>+jedis.get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"按索引查询："</span>+jedis.select<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"删除当前选择数据库中的所有key："</span>+jedis.flushDB<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"返回当前数据库中key的数目："</span>+jedis.dbSize<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"删除所有数据库中的所有key："</span>+jedis.flushAll<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
</code></pre> 
<h3>
<a id="_41_String_484"></a>? 4.1 String</h3> 
<pre><code class="prism language-bash">Jedis jedis <span class="token operator">=</span> new Jedis<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span>, <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.flushDB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"===========增加数据==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.set<span class="token punctuation">(</span><span class="token string">"key1"</span>,<span class="token string">"value1"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.set<span class="token punctuation">(</span><span class="token string">"key2"</span>,<span class="token string">"value2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.set<span class="token punctuation">(</span><span class="token string">"key3"</span>, <span class="token string">"value3"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"删除键key2:"</span>+jedis.del<span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"获取键key2:"</span>+jedis.get<span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"修改key1:"</span>+jedis.set<span class="token punctuation">(</span><span class="token string">"key1"</span>, <span class="token string">"value1Changed"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"获取key1的值："</span>+jedis.get<span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"在key3后面加入值："</span>+jedis.append<span class="token punctuation">(</span><span class="token string">"key3"</span>, <span class="token string">"End"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"key3的值："</span>+jedis.get<span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"增加多个键值
对："</span>+jedis.mset<span class="token punctuation">(</span><span class="token string">"key01"</span>,<span class="token string">"value01"</span>,<span class="token string">"key02"</span>,<span class="token string">"value02"</span>,<span class="token string">"key03"</span>,<span class="token string">"value03"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"获取多个键值对："</span>+jedis.mget<span class="token punctuation">(</span><span class="token string">"key01"</span>,<span class="token string">"key02"</span>,<span class="token string">"key03"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"获取多个键值对："</span>+jedis.mget<span class="token punctuation">(</span><span class="token string">"key01"</span>,<span class="token string">"key02"</span>,<span class="token string">"key03"</span>,<span class="token string">"key04"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"删除多个键值对："</span>+jedis.del<span class="token punctuation">(</span><span class="token string">"key01"</span>,<span class="token string">"key02"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"获取多个键值对："</span>+jedis.mget<span class="token punctuation">(</span><span class="token string">"key01"</span>,<span class="token string">"key02"</span>,<span class="token string">"key03"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
jedis.flushDB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"===========新增键值对防止覆盖原先值=============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.setnx<span class="token punctuation">(</span><span class="token string">"key1"</span>, <span class="token string">"value1"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.setnx<span class="token punctuation">(</span><span class="token string">"key2"</span>, <span class="token string">"value2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.setnx<span class="token punctuation">(</span><span class="token string">"key2"</span>, <span class="token string">"value2-new"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.get<span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.get<span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"===========新增键值对并设置有效时间============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.setex<span class="token punctuation">(</span><span class="token string">"key3"</span>, <span class="token number">2</span>, <span class="token string">"value3"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.get<span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
try <span class="token punctuation">{<!-- --></span>
  TimeUnit.<span class="token environment constant">SECONDS</span>.sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> catch <span class="token punctuation">(</span>InterruptedException e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
System.out.println<span class="token punctuation">(</span>jedis.get<span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"===========获取原值，更新为新值=========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

System.out.println<span class="token punctuation">(</span>jedis.getSet<span class="token punctuation">(</span><span class="token string">"key2"</span>, <span class="token string">"key2GetSet"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.get<span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"获得key2的值的字串："</span>+jedis.getrange<span class="token punctuation">(</span><span class="token string">"key2"</span>, <span class="token number">2</span>, <span class="token number">4</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
</code></pre> 
<h3>
<a id="__42_List_528"></a>? 4.2 List</h3> 
<pre><code class="prism language-bash">Jedis jedis <span class="token operator">=</span> new Jedis<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span>, <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.flushDB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"===========添加一个list==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.lpush<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token string">"ArrayList"</span>, <span class="token string">"Vector"</span>, <span class="token string">"Stack"</span>, <span class="token string">"HashMap"</span>,
<span class="token string">"WeakHashMap"</span>, <span class="token string">"LinkedHashMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.lpush<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token string">"HashSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.lpush<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token string">"TreeSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.lpush<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token string">"TreeMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
//-1代表倒数第一个元素，-2代表倒数第二个元素,end为-1表示查询全部
System.out.println<span class="token punctuation">(</span><span class="token string">"collections的内容："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections区间0-3的元素："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"collections"</span>,0,3<span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"==============================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
// 删除列表指定的值 ，第二个参数为删除的个数（有重复时），后add进去的值先被删，类似于出栈
System.out.println<span class="token punctuation">(</span><span class="token string">"删除指定元素个数："</span>+jedis.lrem<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">2</span>, <span class="token string">"HashMap"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections的内容："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"删除下表0-3区间之外的元素："</span>+jedis.ltrim<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">0</span>, <span class="token number">3</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections的内容："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections列表出栈（左端）："</span>+jedis.lpop<span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections的内容："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections添加元素，从列表右端，与lpush相对
应："</span>+jedis.rpush<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token string">"EnumMap"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections的内容："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections列表出栈（右端）："</span>+jedis.rpop<span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections的内容："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"修改collections指定下标1的内容："</span>+jedis.lset<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">1</span>,
<span class="token string">"LinkedArrayList"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections的内容："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"==============================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"collections的长度："</span>+jedis.llen<span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"获取collections下标为2的元素："</span>+jedis.lindex<span class="token punctuation">(</span><span class="token string">"collections"</span>, <span class="token number">2</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"==============================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.lpush<span class="token punctuation">(</span><span class="token string">"sortedList"</span>, <span class="token string">"3"</span>,<span class="token string">"6"</span>,<span class="token string">"2"</span>,<span class="token string">"0"</span>,<span class="token string">"7"</span>,<span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"sortedList排序前："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"sortedList"</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.sort<span class="token punctuation">(</span><span class="token string">"sortedList"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"sortedList排序后："</span>+jedis.lrange<span class="token punctuation">(</span><span class="token string">"sortedList"</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span><span class="token punctuation">;</span>
</code></pre> 
<h3>
<a id="_43_Set_567"></a>? 4.3 Set</h3> 
<pre><code class="prism language-bash">Jedis jedis <span class="token operator">=</span> new Jedis<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span>, <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.flushDB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"============向集合中添加元素（不重复）============"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.sadd<span class="token punctuation">(</span><span class="token string">"eleSet"</span>,
<span class="token string">"e1"</span>,<span class="token string">"e2"</span>,<span class="token string">"e4"</span>,<span class="token string">"e3"</span>,<span class="token string">"e0"</span>,<span class="token string">"e8"</span>,<span class="token string">"e7"</span>,<span class="token string">"e5"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.sadd<span class="token punctuation">(</span><span class="token string">"eleSet"</span>, <span class="token string">"e6"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.sadd<span class="token punctuation">(</span><span class="token string">"eleSet"</span>, <span class="token string">"e6"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet的所有元素为："</span>+jedis.smembers<span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"删除一个元素e0："</span>+jedis.srem<span class="token punctuation">(</span><span class="token string">"eleSet"</span>, <span class="token string">"e0"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet的所有元素为："</span>+jedis.smembers<span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"删除两个元素e7和e6："</span>+jedis.srem<span class="token punctuation">(</span><span class="token string">"eleSet"</span>, <span class="token string">"e7"</span>,<span class="token string">"e6"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet的所有元素为："</span>+jedis.smembers<span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>

System.out.println<span class="token punctuation">(</span><span class="token string">"随机的移除集合中的一个元素："</span>+jedis.spop<span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"随机的移除集合中的一个元素："</span>+jedis.spop<span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet的所有元素为："</span>+jedis.smembers<span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet中包含元素的个数："</span>+jedis.scard<span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"e3是否在eleSet中："</span>+jedis.sismember<span class="token punctuation">(</span><span class="token string">"eleSet"</span>, <span class="token string">"e3"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"e1是否在eleSet中："</span>+jedis.sismember<span class="token punctuation">(</span><span class="token string">"eleSet"</span>, <span class="token string">"e1"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"e1是否在eleSet中："</span>+jedis.sismember<span class="token punctuation">(</span><span class="token string">"eleSet"</span>, <span class="token string">"e5"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"================================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.sadd<span class="token punctuation">(</span><span class="token string">"eleSet1"</span>,
<span class="token string">"e1"</span>,<span class="token string">"e2"</span>,<span class="token string">"e4"</span>,<span class="token string">"e3"</span>,<span class="token string">"e0"</span>,<span class="token string">"e8"</span>,<span class="token string">"e7"</span>,<span class="token string">"e5"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>jedis.sadd<span class="token punctuation">(</span><span class="token string">"eleSet2"</span>, <span class="token string">"e1"</span>,<span class="token string">"e2"</span>,<span class="token string">"e4"</span>,<span class="token string">"e3"</span>,<span class="token string">"e0"</span>,<span class="token string">"e8"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
//移到集合元素
System.out.println<span class="token punctuation">(</span><span class="token string">"将eleSet1中删除e1并存入eleSet3中："</span>+jedis.smove<span class="token punctuation">(</span><span class="token string">"eleSet1"</span>,
<span class="token string">"eleSet3"</span>, <span class="token string">"e1"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"将eleSet1中删除e2并存入eleSet3中："</span>+jedis.smove<span class="token punctuation">(</span><span class="token string">"eleSet1"</span>,
<span class="token string">"eleSet3"</span>, <span class="token string">"e2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet1中的元素："</span>+jedis.smembers<span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet3中的元素："</span>+jedis.smembers<span class="token punctuation">(</span><span class="token string">"eleSet3"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"============集合运算================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet1中的元素："</span>+jedis.smembers<span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet2中的元素："</span>+jedis.smembers<span class="token punctuation">(</span><span class="token string">"eleSet2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet1和eleSet2的交集:"</span>+jedis.sinter<span class="token punctuation">(</span><span class="token string">"eleSet1"</span>,<span class="token string">"eleSet2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet1和eleSet2的并集:"</span>+jedis.sunion<span class="token punctuation">(</span><span class="token string">"eleSet1"</span>,<span class="token string">"eleSet2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
//eleSet1中有，eleSet2中没有
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet1和eleSet2的差集:"</span>+jedis.sdiff<span class="token punctuation">(</span><span class="token string">"eleSet1"</span>,<span class="token string">"eleSet2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
//求交集并将交集保存到dstkey的集合
jedis.sinterstore<span class="token punctuation">(</span><span class="token string">"eleSet4"</span>,<span class="token string">"eleSet1"</span>,<span class="token string">"eleSet2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"eleSet4中的元素："</span>+jedis.smembers<span class="token punctuation">(</span><span class="token string">"eleSet4"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
</code></pre> 
<h3>
<a id="_44_Hash_613"></a>? 4.4 Hash</h3> 
<pre><code class="prism language-bash">Jedis jedis <span class="token operator">=</span> new Jedis<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span>, <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis.flushDB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Map<span class="token operator">&lt;</span>String,String<span class="token operator">&gt;</span> map <span class="token operator">=</span> new HashMap<span class="token operator">&lt;</span>String,String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map.put<span class="token punctuation">(</span><span class="token string">"key1"</span>,<span class="token string">"value1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map.put<span class="token punctuation">(</span><span class="token string">"key2"</span>,<span class="token string">"value2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map.put<span class="token punctuation">(</span><span class="token string">"key3"</span>,<span class="token string">"value3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map.put<span class="token punctuation">(</span><span class="token string">"key4"</span>,<span class="token string">"value4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
//添加名称为hash（key）的hash元素
jedis.hmset<span class="token punctuation">(</span><span class="token string">"hash"</span>,map<span class="token punctuation">)</span><span class="token punctuation">;</span>
//向名称为hash的hash中添加key为key5，value为value5元素
jedis.hset<span class="token punctuation">(</span><span class="token string">"hash"</span>, <span class="token string">"key5"</span>, <span class="token string">"value5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
//return Map<span class="token operator">&lt;</span>String,String<span class="token operator">&gt;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"散列hash的所有键值对为："</span>+jedis.hgetAll<span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
//return Set<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"散列hash的所有键为："</span>+jedis.hkeys<span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
//return List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"散列hash的所有值为："</span>+jedis.hvals<span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"将key6保存的值加上一个整数，如果key6不存在则添加
key6："</span>+jedis.hincrBy<span class="token punctuation">(</span><span class="token string">"hash"</span>, <span class="token string">"key6"</span>, <span class="token number">6</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"散列hash的所有键值对为："</span>+jedis.hgetAll<span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"将key6保存的值加上一个整数，如果key6不存在则添加
key6："</span>+jedis.hincrBy<span class="token punctuation">(</span><span class="token string">"hash"</span>, <span class="token string">"key6"</span>, <span class="token number">3</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"散列hash的所有键值对为："</span>+jedis.hgetAll<span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"删除一个或者多个键值对："</span>+jedis.hdel<span class="token punctuation">(</span><span class="token string">"hash"</span>, <span class="token string">"key2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"散列hash的所有键值对为："</span>+jedis.hgetAll<span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"散列hash中键值对的个数："</span>+jedis.hlen<span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"判断hash中是否存在key2："</span>+jedis.hexists<span class="token punctuation">(</span><span class="token string">"hash"</span>,<span class="token string">"key2"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"判断hash中是否存在key3："</span>+jedis.hexists<span class="token punctuation">(</span><span class="token string">"hash"</span>,<span class="token string">"key3"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"获取hash中的值："</span>+jedis.hmget<span class="token punctuation">(</span><span class="token string">"hash"</span>,<span class="token string">"key3"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span><span class="token string">"获取hash中的值："</span>+jedis.hmget<span class="token punctuation">(</span><span class="token string">"hash"</span>,<span class="token string">"key3"</span>,<span class="token string">"key4"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
</code></pre> 
<h2>
<a id="_SpringBoot_648"></a>? 五、SpringBoot整合</h2> 
<h3>
<a id="_51__649"></a>? 5.1 源码分析</h3> 
<pre><code class="prism language-bash">@Bean
//我们自己可以定义一个RedisTemplate来替换默认的
@ConditionalOnMissingBean<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"redisTemplate"</span><span class="token punctuation">)</span>
@ConditionalOnSingleCandidate<span class="token punctuation">(</span>RedisConnectionFactory.class<span class="token punctuation">)</span>
public RedisTemplate<span class="token operator">&lt;</span>Object, Object<span class="token operator">&gt;</span> redisTemplate<span class="token punctuation">(</span>RedisConnectionFactory
redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  //默认的RedisTemplate没有过多的设置，redis对象都是需要序列化
  //两个泛型都是Object, Object的类型，我们后续需要强制转换<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span>
  RedisTemplate<span class="token operator">&lt;</span>Object, Object<span class="token operator">&gt;</span> template <span class="token operator">=</span> new RedisTemplate<span class="token operator">&lt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  template.setConnectionFactory<span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin class-name">return</span> template<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@Bean
//由于String类型是redis中最常用的类型，所以单独出来一个bean
@ConditionalOnMissingBean
@ConditionalOnSingleCandidate<span class="token punctuation">(</span>RedisConnectionFactory.class<span class="token punctuation">)</span>
public StringRedisTemplate stringRedisTemplate<span class="token punctuation">(</span>RedisConnectionFactory
redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  StringRedisTemplate template <span class="token operator">=</span> new StringRedisTemplate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  template.setConnectionFactory<span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin class-name">return</span> template<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>??? 导入依赖</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-starter-data-redis<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
</code></pre> 
<p>??? yaml文件</p> 
<pre><code class="prism language-bash">spring:
 redis:
  host: <span class="token number">127.0</span>.0.1
  port: <span class="token number">6379</span>
  password:
  jedis:
   pool:
    max-active: <span class="token number">8</span>
    max-wait: -1ms
    max-idle: <span class="token number">500</span>
    min-idle: <span class="token number">0</span>
  lettuce:
   shutdown-timeout: 0ms
</code></pre> 
<p>??? 测试类</p> 
<pre><code class="prism language-bash">//连接redis
//    RedisConnection connection <span class="token operator">=</span>
redisTemplate.getConnectionFactory<span class="token punctuation">(</span><span class="token punctuation">)</span>.getConnection<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
//    connection.flushAll<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
//    connection.flushAll<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
//redisTemplate 操作不同的数据类型，api和我们的指令是一样的
//opsForValue 操作字符串 类似String
//opsForList 操作list 类似List
redisTemplate.opsForValue<span class="token punctuation">(</span><span class="token punctuation">)</span>.set<span class="token punctuation">(</span><span class="token string">"myKey"</span>,<span class="token string">"myValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System.out.println<span class="token punctuation">(</span>redisTemplate.opsForValue<span class="token punctuation">(</span><span class="token punctuation">)</span>.get<span class="token punctuation">(</span><span class="token string">"myKey"</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
</code></pre> 
<h3>
<a id="_52_RedisConfig_717"></a>? 5.2 RedisConfig</h3> 
<blockquote> 
 <p>RedisTemplate，固定模板，可以直接使用</p> 
</blockquote> 
<pre><code class="prism language-bash">@Configuration
public class RedisConfig <span class="token punctuation">{<!-- --></span>
  @Bean
  @SuppressWarnings<span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span>
  public RedisTemplate<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> redisTemplate<span class="token punctuation">(</span>RedisConnectionFactory
factory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    RedisTemplate<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> template <span class="token operator">=</span> new RedisTemplate<span class="token operator">&lt;</span>String,
Object<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    template.setConnectionFactory<span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span class="token operator">=</span> new
Jackson2JsonRedisSerializer<span class="token punctuation">(</span>Object.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ObjectMapper om <span class="token operator">=</span> new ObjectMapper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    om.setVisibility<span class="token punctuation">(</span>PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    om.enableDefaultTyping<span class="token punctuation">(</span>ObjectMapper.DefaultTyping.NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    jackson2JsonRedisSerializer.setObjectMapper<span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
    StringRedisSerializer stringRedisSerializer <span class="token operator">=</span> new
StringRedisSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    // key采用String的序列化方式
    template.setKeySerializer<span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    // hash的key也采用String的序列化方式
    template.setHashKeySerializer<span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
// value序列化方式采用jackson
    template.setValueSerializer<span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    // hash的value序列化方式采用jackson
    template.setHashValueSerializer<span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    template.afterPropertiesSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> template<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3>
<a id="_53_RedisUtil_753"></a>? 5.3 RedisUtil</h3> 
<blockquote> 
 <p>在企业开发中80%都不会使用原生的方式去编写代码，使用RedisUtil</p> 
</blockquote> 
<pre><code class="prism language-bash">public class RedisUtil <span class="token punctuation">{<!-- --></span>
  @Autowired
  private RedisTemplate<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> redisTemplate<span class="token punctuation">;</span>
  // <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>common<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
  /**
  * 指定缓存失效时间
  * @param key 键
  * @param <span class="token function">time</span> 时间<span class="token punctuation">(</span>秒<span class="token punctuation">)</span>
  */
  public boolean expire<span class="token punctuation">(</span>String key, long <span class="token function">time</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        redisTemplate.expire<span class="token punctuation">(</span>key, time, TimeUnit.<span class="token environment constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 根据key 获取过期时间
  * @param key 键 不能为null
  * @return 时间<span class="token punctuation">(</span>秒<span class="token punctuation">)</span> 返回0代表为永久有效
  */
  public long getExpire<span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin class-name">return</span> redisTemplate.getExpire<span class="token punctuation">(</span>key, TimeUnit.<span class="token environment constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  /**
  * 判断key是否存在
  * @param key 键
  * @return <span class="token boolean">true</span> 存在 false不存在
  */
  public boolean hasKey<span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token builtin class-name">return</span> redisTemplate.hasKey<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 删除缓存
  * @param key 可以传一个值 或多个
  */
  @SuppressWarnings<span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
  public void del<span class="token punctuation">(</span>String<span class="token punctuation">..</span>. key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> key.length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key.length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        redisTemplate.delete<span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        redisTemplate.delete<span class="token variable"><span class="token punctuation">((</span>Collection<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span>
CollectionUtils.arrayToList<span class="token punctuation">(</span>key<span class="token punctuation">))</span></span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  // <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>String<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
  /**
  * 普通缓存获取
  * @param key 键
  * @return 值
  */
  public Object get<span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin class-name">return</span> key <span class="token operator">==</span> null ? null <span class="token builtin class-name">:</span> redisTemplate.opsForValue<span class="token punctuation">(</span><span class="token punctuation">)</span>.get<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  /**
  * 普通缓存放入
  * @param key  键
  * @param value 值
  * @return true成功 false失败
  */
  public boolean set<span class="token punctuation">(</span>String key, Object value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForValue<span class="token punctuation">(</span><span class="token punctuation">)</span>.set<span class="token punctuation">(</span>key, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 普通缓存放入并设置时间
  * @param key  键
  * @param value 值
  * @param <span class="token function">time</span> 时间<span class="token punctuation">(</span>秒<span class="token punctuation">)</span> time要大于0 如果time小于等于0 将设置无限期
  * @return true成功 <span class="token boolean">false</span> 失败
*/
  public boolean set<span class="token punctuation">(</span>String key, Object value, long <span class="token function">time</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        redisTemplate.opsForValue<span class="token punctuation">(</span><span class="token punctuation">)</span>.set<span class="token punctuation">(</span>key, value, time,
TimeUnit.<span class="token environment constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        set<span class="token punctuation">(</span>key, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 递增
  * @param key  键
  * @param delta 要增加几<span class="token punctuation">(</span>大于0<span class="token punctuation">)</span>
  */
  public long incr<span class="token punctuation">(</span>String key, long delta<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      throw new RuntimeException<span class="token punctuation">(</span><span class="token string">"递增因子必须大于0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
    <span class="token builtin class-name">return</span> redisTemplate.opsForValue<span class="token punctuation">(</span><span class="token punctuation">)</span>.increment<span class="token punctuation">(</span>key, delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  /**
  * 递减
  * @param key  键
  * @param delta 要减少几<span class="token punctuation">(</span>小于0<span class="token punctuation">)</span>
  */
  public long decr<span class="token punctuation">(</span>String key, long delta<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      throw new RuntimeException<span class="token punctuation">(</span><span class="token string">"递减因子必须大于0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
    <span class="token builtin class-name">return</span> redisTemplate.opsForValue<span class="token punctuation">(</span><span class="token punctuation">)</span>.increment<span class="token punctuation">(</span>key, -delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  // <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>Map<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
  /**
  * HashGet
  * @param key 键 不能为null
  * @param item 项 不能为null
  */
  public Object hget<span class="token punctuation">(</span>String key, String item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin class-name">return</span> redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.get<span class="token punctuation">(</span>key, item<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  /**
  * 获取hashKey对应的所有键值
  * @param key 键
* @return 对应的多个键值
  */
  public Map<span class="token operator">&lt;</span>Object, Object<span class="token operator">&gt;</span> hmget<span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin class-name">return</span> redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.entries<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  /**
  * HashSet
  * @param key 键
  * @param map 对应多个键值
  */
  public boolean hmset<span class="token punctuation">(</span>String key, Map<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> map<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.putAll<span class="token punctuation">(</span>key, map<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * HashSet 并设置时间
  * @param key 键
  * @param map 对应多个键值
  * @param <span class="token function">time</span> 时间<span class="token punctuation">(</span>秒<span class="token punctuation">)</span>
  * @return true成功 false失败
  */
  public boolean hmset<span class="token punctuation">(</span>String key, Map<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> map, long <span class="token function">time</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.putAll<span class="token punctuation">(</span>key, map<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        expire<span class="token punctuation">(</span>key, <span class="token function">time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 向一张hash表中放入数据,如果不存在将创建
  *
  * @param key  键
  * @param item 项
  * @param value 值
  * @return <span class="token boolean">true</span> 成功 false失败
  */
  public boolean hset<span class="token punctuation">(</span>String key, String item, Object value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span>key, item, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 向一张hash表中放入数据,如果不存在将创建
  *
  * @param key  键
  * @param item 项
  * @param value 值
  * @param <span class="token function">time</span> 时间<span class="token punctuation">(</span>秒<span class="token punctuation">)</span> 注意:如果已存在的hash表有时间,这里将会替换原有的时间
  * @return <span class="token boolean">true</span> 成功 false失败
  */
  public boolean hset<span class="token punctuation">(</span>String key, String item, Object value, long <span class="token function">time</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span>key, item, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        expire<span class="token punctuation">(</span>key, <span class="token function">time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 删除hash表中的值
  *
  * @param key 键 不能为null
  * @param item 项 可以使多个 不能为null
  */
  public void hdel<span class="token punctuation">(</span>String key, Object<span class="token punctuation">..</span>. item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.delete<span class="token punctuation">(</span>key, item<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  /**
  * 判断hash表中是否有该项的值
  *
  * @param key 键 不能为null
  * @param item 项 不能为null
  * @return <span class="token boolean">true</span> 存在 false不存在
  */
  public boolean hHasKey<span class="token punctuation">(</span>String key, String item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin class-name">return</span> redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.hasKey<span class="token punctuation">(</span>key, item<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  /**
  * hash递增 如果不存在,就会创建一个 并把新增后的值返回
  *
  * @param key 键
  * @param item 项
  * @param by  要增加几<span class="token punctuation">(</span>大于0<span class="token punctuation">)</span>
  */
  public double hincr<span class="token punctuation">(</span>String key, String item, double by<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin class-name">return</span> redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.increment<span class="token punctuation">(</span>key, item, by<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
  /**
  * hash递减
  *
  * @param key 键
  * @param item 项
  * @param by  要减少记<span class="token punctuation">(</span>小于0<span class="token punctuation">)</span>
  */
  public double hdecr<span class="token punctuation">(</span>String key, String item, double by<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin class-name">return</span> redisTemplate.opsForHash<span class="token punctuation">(</span><span class="token punctuation">)</span>.increment<span class="token punctuation">(</span>key, item, -by<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  // <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>set<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
  /**
  * 根据key获取Set中的所有值
  * @param key 键
  */
  public Set<span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span> sGet<span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token builtin class-name">return</span> redisTemplate.opsForSet<span class="token punctuation">(</span><span class="token punctuation">)</span>.members<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> null<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 根据value从一个set中查询,是否存在
  *
  * @param key  键
  * @param value 值
  * @return <span class="token boolean">true</span> 存在 false不存在
  */
  public boolean sHasKey<span class="token punctuation">(</span>String key, Object value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token builtin class-name">return</span> redisTemplate.opsForSet<span class="token punctuation">(</span><span class="token punctuation">)</span>.isMember<span class="token punctuation">(</span>key, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 将数据放入set缓存
  *
  * @param key  键
  * @param values 值 可以是多个
  * @return 成功个数
  */
  public long sSet<span class="token punctuation">(</span>String key, Object<span class="token punctuation">..</span>. values<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token builtin class-name">return</span> redisTemplate.opsForSet<span class="token punctuation">(</span><span class="token punctuation">)</span>.add<span class="token punctuation">(</span>key, values<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 将set数据放入缓存
  *
  * @param key  键
  * @param <span class="token function">time</span>  时间<span class="token punctuation">(</span>秒<span class="token punctuation">)</span>
  * @param values 值 可以是多个
  * @return 成功个数
  */
  public long sSetAndTime<span class="token punctuation">(</span>String key, long time, Object<span class="token punctuation">..</span>. values<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      Long count <span class="token operator">=</span> redisTemplate.opsForSet<span class="token punctuation">(</span><span class="token punctuation">)</span>.add<span class="token punctuation">(</span>key, values<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        expire<span class="token punctuation">(</span>key, <span class="token function">time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> count<span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 获取set缓存的长度
  *
  * @param key 键
  */
  public long sGetSetSize<span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token builtin class-name">return</span> redisTemplate.opsForSet<span class="token punctuation">(</span><span class="token punctuation">)</span>.size<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 移除值为value的
  *
  * @param key  键
  * @param values 值 可以是多个
  * @return 移除的个数
  */
  public long setRemove<span class="token punctuation">(</span>String key, Object<span class="token punctuation">..</span>. values<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      Long count <span class="token operator">=</span> redisTemplate.opsForSet<span class="token punctuation">(</span><span class="token punctuation">)</span>.remove<span class="token punctuation">(</span>key, values<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> count<span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  // <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>list<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
  /**
  * 获取list缓存的内容
  *
  * @param key  键
  * @param start 开始
  * @param end  结束 <span class="token number">0</span> 到 -1代表所有值
  */
  public List<span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span> lGet<span class="token punctuation">(</span>String key, long start, long end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token builtin class-name">return</span> redisTemplate.opsForList<span class="token punctuation">(</span><span class="token punctuation">)</span>.range<span class="token punctuation">(</span>key, start, end<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> null<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 获取list缓存的长度
  *
  * @param key 键
  */
  public long lGetListSize<span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token builtin class-name">return</span> redisTemplate.opsForList<span class="token punctuation">(</span><span class="token punctuation">)</span>.size<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 通过索引 获取list中的值
  *
  * @param key  键
  * @param index 索引 index<span class="token operator">&gt;</span><span class="token operator">=</span><span class="token number">0</span>时， <span class="token number">0</span> 表头，1 第二个元素，依次类推；index<span class="token operator">&lt;</span><span class="token number">0</span>时，-1，表
尾，-2倒数第二个元素，依次类推
  */
  public Object lGetIndex<span class="token punctuation">(</span>String key, long index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      <span class="token builtin class-name">return</span> redisTemplate.opsForList<span class="token punctuation">(</span><span class="token punctuation">)</span>.index<span class="token punctuation">(</span>key, index<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> null<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 将list放入缓存
  *
  * @param key  键
* @param value 值
  */
  public boolean lSet<span class="token punctuation">(</span>String key, Object value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForList<span class="token punctuation">(</span><span class="token punctuation">)</span>.rightPush<span class="token punctuation">(</span>key, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 将list放入缓存
  * @param key  键
  * @param value 值
  * @param <span class="token function">time</span> 时间<span class="token punctuation">(</span>秒<span class="token punctuation">)</span>
  */
  public boolean lSet<span class="token punctuation">(</span>String key, Object value, long <span class="token function">time</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForList<span class="token punctuation">(</span><span class="token punctuation">)</span>.rightPush<span class="token punctuation">(</span>key, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        expire<span class="token punctuation">(</span>key, <span class="token function">time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 将list放入缓存
  *
  * @param key  键
  * @param value 值
  * @return
  */
  public boolean lSet<span class="token punctuation">(</span>String key, List<span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForList<span class="token punctuation">(</span><span class="token punctuation">)</span>.rightPushAll<span class="token punctuation">(</span>key, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 将list放入缓存
  *
  * @param key  键
  * @param value 值
  * @param <span class="token function">time</span> 时间<span class="token punctuation">(</span>秒<span class="token punctuation">)</span>
* @return
  */
  public boolean lSet<span class="token punctuation">(</span>String key, List<span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span> value, long <span class="token function">time</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForList<span class="token punctuation">(</span><span class="token punctuation">)</span>.rightPushAll<span class="token punctuation">(</span>key, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        expire<span class="token punctuation">(</span>key, <span class="token function">time</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 根据索引修改list中的某条数据
  *
  * @param key  键
  * @param index 索引
  * @param value 值
  * @return
  */
  public boolean lUpdateIndex<span class="token punctuation">(</span>String key, long index, Object value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      redisTemplate.opsForList<span class="token punctuation">(</span><span class="token punctuation">)</span>.set<span class="token punctuation">(</span>key, index, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  /**
  * 移除N个值为value
  *
  * @param key  键
  * @param count 移除多少个
  * @param value 值
  * @return 移除的个数
  */
  public long lRemove<span class="token punctuation">(</span>String key, long count, Object value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    try <span class="token punctuation">{<!-- --></span>
      Long remove <span class="token operator">=</span> redisTemplate.opsForList<span class="token punctuation">(</span><span class="token punctuation">)</span>.remove<span class="token punctuation">(</span>key, count, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> remove<span class="token punctuation">;</span>
   <span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="_redisconf_1246"></a>? 六、redis.conf详解</h2> 
<blockquote> 
 <p>单位，大小写不敏感</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment"># Note on units: when memory size is needed, it is possible to specify</span>
<span class="token comment"># it in the usual form of 1k 5GB 4M and so forth:</span>
<span class="token comment">#</span>
<span class="token comment"># 1k =&gt; 1000 bytes</span>
<span class="token comment"># 1kb =&gt; 1024 bytes</span>
<span class="token comment"># 1m =&gt; 1000000 bytes</span>
<span class="token comment"># 1mb =&gt; 1024*1024 bytes</span>
<span class="token comment"># 1g =&gt; 1000000000 bytes</span>
<span class="token comment"># 1gb =&gt; 1024*1024*1024 bytes</span>
<span class="token comment">#</span>
<span class="token comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span>
</code></pre> 
<blockquote> 
 <p>包含</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment"># include /path/to/local.conf</span>
<span class="token comment"># include /path/to/other.conf</span>
</code></pre> 
<blockquote> 
 <p>网络</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#绑定IP</span>
<span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1
<span class="token comment">#保护模式</span>
protected-mode <span class="token function">yes</span>
<span class="token comment">#端口设置</span>
port <span class="token number">6379</span>
</code></pre> 
<blockquote> 
 <p>通用配置</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#以守护进程的方式运行，默认是no，我们需要自己开启为yes</span>
daemonize <span class="token function">yes</span>
<span class="token comment">#如果是以后台的方式运行，我们需要自己开启一个pid文件</span>
pidfile /var/run/redis_6379.pid
<span class="token comment">#日志</span>
<span class="token comment"># Specify the server verbosity level.</span>
<span class="token comment"># This can be one of:</span>
<span class="token comment"># debug (a lot of information, useful for development/testing)</span>
<span class="token comment"># verbose (many rarely useful info, but not a mess like the debug level)</span>
<span class="token comment"># notice (moderately verbose, what you want in production probably) 生产环境</span>
<span class="token comment"># warning (only very important / critical messages are logged)</span>
loglevel notice
<span class="token comment">#日志的文件位置名</span>
logfile <span class="token string">""</span>
<span class="token comment">#数据库的数量，默认是16的数据库</span>
databases <span class="token number">16</span>
<span class="token comment">#总是显示Logo</span>
always-show-logo <span class="token function">yes</span>
</code></pre> 
<blockquote> 
 <p>快照，持久化：在指定时间内，执行了多少次操作，则会持久化到文件.rdb.aof<br> redis是内存数据库，如果没有持久化，那么数据断电即失</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#如果900s内，至少有1个key进行了修改，我们及进行持久化操作</span>
save <span class="token number">900</span> <span class="token number">1</span>
<span class="token comment">#300，至少有10个key进行了修改，我们及进行持久化操作</span>
save <span class="token number">300</span> <span class="token number">10</span>
<span class="token comment">#60，至少有10000个key进行了修改，我们及进行持久化操作</span>
save <span class="token number">60</span> <span class="token number">10000</span>
<span class="token comment">#持久化如果出错，是否还需要继续工作</span>
stop-writes-on-bgsave-error <span class="token function">yes</span>
<span class="token comment">#是否压缩rdb文件，需要消耗一些cpu资源</span>
rdbcompression <span class="token function">yes</span>
<span class="token comment">#保存rdb文件的时候是否进行错误的检查校验</span>
rdbchecksum <span class="token function">yes</span>
<span class="token comment">#rdb文件保存的目录</span>
<span class="token function">dir</span> ./
</code></pre> 
<blockquote> 
 <p>SECURITY 安全</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#查看和设置redis密码</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config get requirepass
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"requirepass"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">""</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config <span class="token builtin class-name">set</span> requirepass <span class="token string">"1234"</span>
OK
<span class="token comment">#登录redis</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> auth <span class="token number">1234</span>
OK
</code></pre> 
<blockquote> 
 <p>CLIENTS 设置客户端</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#设置能够连接redis的客户端登录数量</span>
maxclients <span class="token number">10000</span>
<span class="token comment">#redis配置最大内存</span>
maxmemory <span class="token operator">&lt;</span>bytes<span class="token operator">&gt;</span>
<span class="token comment">#内存到达上限后的处理策略</span>
maxmemory-policy noeviction
<span class="token number">1</span>、volatile-lru：只对设置了过期时间的key进行LRU（默认值）
<span class="token number">2</span>、allkeys-lru ： 删除lru算法的key 
<span class="token number">3</span>、volatile-random：随机删除即将过期key 
<span class="token number">4</span>、allkeys-random：随机删除 
<span class="token number">5</span>、volatile-ttl ： 删除即将过期的 
<span class="token number">6</span>、noeviction ： 永不过期，返回错误
</code></pre> 
<blockquote> 
 <p>APPEND ONLY MODE aof配置</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#默认是不开启aof的，默认是使用rdb方式持久化的，在大部分的情况下rdb完全够用</span>
appendonly no
<span class="token comment">#持久化文件的名字</span>
appendfilename <span class="token string">"appendonly.aof"</span>
<span class="token comment"># appendfsync always #每次修改都会sync，消耗性能</span>
appendfsync everysec <span class="token comment">#每秒执行一次sync，可能会对视着1s的数据</span>
<span class="token comment"># appendfsync no #不执行sunc，这个时候操作系统会自己同步数据，速度最快</span>
</code></pre> 
<h2>
<a id="_Redis_1365"></a>? 七、Redis持久化</h2> 
<h3>
<a id="_71_RDB_1366"></a>? 7.1 RDB</h3> 
<blockquote> 
 <p>什么是RDB</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/52/a2/GRvyq98A_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot快照,它恢复时是将快照文件直接读到内存里。Redis会单独创建(fork)一个子进程来进行持久化,会先将数据写入到一个临时文件中,待持久化过程都结束了,再用这个临时文 件替换.上次持久化好的文件。整个过程中,主进程是不进行任何I0操作的。这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感,那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丟失。<br> RDB持久化是把当前进程数据生成快照保存到硬盘的过程，触发RDB持久化过程分为手动触发和自动触<br> 发rdb保存的文件时dump.rdb 都是在我们配置文件快照中进行配置的</p> 
</blockquote> 
<p>??? 触发机制</p> 
<blockquote> 
 <ol>
<li>save的规则满足的情况下，会自动触发rdb规则</li>
<li>执行flushall命令，也会触发</li>
<li>退出redis</li>
</ol> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f0/c3/oLuspzoy_o.png" alt="在这里插入图片描述"><br> ??? 如何恢复rdb文件</p> 
<pre><code class="prism language-bash"><span class="token number">1</span>. 将dump.rdb放在我们的redis启动目录下就可以，redis启动的时候会自动检查dump.rdb恢复数据
<span class="token number">2</span>. 查看需要存在的位置
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config get <span class="token function">dir</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"dir"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"/usr/local/bin"</span>
</code></pre> 
<p>??? 优缺点</p> 
<pre><code class="prism language-bash">优点：
<span class="token number">1</span>. 适合大规模的数恢复
<span class="token number">2</span>. 对数据的完整性要求不高
缺点：
<span class="token number">1</span>. 需要一定的时间间隔进程操作，如果redis意外宕机了，这个最后一场修改数据就没有了
<span class="token number">2</span>. fork进程的时候会占用一定的内容空间
</code></pre> 
<h3>
<a id="_72_AOFAppend_Only_File_1401"></a>? 7.2 AOF(Append Only File)</h3> 
<blockquote> 
 <p>将我们的所有命令记录下来，恢复的时候就把这个文件里面的命令全部执行一遍</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/02/d7/hZbziCXd_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>以日志的形式来记录每个写操作，将Redis执行过得所有指令记录下来（读操作不记录），只追加文件但不可以改写文件，redis启动之初读取该文件重新构建数据库，即redis重启的话根据日志文件的内容将写指令从前到后执行一次完成数据库的恢复工作</p> 
</blockquote> 
<p>??? 优缺点</p> 
<pre><code class="prism language-bash">优点
<span class="token number">1</span>. 每一次修改都要同步，文件的完整性更好
<span class="token number">2</span>. 每秒同步一次，可能会丢失这一秒的数据
<span class="token number">3</span>. 从不同步，效率最高
缺点
<span class="token number">1</span>. 相对于数据文件，AOF远远大于RDB，修复速度也比rdb慢
<span class="token number">2</span>. AOF效率也比RDB慢
</code></pre> 
<h2>
<a id="__1421"></a>? 八、发布和订阅消息</h2> 
<blockquote> 
 <p>使用 subscribe 频道名 进行订阅监听<br> 使用 publish 频道名 发布的内容 进行发布消息广播；</p> 
</blockquote> 
<p>??? 订阅监听</p> 
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> subscribe wangqin
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"subscribe"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"wangqin"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"message"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"wangqin"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hello, qin"</span>
</code></pre> 
<p>??? 发布消息广播</p> 
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> publish wangqin <span class="token string">"hello, qin"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre> 
<h2>
<a id="__1446"></a>? 九、主从复制</h2> 
<h3>
<a id="_91__1447"></a>? 9.1 主从复制</h3> 
<blockquote> 
 <p>主从复制,是指将一台Redis服务器的数据 ,复制到其他的Redis服务器I前者称为主节点(master/leader)，<br> 后者称为从节点(slave/follower)数据的复制是单向的，只能由主节点到从节点，Master以写为主, Slave<br> 以读为主。<br> 默认情况下,每台Redis服务器都是主节点，且一个主节点可以有多个从节点(或没有从节点) ,但一个从节<br> 点只能有一一个主节点。 主从复制的作用主要包括:</p> 
 <ol>
<li>数据冗余：主从复制实现了数据的热备份,是持久化之外的一种数据冗余方式。</li>
<li>故障恢复：当主节点出现问题时,可以由从节点提供服务,实现快速的故障恢复;实际上是一种服务的<br> 冗余。</li>
<li>负载均衡：在主从复制的基础上,配合读写分离,可以由主节点提供写服务,由从节点提供读服务(即写<br> Redis数据时应用连接主节点,读Redis数据时应用连接从节点) , 分担服务器负载;尤其是在写少读多<br> 的场景下,通过多个从节点分担读负载,可以大大提高Redis服务器的并发量。</li>
<li>高可用基石:除了.上述作用以外,主从复制还是哨兵和集群能够实施的基础,因此说主从复制是Redis<br> 高可用的基础。<br> 一般来说,要将Redis运用于工程项目中,只使用一台Redis是万万不能的,原因如下:</li>
<li>从结构上,单个Redis服务器会发生单点故障,并且一台服务器需要处理所有的请求负载,压力较大;</li>
<li>从容量上,单个Redis服务器内存容量有限,就算一台Redis服务器内存容量为256G ,也不能将所有内<br> 存用作Redis存储内存， 一般来说 ,单台Redis最大使用内存不应该超过20G。<br> 电商网站上的商品,一般都是一次上传,无数次浏览的,说专业点也就是"多读少写"</li>
</ol> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d4/8a/0vykRFte_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@qin bin<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6380</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master  <span class="token comment">#主机</span>
connected_slaves:2  <span class="token comment">#从机两个 6379和6380</span>
slave0:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">266</span>,lag<span class="token operator">=</span><span class="token number">1</span>
slave1:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6381</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">266</span>,lag<span class="token operator">=</span><span class="token number">1</span>
master_replid:ee9893cc165118d4639a473c3db9bb55b7e29248
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:266
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:266
</code></pre> 
<p>??? 主从复制配置过程</p> 
<pre><code class="prism language-bash">在redis-cli应用中配置主从 slaveof <span class="token number">127.0</span>.0.1 <span class="token number">6380</span>
这里以主服务器：192.168.238.143 ；从服务器：192.168.238.144 为例；
配置从服务器的 redis.conf ，添加：
配置主机： replicaof <span class="token number">127.0</span>.0.1 <span class="token number">6380</span>
密码： masterauth <span class="token operator">&lt;</span>master-password<span class="token operator">&gt;</span>
配置从机只能做读操作 replica-read-only <span class="token function">yes</span>
如果主机断开连接，从机依旧连接到主机的，但是没有写操作。如果主机回来，从机依旧可以直接获取
到主机写的信息
</code></pre> 
<p>??? 复制原理</p> 
<pre><code class="prism language-bash">Slave启动成功连接到master后会发送一个sync同步命令
Master接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行
完毕之后，master将传送整个数据文件到slave，并完成一次完全同步。
全量复制:而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。
<span class="token punctuation">[</span>root@qin bin<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6380</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master  <span class="token comment">#主机</span>
connected_slaves:2  <span class="token comment">#从机两个 6379和6380</span>
slave0:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6379</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">266</span>,lag<span class="token operator">=</span><span class="token number">1</span>
slave1:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6381</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">266</span>,lag<span class="token operator">=</span><span class="token number">1</span>
master_replid:ee9893cc165118d4639a473c3db9bb55b7e29248
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:266
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:266
增量复制:Master继续将新的所有收集到的修改命令依次传给slave，完成同步
但是只要是重新连接master,一次完全同步<span class="token punctuation">(</span>全量复制<span class="token punctuation">)</span>将被自动执行
</code></pre> 
<p>??? 层层链路<br> <img src="https://images2.imgbox.com/f0/4f/QtlayDYV_o.png" alt="在这里插入图片描述"></p> 
<h3>
<a id="_92__1527"></a>? 9.2 哨兵模式</h3> 
<blockquote> 
 <p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象成为主观下线。当后面的哨兵也检测到主服务器不可用,并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover[故障转移]操作。切换成功后,就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为客观下线。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/63/87/y2jIzBNR_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>主要是在 Redis 2.0 中的，用于对主服务器进行监控<br> 功能一：监控主数据库和从数据库是否正常运行；<br> 功能二：主数据库出现故障时候，可以自动将从数据库转换为主数据库，实现自动切换；<br> 实现步骤：<br> 修改从服务器的 sentinel.conf<br> sentinel monitor myredis 192.168.238.143 6379 1 # 主数据库名称、IP、端口、<br> 投票选举次数<br> sentinel down-after-milliseconds myredis 5000 #默认 1 秒检查一次，这里配置超<br> 时 5000 毫秒为宕机；<br> sentinel failover-timeout myredis 900000<br> sentinel parallel-syncs myredis 2<br> sentinel can-failover myredis yes</p> 
</blockquote> 
<p>??? 启动 sentinel 哨兵</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@qin bin<span class="token punctuation">]</span><span class="token comment"># redis-sentinel qconfig/sentinel.conf</span>
<span class="token number">72466</span>:X 08 Dec <span class="token number">2020</span> 02:41:53.764 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting</span>
oO0OoO0OoO0Oo
<span class="token number">72466</span>:X 08 Dec <span class="token number">2020</span> 02:41:53.764 <span class="token comment"># Redis version=5.0.7, bits=64,</span>
<span class="token assign-left variable">commit</span><span class="token operator">=</span>00000000, <span class="token assign-left variable">modified</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">72466</span>, just started
<span class="token number">72466</span>:X 08 Dec <span class="token number">2020</span> 02:41:53.764 <span class="token comment"># Configuration loaded</span>
       _._                         
     _.-`<span class="token variable"><span class="token variable">`</span>__ <span class="token string">''</span>-._                      
  _.-<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span>   <span class="token variable">`</span></span><span class="token builtin class-name">.</span> <span class="token variable"><span class="token variable">`</span>_.  <span class="token string">''</span>-._      Redis <span class="token number">5.0</span>.7 <span class="token punctuation">(</span>00000000/0<span class="token punctuation">)</span> <span class="token number">64</span> bit
.-<span class="token variable">`</span></span><span class="token variable"><span class="token variable">`</span> .-<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">.</span> <span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token punctuation"></span>/  _.,_ <span class="token string">''</span>-._                 
<span class="token punctuation">(</span>   '   ,    .-<span class="token variable">`</span></span> <span class="token operator">|</span> <span class="token variable"><span class="token variable">`</span>,  <span class="token punctuation">)</span>   Running <span class="token keyword">in</span> sentinel mode
<span class="token operator">|</span><span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-<span class="token punctuation">..</span>.-<span class="token variable">`</span></span> __<span class="token punctuation">..</span>.-.`<span class="token variable"><span class="token variable">`</span>-._<span class="token operator">|</span>'<span class="token variable">`</span></span> _.-<span class="token string">'|   Port: 26379
|   <span class="token variable"><span class="token variable">`</span>-._  <span class="token variable">`</span></span>._  /   _.-'</span>  <span class="token operator">|</span>   PID: <span class="token number">72466</span>
 <span class="token variable"><span class="token variable">`</span>-._  <span class="token variable">`</span></span>-._  <span class="token variable"><span class="token variable">`</span>-./ _.-<span class="token string">'  _.-'</span>                 
<span class="token operator">|</span><span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-._   <span class="token variable">`</span></span>-.__.-<span class="token string">'  _.-'</span>_.-<span class="token string">'|                 
|   <span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._    _.-'</span>_.-<span class="token string">'  |      http://redis.io    
 <span class="token variable"><span class="token variable">`</span>-._  <span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-.__.-<span class="token string">'_.-'</span>  _.-'                 
<span class="token operator">|</span><span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-._   <span class="token variable">`</span></span>-.__.-'</span>  _.-<span class="token string">'_.-'</span><span class="token operator">|</span>                 
<span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._    _.-<span class="token string">'_.-'</span>  <span class="token operator">|</span>                 
 <span class="token variable"><span class="token variable">`</span>-._  <span class="token variable">`</span></span>-._<span class="token variable"><span class="token variable">`</span>-.__.-<span class="token string">'_.-'</span>  _.-'                 
   <span class="token variable">`</span></span>-._  <span class="token variable"><span class="token variable">`</span>-.__.-<span class="token string">'  _.-'</span>                   
     <span class="token variable">`</span></span>-._    _.-'                     
       `-.__.-'                       
<span class="token number">72466</span>:X 08 Dec <span class="token number">2020</span> 02:41:53.765 <span class="token comment"># WARNING: The TCP backlog setting of 511</span>
cannot be enforced because /proc/sys/net/core/somaxconn is <span class="token builtin class-name">set</span> to the lower
value of <span class="token number">128</span>.
<span class="token number">72466</span>:X 08 Dec <span class="token number">2020</span> 02:41:53.765 <span class="token comment"># Sentinel ID is</span>
df5d73e7709db2ce099fa9b7432a58281b982f48
<span class="token number">72466</span>:X 08 Dec <span class="token number">2020</span> 02:41:53.765 <span class="token comment"># +monitor master myredis 127.0.0.1 6380</span>
quorum <span class="token number">1</span>
</code></pre> 
<blockquote> 
 <p>若主机断开了，哨兵会选举一个从机作为主机。如果主机后来回来了，只能归并到新的主机下当做<br> 从机。<br> 优点：</p> 
 <ol>
<li>哨兵集群,基于主从复制模式,所有的主从配置优点,它全有</li>
<li>主从可以切换 ,故障可以转移,系统的可用性就会更好</li>
<li>哨兵模式就是主从模式的升级,手动到自动,更加健壮。<br> 缺点:</li>
<li>Redis 不好啊在线扩容的，集群容量一旦到达上限,在线扩容就十分麻烦！</li>
<li>实现哨兵模式的配置其实是很麻烦的，里面有很多选择</li>
</ol> 
</blockquote> 
<p><img src="https://images2.imgbox.com/37/9b/tBmj97hI_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover故障转移过程，仅仅是哨兵1
主观的认为主服务器不可用，这个现象成为主观下线。当后面的哨兵也检测到主服务器不可用，并且数
量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover<span class="token punctuation">[</span>故障转
移<span class="token punctuation">]</span>操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个
过程称为客观下线。
</code></pre> 
<p>??? 配置文件</p> 
<pre><code class="prism language-bash"><span class="token comment"># Example sentinel.conf </span>
<span class="token comment"># 哨兵sentinel实例运行的端口 默认26379 </span>
port <span class="token number">26379</span> 
<span class="token comment"># 哨兵sentinel的工作目录 </span>
<span class="token function">dir</span> /tmp 
<span class="token comment"># 哨兵sentinel监控的redis主节点的 ip port </span>
<span class="token comment"># master-name 可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符".-_"组成。 </span>
<span class="token comment"># quorum 当这些quorum个数sentinel哨兵认为master主节点失联 那么这时 客观上认为主节点失联了</span>
<span class="token comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt; </span>
sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">2</span> 
<span class="token comment"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供</span>
密码 
<span class="token comment"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码 </span>
<span class="token comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt; </span>
sentinel auth-pass mymaster MySUPER--secret-0123password 
<span class="token comment"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒 </span>
<span class="token comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt; </span>
sentinel down-after-milliseconds mymaster <span class="token number">30000</span> 
<span class="token comment"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步， </span>
这个数字越小，完成failover所需的时间就越长， 
但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。 
可以通过将这个值设为 <span class="token number">1</span> 来保证每次只有一个slave 处于不能处理命令请求的状态。 
<span class="token comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span>

sentinel parallel-syncs mymaster <span class="token number">1</span> 
<span class="token comment"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面： </span>
<span class="token comment">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。 </span>
<span class="token comment">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那</span>
里同步数据时。 
<span class="token comment">#3.当想要取消一个正在进行的failover所需要的时间。  </span>
<span class="token comment">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，</span>
slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了 
<span class="token comment"># 默认三分钟 </span>
<span class="token comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt; </span>
sentinel failover-timeout mymaster <span class="token number">180000</span> 
<span class="token comment"># SCRIPTS EXECUTION </span>
<span class="token comment">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知</span>
相关人员。 
<span class="token comment">#对于脚本的运行结果有以下规则： </span>
<span class="token comment">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10 </span>
<span class="token comment">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。 </span>
<span class="token comment">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。 </span>
<span class="token comment">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span>
<span class="token comment">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），</span>
将会去调用这个脚本， 
这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传
给脚本两个参数， 
一个是事件的类型， 
一个是事件的描述。 
如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执
行的，否则sentinel无法正常启动成功。 
<span class="token comment">#通知脚本 </span>
<span class="token comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt; </span>
sentinel notification-script mymaster /var/redis/notify.sh 
<span class="token comment"># 客户端重新配置主节点参数脚本 </span>
<span class="token comment"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已</span>
经发生改变的信息。 
<span class="token comment"># 以下参数将会在调用脚本时传给脚本: </span>
<span class="token comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt; </span>
<span class="token comment"># 目前&lt;state&gt;总是“failover”, </span>
<span class="token comment"># &lt;role&gt;是“leader”或者“observer”中的一个。 </span>
<span class="token comment"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通</span>
信的 
<span class="token comment"># 这个脚本应该是通用的，能被多次调用，不是针对性的。 </span>
<span class="token comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt; </span>
sentinel client-reconfig-script mymaster /var/redis/reconfig.sh  
</code></pre> 
<h2>
<a id="_Redis_1669"></a>? 十、Redis缓存穿透和雪崩</h2> 
<blockquote> 
 <p>Redis缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。但同时，它也带来了一些问题。其中，最要害的 问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓存。<br> 另外的一些典型问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都有比较流行的解决方案。</p> 
</blockquote> 
<h3>
<a id="_101__1673"></a>? 10.1 缓存穿透(查不到)</h3> 
<p>??? 概念</p> 
<blockquote> 
 <p>缓存穿透的概念很简单，用户想要查询一个数据，发现redis内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。发 现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中(秒<br> 杀)，于是都去请求了持久层数据库。这会给持久层数据库造成很 大的压力，这时候就相当于出现了缓存</p> 
</blockquote> 
<p>??? 解决方案</p> 
<pre><code class="prism language-bash">布隆过滤器
当存储层不命中后，即使返回的空对象也要将其缓存起来，同时设置一个过期时间，之后再访问这个数
据库将会从缓存中获取，保护了后端数据库
但是这种方法会存在两个问题:
<span class="token number">1</span>. 如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很
多的空值的键<span class="token punctuation">;</span>
<span class="token number">2</span>. 即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对
于需要保持一致性的业务会 有影响。
</code></pre> 
<h3>
<a id="_102__1691"></a>? 10.2 缓存击穿(量太大)</h3> 
<p>??? 概述</p> 
<blockquote> 
 <p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。当某个key在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数 据，并且回写缓存，会导使数据库瞬间压力过大。</p> 
</blockquote> 
<p>??? 解决方案</p> 
<blockquote> 
 <p>设置热点数据永不过期从缓存层面来看，没有设置过期时间，所以不会出现热点key过期后产生的问题。加互斥锁<br> 分布式锁：使用分布式锁,保证对于每个key同时只有一一个线程去查询后端服务,其他线程没有获得分布式锁的权限,因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁,因此对分布式锁的考验很大。</p> 
</blockquote> 
<h3>
<a id="_103__1699"></a>? 10.3 缓存雪崩</h3> 
<p>??? 概念</p> 
<blockquote> 
 <p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。Redis宕机!<br> 产生雪崩的原因之一，比如在写本文的时候，马上就要到双十二零点，很快就会迎来一波抢购，这波商<br> 品时间比较集中的放入了缓 存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都<br> 过期了。而对这批商品的访问查询，都落到了数据库 上，对于数据库而言，就会产生周期性的压力波<br> 峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂 掉的情况。</p> 
</blockquote> 
<p>??? 解决方案</p> 
<blockquote> 
 <p>redis高可用<br> 这个思想的含义是,既然redis有可能挂掉,那我多增设几台redis ,这样-台挂掉之后其他的还可以继续工作,<br> 其实就是搭建的集 群。(异地多活!|)<br> 限流降级<br> 这个解决方案的思想是,在缓存失效后,通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个<br> key只允许一个线程查 询数据和写缓存,其他线程等待。<br> 数据预热.<br> 数据加热的含义就是在正式部署之前,我先把可能的数据先预先访问一遍,这样部分可能大量访问的数据就<br> 会加载到缓存中。在即. 将发生大并发访问前手动触发加载缓存不同的key ,设置不同的过期时间,让缓存<br> 失效的时间点尽量均匀。</p> 
</blockquote> 
<h2>
<a id="_redis__1720"></a>? 十一、redis 在项目中的应用</h2> 
<h3>
<a id="__111_redis_1722"></a>? 11.1 redis缓存注解</h3> 
<blockquote> 
 <p>@Cacheable：根据方法对其返回结果进行缓存，下次请求时，如果缓存存在，则直接读取缓存数<br> 据返回；如果缓存不存在，则执行方法，并把返回的结果存入缓存中，一般用在查询方法上。<br> value：缓存名，必填，它指定了你的缓存存放在哪块命名空间<br> cacheNames：与 value 差不多，二选一即可<br> key：可选属性，可以使用 SpEL 标签自定义缓存的key<br> @CachePut：使用该注解标志的方法，每次都会执行，并将结果存入指定的缓存中。其他方法可<br> 以直接从响应的缓存中读取缓存数据，而不需要再去查询数据库，一般用在新增方法上。<br> value：缓存名，必填，它指定了你的缓存存放在哪块命名空间<br> cacheNames：与 value 差不多，二选一即可<br> key：可选属性，可以使用 SpEL 标签自定义缓存的key<br> @CacheEvict：使用该注解标志的方法，会清空指定的缓存，一般用在更新或者删除方法上<br> value：缓存名，必填，它指定了你的缓存存放在哪块命名空间<br> cacheNames：与 value 差不多，二选一即可<br> key：可选属性，可以使用 SpEL 标签自定义缓存的key<br> allEntries：是否清空所有缓存，默认为 false。如果指定为 true，则方法调用后将立即清空所<br> 有的缓存<br> beforeInvocation：是否在方法执行前就清空，默认为 false。如果指定为 true，则在方法执行<br> 前就会清空缓存</p> 
</blockquote> 
<h3>
<a id="_112__1742"></a>? 11.2 环境配置</h3> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span><span class="token operator">!</span>-- redis --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-starter-data-redis<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- spring2.X集成redis所需common-pool2 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.apache.commons<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>commons-pool<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/artifactId<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">2.6</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
</code></pre> 
<p>??? 在service-base模块添加redis配置类</p> 
<pre><code class="prism language-bash">@EnableCaching //开启缓存
@Configuration //配置类
public class RedisConfig extends CachingConfigurerSupport <span class="token punctuation">{<!-- --></span>
  @Bean
  public RedisTemplate<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> redisTemplate<span class="token punctuation">(</span>RedisConnectionFactory
factory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    RedisTemplate<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> template <span class="token operator">=</span> new RedisTemplate<span class="token operator">&lt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    RedisSerializer<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> redisSerializer <span class="token operator">=</span> new StringRedisSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span class="token operator">=</span> new
Jackson2JsonRedisSerializer<span class="token punctuation">(</span>Object.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ObjectMapper om <span class="token operator">=</span> new ObjectMapper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    om.setVisibility<span class="token punctuation">(</span>PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    om.enableDefaultTyping<span class="token punctuation">(</span>ObjectMapper.DefaultTyping.NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    jackson2JsonRedisSerializer.setObjectMapper<span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
    template.setConnectionFactory<span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //key序列化方式
    template.setKeySerializer<span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //value序列化
    template.setValueSerializer<span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //value hashmap序列化
    template.setHashValueSerializer<span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> template<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  @Bean
  public CacheManager cacheManager<span class="token punctuation">(</span>RedisConnectionFactory factory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    RedisSerializer<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> redisSerializer <span class="token operator">=</span> new StringRedisSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span class="token operator">=</span> new
Jackson2JsonRedisSerializer<span class="token punctuation">(</span>Object.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //解决查询缓存转换异常的问题
    ObjectMapper om <span class="token operator">=</span> new ObjectMapper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    om.setVisibility<span class="token punctuation">(</span>PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    om.enableDefaultTyping<span class="token punctuation">(</span>ObjectMapper.DefaultTyping.NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    jackson2JsonRedisSerializer.setObjectMapper<span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
    // 配置序列化（解决乱码的问题）,过期时间600秒
    RedisCacheConfiguration config <span class="token operator">=</span>
RedisCacheConfiguration.defaultCacheConfig<span class="token punctuation">(</span><span class="token punctuation">)</span>
.entryTtl<span class="token punctuation">(</span>Duration.ofSeconds<span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">))</span>      
.serializeKeysWith<span class="token punctuation">(</span>RedisSerializationContext.SerializationPair.fromSerializer<span class="token punctuation">(</span>re
disSerializer<span class="token punctuation">))</span>     
.serializeValuesWith<span class="token punctuation">(</span>RedisSerializationContext.SerializationPair.fromSerializer<span class="token punctuation">(</span>
jackson2JsonRedisSerializer<span class="token punctuation">))</span>.disableCachingNullValues<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    RedisCacheManager cacheManager <span class="token operator">=</span> RedisCacheManager.builder<span class="token punctuation">(</span>factory<span class="token punctuation">)</span>
     .cacheDefaults<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
     .build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> cacheManager<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>??? Linux启动Redis要修改的配置</p> 
<blockquote> 
 <ol>
<li>关闭Linux防火墙</li>
<li>配置文件注释：# bind 127.0.0.1</li>
<li>protected-mode no</li>
</ol> 
</blockquote> 
<h3>
<a id="_113_banner_1814"></a>? 11.3 banner接口改造</h3> 
<blockquote> 
 <p>由于首页数据变化不是很频繁，而且首页访问量相对较大，所以我们有必要把首页接口数据缓存到redis缓存中，减少数据库压力和提高访问速度。<br> 改造service-cms模块首页banner接口，首页课程与讲师接口类似</p> 
</blockquote> 
<p>??? properies文件配置，在service-cms模块配置文件添加redis配置</p> 
<blockquote> 
 <p>spring.redis.host=120.55.59.163<br> spring.redis.port=6379<br> spring.redis.database= 0<br> spring.redis.timeout=1800000<br> spring.redis.lettuce.pool.max-active=20<br> spring.redis.lettuce.pool.max-wait=-1<br> #最大阻塞等待时间(负数表示没限制)<br> spring.redis.lettuce.pool.max-idle=5<br> spring.redis.lettuce.pool.min-idle=0</p> 
</blockquote> 
<p>??? 修改CrmBannerServiceImpl，添加redis缓存注解</p> 
<pre><code class="prism language-bash">@Service
public class CrmBannerServiceImpl extends ServiceImpl<span class="token operator">&lt;</span>CrmBannerMapper,
CrmBanner<span class="token operator">&gt;</span> implements CrmBannerService <span class="token punctuation">{<!-- --></span>
  /**
  * 查询所有banner
  * @return
  */
  @Cacheable<span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"banner"</span>,key <span class="token operator">=</span> <span class="token string">"'selectIndexList'"</span><span class="token punctuation">)</span>
  @Override
  public List<span class="token operator">&lt;</span>CrmBanner<span class="token operator">&gt;</span> <span class="token function-name function">selectAllBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    //根据id进行降序排列，显示排列之后前两条记录
    QueryWrapper<span class="token operator">&lt;</span>CrmBanner<span class="token operator">&gt;</span> wrapper <span class="token operator">=</span> new QueryWrapper<span class="token operator">&lt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper.orderByDesc<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //last方法，拼接sql语句
    wrapper.last<span class="token punctuation">(</span><span class="token string">"limit 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>CrmBanner<span class="token operator">&gt;</span> list <span class="token operator">=</span> baseMapper.selectList<span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> list<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>??? 在redis添加了key</p> 
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"banner::selectIndexList"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"name"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get banner::selectIndexList
<span class="token string">"[<span class="token entity" title='"'>"</span>java.util.ArrayList<span class="token entity" title='"'>"</span>,[[<span class="token entity" title='"'>"</span>com.wq.educms.entity.CrmBanner<span class="token entity" title='"'>"</span>,
{<!-- --><span class="token entity" title='"'>"</span>id<span class="token entity" title='"'>"</span>:<span class="token entity" title='"'>"</span>1194556896025845762<span class="token entity" title='"'>"</span>,<span class="token entity" title='"'>"</span>title<span class="token entity" title='"'>"</span>:<span class="token entity" title='"'>"</span>test1<span class="token entity" title='"'>"</span>,<span class="token entity" title='"'>"</span>imageUrl<span class="token entity" title='"'>"</span>:<span class="token entity" title='"'>"</span>https://onlin
e-teach-file.oss-cn-beijing.aliyuncs.com/cms/2019/11/14/297acd3b-b592-4cfb-a446-
a28310369675.jpg<span class="token entity" title='"'>"</span>,<span class="token entity" title='"'>"</span>linkUrl<span class="token entity" title='"'>"</span>:<span class="token entity" title='"'>"</span>/course<span class="token entity" title='"'>"</span>,<span class="token entity" title='"'>"</span>sort<span class="token entity" title='"'>"</span>:1,<span class="token entity" title='"'>"</span>isDeleted<span class="token entity" title='"'>"</span>:false,<span class="token entity" title='"'>"</span>gmtC
reate<span class="token entity" title='"'>"</span>:[<span class="token entity" title='"'>"</span>java.util.Date<span class="token entity" title='"'>"</span>,1573639532000],<span class="token entity" title='"'>"</span>gmtModified<span class="token entity" title='"'>"</span>:
[<span class="token entity" title='"'>"</span>java.util.Date<span class="token entity" title='"'>"</span>,1574044102000]}],[<span class="token entity" title='"'>"</span>com.wq.educms.entity.CrmBanner<span class="token entity" title='"'>"</span>,
{<!-- --><span class="token entity" title='"'>"</span>id<span class="token entity" title='"'>"</span>:<span class="token entity" title='"'>"</span>1194607458461216769<span class="token entity" title='"'>"</span>,<span class="token entity" title='"'>"</span>title<span class="token entity" title='"'>"</span>:<span class="token entity" title='"'>"</span>test2<span class="token entity" title='"'>"</span>,<span class="token entity" title='"'>"</span>imageUrl<span class="token entity" title='"'>"</span>:<span class="token entity" title='"'>"</span>https://onlin
e-teach-file.oss-cn-beijing.aliyuncs.com/cms/2019/11/13/8f80790d-d736-4842-a6a4-
4dcb0d684d4e.jpg<span class="token entity" title='"'>"</span>,<span class="token entity" title='"'>"</span>linkUrl<span class="token entity" title='"'>"</span>:<span class="token entity" title='"'>"</span>/teacher<span class="token entity" title='"'>"</span>,<span class="token entity" title='"'>"</span>sort<span class="token entity" title='"'>"</span>:2,<span class="token entity" title='"'>"</span>isDeleted<span class="token entity" title='"'>"</span>:false,<span class="token entity" title='"'>"</span>gmt
Create<span class="token entity" title='"'>"</span>:[<span class="token entity" title='"'>"</span>java.util.Date<span class="token entity" title='"'>"</span>,1573651587000],<span class="token entity" title='"'>"</span>gmtModified<span class="token entity" title='"'>"</span>:
[<span class="token entity" title='"'>"</span>java.util.Date<span class="token entity" title='"'>"</span>,1573693935000]}]]]"</span>
</code></pre> 
<p>大家点赞、收藏、关注、评论啦 ??????微信公众号??????</p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
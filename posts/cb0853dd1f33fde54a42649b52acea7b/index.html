<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>【金融系列】【statsmodels】如何用Python做实证研究？介绍一个功能和STATA很像的Python包，最小二乘，虚拟变量 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【金融系列】【statsmodels】如何用Python做实证研究？介绍一个功能和STATA很像的Python包，最小二乘，虚拟变量</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>博主本科接触的研究主要是公司金融方向的研究，在公司金融的实证研究中，我们的终极目标是建立变量间的因果关系。我们需要识别因果关系，来检验理论、评价政策效果、或作出预测。目前该领域的研究大部分是使用了STATA和R这两种工具来开展研究的，其实作为开放性极强、实现更为快速的Python也可用于这方面的研究，并且我自认为使用Python还具有以下有点（或许还有更多）：<span style="color:#fe2c24">1、数据预处理更方便；2、模型建立逻辑更清晰；3、代码可重用性更强；4、可以更方便使用面向对象思想对研究模型进行封装；6、结合matplotlib等工具使得对数据、实证结果的展示可以更加丰富多彩；5、在教学中使用Python更能帮助学生理解模型建立的逻辑</span>（STATA的“懒人式”命令往往会让学生不去理解模型构建逻辑，只去记忆命令）。本文就将介绍一下statsmodels这一实现了很多STATA中的功能的模块。并且对一篇《金融研究》的论文进行部分结果的复现。</p> 
</blockquote> 
<p>求三连！数据、代码和论文地址：</p> 
<p>链接：https://pan.baidu.com/s/1Khy6-jZDTn9DMoz267NfFA?pwd=sv4i <br> 提取码：sv4i </p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="1.statsmodels%E5%AE%89%E8%A3%85%E4%B8%8E%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%E7%AE%80%E4%BB%8B-toc" style="margin-left:0px"><a href="#1.statsmodels%E5%AE%89%E8%A3%85%E4%B8%8E%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%E7%AE%80%E4%BB%8B">1.statsmodels安装与模块功能简介</a></p> 
<p id="regression-toc" style="margin-left:80px"><a href="#regression">Regression¶回归</a></p> 
<p id="imputation-toc" style="margin-left:80px"><a href="#imputation">Imputation¶插值处理</a></p> 
<p id="generalized-estimating-equations-toc" style="margin-left:80px"><a href="#generalized-estimating-equations">Generalized Estimating Equations¶广义估计方程</a></p> 
<p id="generalized-linear-models-toc" style="margin-left:80px"><a href="#generalized-linear-models">Generalized Linear Models¶广义线性模型</a></p> 
<p id="discrete-and-count-models-toc" style="margin-left:80px"><a href="#discrete-and-count-models">Discrete and Count Models¶离散模型</a></p> 
<p id="multivariate-models-toc" style="margin-left:80px"><a href="#multivariate-models">Multivariate Models¶多元模型</a></p> 
<p id="other-models-toc" style="margin-left:80px"><a href="#other-models">Other Models¶其他模型</a></p> 
<p id="graphics-toc" style="margin-left:80px"><a href="#graphics">Graphics¶画图</a></p> 
<p id="statistics-toc" style="margin-left:80px"><a href="#statistics">Statistics¶描述性统计</a></p> 
<p id="tools-toc" style="margin-left:80px"><a href="#tools">Tools¶</a></p> 
<p id="2.%E7%A4%BA%E4%BE%8B%EF%BC%9A%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0-toc" style="margin-left:0px"><a href="#2.%E7%A4%BA%E4%BE%8B%EF%BC%9A%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0">2.示例：论文复现</a></p> 
<p id="2.1%20%E8%AE%BA%E6%96%87%E6%83%85%E5%86%B5%E7%AE%80%E4%BB%8B-toc" style="margin-left:40px"><a href="#2.1%20%E8%AE%BA%E6%96%87%E6%83%85%E5%86%B5%E7%AE%80%E4%BB%8B">2.1 论文情况简介</a></p> 
<p id="2.2%20%E4%BB%A3%E9%99%85%E6%B5%81%E5%8A%A8%E6%80%A7%E6%97%B6%E9%97%B4%E8%B6%8B%E5%8A%BF%E5%9B%BE%E7%BB%98%E5%88%B6-toc" style="margin-left:40px"><a href="#2.2%20%E4%BB%A3%E9%99%85%E6%B5%81%E5%8A%A8%E6%80%A7%E6%97%B6%E9%97%B4%E8%B6%8B%E5%8A%BF%E5%9B%BE%E7%BB%98%E5%88%B6">2.2 代际流动性时间趋势图绘制</a></p> 
<p id="%C2%A02.3%20%E5%9F%BA%E5%87%86%E5%9B%9E%E5%BD%92%E5%8F%8A%E5%AE%9E%E7%8E%B0-toc" style="margin-left:40px"><a href="#%C2%A02.3%20%E5%9F%BA%E5%87%86%E5%9B%9E%E5%BD%92%E5%8F%8A%E5%AE%9E%E7%8E%B0"> 2.3 基准回归及实现</a></p> 
<hr id="hr-toc">
<p></p> 
<h1 id="1.statsmodels%E5%AE%89%E8%A3%85%E4%B8%8E%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%E7%AE%80%E4%BB%8B">1.statsmodels安装与模块功能简介</h1> 
<pre><code class="language-python">pip install statsmodels</code></pre> 
<p>statsmodels的API文档链接：</p> 
<p><a href="https://www.statsmodels.org/stable/api.html" title="API Reference — statsmodels">API Reference — statsmodels</a></p> 
<p> Statsmodels库是Python中一个强大的统计分析库，包含假设检验、回归分析、时间序列分析等功能，能够很好的和Numpy和Pandas等库结合起来，提高工作效率。</p> 
<h3 id="regression">Regression<a href="https://www.statsmodels.org/stable/api.html#regression" title="¶">¶</a>回归</h3> 
<table style="width:653px"><tbody>
<tr>
<td style="width:303px">函数</td>
<td style="width:178px">功能</td>
<td style="width:326px">解释</td>
</tr>
<tr>
<td style="width:303px"> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.linear_model.OLS.html#statsmodels.regression.linear_model.OLS" title="OLS">OLS</a>(endog[, exog, missing, hasconst])</p> </td>
<td style="width:178px"> <p>Ordinary Least Squares</p> </td>
<td style="width:326px">普通最小二乘</td>
</tr>
<tr>
<td style="width:303px"> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.linear_model.WLS.html#statsmodels.regression.linear_model.WLS" title="WLS">WLS</a>(endog, exog[, weights, missing, hasconst])</p> </td>
<td style="width:178px"> <p>Weighted Least Squares</p> </td>
<td style="width:326px">带权重的最小二乘（用于解决<a href="https://baike.baidu.com/item/%E5%BC%82%E6%96%B9%E5%B7%AE%E6%80%A7/3206526" title="异方差性">异方差性</a>）</td>
</tr>
<tr>
<td style="width:303px"> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.linear_model.GLS.html#statsmodels.regression.linear_model.GLS" title="GLS">GLS</a>(endog, exog[, sigma, missing, hasconst])</p> </td>
<td style="width:178px"> <p>Generalized Least Squares</p> </td>
<td style="width:326px">广义最小二乘（放弃残差平稳假设，残差带噪声时使用）</td>
</tr>
<tr>
<td style="width:303px"> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.linear_model.GLSAR.html#statsmodels.regression.linear_model.GLSAR" title="GLSAR">GLSAR</a>(endog[, exog, rho, missing, hasconst])</p> </td>
<td style="width:178px"> <p>Generalized Least Squares with AR covariance structure</p> </td>
<td style="width:326px">带AR (p)协方差结构的广义最小二乘</td>
</tr>
<tr>
<td style="width:303px"> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.recursive_ls.RecursiveLS.html#statsmodels.regression.recursive_ls.RecursiveLS" title="RecursiveLS">RecursiveLS</a>(endog, exog[, constraints])</p> </td>
<td style="width:178px"> <p>Recursive least squares</p> </td>
<td style="width:326px"> <p>递归最小二乘，参考：</p> <p>Durbin, James, and Siem Jan Koopman. 2012. Time Series Analysis by State Space Methods: Second Edition. Oxford University Press.</p> </td>
</tr>
<tr>
<td style="width:303px"> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.rolling.RollingOLS.html#statsmodels.regression.rolling.RollingOLS" title="RollingOLS">RollingOLS</a>(endog, exog[, window, min_nobs, ...])</p> </td>
<td style="width:178px"> <p>Rolling Ordinary Least Squares</p> </td>
<td style="width:326px"></td>
</tr>
<tr>
<td style="width:303px"> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.rolling.RollingWLS.html#statsmodels.regression.rolling.RollingWLS" title="RollingWLS">RollingWLS</a>(endog, exog[, window, weights, ...])</p> </td>
<td style="width:178px"> <p>Rolling Weighted Least Squares</p> </td>
<td style="width:326px"></td>
</tr>
</tbody></table>
<h3 id="imputation">Imputation<a href="https://www.statsmodels.org/stable/api.html#imputation" title="¶">¶</a>插值处理</h3> 
<p>数据缺失值处理可分两类。一类是删除缺失数据，一类是进行数据插补。进行有效的数据差补能够简历更好的回归。</p> 
<table><tbody>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.imputation.bayes_mi.BayesGaussMI.html#statsmodels.imputation.bayes_mi.BayesGaussMI" title="BayesGaussMI">BayesGaussMI</a>(data[, mean_prior, cov_prior, ...])</p> </td>
<td> <p>Bayesian Imputation using a Gaussian model.</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.imputation.bayes_mi.MI.html#statsmodels.imputation.bayes_mi.MI" title="MI">MI</a>(imp, model[, model_args_fn, ...])</p> </td>
<td> <p>MI performs multiple imputation using a provided imputer object.</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.imputation.mice.MICE.html#statsmodels.imputation.mice.MICE" title="MICE">MICE</a>(model_formula, model_class, data[, ...])</p> </td>
<td> <p>Multiple Imputation with Chained Equations.</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.imputation.mice.MICEData.html#statsmodels.imputation.mice.MICEData" title="MICEData">MICEData</a>(data[, perturbation_method, k_pmm, ...])</p> </td>
<td> <p>Wrap a data set to allow missing data handling with MICE.</p> </td>
</tr>
</tbody></table>
<h3 id="generalized-estimating-equations">Generalized Estimating Equations<a href="https://www.statsmodels.org/stable/api.html#generalized-estimating-equations" title="¶">¶</a>广义估计方程</h3> 
<p>广义估计方程是一种研究纵向数据（比如重复测量数据，面板数据）的方法。</p> 
<p>同一测量对象的多次测量数据结果之间很可能有着相关关系，如果不考虑数据之间的相关性会造成信息损失。常见的研究模型（比如线性回归）都要求数据之间独立，此时可使用广义估计方程进行研究。</p> 
<table><tbody>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.genmod.generalized_estimating_equations.GEE.html#statsmodels.genmod.generalized_estimating_equations.GEE" title="GEE">GEE</a>(endog, exog, groups[, time, family, ...])</p> </td>
<td> <p>Marginal Regression Model using Generalized Estimating Equations.</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.genmod.generalized_estimating_equations.NominalGEE.html#statsmodels.genmod.generalized_estimating_equations.NominalGEE" title="NominalGEE">NominalGEE</a>(endog, exog, groups[, time, ...])</p> </td>
<td> <p>Nominal Response Marginal Regression Model using GEE.</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.genmod.generalized_estimating_equations.OrdinalGEE.html#statsmodels.genmod.generalized_estimating_equations.OrdinalGEE" title="OrdinalGEE">OrdinalGEE</a>(endog, exog, groups[, time, ...])</p> </td>
<td> <p>Ordinal Response Marginal Regression Model using GEE</p> </td>
</tr>
</tbody></table>
<p></p> 
<h3 id="generalized-linear-models">Generalized Linear Models<a href="https://www.statsmodels.org/stable/api.html#generalized-linear-models" title="¶">¶</a>广义线性模型</h3> 
<p>在广义线性模型中，相比简单线性模型，这是对因变量Y进行了变换，使变换后的Y和X呈线性关系</p> 
<table><tbody>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.genmod.generalized_linear_model.GLM.html#statsmodels.genmod.generalized_linear_model.GLM" title="GLM">GLM</a>(endog, exog[, family, offset, exposure, ...])</p> </td>
<td> <p>Generalized Linear Models</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.gam.generalized_additive_model.GLMGam.html#statsmodels.gam.generalized_additive_model.GLMGam" title="GLMGam">GLMGam</a>(endog[, exog, smoother, alpha, ...])</p> </td>
<td> <p>Generalized Additive Models (GAM)</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.genmod.bayes_mixed_glm.BinomialBayesMixedGLM.html#statsmodels.genmod.bayes_mixed_glm.BinomialBayesMixedGLM" title="BinomialBayesMixedGLM">BinomialBayesMixedGLM</a>(endog, exog, exog_vc, ...)</p> </td>
<td> <p>Generalized Linear Mixed Model with Bayesian estimation</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.genmod.bayes_mixed_glm.PoissonBayesMixedGLM.html#statsmodels.genmod.bayes_mixed_glm.PoissonBayesMixedGLM" title="PoissonBayesMixedGLM">PoissonBayesMixedGLM</a>(endog, exog, exog_vc, ident)</p> </td>
<td> <p>Generalized Linear Mixed Model with Bayesian estimation</p> </td>
</tr>
</tbody></table>
<p></p> 
<h3 id="discrete-and-count-models">Discrete and Count Models<a href="https://www.statsmodels.org/stable/api.html#discrete-and-count-models" title="¶">¶</a>离散模型</h3> 
<table><tbody>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.discrete_model.Logit.html#statsmodels.discrete.discrete_model.Logit" title="Logit">Logit</a>(endog, exog[, check_rank])</p> </td>
<td> <p>Logit Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.discrete_model.Probit.html#statsmodels.discrete.discrete_model.Probit" title="Probit">Probit</a>(endog, exog[, check_rank])</p> </td>
<td> <p>Probit Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.discrete_model.MNLogit.html#statsmodels.discrete.discrete_model.MNLogit" title="MNLogit">MNLogit</a>(endog, exog[, check_rank])</p> </td>
<td> <p>Multinomial Logit Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.miscmodels.ordinal_model.OrderedModel.html#statsmodels.miscmodels.ordinal_model.OrderedModel" title="OrderedModel">OrderedModel</a>(endog, exog[, offset, distr])</p> </td>
<td> <p>Ordinal Model based on logistic or normal distribution</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.discrete_model.Poisson.html#statsmodels.discrete.discrete_model.Poisson" title="Poisson">Poisson</a>(endog, exog[, offset, exposure, ...])</p> </td>
<td> <p>Poisson Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.discrete_model.NegativeBinomial.html#statsmodels.discrete.discrete_model.NegativeBinomial" title="NegativeBinomial">NegativeBinomial</a>(endog, exog[, ...])</p> </td>
<td> <p>Negative Binomial Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.discrete_model.NegativeBinomialP.html#statsmodels.discrete.discrete_model.NegativeBinomialP" title="NegativeBinomialP">NegativeBinomialP</a>(endog, exog[, p, offset, ...])</p> </td>
<td> <p>Generalized Negative Binomial (NB-P) Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.discrete_model.GeneralizedPoisson.html#statsmodels.discrete.discrete_model.GeneralizedPoisson" title="GeneralizedPoisson">GeneralizedPoisson</a>(endog, exog[, p, offset, ...])</p> </td>
<td> <p>Generalized Poisson Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.count_model.ZeroInflatedPoisson.html#statsmodels.discrete.count_model.ZeroInflatedPoisson" title="ZeroInflatedPoisson">ZeroInflatedPoisson</a>(endog, exog[, ...])</p> </td>
<td> <p>Poisson Zero Inflated Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.count_model.ZeroInflatedNegativeBinomialP.html#statsmodels.discrete.count_model.ZeroInflatedNegativeBinomialP" title="ZeroInflatedNegativeBinomialP">ZeroInflatedNegativeBinomialP</a>(endog, exog[, ...])</p> </td>
<td> <p>Zero Inflated Generalized Negative Binomial Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.discrete.count_model.ZeroInflatedGeneralizedPoisson.html#statsmodels.discrete.count_model.ZeroInflatedGeneralizedPoisson" title="ZeroInflatedGeneralizedPoisson">ZeroInflatedGeneralizedPoisson</a>(endog, exog)</p> </td>
<td> <p>Zero Inflated Generalized Poisson Model</p> </td>
</tr>
</tbody></table>
<p></p> 
<h3 id="multivariate-models">Multivariate Models<a href="https://www.statsmodels.org/stable/api.html#multivariate-models" title="¶">¶</a>多元模型</h3> 
<table><tbody>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.multivariate.factor.Factor.html#statsmodels.multivariate.factor.Factor" title="Factor">Factor</a>([endog, n_factor, corr, method, smc, ...])</p> </td>
<td> <p>Factor analysis</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.multivariate.manova.MANOVA.html#statsmodels.multivariate.manova.MANOVA" title="MANOVA">MANOVA</a>(endog, exog[, missing, hasconst])</p> </td>
<td> <p>Multivariate Analysis of Variance</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.multivariate.pca.PCA.html#statsmodels.multivariate.pca.PCA" title="PCA">PCA</a>(data[, ncomp, standardize, demean, ...])</p> </td>
<td> <p>Principal Component Analysis</p> </td>
</tr>
</tbody></table>
<h3 id="other-models">Other Models<a href="https://www.statsmodels.org/stable/api.html#other-models" title="¶">¶</a>其他模型</h3> 
<p>MixedLM线性混合效应模型Linear Mixed Effects Model，这种模型结合了固定效应和随机效应。当使用存在内部聚集效应和重复测量数据时采用。研究中用的比较多。</p> 
<p>SurvfuncRight和PHReg不太懂，貌似跟生存分析有关系，医学上用的比较多？</p> 
<p>Quantile Regression分位数回归，金融的研究中用的也比较多，对于截尾拖尾数据很有效，有时候OLS无法探究的关系可以靠分位数回归搞定。</p> 
<p>Robust Linear Model稳健线性模型，是能够较好应对数据中的极端值的模型，能够削弱偶然出现的极端值对模型的影响，在量化投资中应用较多，用于削弱有些极端变化但是对股价影响并不大的因子。</p> 
<table><tbody>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.mixed_linear_model.MixedLM.html#statsmodels.regression.mixed_linear_model.MixedLM" title="MixedLM">MixedLM</a>(endog, exog, groups[, exog_re, ...])</p> </td>
<td> <p>Linear Mixed Effects Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.duration.survfunc.SurvfuncRight.html#statsmodels.duration.survfunc.SurvfuncRight" title="SurvfuncRight">SurvfuncRight</a>(time, status[, entry, title, ...])</p> </td>
<td> <p>Estimation and inference for a survival function.</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.duration.hazard_regression.PHReg.html#statsmodels.duration.hazard_regression.PHReg" title="PHReg">PHReg</a>(endog, exog[, status, entry, strata, ...])</p> </td>
<td> <p>Cox Proportional Hazards Regression Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.quantile_regression.QuantReg.html#statsmodels.regression.quantile_regression.QuantReg" title="QuantReg">QuantReg</a>(endog, exog, **kwargs)</p> </td>
<td> <p>Quantile Regression</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.robust.robust_linear_model.RLM.html#statsmodels.robust.robust_linear_model.RLM" title="RLM">RLM</a>(endog, exog[, M, missing])</p> </td>
<td> <p>Robust Linear Model</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.othermod.betareg.BetaModel.html#statsmodels.othermod.betareg.BetaModel" title="BetaModel">BetaModel</a>(endog, exog[, exog_precision, ...])</p> </td>
<td> <p>Beta Regression.</p> </td>
</tr>
</tbody></table>
<h3 id="graphics">Graphics<a href="https://www.statsmodels.org/stable/api.html#graphics" title="¶">¶</a>画图</h3> 
<table><tbody>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.gofplots.ProbPlot.html#statsmodels.graphics.gofplots.ProbPlot" title="ProbPlot">ProbPlot</a>(data[, dist, fit, distargs, a, ...])</p> </td>
<td> <p>Q-Q and P-P Probability Plots</p> </td>
<td> <p class="img-center"><img alt="" src="https://images2.imgbox.com/b7/db/wNMnppq0_o.png"></p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.gofplots.qqline.html#statsmodels.graphics.gofplots.qqline" title="qqline">qqline</a>(ax, line[, x, y, dist, fmt])</p> </td>
<td> <p>Plot a reference line for a qqplot.</p> </td>
<td> <p class="img-center"><img alt="" src="https://images2.imgbox.com/03/98/7jbpq3oc_o.png"></p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.gofplots.qqplot.html#statsmodels.graphics.gofplots.qqplot" title="qqplot">qqplot</a></p> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.gofplots.qqplot.html#statsmodels.graphics.gofplots.qqplot" title="qqplot">qqplot</a>(data[, dist, distargs, a, loc, ...])</p> </td>
<td> <p>Q-Q plot of the quantiles of x versus the quantiles/ppf of a distribution.</p> </td>
<td> <p class="img-center"><img alt="" src="https://images2.imgbox.com/11/3e/8THHwjlu_o.png"></p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.gofplots.qqplot_2samples.html#statsmodels.graphics.gofplots.qqplot_2samples" title="qqplot_2samples">qqplot_2samples</a>(data1, data2[, xlabel, ...])</p> </td>
<td> <p>Q-Q Plot of two samples' quantiles.</p> </td>
<td> <p class="img-center"><img alt="" src="https://images2.imgbox.com/c5/5c/ahMeLmw9_o.png"></p> </td>
</tr>
</tbody></table>
<h3 id="statistics">Statistics<a href="https://www.statsmodels.org/stable/api.html#statistics" title="¶">¶</a>描述性统计</h3> 
<table><tbody>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.stats.descriptivestats.Description.html#statsmodels.stats.descriptivestats.Description" title="Description">Description</a>(data[, stats, numeric, ...])</p> </td>
<td> <p>Extended descriptive statistics for data</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.stats.descriptivestats.describe.html#statsmodels.stats.descriptivestats.describe" title="describe">describe</a>(data[, stats, numeric, ...])</p> </td>
<td> <p>Extended descriptive statistics for data</p> </td>
</tr>
</tbody></table>
<p></p> 
<p>例子：</p> 
<p><img alt="" height="676" src="https://images2.imgbox.com/70/8b/vBQ6Oyv0_o.png" width="1200"></p> 
<h3 id="tools">Tools<a href="https://www.statsmodels.org/stable/api.html#tools" title="¶">¶</a>
</h3> 
<p>add_constant很有用，为数据添加一列1进行截距项的回归。</p> 
<table><tbody>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/dev/generated/statsmodels.__init__.test.html#statsmodels.__init__.test" title="test">test</a>([extra_args, exit])</p> </td>
<td> <p>Run the test suite</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.tools.tools.add_constant.html#statsmodels.tools.tools.add_constant" title="add_constant">add_constant</a>(data[, prepend, has_constant])</p> </td>
<td> <p>Add a column of ones to an array.</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.iolib.smpickle.load_pickle.html#statsmodels.iolib.smpickle.load_pickle" title="load_pickle">load_pickle</a>(fname)</p> </td>
<td> <p>Load a previously saved object</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.tools.print_version.show_versions.html#statsmodels.tools.print_version.show_versions" title="show_versions">show_versions</a>([show_dirs])</p> </td>
<td> <p>List the versions of statsmodels and any installed dependencies</p> </td>
</tr>
<tr>
<td> <p><a href="https://www.statsmodels.org/stable/generated/statsmodels.tools.web.webdoc.html#statsmodels.tools.web.webdoc" title="webdoc">webdoc</a>([func, stable])</p> </td>
<td> <p>Opens a browser and displays online documentation其他</p> </td>
</tr>
</tbody></table>
<p>除了上述功能外，还有诸如Univariate Time-Series Analysis（单变量时间序列分析）、Multivariate Time Series Models（多元时间序列模型）、Filters and Decompositions（过滤降维算法）、Markov Regime Switching Models（马尔科夫机制转换模型）等等。</p> 
<h1 id="2.%E7%A4%BA%E4%BE%8B%EF%BC%9A%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0">2.示例：论文复现</h1> 
<p>为了给出一个实际的例子，加深学习印象，选择了一篇发表在《金融研究》上的论文对其进行部分复现。</p> 
<h2 id="2.1%20%E8%AE%BA%E6%96%87%E6%83%85%E5%86%B5%E7%AE%80%E4%BB%8B">2.1 论文情况简介</h2> 
<p><a class="has-card" href="https://kns.cnki.net/kcms/detail/detail.aspx?dbcode=CJFD&amp;dbname=CJFDLAST2021&amp;filename=JRYJ202106005&amp;uniplatform=NZKPT&amp;v=Dy2OTtraPRzoUOo03HDEpf09y-Qrk1KRueN9Eqk7cqjes2XjVzLZJ9e_ywxmTen1" title="义务教育能提高代际流动性吗? - 中国知网"><span class="link-card-box"><span class="link-title">义务教育能提高代际流动性吗? - 中国知网</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/e6/f8/6ddNHI8t_o.png">https://kns.cnki.net/kcms/detail/detail.aspx?dbcode=CJFD&amp;dbname=CJFDLAST2021&amp;filename=JRYJ202106005&amp;uniplatform=NZKPT&amp;v=Dy2OTtraPRzoUOo03HDEpf09y-Qrk1KRueN9Eqk7cqjes2XjVzLZJ9e_ywxmTen1</span></span></a></p> 
<p>[1]陈斌开,张淑娟,申广军.义务教育能提高代际流动性吗?[J].金融研究,2021(06):76-94.</p> 
<p>依赖包导入：</p> 
<pre><code class="language-python">import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import statsmodels.api as sm
import statsmodels
np.random.seed(2022)</code></pre> 
<p>数据导入：</p> 
<pre><code class="language-python">data = pd.read_excel(r'data_merge2.xlsx')#这里改成你的数据所在文件的路径</code></pre> 
<p>数据预览：</p> 
<pre><code>data</code></pre> 
<table border="1">
<thead><tr>
<th>hhcode</th>
<th>coun</th>
<th>househead</th>
<th>gender</th>
<th>birthyear</th>
<th>nationality</th>
<th>siblings</th>
<th>hukou</th>
<th>education</th>
<th>ChildEdu</th>
<th>...</th>
<th>Educorr1</th>
<th>Educorr2</th>
<th>Educorr3</th>
<th>Educorr4</th>
<th>Educorr5</th>
<th>PY</th>
<th>x</th>
<th>Eligibility</th>
<th>fa_work</th>
<th>birthyear_groupby5</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td style="vertical-align:middle;width:48pt"><span style="color:#000000">家庭编码</span></td>
<td style="vertical-align:middle;width:48pt"><span style="color:#000000">县区编码</span></td>
<td style="vertical-align:middle;width:58pt"><span style="color:#000000">是否是户主</span></td>
<td style="vertical-align:middle;width:48pt"><span style="color:#000000">性别</span></td>
<td style="vertical-align:middle;width:48pt"><span style="color:#000000">出生年份</span></td>
<td style="vertical-align:middle;width:48pt"><span style="color:#000000">民族</span></td>
<td style="vertical-align:middle;width:48pt"><span style="color:#000000">子女个数</span></td>
<td style="vertical-align:middle;width:48pt"><span style="color:#000000">户口</span></td>
<td style="vertical-align:middle;width:59pt"><span style="color:#000000">受教育程度</span></td>
<td style="vertical-align:middle;width:58pt"><span style="color:#000000">受教育年限</span></td>
<td style="vertical-align:middle;width:67pt"><span style="color:#000000">父亲受教育程度</span></td>
<td style="vertical-align:middle;width:66pt"><span style="color:#000000">母亲受教育程度</span></td>
<td style="vertical-align:middle;width:54pt"><span style="color:#000000">父亲职业</span></td>
<td style="vertical-align:middle;width:62pt"><span style="color:#000000">母亲职业</span></td>
<td style="vertical-align:middle;width:92pt"><span style="color:#000000">父亲受教育年限</span></td>
<td style="vertical-align:middle;width:86pt"><span style="color:#000000">母亲受教育年限</span></td>
<td style="vertical-align:middle;width:86pt"><span style="color:#000000">父母平均受教育年限</span></td>
<td style="vertical-align:middle;width:48pt"><span style="color:#000000">省份</span></td>
<td style="vertical-align:middle;width:70pt"><span style="color:#000000">父母最高受教育年限</span></td>
<td style="vertical-align:middle;width:59pt"><span style="color:#000000">父母最低受教育年限</span></td>
<td colspan="3" style="vertical-align:middle;width:144pt"><span style="color:#000000">相关系数：衡量代际流动性</span></td>
<td style="vertical-align:middle;width:48pt"></td>
<td style="vertical-align:middle;width:48pt"></td>
<td style="vertical-align:middle;width:81pt"><span style="color:#000000">义务教育政策开始年份</span></td>
<td style="vertical-align:middle;width:82pt"><span style="color:#000000">义务教育开始时年龄</span></td>
<td style="vertical-align:middle;width:101pt"><span style="color:#000000">受义务教育影响程度大小</span></td>
<td style="vertical-align:middle;width:48pt"><span style="color:#000000">父亲职业分组</span></td>
</tr>
<tr>
<th>0</th>
<td>1101065303202</td>
<td>110106</td>
<td>1</td>
<td>2</td>
<td>1976</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>9.0</td>
<td>...</td>
<td>0.214808</td>
<td>0.503370</td>
<td>0.349154</td>
<td>0.245640</td>
<td>0.554755</td>
<td>1986</td>
<td>10</td>
<td>0.666667</td>
<td>NaN</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>0</td>
</tr>
<tr>
<th>1</th>
<td>1101065306101</td>
<td>110106</td>
<td>1</td>
<td>1</td>
<td>1957</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>...</td>
<td>0.276842</td>
<td>0.123774</td>
<td>0.207662</td>
<td>0.276842</td>
<td>0.137444</td>
<td>1986</td>
<td>29</td>
<td>0.000000</td>
<td>NaN</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<td>1101065309001</td>
<td>110106</td>
<td>1</td>
<td>1</td>
<td>1960</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>8.0</td>
<td>...</td>
<td>0.146180</td>
<td>0.355535</td>
<td>0.267936</td>
<td>0.190255</td>
<td>0.311783</td>
<td>1986</td>
<td>26</td>
<td>0.000000</td>
<td>NaN</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>2</td>
</tr>
<tr>
<th>3</th>
<td>1101065311101</td>
<td>110106</td>
<td>1</td>
<td>2</td>
<td>1936</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>NaN</td>
<td>...</td>
<td>0.790569</td>
<td>0.607143</td>
<td>0.852116</td>
<td>0.790569</td>
<td>0.607143</td>
<td>1986</td>
<td>50</td>
<td>0.000000</td>
<td>NaN</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>3</td>
</tr>
<tr>
<th>4</th>
<td>1101066100401</td>
<td>110106</td>
<td>1</td>
<td>1</td>
<td>1976</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>9.0</td>
<td>...</td>
<td>0.214808</td>
<td>0.503370</td>
<td>0.349154</td>
<td>0.245640</td>
<td>0.554755</td>
<td>1986</td>
<td>10</td>
<td>0.666667</td>
<td>NaN</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>4</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>...</td>
</tr>
<tr>
<th>32917</th>
<td>6210210205901</td>
<td>621021</td>
<td>2</td>
<td>2</td>
<td>1975</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>...</td>
<td>0.359305</td>
<td>0.449707</td>
<td>0.471492</td>
<td>0.354519</td>
<td>0.483449</td>
<td>1991</td>
<td>16</td>
<td>0.000000</td>
<td>11.0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>5</td>
</tr>
<tr>
<th>32918</th>
<td>6210210209201</td>
<td>621021</td>
<td>2</td>
<td>2</td>
<td>1959</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>...</td>
<td>0.501423</td>
<td>0.196046</td>
<td>0.467181</td>
<td>0.501423</td>
<td>0.196046</td>
<td>1991</td>
<td>32</td>
<td>0.000000</td>
<td>11.0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>6</td>
</tr>
<tr>
<th>32919</th>
<td>6210210210501</td>
<td>621021</td>
<td>2</td>
<td>1</td>
<td>1977</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>...</td>
<td>0.443866</td>
<td>0.404331</td>
<td>0.498954</td>
<td>0.434100</td>
<td>0.432057</td>
<td>1991</td>
<td>14</td>
<td>0.222222</td>
<td>11.0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>7</td>
</tr>
<tr>
<th>32920</th>
<td>6210210211801</td>
<td>621021</td>
<td>2</td>
<td>2</td>
<td>1984</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>8.0</td>
<td>...</td>
<td>-0.018009</td>
<td>0.337699</td>
<td>0.167929</td>
<td>0.147695</td>
<td>0.144852</td>
<td>1991</td>
<td>7</td>
<td>1.000000</td>
<td>11.0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>8</td>
</tr>
<tr>
<th>32921</th>
<td>6210220110401</td>
<td>621022</td>
<td>2</td>
<td>2</td>
<td>1979</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
<td>8.0</td>
<td>...</td>
<td>0.611632</td>
<td>0.232354</td>
<td>0.528778</td>
<td>0.610094</td>
<td>0.306826</td>
<td>1991</td>
<td>12</td>
<td>0.444444</td>
<td>11.0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>32922 rows × 30 columns</p> 
<p> 描述性统计：</p> 
<pre><code class="language-python">data.describe()</code></pre> 
<table border="1">
<thead><tr>
<th>coun</th>
<th>househead</th>
<th>gender</th>
<th>birthyear</th>
<th>nationality</th>
<th>siblings</th>
<th>hukou</th>
<th>education</th>
<th>ChildEdu</th>
<th>father_edu</th>
<th>...</th>
<th>Educorr1</th>
<th>Educorr2</th>
<th>Educorr3</th>
<th>Educorr4</th>
<th>Educorr5</th>
<th>PY</th>
<th>x</th>
<th>Eligibility</th>
<th>fa_work</th>
<th>birthyear_groupby5</th>
</tr></thead>
<tbody>
<tr>
<th>count</th>
<td>32922.000000</td>
<td>32922.000000</td>
<td>32922.000000</td>
<td>32922.000000</td>
<td>32916.000000</td>
<td>32785.000000</td>
<td>32914.000000</td>
<td>32911.000000</td>
<td>31999.000000</td>
<td>31195.000000</td>
<td>...</td>
<td>32575.000000</td>
<td>31706.000000</td>
<td>32586.000000</td>
<td>32578.000000</td>
<td>31578.000000</td>
<td>32922.000000</td>
<td>32922.000000</td>
<td>32922.000000</td>
<td>25588.000000</td>
<td>32922.000000</td>
</tr>
<tr>
<th>mean</th>
<td>382013.629549</td>
<td>1.478677</td>
<td>1.506105</td>
<td>1962.923881</td>
<td>1.339318</td>
<td>2.870581</td>
<td>1.552956</td>
<td>3.342196</td>
<td>8.255899</td>
<td>1.858856</td>
<td>...</td>
<td>0.329442</td>
<td>0.307071</td>
<td>0.357607</td>
<td>0.337348</td>
<td>0.306641</td>
<td>1987.269273</td>
<td>24.345392</td>
<td>0.145553</td>
<td>11.286931</td>
<td>7.998937</td>
</tr>
<tr>
<th>std</th>
<td>135042.465042</td>
<td>0.499553</td>
<td>0.499970</td>
<td>11.895852</td>
<td>1.406428</td>
<td>1.754655</td>
<td>0.686343</td>
<td>1.781469</td>
<td>3.639925</td>
<td>1.210058</td>
<td>...</td>
<td>0.177946</td>
<td>0.178255</td>
<td>0.181399</td>
<td>0.177930</td>
<td>0.175811</td>
<td>1.726825</td>
<td>11.973904</td>
<td>0.308486</td>
<td>0.521000</td>
<td>4.898945</td>
</tr>
<tr>
<th>min</th>
<td>110101.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1916.000000</td>
<td>1.000000</td>
<td>-1.000000</td>
<td>1.000000</td>
<td>-1.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>...</td>
<td>-1.000000</td>
<td>-1.000000</td>
<td>-1.000000</td>
<td>-1.000000</td>
<td>-1.000000</td>
<td>1986.000000</td>
<td>-12.000000</td>
<td>0.000000</td>
<td>9.000000</td>
<td>0.000000</td>
</tr>
<tr>
<th>25%</th>
<td>321002.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1955.000000</td>
<td>1.000000</td>
<td>2.000000</td>
<td>1.000000</td>
<td>2.000000</td>
<td>6.000000</td>
<td>1.000000</td>
<td>...</td>
<td>0.234758</td>
<td>0.198073</td>
<td>0.257497</td>
<td>0.241156</td>
<td>0.210418</td>
<td>1986.000000</td>
<td>16.000000</td>
<td>0.000000</td>
<td>11.000000</td>
<td>4.000000</td>
</tr>
<tr>
<th>50%</th>
<td>411421.000000</td>
<td>1.000000</td>
<td>2.000000</td>
<td>1964.000000</td>
<td>1.000000</td>
<td>3.000000</td>
<td>1.000000</td>
<td>3.000000</td>
<td>8.000000</td>
<td>2.000000</td>
<td>...</td>
<td>0.340944</td>
<td>0.322726</td>
<td>0.366655</td>
<td>0.343839</td>
<td>0.315769</td>
<td>1987.000000</td>
<td>23.000000</td>
<td>0.000000</td>
<td>11.000000</td>
<td>8.000000</td>
</tr>
<tr>
<th>75%</th>
<td>445381.000000</td>
<td>2.000000</td>
<td>2.000000</td>
<td>1971.000000</td>
<td>1.000000</td>
<td>4.000000</td>
<td>2.000000</td>
<td>4.000000</td>
<td>10.000000</td>
<td>2.000000</td>
<td>...</td>
<td>0.426330</td>
<td>0.414291</td>
<td>0.466546</td>
<td>0.438355</td>
<td>0.418991</td>
<td>1987.000000</td>
<td>33.000000</td>
<td>0.000000</td>
<td>12.000000</td>
<td>12.000000</td>
</tr>
<tr>
<th>max</th>
<td>621121.000000</td>
<td>2.000000</td>
<td>2.000000</td>
<td>1999.000000</td>
<td>8.000000</td>
<td>12.000000</td>
<td>4.000000</td>
<td>9.000000</td>
<td>21.000000</td>
<td>9.000000</td>
<td>...</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1992.000000</td>
<td>72.000000</td>
<td>1.000000</td>
<td>13.000000</td>
<td>16.000000</td>
</tr>
</tbody>
</table>
<p>8 rows × 29 columns</p> 
<p></p> 
<h2 id="2.2%20%E4%BB%A3%E9%99%85%E6%B5%81%E5%8A%A8%E6%80%A7%E6%97%B6%E9%97%B4%E8%B6%8B%E5%8A%BF%E5%9B%BE%E7%BB%98%E5%88%B6">2.2 代际流动性时间趋势图绘制</h2> 
<pre><code class="language-python">import matplotlib as mpl
import matplotlib.pyplot as plt
data_draw = data.loc[data["Educorr1"] &gt;0]
data_draw = data_draw.loc[data_draw["Educorr2"] &gt;0]
data_draw = data_draw.loc[data_draw["Educorr3"] &gt;0]
data_draw = data_draw.loc[data_draw["Educorr4"] &gt;0]
#设置字体
plt.rcParams['font.family'] = 'FangSong'   # 设置字体为仿宋
plt.figure()

# 绘制一个子图，其中row=2,co1=2，该子图占第1个位置
plt.subplot(2, 2, 1)
plt.scatter(data_draw['birthyear'], data_draw['Educorr1'], color="black", s=10, zorder=1)
z = np.polyfit(data_draw.dropna()['birthyear'], data_draw.dropna()['Educorr1'], 1)
p = np.poly1d(z)
plt.plot(data_draw.dropna()['birthyear'],p(data_draw.dropna()['birthyear']),"r--")

plt.ylabel("教育流动性", fontsize=12)
# 绘制一个子图，其中row=2,col=2，该子图占第2个位置
plt.subplot(2, 2, 2)
plt.scatter(data_draw['birthyear'], data_draw['Educorr2'], color="blue", s=10, zorder=1)
z = np.polyfit(data_draw.dropna()['birthyear'], data_draw.dropna()['Educorr2'], 1)
p = np.poly1d(z)
plt.plot(data_draw.dropna()['birthyear'],p(data_draw.dropna()['birthyear']),"r--")


plt.subplot(2, 2, 3)
plt.scatter(data_draw['birthyear'], data_draw['Educorr3'], color="green", s=10, zorder=1)
z = np.polyfit(data_draw.dropna()['birthyear'], data_draw.dropna()['Educorr3'], 1)
p = np.poly1d(z)
plt.plot(data_draw.dropna()['birthyear'],p(data_draw.dropna()['birthyear']),"r--")
plt.xlabel("出生年份", fontsize=12)
plt.ylabel("教育流动性", fontsize=12)

plt.subplot(2, 2, 4)
plt.scatter(data_draw['birthyear'], data_draw['Educorr4'], color="yellow", s=10, zorder=1)
z = np.polyfit(data_draw.dropna()['birthyear'], data_draw.dropna()['Educorr4'], 1)
p = np.poly1d(z)
plt.plot(data_draw.dropna()['birthyear'],p(data_draw.dropna()['birthyear']),"r--")
plt.suptitle("代际流动性的时间趋势图", fontsize=15)    #默认字体大小为12
plt.xlabel("出生年份", fontsize=12)


plt.show()
</code></pre> 
<p> 输出：</p> 
<p class="img-center"><img alt="" height="293" src="https://images2.imgbox.com/1e/72/zQWnoFmr_o.png" width="387"></p> 
<p>原论文：</p> 
<p><img alt="" height="277" src="https://images2.imgbox.com/d2/bb/8zsYTyPQ_o.png" width="708"></p> 
<h2 id="%C2%A02.3%20%E5%9F%BA%E5%87%86%E5%9B%9E%E5%BD%92%E5%8F%8A%E5%AE%9E%E7%8E%B0"> 2.3 基准回归及实现</h2> 
<p>模型定义（见论文第5页）</p> 
<p><img alt="" height="161" src="https://images2.imgbox.com/8d/26/7aFb0V5j_o.png" width="694"></p> 
<p>模型需要为出生年份和省份控制固定效应（不知道这个说法是否准确，按理说应该面板数据才好控制固定效应，但这是截面数据，貌似是控制组间固定效应），控制方法是为每一个出生年份档位和省份都生成一个虚拟变量，并加入回归方程中。</p> 
<p>由于出生年份是每五年一个档位，原数据为具体每年的数据，因此构建一个新的变量存储样本的出生年份档位。 </p> 
<p>首先对出生年份数据进行描述性统计：</p> 
<pre><code class="language-python">data['birthyear'].describe()</code></pre> 
<p>结果： </p> 
<blockquote> 
 <pre>count    32922.000000
mean      1962.923881
std         11.895852
min       1916.000000
25%       1955.000000
50%       1964.000000
75%       1971.000000
max       1999.000000
Name: birthyear, dtype: float64</pre> 
</blockquote> 
<p>最小1916年，最大1999年，因此共有17个分组 ，生成变量birthyear_groupby5过程如下：</p> 
<pre><code class="language-python">a = list(range(1916,1999,5))
b = list(range(1921,2002,5))
birthyear_groupby5 = []
for year in data['birthyear']:
    for i in range(0,17):
        if(year&gt;=a[i] &amp; year&lt;b[i]):
            birthyear_groupby5.append(i)
data['birthyear_groupby5'] = pd.DataFrame(birthyear_groupby5)</code></pre> 
<p>将模型中要用到的变量保存到data1中：</p> 
<pre><code class="language-python">data1 = data[['coun','Educorr1','Eligibility','birthyear_groupby5','province']].dropna()</code></pre> 
<p>定义my_OLS函数（基于statsmodels.api.OLS()）:</p> 
<p>*注意函数里面实现了虚拟变量的生成和截距项的生成(更多内容见<a href="https://www.cnblogs.com/-wenli/p/12868439.html" title="【机器学习】 Statsmodels 统计包之 OLS 回归 - -零 - 博客园">【机器学习】 Statsmodels 统计包之 OLS 回归 - -零 - 博客园</a>)</p> 
<pre><code class="language-python">def my_OLS(data):
    data = data.dropna()
    nsample = len(data['coun'])
    x = data['Eligibility']
    dummy_birthyear_groupby5 = sm.categorical(data['birthyear_groupby5'].values,drop = True)
    dummy_province = sm.categorical(data['province'].values,drop = True)
    X = np.column_stack((x, dummy_birthyear_groupby5,dummy_province))
    X = sm.add_constant(X)
    #beta = np.ones( 2 + len(dummy_birthyear_groupby5[0]) + len(dummy_province[0]))
    e = np.random.normal(size=nsample)
    y = data['Educorr1']
    result = sm.OLS(y,X).fit()
    print(result.summary())
    return result</code></pre> 
<p><span style="color:#fe2c24"><strong> ****关注点：summary()输出回归表非常方便**** </strong></span></p> 
<p>回归：</p> 
<pre><code class="language-python">OLS1 = my_OLS(data1)</code></pre> 
<p>回归结果：</p> 
<blockquote> 
 <pre>                           OLS Regression Results                            
==============================================================================
Dep. Variable:               Educorr1   R-squared:                       0.061
Model:                            OLS   Adj. R-squared:                  0.060
Method:                 Least Squares   F-statistic:                     70.28
Date:                Thu, 05 May 2022   Prob (F-statistic):               0.00
Time:                        15:38:21   Log-Likelihood:                 11034.
No. Observations:               32575   AIC:                        -2.201e+04
Df Residuals:                   32544   BIC:                        -2.175e+04
Df Model:                          30                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.2818      0.001    297.766      0.000       0.280       0.284
x1             0.0989      0.003     31.634      0.000       0.093       0.105
x2             0.0130      0.004      3.412      0.001       0.006       0.021
x3             0.0181      0.004      4.738      0.000       0.011       0.026
x4             0.0231      0.004      6.042      0.000       0.016       0.031
x5             0.0178      0.004      4.658      0.000       0.010       0.025
x6             0.0143      0.004      3.753      0.000       0.007       0.022
x7             0.0180      0.004      4.699      0.000       0.010       0.025
x8             0.0189      0.004      4.945      0.000       0.011       0.026
x9             0.0193      0.004      5.056      0.000       0.012       0.027
x10            0.0128      0.004      3.351      0.001       0.005       0.020
x11            0.0102      0.004      2.668      0.008       0.003       0.018
x12            0.0171      0.004      4.477      0.000       0.010       0.025
x13            0.0154      0.004      4.033      0.000       0.008       0.023
x14            0.0133      0.004      3.482      0.000       0.006       0.021
x15            0.0203      0.004      5.318      0.000       0.013       0.028
x16            0.0158      0.004      4.128      0.000       0.008       0.023
x17            0.0143      0.004      3.734      0.000       0.007       0.022
x18            0.0199      0.004      5.194      0.000       0.012       0.027
x19            0.0165      0.004      4.477      0.000       0.009       0.024
x20            0.0072      0.003      2.053      0.040       0.000       0.014
x21            0.0270      0.004      7.287      0.000       0.020       0.034
x22            0.0178      0.003      5.577      0.000       0.012       0.024
x23            0.0134      0.004      3.766      0.000       0.006       0.020
x24           -0.0216      0.003     -6.896      0.000      -0.028      -0.015
x25            0.0106      0.003      3.421      0.001       0.005       0.017
x26           -0.0148      0.003     -4.281      0.000      -0.022      -0.008
x27           -0.0107      0.003     -3.129      0.002      -0.017      -0.004
x28            0.0200      0.003      6.269      0.000       0.014       0.026
x29            0.0855      0.004     21.846      0.000       0.078       0.093
x30           -0.0136      0.003     -4.036      0.000      -0.020      -0.007
x31            0.0515      0.004     13.913      0.000       0.044       0.059
x32            0.0931      0.004     24.275      0.000       0.086       0.101
==============================================================================
Omnibus:                     4647.437   Durbin-Watson:                   1.976
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            19392.273
Skew:                          -0.658   Prob(JB):                         0.00
Kurtosis:                       6.544   Cond. No.                     2.77e+15
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 4.92e-27. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.</pre> 
</blockquote> 
<p></p> 
<p>更多statsmodels内容等待以后探索</p> 
<p></p> 
<h1>参考文献</h1> 
<p>[1]陈斌开,张淑娟,申广军.义务教育能提高代际流动性吗?[J].金融研究,2021(06):76-94.</p>
                </div>

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
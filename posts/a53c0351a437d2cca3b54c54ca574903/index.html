<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>【经典永不过时】数据分析网红级别的项目案例分享【超详细】 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【经典永不过时】数据分析网红级别的项目案例分享【超详细】</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <p>大家好，你可以叫俺老吴，本周给大家分享的数据分析案例是<a href="https://www.kaggle.com/c/titanic/">泰坦尼克号幸存者预测</a>的项目，没记错的话，这应该是很多朋友写在简历上的项目经历。不过这里我先提一嘴，如果你目前正在找工作，想要充实项目经历的话，建议还是不要把它写到你的简历上了，原因就是刚刚说的——实在太多人写在简历上了，没有特色。</p> 
<p>但是，虽然不建议你写到简历上，却强烈建议你亲身体验一遍，毕竟这么多人都喜欢的项目还是有它的道理在的。</p> 
<p>详细的项目背景介绍可以参考<a href="https://www.kaggle.com/c/titanic/">这里</a>，多的不说，本篇博客将详细地把整个项目流程分享给你，<strong>欢迎收藏</strong>。</p> 
<p></p>
<div class="toc">
 <h3>目录</h3>
 <ul>
<li><a href="#_8">泰坦尼克号幸存者预测</a></li>
<li>
<ul>
<li><a href="#1__32">1 获取数据集</a></li>
<li><a href="#11__44">1.1 探索性数据分析</a></li>
<li>
<ul>
<li><a href="#111__62">1.1.1 预览数据</a></li>
<li><a href="#112__212">1.1.2 数据集的大致信息</a></li>
<li><a href="#113__292">1.1.3 数据集的描述性统计信息</a></li>
<li><a href="#114__427">1.1.4 数据集缺失值详情</a></li>
<li><a href="#115__588">1.1.5 假设</a></li>
<li>
<ul>
<li><a href="#1151__Age_Sex_Survived__607">1.1.5.1 数值型 Age、类别型 Sex、类别型 Survived 三者之间的关系:</a></li>
<li>
<ul>
<li><a href="#11511__Age__Survived__845">1.1.5.1.1 数值型 Age、 类别型 Survived 两者之间的关系</a></li>
<li><a href="#11512__Sex__Survived___Survived_879">1.1.5.1.2 类别型 Sex、 数值型 Survived 两者之间的关系 (这里用的是数值型 Survived，可能需要放到其他位置)</a></li>
</ul>
     </li>
<li><a href="#1152__Embarked_Pclass_Sex_Survived_4_898">1.1.5.2 类别型 Embarked、类别型 Pclass、类别型 Sex、数值型 Survived 4者之间的关系</a></li>
<li><a href="#1153__Pclass__Survived__917">1.1.5.3 类别型 Pclass、 数值型 Survived 两者之间的关系</a></li>
<li><a href="#1154__Pclass_Age__Survived__930">1.1.5.4 类别型 Pclass、数值型 Age、 类别型 Survived 三者之间的关系</a></li>
<li><a href="#1155__SibSp__Parch__Survived_3_955">1.1.5.5 数值型 SibSp、 数值型 Parch、 数值型 Survived 3者之间的关系</a></li>
</ul>
   </li>
</ul>
   </li>
<li><a href="#2__1106">2 特征工程</a></li>
<li>
<ul>
<li><a href="#21__PassengerId___1163">2.1 处理特征 PassengerId - 删除特征</a></li>
<li><a href="#22__Name___1172">2.2 处理特征 Name - 创建新的特征:乘客称谓</a></li>
<li><a href="#23__Age___1284">2.3 处理特征 Age - 缺失值填写</a></li>
<li>
<ul>
<li><a href="#231__Cabin____1363">2.3.1 处理特征 Cabin - 创建新的特征：甲板号 (暂时不用这个方法)</a></li>
<li><a href="#232__1440">2.3.2 知识点：正则表达式</a></li>
<li><a href="#233__EmbarkedFare___1485">2.3.3 处理其他特征 Embarked、Fare - 缺失值填充</a></li>
</ul>
    </li>
<li><a href="#24__SibSp__Parch___FamilySize_1570">2.4 处理特征 SibSp 和 Parch - 创建新的特征 FamilySize</a></li>
<li><a href="#25__Cabin___Deck_1578">2.5 处理特征 Cabin - 创建新的特征 Deck</a></li>
<li><a href="#26__1757">2.6 编码</a></li>
</ul>
   </li>
<li><a href="#3__2054">3 建模</a></li>
</ul>
  </li>
<li><a href="#_2101">结束语</a></li>
</ul>
</div>
<p></p> 
<h1>
<a id="_8"></a>泰坦尼克号幸存者预测</h1> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np  <span class="token comment"># 科学计算工具包</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd  <span class="token comment"># 数据分析工具包</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt <span class="token comment"># 图表绘制工具包</span>
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns <span class="token comment"># 基于 matplot, 导入 seaborn 会修改默认的 matplotlib 配色方案和绘图样式，这会提高图表的可读性和美观性</span>

<span class="token comment"># 算法库</span>
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> linear_model
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> Perceptron
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> SGDClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC<span class="token punctuation">,</span> LinearSVC
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">import</span> GaussianNB

<span class="token comment"># 在 jupyter notebook 里面显示图表</span>
<span class="token operator">%</span>matplotlib inline 
</code></pre> 
<h2>
<a id="1__32"></a>1 获取数据集</h2> 
<p>读取参数指定的文件，返回一个DataFrame类型的对象。</p> 
<p>有两个数据集：训练集和测试集。 我们将使用训练集来构建我们的预测模型，用测试集来对其进行评分并生成输出文件以在Kaggle评估系统上提交。</p> 
<pre><code class="prism language-python">test_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"./test.csv"</span><span class="token punctuation">)</span>
train_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"./train.csv"</span><span class="token punctuation">)</span>
</code></pre> 
<h2>
<a id="11__44"></a>1.1 探索性数据分析</h2> 
<p>开始探索数据，带着问题去理解数据。</p> 
<p>通过以下的属性和方法了解数据</p> 
<ul>
<li>属性 
  <ul><li>
<code>df.columns.value</code> 数据集中所有列名(特征),numpy.ndarray 类型</li></ul> </li>
<li>方法 
  <ul>
<li>
<code>df.head()</code> 预览数据集前5行</li>
<li>
<code>df.tail()</code> 预览数据集后5行</li>
<li>
<code>df.info()</code> 显示大致数据信息，包括每列名称，非空值数量，每列的数据类型，内存占用等信息。</li>
<li>
<code>df.describe()</code> 展示数据的一些描述性统计信息,但会过滤掉缺失值。默认只统计数值类型的字段内容。 
    <ul>
<li>
<code>describe(include=‘ALL‘)</code>,统计所有类型的数据</li>
<li>
<code>describe(include=[np.number])</code> 只统计数值类型的字段内容：count计数，mean平均数，std方差，min最小值，四分位数，max 最大值</li>
<li>
<code>describe(include=[np.object])</code> 只统计object类型的字段内容</li>
<li>`describe(include=‘O’) 只统计字符串类型的字段内容：count计数，unique唯一值数量，top出现频率最高的内容，freq最高出现频率</li>
<li>
<code>describe(percentiles=[])</code>:设置输出的百分位数，默认为[.25，.5，.75]，返回第25，第50和第75百分位数。</li>
</ul> </li>
</ul> </li>
</ul> 
<h3>
<a id="111__62"></a>1.1.1 预览数据</h3> 
<ul><li>
<code>df.head()</code> 预览数据集前5行</li></ul> 
<pre><code class="prism language-python">train_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<div> 
</div> 
<table border="1" class="dataframe">
<thead><tr>
<th></th>
<th>PassengerId</th>
<th>Survived</th>
<th>Pclass</th>
<th>Name</th>
<th>Sex</th>
<th>Age</th>
<th>SibSp</th>
<th>Parch</th>
<th>Ticket</th>
<th>Fare</th>
<th>Cabin</th>
<th>Embarked</th>
</tr></thead>
<tbody>
<tr>
<th>0</th>
<td>1</td>
<td>0</td>
<td>3</td>
<td>Braund, Mr. Owen Harris</td>
<td>male</td>
<td>22.0</td>
<td>1</td>
<td>0</td>
<td>A/5 21171</td>
<td>7.2500</td>
<td>NaN</td>
<td>S</td>
</tr>
<tr>
<th>1</th>
<td>2</td>
<td>1</td>
<td>1</td>
<td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>
<td>female</td>
<td>38.0</td>
<td>1</td>
<td>0</td>
<td>PC 17599</td>
<td>71.2833</td>
<td>C85</td>
<td>C</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>1</td>
<td>3</td>
<td>Heikkinen, Miss. Laina</td>
<td>female</td>
<td>26.0</td>
<td>0</td>
<td>0</td>
<td>STON/O2. 3101282</td>
<td>7.9250</td>
<td>NaN</td>
<td>S</td>
</tr>
<tr>
<th>3</th>
<td>4</td>
<td>1</td>
<td>1</td>
<td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td>female</td>
<td>35.0</td>
<td>1</td>
<td>0</td>
<td>113803</td>
<td>53.1000</td>
<td>C123</td>
<td>S</td>
</tr>
<tr>
<th>4</th>
<td>5</td>
<td>0</td>
<td>3</td>
<td>Allen, Mr. William Henry</td>
<td>male</td>
<td>35.0</td>
<td>0</td>
<td>0</td>
<td>373450</td>
<td>8.0500</td>
<td>NaN</td>
<td>S</td>
</tr>
</tbody>
</table> 
<p><strong>Survived 列是目标变量，这是我们要预测的变量。</strong> 如果 Survived 为 1，乘客幸免于难，为 0，表示未存活。</p> 
<table>
<thead><tr>
<th>Survived</th>
<th>是否存活</th>
</tr></thead>
<tbody>
<tr>
<td>0</td>
<td>死亡</td>
</tr>
<tr>
<td>1</td>
<td>存活</td>
</tr>
</tbody>
</table>
<p>其他描述乘客的变量，是<strong>特征</strong>。</p> 
<table>
<thead><tr>
<th>数据特征</th>
<th>意思</th>
</tr></thead>
<tbody>
<tr>
<td>PassengerId</td>
<td>乘客ID</td>
</tr>
<tr>
<td>Pclass</td>
<td>乘客等级(1,2,3)</td>
</tr>
<tr>
<td>Name</td>
<td>乘客姓名</td>
</tr>
<tr>
<td>Sex</td>
<td>乘客性别 (Female,Male)</td>
</tr>
<tr>
<td>Age</td>
<td>乘客年龄</td>
</tr>
<tr>
<td>SibSp</td>
<td>与乘客同行的兄弟姐妹和配偶的数量</td>
</tr>
<tr>
<td>Parch</td>
<td>与乘客同行的父母和孩子的数量</td>
</tr>
<tr>
<td>Ticket</td>
<td>船票号码</td>
</tr>
<tr>
<td>Fare</td>
<td>票价</td>
</tr>
<tr>
<td>Cabin</td>
<td>船舱号码</td>
</tr>
<tr>
<td>Embarked</td>
<td>乘客登船港口(C = Cherbourg, Q = Queenstown, S = Southampton)</td>
</tr>
</tbody>
</table>
<h3>
<a id="112__212"></a>1.1.2 数据集的大致信息</h3> 
<p><code>df.info()</code> 显示大致数据信息，包括每列名称，非空值数量，每列的数据类型，内存占用</p> 
<pre><code class="prism language-python">train_df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'_'</span><span class="token operator">*</span><span class="token number">40</span><span class="token punctuation">)</span>
test_df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  891 non-null    int64  
 1   Survived     891 non-null    int64  
 2   Pclass       891 non-null    int64  
 3   Name         891 non-null    object 
 4   Sex          891 non-null    object 
 5   Age          714 non-null    float64
 6   SibSp        891 non-null    int64  
 7   Parch        891 non-null    int64  
 8   Ticket       891 non-null    object 
 9   Fare         891 non-null    float64
 10  Cabin        204 non-null    object 
 11  Embarked     889 non-null    object 
dtypes: float64(2), int64(5), object(5)
memory usage: 83.7+ KB
________________________________________
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 418 entries, 0 to 417
Data columns (total 11 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  418 non-null    int64  
 1   Pclass       418 non-null    int64  
 2   Name         418 non-null    object 
 3   Sex          418 non-null    object 
 4   Age          332 non-null    float64
 5   SibSp        418 non-null    int64  
 6   Parch        418 non-null    int64  
 7   Ticket       418 non-null    object 
 8   Fare         417 non-null    float64
 9   Cabin        91 non-null     object 
 10  Embarked     418 non-null    object 
dtypes: float64(2), int64(4), object(5)
memory usage: 36.0+ KB
</code></pre> 
<ul>
<li> <p>训练数据集</p> 
  <ul>
<li>行数 ： 891个样本大小</li>
<li>列数 ：12（11个特征+1个<strong>目标变量 Survived</strong>）</li>
<li>数据类型 ： 7个特征是整数或浮点数，5个特征是字符串</li>
<li>缺失值情况 ：Cabin &gt; Age &gt; Embarked (数量从大到小排序)</li>
<li>数值型数据 ：PassengerId，Age，Fare,SibSp,Parch</li>
<li>类别数据 ：Survived,Sex,Embarked,Pclass</li>
<li>混合型数据：Ticket,Cabin</li>
</ul> </li>
<li> <p>测试数据集</p> 
  <ul>
<li>列数 ：11个特征</li>
<li>数据类型 ： 6个特征是整数或浮点数，5个特征是字符串</li>
<li>缺失值情况 ：Cabin &gt; Age &gt; Fare (数量从大到小排序)</li>
</ul> </li>
</ul> 
<hr> 
<p><strong>知识点</strong></p> 
<ul>
<li> <p><strong>类别数据(定性数据)</strong></p> <p>数据被划分为各种类别，用以描述某类得性质或特征。因此，类别数据也称为定性数据。游戏种类就是定性数据的一个实例 —— 每种游戏种类形成一个独立的类别。关于定性数据，请记住一个重点：不能将数据值理解为数字。</p> </li>
<li> <p><strong>数值型数据(定量数据)</strong></p> <p>数值型数据不同，它所涉及的是数字。数值型数据中的数值具有数字的意义，但还涉及计量或计数。由于数值型数据描述的是数量，所以也称为定量数据。</p> </li>
</ul> 
<hr> 
<h3>
<a id="113__292"></a>1.1.3 数据集的描述性统计信息</h3> 
<p><code>df.describe()</code> 返回数据数值情况，数值数据的字段内容：count计数，mean平均数，std方差，min最小值，四分位数，max 最大值</p> 
<pre><code class="prism language-python">train_df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<div> 
</div> 
<table border="1" class="dataframe">
<thead><tr>
<th></th>
<th>PassengerId</th>
<th>Survived</th>
<th>Pclass</th>
<th>Age</th>
<th>SibSp</th>
<th>Parch</th>
<th>Fare</th>
</tr></thead>
<tbody>
<tr>
<th>count</th>
<td>891.000000</td>
<td>891.000000</td>
<td>891.000000</td>
<td>714.000000</td>
<td>891.000000</td>
<td>891.000000</td>
<td>891.000000</td>
</tr>
<tr>
<th>mean</th>
<td>446.000000</td>
<td>0.383838</td>
<td>2.308642</td>
<td>29.699118</td>
<td>0.523008</td>
<td>0.381594</td>
<td>32.204208</td>
</tr>
<tr>
<th>std</th>
<td>257.353842</td>
<td>0.486592</td>
<td>0.836071</td>
<td>14.526497</td>
<td>1.102743</td>
<td>0.806057</td>
<td>49.693429</td>
</tr>
<tr>
<th>min</th>
<td>1.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>0.420000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr>
<th>25%</th>
<td>223.500000</td>
<td>0.000000</td>
<td>2.000000</td>
<td>20.125000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>7.910400</td>
</tr>
<tr>
<th>50%</th>
<td>446.000000</td>
<td>0.000000</td>
<td>3.000000</td>
<td>28.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>14.454200</td>
</tr>
<tr>
<th>75%</th>
<td>668.500000</td>
<td>1.000000</td>
<td>3.000000</td>
<td>38.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>31.000000</td>
</tr>
<tr>
<th>max</th>
<td>891.000000</td>
<td>1.000000</td>
<td>3.000000</td>
<td>80.000000</td>
<td>8.000000</td>
<td>6.000000</td>
<td>512.329200</td>
</tr>
</tbody>
</table> 
<ul><li>Survied 的均值为 0.383838，而 survied 值只有0或1，说明这个均值反应了存活率。 
  <ul><li>样本存活率约38%，实际存活率为32%(2224-1502/2224=32.4%)</li></ul> </li></ul> 
<p>从目前来看，要注意几点。</p> 
<ul>
<li>需要将非数值型特征转换为数值型特征，以便机器学习算法后期处理。</li>
<li>这些特征的范围有很大的差异，需要将其转换为大致相同的尺度。</li>
<li>一些特征包含缺失值（NaN = 不是数字），们需要处理。</li>
</ul> 
<h3>
<a id="114__427"></a>1.1.4 数据集缺失值详情</h3> 
<ul>
<li>
<code>df.isnull()</code> 返回表明哪些值是缺失值的布尔值</li>
<li>
<code>df.notnull()</code> 返回表明哪些值不是缺失值的布尔值</li>
<li>
<code>df.dropna()</code> 根据每个标签的值是否是缺失数据来筛选轴标签，并根据允许丢失的数据量来确定阀值</li>
<li>
<code>df.sort_values()</code> 排序，默认升序，ascending = False表示降序</li>
<li>
<code>pd.concat([])</code> 使对象在轴向上进行粘合或“堆叠“，默认是沿着 axis=0(行) 的轴向。axis=1 表示(列)的轴向。</li>
<li>
<code>round(x[, n])</code> 方法返回浮点数x的四舍五入值,n小数点位数</li>
</ul> 
<pre><code class="prism language-python">train_total <span class="token operator">=</span> train_df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
percent_1 <span class="token operator">=</span> train_df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>train_df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
percent_2 <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span>percent_1<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
train_miss_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>train_total<span class="token punctuation">,</span>percent_2<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
train_miss_data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<div> 
</div> 
<table border="1" class="dataframe">
<thead><tr>
<th></th>
<th>total</th>
<th>%</th>
</tr></thead>
<tbody>
<tr>
<th>Cabin</th>
<td>687</td>
<td>77.1</td>
</tr>
<tr>
<th>Age</th>
<td>177</td>
<td>19.9</td>
</tr>
<tr>
<th>Embarked</th>
<td>2</td>
<td>0.2</td>
</tr>
<tr>
<th>Fare</th>
<td>0</td>
<td>0.0</td>
</tr>
<tr>
<th>Ticket</th>
<td>0</td>
<td>0.0</td>
</tr>
</tbody>
</table> 
<pre><code class="prism language-python">test_total <span class="token operator">=</span> test_df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
percent_1 <span class="token operator">=</span> test_df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>test_df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
percent_2 <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span>percent_1<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
test_miss_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>test_total<span class="token punctuation">,</span>percent_2<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
test_miss_data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<div> 
</div> 
<table border="1" class="dataframe">
<thead><tr>
<th></th>
<th>total</th>
<th>%</th>
</tr></thead>
<tbody>
<tr>
<th>Cabin</th>
<td>327</td>
<td>78.2</td>
</tr>
<tr>
<th>Age</th>
<td>86</td>
<td>20.6</td>
</tr>
<tr>
<th>Fare</th>
<td>1</td>
<td>0.2</td>
</tr>
<tr>
<th>Embarked</th>
<td>0</td>
<td>0.0</td>
</tr>
<tr>
<th>Ticket</th>
<td>0</td>
<td>0.0</td>
</tr>
</tbody>
</table> 
<ul>
<li>训练数据集 
  <ul>
<li>Embarked 特征只有2个缺失的值，可以很容易地填补。</li>
<li>Age 特征就比较麻烦了，因为它有177个缺失值。</li>
<li>Cabin 特征需要进一步调查，但看起来可能要从数据集中删除它，因为缺失值比例高达 77%。</li>
</ul> </li>
<li>测试数据集 
  <ul>
<li>Fare 特征只有1个缺失的值，可以很容易地填补。</li>
<li>Age 特征有86个缺失值。</li>
<li>Cabin 特征需要进一步调查，但看起来可能要从数据集中删除它，因为缺失值比例高达 78.2%。</li>
</ul> </li>
</ul> 
<p>isnull用法</p> 
<ul>
<li>df.isnull() #元素为空或者NA就显示True，否则就是False</li>
<li>df.isnull().any() #判断哪些列包含缺失值，该列存在缺失值则返回True，反之False。</li>
</ul> 
<p>对比count() 、isnull().count()和isnull().sum()</p> 
<ul>
<li>df.count() #每一列中非缺失值的个数</li>
<li>df.isnull().count() #每一列总元素个数</li>
<li>df.isnull().sum() #每列缺失数据的个数</li>
</ul> 
<h3>
<a id="115__588"></a>1.1.5 假设</h3> 
<p><strong>哪些特征可能和存活有关？</strong></p> 
<pre><code class="prism language-python">train_df<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>values
</code></pre> 
<pre><code>array(['PassengerId', 'Survived', 'Pclass', 'Name', 'Sex', 'Age', 'SibSp',
       'Parch', 'Ticket', 'Fare', 'Cabin', 'Embarked'], dtype=object)
</code></pre> 
<p>初步判断，除了PassengerId、Ticket和 Name之外,其他特征都可能与存活有关。</p> 
<h4>
<a id="1151__Age_Sex_Survived__607"></a>1.1.5.1 数值型 Age、类别型 Sex、类别型 Survived 三者之间的关系:</h4> 
<ul>
<li>首先将数据按照性别(Female, Male)划分</li>
<li>基于性别，再根据存活状态(Survived,Not_Survived)划分</li>
<li>就会有四种搭配<br> - Female &amp; Survived<br> - Female &amp; Not_Survived<br> - Male &amp; Survived<br> - Male &amp; Not_Survived</li>
<li>鉴于 Age 特征有缺失值，在此处可视化分析时，需要去除 Age 的缺失值</li>
</ul> 
<pre><code class="prism language-python"><span class="token comment"># 按性别筛选出数据</span>
women <span class="token operator">=</span> train_df<span class="token punctuation">[</span>train_df<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'female'</span><span class="token punctuation">]</span>
men <span class="token operator">=</span> train_df<span class="token punctuation">[</span>train_df<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'male'</span><span class="token punctuation">]</span>

<span class="token comment"># 在性别的基础上筛选出存活和未存活的数据</span>

<span class="token comment"># 选出存活的数据</span>
F_survived <span class="token operator">=</span> women<span class="token punctuation">[</span>women<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">]</span>
M_survived <span class="token operator">=</span> men<span class="token punctuation">[</span>men<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment"># 选出未存活的数据</span>
F_not_surv <span class="token operator">=</span> women<span class="token punctuation">[</span>women<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span>
M_not_surv <span class="token operator">=</span> men<span class="token punctuation">[</span>men<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span>

F_survived<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<div> 
</div> 
<table border="1" class="dataframe">
<thead><tr>
<th></th>
<th>PassengerId</th>
<th>Survived</th>
<th>Pclass</th>
<th>Name</th>
<th>Sex</th>
<th>Age</th>
<th>SibSp</th>
<th>Parch</th>
<th>Ticket</th>
<th>Fare</th>
<th>Cabin</th>
<th>Embarked</th>
</tr></thead>
<tbody>
<tr>
<th>1</th>
<td>2</td>
<td>1</td>
<td>1</td>
<td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>
<td>female</td>
<td>38.0</td>
<td>1</td>
<td>0</td>
<td>PC 17599</td>
<td>71.2833</td>
<td>C85</td>
<td>C</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>1</td>
<td>3</td>
<td>Heikkinen, Miss. Laina</td>
<td>female</td>
<td>26.0</td>
<td>0</td>
<td>0</td>
<td>STON/O2. 3101282</td>
<td>7.9250</td>
<td>NaN</td>
<td>S</td>
</tr>
<tr>
<th>3</th>
<td>4</td>
<td>1</td>
<td>1</td>
<td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td>female</td>
<td>35.0</td>
<td>1</td>
<td>0</td>
<td>113803</td>
<td>53.1000</td>
<td>C123</td>
<td>S</td>
</tr>
<tr>
<th>8</th>
<td>9</td>
<td>1</td>
<td>3</td>
<td>Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg)</td>
<td>female</td>
<td>27.0</td>
<td>0</td>
<td>2</td>
<td>347742</td>
<td>11.1333</td>
<td>NaN</td>
<td>S</td>
</tr>
<tr>
<th>9</th>
<td>10</td>
<td>1</td>
<td>2</td>
<td>Nasser, Mrs. Nicholas (Adele Achem)</td>
<td>female</td>
<td>14.0</td>
<td>1</td>
<td>0</td>
<td>237736</td>
<td>30.0708</td>
<td>NaN</td>
<td>C</td>
</tr>
</tbody>
</table> 
<p>求某一列的缺失值情况</p> 
<p>由于 Dataframe 数据中选择某一列的方式有 (按照字典型标记或属性那样检索为 Series)<br> - df.A 的属性方式<br> - df[‘A’] 的方式<br> 所以求某一列的缺失值情况也有两种<br> - df.A.isnull().sum()<br> - df[‘A’].isnull().sum()</p> 
<p>根据某一列去除缺失值<br> - df.A.isnull().dropna()<br> - df[‘A’].isnull().dropna()</p> 
<pre><code class="prism language-python"><span class="token comment"># 每种数据去除 Age 缺失值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'去除前，Female survived null'</span><span class="token punctuation">,</span> F_survived<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 去除 Age 缺失值</span>
F_survived<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
M_survived<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
F_not_surv<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
M_not_surv<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'取出后，Female survived null'</span><span class="token punctuation">,</span>F_survived<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>去除前，Female survived null 36
取出后，Female survived null 0
</code></pre> 
<hr> 
<p><strong>知识点</strong></p> 
<p>displot()集合了matplotlib的hist()与核函数估计kdeplot的功能，增加了rugplot分布观测条显示与利用scipy库fit拟合参数分布的新颖用途。具体用法如下：：</p> 
<pre><code>seaborn.distplot(a, bins=None, hist=True, kde=True, rug=False, fit=None, hist_kws=None, kde_kws=None, rug_kws=None, fit_kws=None, color=None, vertical=False, norm_hist=False, axlabel=None, label=None, ax=None)
</code></pre> 
<pre><code>- 参数 ax：选择位置
- 参数 hist、kde，调节是否显示直方图及核密度估计(默认hist,kde均为True)
</code></pre> 
<hr> 
<p>问题：直方图中参数 bins，这里是根据什么设置的?</p> 
<ul>
<li> <p>极端情况, bins = 1<br> 上图展现了极端情况, 当 bins = 1，表示所有的数据都在一个组内。分组太粗糙影响数据分组规律的明显性，什么都看不出。</p> </li>
<li> <p>极端情况, bins = 数据大小<br> 下图进行极端情况的对比, 当 bins = len(data)，表示如果所有的数据都不同,将出现和数据长度一样的组。分组太细致会引起较大的误差，因此组数的确定要适当。</p> </li>
</ul> 
<p>组距的宽度：用数据中(最大值-最小值)/组数</p> 
<hr> 
<pre><code class="prism language-python">sns<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 声明使用 Seaborn 样式</span>

fig<span class="token punctuation">,</span>axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>nrows<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>ncols<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 创建一个 Figure, 子图为1行，2列</span>
survived <span class="token operator">=</span> <span class="token string">'survived'</span> <span class="token comment"># 图例 label </span>
not_survived <span class="token operator">=</span> <span class="token string">'not survived'</span> <span class="token comment"># 图例 label</span>

ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>distplot<span class="token punctuation">(</span>F_survived<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>kde<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>distplot<span class="token punctuation">(</span>F_not_surv<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>kde<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span>survived<span class="token punctuation">,</span>not_survived<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 图例 label 放置位置1</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Female'</span><span class="token punctuation">)</span>

ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>distplot<span class="token punctuation">(</span>M_survived<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>label<span class="token operator">=</span>survived<span class="token punctuation">,</span>kde<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 图例 label 放置位置2</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>distplot<span class="token punctuation">(</span>M_not_surv<span class="token punctuation">.</span>Age<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>label<span class="token operator">=</span>not_survived<span class="token punctuation">,</span>kde<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Male'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>Text(0.5, 1.0, 'Male')
</code></pre> 
<p><img src="https://images2.imgbox.com/25/35/ZkgCusG6_o.png" alt="在这里插入图片描述"></p> 
<p>可以看出</p> 
<ul>
<li>对于男性来说，大概20岁到35岁之间的存活率较高的；5岁到18岁之间的存活概率很低，</li>
<li>对于女性来说，大概15岁到40岁之间的存活概率更高</li>
<li>无论男女，婴儿的存活概率会高一点。</li>
</ul> 
<p>似乎有一些特定的年龄段，存活几率会增加。下面来观察 Age 和 Survived 的关系</p> 
<h5>
<a id="11511__Age__Survived__845"></a>1.1.5.1.1 数值型 Age、 类别型 Survived 两者之间的关系</h5> 
<p>FacetGrid当您想要在数据集的子集中分别可视化变量的分布或多个变量之间的关系时，该类非常有用。一个FacetGrid可以与多达三个维度可以得出：row，col，和hue。前两个与得到的轴阵列有明显的对应关系; 将色调变量视为沿深度轴的第三个维度，其中不同的级别用不同的颜色绘制。</p> 
<pre><code>FacetGrid(data, row=None, col=None, hue=None, col_wrap=None, sharex=True, sharey=True, height=3, aspect=1, palette=None, row_order=None, col_order=None, hue_order=None, hue_kws=None, dropna=True, legend_out=True, despine=True, margin_titles=False, xlim=None, ylim=None, subplot_kws=None, gridspec_kws=None, size=None)
</code></pre> 
<ul>
<li>col 列上的变量(左右)</li>
<li>row 行上的变量(上下)</li>
</ul> 
<p>这里将 FacetGrid 函数用于不同存活率的值，独立分成两个直方图。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt <span class="token comment">#导入 matplotlib.pyplot，并简写成plt</span>
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np  <span class="token comment">#导入numpy包，用于生成数组</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment">#导入pandas包，用于数据分析</span>
<span class="token comment">#IPython notebook中的魔法方法，这样每次运行后可以直接得到图像，不再需要使用plt.show()</span>
<span class="token operator">%</span>matplotlib inline  

g <span class="token operator">=</span> sns<span class="token punctuation">.</span>FacetGrid<span class="token punctuation">(</span>train_df<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'Survived'</span><span class="token punctuation">)</span>
g<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>plt<span class="token punctuation">.</span>hist<span class="token punctuation">,</span> <span class="token string">'Age'</span><span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d8/36/c5hWQlsu_o.png" alt="在这里插入图片描述"></p> 
<p>可以看出</p> 
<ul>
<li>婴儿（Age&lt;=4）有较高的生存率</li>
<li>老人（Age=80）全部生还</li>
<li>大量的15-25年纪的乘客没有生还</li>
<li>乘客主要在15-35的年纪范围内</li>
</ul> 
<h5>
<a id="11512__Sex__Survived___Survived_879"></a>1.1.5.1.2 类别型 Sex、 数值型 Survived 两者之间的关系 (这里用的是数值型 Survived，可能需要放到其他位置)</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt <span class="token comment">#导入 matplotlib.pyplot，并简写成plt</span>
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np  <span class="token comment">#导入numpy包，用于生成数组</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment">#导入pandas包，用于数据分析</span>
<span class="token comment">#IPython notebook中的魔法方法，这样每次运行后可以直接得到图像，不再需要使用plt.show()</span>
<span class="token operator">%</span>matplotlib inline  

sns<span class="token punctuation">.</span>barplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'Sex'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'Survived'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train_df<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4e/9b/eVZrdn8c_o.png" alt="在这里插入图片描述"></p> 
<p>可以看出，女性乘客的幸存率比男性高。</p> 
<h4>
<a id="1152__Embarked_Pclass_Sex_Survived_4_898"></a>1.1.5.2 类别型 Embarked、类别型 Pclass、类别型 Sex、数值型 Survived 4者之间的关系</h4> 
<pre><code class="prism language-python">grid <span class="token operator">=</span> sns<span class="token punctuation">.</span>FacetGrid<span class="token punctuation">(</span>train_df<span class="token punctuation">,</span> row<span class="token operator">=</span><span class="token string">'Embarked'</span><span class="token punctuation">,</span>height<span class="token operator">=</span><span class="token number">2.2</span><span class="token punctuation">,</span> aspect<span class="token operator">=</span><span class="token number">1.6</span><span class="token punctuation">)</span> 
grid<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>sns<span class="token punctuation">.</span>pointplot<span class="token punctuation">,</span> <span class="token string">'Pclass'</span><span class="token punctuation">,</span> <span class="token string">'Survived'</span><span class="token punctuation">,</span><span class="token string">'Sex'</span><span class="token punctuation">,</span>palette<span class="token operator">=</span><span class="token string">'deep'</span><span class="token punctuation">,</span>hue_order<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'female'</span><span class="token punctuation">,</span><span class="token string">'male'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>order<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
grid<span class="token punctuation">.</span>add_legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ba/54/33TmpMxZ_o.png" alt="在这里插入图片描述"></p> 
<p>按照性别分类，Embarked 似乎与存活率有关。</p> 
<ul>
<li>不论从哪个港口登船，Pclass 一样的前提下，女性乘客的存活率都高于男性。</li>
<li>对于从S或C港口登船的男性乘客中，Pclass=1的存活率比 Pclass =2, Pclass=3 都高。</li>
<li>对于从Q港口登船的男性乘客中，Pclass=3的存活率比 Pclass =1, Pclass=2 高。</li>
</ul> 
<p>Pclass 似乎也与存活率有关。下面来观察 Pclass 和 Survived 的关系</p> 
<h4>
<a id="1153__Pclass__Survived__917"></a>1.1.5.3 类别型 Pclass、 数值型 Survived 两者之间的关系</h4> 
<pre><code class="prism language-python">sns<span class="token punctuation">.</span>barplot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token string">'Pclass'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'Survived'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train_df<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/37/be/zH29RTUv_o.png" alt="在这里插入图片描述"></p> 
<p>明显可以看出 Pclass=1的乘客存活率更高</p> 
<h4>
<a id="1154__Pclass_Age__Survived__930"></a>1.1.5.4 类别型 Pclass、数值型 Age、 类别型 Survived 三者之间的关系</h4> 
<p>aspect:每个小图表的横轴长度和纵轴的比，默认为1; height:每个小图表的高度设定，默认为3</p> 
<pre><code class="prism language-python">grid <span class="token operator">=</span> sns<span class="token punctuation">.</span>FacetGrid<span class="token punctuation">(</span>train_df<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">'Survived'</span><span class="token punctuation">,</span> row<span class="token operator">=</span><span class="token string">'Pclass'</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">2.2</span><span class="token punctuation">,</span> aspect<span class="token operator">=</span><span class="token number">1.6</span><span class="token punctuation">)</span>
grid<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>plt<span class="token punctuation">.</span>hist<span class="token punctuation">,</span> <span class="token string">'Age'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">.5</span><span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
grid<span class="token punctuation">.</span>add_legend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/86/0d/hkk6yZLU_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 或者用这个</span>
grid <span class="token operator">=</span> sns<span class="token punctuation">.</span>FacetGrid<span class="token punctuation">(</span>train_df<span class="token punctuation">,</span>hue<span class="token operator">=</span><span class="token string">'Survived'</span><span class="token punctuation">,</span>row<span class="token operator">=</span><span class="token string">'Pclass'</span><span class="token punctuation">)</span>
grid<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>plt<span class="token punctuation">.</span>hist<span class="token punctuation">,</span><span class="token string">"Age"</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
grid<span class="token punctuation">.</span>add_legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/66/B7xBUqdQ_o.png" alt="在这里插入图片描述"></p> 
<h4>
<a id="1155__SibSp__Parch__Survived_3_955"></a>1.1.5.5 数值型 SibSp、 数值型 Parch、 数值型 Survived 3者之间的关系</h4> 
<p>SibSp 和 Parch 组合在一起使用才更有意义，组合起来表示与乘客同行的亲属人数。并计算出单独出行和非单独出行的人数</p> 
<pre><code class="prism language-python">data <span class="token operator">=</span> <span class="token punctuation">[</span>train_df<span class="token punctuation">,</span> test_df<span class="token punctuation">]</span>  <span class="token comment"># 训练集和测试集</span>
<span class="token keyword">for</span> dataset <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    dataset<span class="token punctuation">[</span><span class="token string">'relatives'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token string">'SibSp'</span><span class="token punctuation">]</span> <span class="token operator">+</span> dataset<span class="token punctuation">[</span><span class="token string">'Parch'</span><span class="token punctuation">]</span>
    dataset<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>dataset<span class="token punctuation">[</span><span class="token string">'relatives'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'not_alone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    dataset<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>dataset<span class="token punctuation">[</span><span class="token string">'relatives'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'not_alone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    dataset<span class="token punctuation">[</span><span class="token string">'not_alone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token string">'not_alone'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
train_df<span class="token punctuation">[</span><span class="token string">'not_alone'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<pre><code>1    537
0    354
Name: not_alone, dtype: int64
</code></pre> 
<p>知识点：<strong><a href="https://blog.csdn.net/qq_36523839/article/details/80502574">loc 根据条件，对新增列赋值</a></strong></p> 
<p><code>df.loc[条件,新增列] = 赋初始值</code></p> 
<p>如果新增列名为已有列名，则在原来的数据列上改变</p> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'abcdefgh'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df1<span class="token punctuation">)</span>

df1<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df1<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token string">'小于0.5'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
df1<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df1<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token string">'小于0.5'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df1<span class="token punctuation">)</span>
</code></pre> 
<pre><code>          A         B         C         D
a  0.075956  0.513582  0.090774  0.542909
b  0.156261  0.873195  0.974398  0.920191
c  0.015779  0.786579  0.356560  0.604733
d  0.574546  0.742924  0.243504  0.751018
e  0.814584  0.196367  0.067841  0.232922
f  0.480406  0.103638  0.301940  0.153113
g  0.863849  0.479492  0.110800  0.322068
h  0.395352  0.851746  0.858481  0.225225
          A         B         C         D  小于0.5
a  0.075956  0.513582  0.090774  0.542909    1.0
b  0.156261  0.873195  0.974398  0.920191    1.0
c  0.015779  0.786579  0.356560  0.604733    1.0
d  0.574546  0.742924  0.243504  0.751018    0.0
e  0.814584  0.196367  0.067841  0.232922    0.0
f  0.480406  0.103638  0.301940  0.153113    1.0
g  0.863849  0.479492  0.110800  0.322068    0.0
h  0.395352  0.851746  0.858481  0.225225    1.0
</code></pre> 
<p>知识点：<strong>value_counts() 方法</strong></p> 
<p>返回一个序列 Series，该序列包含每个值的数量。也就是说，对于数据框中的任何列，value-counts () 方法会返回该列每个项的计数。</p> 
<ul>
<li>对该列中出现的每个值进行计数(无效值会被排除) 默认降序排序 
  <ul><li>
<code>value_counts(ascending=True)</code> 升序</li></ul> </li>
<li>求各个值的相对频率 
  <ul><li><code>value_counts(normalize=True)</code></li></ul> </li>
</ul> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'abcdefgh'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df1<span class="token punctuation">)</span>

df1<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df1<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token string">'小于0.5'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df1<span class="token punctuation">[</span><span class="token string">'小于0.5'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df1<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token string">'小于0.5'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df1<span class="token punctuation">[</span><span class="token string">'小于0.5'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>normalize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>          A         B         C         D
a  0.387505  0.040494  0.105987  0.320365
b  0.990164  0.930623  0.644406  0.467170
c  0.932130  0.681749  0.080384  0.409407
d  0.985110  0.305801  0.690751  0.145207
e  0.247883  0.645068  0.049671  0.899674
f  0.654758  0.152449  0.750448  0.716139
g  0.753139  0.387617  0.299998  0.236939
h  0.937349  0.227210  0.722307  0.555785
          A         B         C         D  小于0.5
a  0.387505  0.040494  0.105987  0.320365    1.0
b  0.990164  0.930623  0.644406  0.467170    NaN
c  0.932130  0.681749  0.080384  0.409407    NaN
d  0.985110  0.305801  0.690751  0.145207    NaN
e  0.247883  0.645068  0.049671  0.899674    1.0
f  0.654758  0.152449  0.750448  0.716139    NaN
g  0.753139  0.387617  0.299998  0.236939    NaN
h  0.937349  0.227210  0.722307  0.555785    NaN
1.0    2
Name: 小于0.5, dtype: int64
0.0    0.75
1.0    0.25
Name: 小于0.5, dtype: float64
</code></pre> 
<p>知识点 <strong>astype(int)</strong></p> 
<p>用于转化dateframe某一列的数据类型</p> 
<p>如下将dateframe某列的str类型转为int，注意astype()没有replace=True的用法，想要在原数据上修改，要写成如下形式。</p> 
<p><code>app_train[['uid','index']] = app_train[['uid','index']].astype(int)</code></p> 
<p>注意只有当该列的字符串全是由纯数字构成时才可以这样写，如果混有字母，会报错：ValueError: invalid literal for int() with base 10</p> 
<p>利用int()函数转字符串也类似</p> 
<p>isdigit()用于判断一个字符串是否由纯数字构成，如果是返回True,否则False</p> 
<pre><code class="prism language-python">df1<span class="token punctuation">[</span><span class="token string">'小于0.5'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>0    6
1    2
Name: 小于0.5, dtype: int64
</code></pre> 
<pre><code class="prism language-python">grid <span class="token operator">=</span> sns<span class="token punctuation">.</span>catplot<span class="token punctuation">(</span><span class="token string">'relatives'</span><span class="token punctuation">,</span><span class="token string">'Survived'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>train_df<span class="token punctuation">,</span> kind<span class="token operator">=</span><span class="token string">'point'</span><span class="token punctuation">,</span>aspect <span class="token operator">=</span> <span class="token number">2.5</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ed/0d/CFuOg1b9_o.png" alt="在这里插入图片描述"></p> 
<p>观察：</p> 
<ul>
<li>同行家属在1到3位的存活率较高</li>
<li>除了6位，同行家属只有1位或者超过3位的存活率较低</li>
</ul> 
<p>决策：</p> 
<ul><li>纳入模型</li></ul> 
<h2>
<a id="2__1106"></a>2 特征工程</h2> 
<p>训练集和测试集都需要处理，所以将其合并。</p> 
<p>方法</p> 
<ul>
<li>删除无关特征</li>
<li>创建新的特征(根据已有特征，挖掘有效信息创建新的特征)</li>
<li>处理缺失值<br> 根据之前我们知晓的缺失值情况,对其一一处理 
  <ul>
<li>训练数据集 
    <ul>
<li>Embarked 特征只有2个缺失的值，可以很容易地填补。</li>
<li>Age 特征就比较麻烦了，因为它有177个缺失值。</li>
<li>Cabin 特征需要进一步调查，但看起来可能要从数据集中删除它，因为缺失值比例高达 77%。</li>
</ul> </li>
<li>测试数据集 
    <ul>
<li>Fare 特征只有2个缺失的值，可以很容易地填补。</li>
<li>Age 特征有86个缺失值。</li>
<li>Cabin 特征需要进一步调查，但看起来可能要从数据集中删除它，因为缺失值比例高达 78.2%。</li>
</ul> </li>
</ul> </li>
</ul> 
<pre><code class="prism language-python"><span class="token comment"># 合并训练集和测试集</span>
titanic <span class="token operator">=</span> train_df<span class="token punctuation">.</span>append<span class="token punctuation">(</span>test_df<span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 保存测试集的 PassengerId 用于最后提交</span>
passengerId <span class="token operator">=</span> test_df<span class="token punctuation">.</span>PassengerId

<span class="token comment"># 创建索引，后期用于分开数据集</span>
train_idx <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_df<span class="token punctuation">)</span>
test_idx <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>titanic<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_df<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>titanic<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1309 entries, 0 to 1308
Data columns (total 14 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  1309 non-null   int64  
 1   Survived     891 non-null    float64
 2   Pclass       1309 non-null   int64  
 3   Name         1309 non-null   object 
 4   Sex          1309 non-null   object 
 5   Age          1046 non-null   float64
 6   SibSp        1309 non-null   int64  
 7   Parch        1309 non-null   int64  
 8   Ticket       1309 non-null   object 
 9   Fare         1308 non-null   float64
 10  Cabin        295 non-null    object 
 11  Embarked     1307 non-null   object 
 12  relatives    1309 non-null   int64  
 13  not_alone    1309 non-null   int64  
dtypes: float64(3), int64(6), object(5)
memory usage: 143.3+ KB
None
</code></pre> 
<h3>
<a id="21__PassengerId___1163"></a>2.1 处理特征 PassengerId - 删除特征</h3> 
<p>训练集中删除特征 PassengerId，因为它并不会对生存率造成什么影响。目前不能删除测试集中 PassengerId，因为要提交。</p> 
<pre><code class="prism language-python"><span class="token comment">#train_df = train_df.drop(['PassengerId'], axis=1)</span>
</code></pre> 
<h3>
<a id="22__Name___1172"></a>2.2 处理特征 Name - 创建新的特征:乘客称谓</h3> 
<p>在查看乘客姓名时，人们可能想知道如何处理它们以提取有用的信息。如果你仔细看看这些第一个例子：</p> 
<ul>
<li>Braund, Mr. Owen Harris</li>
<li>Heikkinen, Miss. Laina</li>
<li>Peter, Master. Michael J</li>
</ul> 
<p>你会注意到每个名字都有一个称谓！这可能是一个简单的小姐（Miss.）或太太（Mrs.），但它有时可能像 Master，Sir 那样更复杂。在这种情况下，可以对称谓进行大的分类。让我们看看我们将如何在下面的函数中执行此操作。</p> 
<p>让我们先来看看在训练集中有什么不同的称谓。</p> 
<pre><code class="prism language-python"><span class="token comment"># 正则测试</span>
<span class="token keyword">import</span> re

test <span class="token operator">=</span> <span class="token string">'Braund,the Countess. Owen Harris'</span>
pattern <span class="token operator">=</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">",(.+)."</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pattern<span class="token punctuation">.</span>search<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>the Countess
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 训练集</span>
train_df<span class="token punctuation">[</span><span class="token string">'Title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">",(.+?)."</span><span class="token punctuation">)</span><span class="token punctuation">.</span>search<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>train_df<span class="token punctuation">[</span><span class="token string">'Title'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 测试集</span>
test_df<span class="token punctuation">[</span><span class="token string">'Title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">",(.+?)."</span><span class="token punctuation">)</span><span class="token punctuation">.</span>search<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>test_df<span class="token punctuation">[</span><span class="token string">'Title'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>['Mr', 'Mrs', 'Miss', 'Master', 'Don', 'Rev', 'Dr', 'Mme', 'Ms', 'Major', 'Lady', 'Sir', 'Mlle', 'Col', 'Capt', 'the Countess', 'Jonkheer']
['Mr', 'Mrs', 'Miss', 'Master', 'Ms', 'Col', 'Rev', 'Dr', 'Dona']
</code></pre> 
<p>于是我们把称谓信息提取出来，由于有些称谓的人数量过少，我们还需要做一个映射</p> 
<ul>
<li>Mme：称呼非英语民族的"上层社会"已婚妇女,及有职业的妇女，相当于Mrs</li>
<li>Jonkheer:乡绅</li>
<li>Capt：船长？。。</li>
<li>Lady：贵族夫人的称呼</li>
<li>Don：是西班牙语中贵族和有地位者的尊称</li>
<li>sir：都懂</li>
<li>the Countess：女伯爵</li>
<li>Ms：Ms.或Mz 美国近来用来称呼婚姻状态不明的妇女</li>
<li>Col：中校:Lieutenant Colonel(Lt. Col.)上校:Colonel(Col.)</li>
<li>Major：少校</li>
<li>Mlle:小姐</li>
<li>Rev：牧师</li>
</ul> 
<pre><code class="prism language-python">Title_Dictionary <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"Capt"</span><span class="token punctuation">:</span> <span class="token string">"Officer"</span><span class="token punctuation">,</span>
    <span class="token string">"Col"</span><span class="token punctuation">:</span> <span class="token string">"Officer"</span><span class="token punctuation">,</span>
    <span class="token string">"Major"</span><span class="token punctuation">:</span> <span class="token string">"Officer"</span><span class="token punctuation">,</span>
    <span class="token string">"Jonkheer"</span><span class="token punctuation">:</span> <span class="token string">"Royalty"</span><span class="token punctuation">,</span>
    <span class="token string">"Don"</span><span class="token punctuation">:</span> <span class="token string">"Royalty"</span><span class="token punctuation">,</span>
    <span class="token string">"Sir"</span> <span class="token punctuation">:</span> <span class="token string">"Royalty"</span><span class="token punctuation">,</span>
    <span class="token string">"Dr"</span><span class="token punctuation">:</span> <span class="token string">"Officer"</span><span class="token punctuation">,</span>
    <span class="token string">"Rev"</span><span class="token punctuation">:</span> <span class="token string">"Officer"</span><span class="token punctuation">,</span>
    <span class="token string">"the Countess"</span><span class="token punctuation">:</span><span class="token string">"Royalty"</span><span class="token punctuation">,</span>
    <span class="token string">"Mme"</span><span class="token punctuation">:</span> <span class="token string">"Mrs"</span><span class="token punctuation">,</span>
    <span class="token string">"Mlle"</span><span class="token punctuation">:</span> <span class="token string">"Miss"</span><span class="token punctuation">,</span>
    <span class="token string">"Ms"</span><span class="token punctuation">:</span> <span class="token string">"Mrs"</span><span class="token punctuation">,</span>
    <span class="token string">"Mr"</span> <span class="token punctuation">:</span> <span class="token string">"Mr"</span><span class="token punctuation">,</span>
    <span class="token string">"Mrs"</span> <span class="token punctuation">:</span> <span class="token string">"Mrs"</span><span class="token punctuation">,</span>
    <span class="token string">"Miss"</span> <span class="token punctuation">:</span> <span class="token string">"Miss"</span><span class="token punctuation">,</span>
    <span class="token string">"Master"</span> <span class="token punctuation">:</span> <span class="token string">"Master"</span><span class="token punctuation">,</span>
    <span class="token string">"Lady"</span> <span class="token punctuation">:</span> <span class="token string">"Royalty"</span><span class="token punctuation">,</span>
    <span class="token string">"Dona"</span><span class="token punctuation">:</span><span class="token string">"Royalty"</span>
<span class="token punctuation">}</span>

titanic<span class="token punctuation">[</span><span class="token string">'Title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">",(.+?)."</span><span class="token punctuation">)</span><span class="token punctuation">.</span>search<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
titanic<span class="token punctuation">[</span><span class="token string">'Title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Title'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>Title_Dictionary<span class="token punctuation">)</span>

<span class="token comment"># 查看缺失值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Title'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#titanic[titanic['Title'].isnull() == True]</span>
</code></pre> 
<pre><code>0
</code></pre> 
<p>Oliva y Ocana, <strong>Dona</strong>. Fermina。这在训练数据集中没有遇到这个称谓，测试集中的Dona是女士的尊称。</p> 
<pre><code class="prism language-python"><span class="token comment"># 相同尊称的人数</span>
titanic<span class="token punctuation">[</span><span class="token string">'Title'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>Mr         757
Miss       262
Mrs        200
Master      61
Officer     23
Royalty      6
Name: Title, dtype: int64
</code></pre> 
<p>创建 Title 特征，还能用来更好地估计缺失值的年龄。</p> 
<h3>
<a id="23__Age___1284"></a>2.3 处理特征 Age - 缺失值填写</h3> 
<p>不是简单地用数据集的平均年龄或中位年龄来填补缺失的Age值，而是通过对乘客的性别、等级和进行分组，我们可以更深入地了解乘客的年龄。</p> 
<p>我们将按照性别、Pclass（乘客等级）和Title对数据集进行分组，并为每个子集计算中位数年龄。</p> 
<p>为了避免测试集中的数据泄漏，使用从训练集计算的值来填充测试集中的年龄。</p> 
<pre><code class="prism language-python">grouped <span class="token operator">=</span> titanic<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">,</span><span class="token string">'Pclass'</span><span class="token punctuation">,</span> <span class="token string">'Title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  
grouped<span class="token punctuation">[</span><span class="token string">"Age"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>Sex     Pclass  Title  
female  1       Miss       30.0
                Mrs        45.0
                Officer    49.0
                Royalty    39.0
        2       Miss       20.0
                Mrs        30.0
        3       Miss       18.0
                Mrs        31.0
male    1       Master      6.0
                Mr         41.5
                Officer    52.0
                Royalty    40.0
        2       Master      2.0
                Mr         30.0
                Officer    41.5
        3       Master      6.0
                Mr         26.0
Name: Age, dtype: float64
</code></pre> 
<p>此 dataframe 将帮助我们根据不同的标准估算缺失的年龄值。查看中位年龄列，看看这个值如何根据 Sex，Pclass 和 Title 组合在一起。<br> 例如：</p> 
<ul>
<li>如果乘客是女性，则来自 Pclass 1 和来自王室（royalty），中位年龄为40.5岁。</li>
<li>如果乘客是男性，来自 Pclass 3，拥有 Mr 称谓，则年龄中位数为26岁。</li>
</ul> 
<p>用不同组合的的中位数年龄填充缺失的年龄。</p> 
<pre><code class="prism language-python">titanic<span class="token punctuation">[</span><span class="token string">"Age"</span><span class="token punctuation">]</span> <span class="token operator">=</span> grouped<span class="token punctuation">[</span><span class="token string">"Age"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>x<span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 查看处理后的情况</span>
titanic<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1309 entries, 0 to 1308
Data columns (total 15 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  1309 non-null   int64  
 1   Survived     891 non-null    float64
 2   Pclass       1309 non-null   int64  
 3   Name         1309 non-null   object 
 4   Sex          1309 non-null   object 
 5   Age          1309 non-null   float64
 6   SibSp        1309 non-null   int64  
 7   Parch        1309 non-null   int64  
 8   Ticket       1309 non-null   object 
 9   Fare         1308 non-null   float64
 10  Cabin        295 non-null    object 
 11  Embarked     1307 non-null   object 
 12  relatives    1309 non-null   int64  
 13  not_alone    1309 non-null   int64  
 14  Title        1309 non-null   object 
dtypes: float64(3), int64(6), object(6)
memory usage: 153.5+ KB
</code></pre> 
<h4>
<a id="231__Cabin____1363"></a>2.3.1 处理特征 Cabin - 创建新的特征：甲板号 (暂时不用这个方法)</h4> 
<p>之前想直接删除’Cabin’这个特征，但后来我发现了一些有趣的东西。船舱号码’C123’，看起来字母代表的是甲板号。因此，我们要提取这些并创建一个新的特征，其中包含一个人的甲板号</p> 
<ul><li>fillna 对缺失值进行填充<br> Pandas 中，缺失数据一般采用 NaN 标记 NaN 代表 Not a Number。特别地，在时间序列里，时间戳的丢失采用 NaT 标记。</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 训练集</span>
train_df<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">"U0"</span><span class="token punctuation">)</span> <span class="token comment"># 将缺失值填充为 “U0”  表示 Unknow</span>
<span class="token comment"># 正则获取夹板号 并 使用 drop_duplicates() 去重</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>train_df<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">"([a-zA-Z]+)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>search<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>['U', 'C', 'E', 'G', 'D', 'A', 'B', 'F', 'T']
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 测试集</span>
test_df<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">"U0"</span><span class="token punctuation">)</span> <span class="token comment"># 将缺失值填充为 “U0”  表示 Unknow</span>
<span class="token comment"># 正则获取夹板号 并 使用 drop_duplicates() 去重</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>test_df<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">"([a-zA-Z]+)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>search<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>['U', 'B', 'E', 'A', 'C', 'D', 'F', 'G']
</code></pre> 
<p>对 NAN 填充"U0"，去重，可以看到甲板号，训练集从A到G,然后T，而测试集是从A到G，没有任何不存在于训练集中的夹板号。</p> 
<p>我们把这个特征转换成一个数字变量。缺少的值将被转换为零。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> re
deck <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"A"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"E"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"F"</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">"G"</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"U"</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">}</span>

titanic<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">"U0"</span><span class="token punctuation">)</span> <span class="token comment"># 没有船舱号 将缺失值填充为 “U0”</span>
titanic<span class="token punctuation">[</span><span class="token string">'Deck'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">"([a-zA-Z]+)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>search<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#正则获取夹板号</span>
titanic<span class="token punctuation">[</span><span class="token string">'Deck'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Deck'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>deck<span class="token punctuation">)</span> <span class="token comment"># 通过字典用 map 映射夹板号为数字</span>
titanic<span class="token punctuation">[</span><span class="token string">'Deck'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Deck'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 没有夹板号 将缺失值填充为 “0”</span>
titanic<span class="token punctuation">[</span><span class="token string">'Deck'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Deck'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token comment"># 将dateframe某一列的数据类型转化为整数型</span>

<span class="token comment"># 处理完删除 cabin 特征</span>
<span class="token comment"># train_df = train_df.drop(['Cabin'], axis=1)</span>
<span class="token comment"># test_df = test_df.drop(['Cabin'], axis=1)</span>

<span class="token comment"># 处理后的情况</span>
titanic<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1309 entries, 0 to 1308
Data columns (total 16 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  1309 non-null   int64  
 1   Survived     891 non-null    float64
 2   Pclass       1309 non-null   int64  
 3   Name         1309 non-null   object 
 4   Sex          1309 non-null   object 
 5   Age          1309 non-null   float64
 6   SibSp        1309 non-null   int64  
 7   Parch        1309 non-null   int64  
 8   Ticket       1309 non-null   object 
 9   Fare         1308 non-null   float64
 10  Cabin        1309 non-null   object 
 11  Embarked     1307 non-null   object 
 12  relatives    1309 non-null   int64  
 13  not_alone    1309 non-null   int64  
 14  Title        1309 non-null   object 
 15  Deck         1309 non-null   int64  
dtypes: float64(3), int64(7), object(6)
memory usage: 163.8+ KB
</code></pre> 
<h4>
<a id="232__1440"></a>2.3.2 知识点：正则表达式</h4> 
<ul>
<li> <p><code>"([a-zA-Z]+)"</code> 这个表示至少匹配1个或多个大/小写字母，带分组</p> 
  <ul>
<li>. 匹配除换行符之外的任意字符</li>
<li> 
    <ul><li>匹配前面的字符1次或多次（&gt;=1）</li></ul> </li>
<li>[a-zA-Z_] 可以匹配一个字母无论大小写</li>
</ul> </li>
<li> <p><code>re.compile(pattern, flags=0)</code><br> 这个方法可以将正则字符串编译成正表达式对象（Pattern对象），以便在后面的匹配中复用</p> <pre><code>prog = re.compile(pattern)
result = prog.search(string)
</code></pre> <p>等价于<br> <code>result = re.search(pattern, string)</code></p> </li>
<li> <p>分组<br> 可以使用group(num) 或 groups() 匹配对象函数来获取匹配表达式。</p> 
  <ul>
<li>group(num=0) 匹配的整个表达式的字符串</li>
<li>group() 可以一次输入多个组号，在这种情况下它将返回一个包含那些组所对应值的元组。</li>
<li>groups() 返回一个包含所有小组字符串的元组，从 1 到 所含的小组号。</li>
</ul> </li>
<li> <p>匿名函数<br> <code>lambda x: x * x</code><br> 关键字lambda表示匿名函数，冒号前面的x表示函数参数。等价于</p> <pre><code>def f(x):
    return x * x
</code></pre> </li>
<li> <p>映射</p> 
  <ul>
<li>Series 数据 
    <ul>
<li>s.map() 都是把对应的数据逐个当作参数传入到字典或函数中，得到映射后的值 
      <ul>
<li>使用字典进行映射</li>
<li>使用函数进行映射</li>
</ul> </li>
<li>s.apply() 作用原理和map方法类似，区别在于apply能够传入功能更为复杂的函数(传入map的函数只能接收一个参数)</li>
</ul> </li>
<li>DataFrame 数据(默认 axis=1) (axis=1为横向，axis=0为纵向) 
    <ul>
<li>df.apply() 将函数应用到每行或者每一列上面 
      <ul>
<li>axis =1 将每一行数据以Series的形式（Series的索引为列名）传入指定函数</li>
<li>axis =0 将各列(columns)以Series的形式作为参数，传入到你指定的操作函数中</li>
</ul> </li>
<li>df.applymap() 将某函数应用到每一个元素上</li>
</ul> </li>
</ul> </li>
<li> <p>astype(int)<br> 用于转化dateframe某一列的数据类型</p> </li>
</ul> 
<h4>
<a id="233__EmbarkedFare___1485"></a>2.3.3 处理其他特征 Embarked、Fare - 缺失值填充</h4> 
<ul>
<li> <p>训练集中 Embarked 特征只有2个缺失的值，用众数进行填补。</p> </li>
<li> <p>训练集中 Fare 特征只有1个缺失的值，用中位数进行填补。</p> </li>
<li> <p>训练集中 Cabin 特征有687个缺失的值，用常数 ‘U’(Unknow) 进行填补。</p> 
  <ul>
<li> <p>众值填充</p> 
    <ul>
<li><code>df.fillna(df.value_counts().index[0])</code></li>
<li><code>df.fillna(df.mode().iloc[0])</code></li>
</ul> </li>
<li> <p>中位数填充<br> <code>df.fillna(df.median())</code></p> </li>
</ul> </li>
</ul> 
<pre><code class="prism language-python"><span class="token comment"># 用 value_counts() 获取众数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 默认降序</span>

<span class="token comment"># 获取行标签</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span>

<span class="token comment"># 获取第一行的行标签</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>S    914
C    270
Q    123
Name: Embarked, dtype: int64
Index(['S', 'C', 'Q'], dtype='object')
S
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 用 mode() 获取众数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>0    S
dtype: object
S
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 用众数填充 Embarked</span>
titanic<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 用中位数填充 Fare</span>
titanic<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>titanic<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 用‘U’填充 Cabin</span>
titanic<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'U'</span><span class="token punctuation">)</span>

<span class="token comment"># 看处理后结果</span>
titanic<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1309 entries, 0 to 1308
Data columns (total 16 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  1309 non-null   int64  
 1   Survived     891 non-null    float64
 2   Pclass       1309 non-null   int64  
 3   Name         1309 non-null   object 
 4   Sex          1309 non-null   object 
 5   Age          1309 non-null   float64
 6   SibSp        1309 non-null   int64  
 7   Parch        1309 non-null   int64  
 8   Ticket       1309 non-null   object 
 9   Fare         1309 non-null   float64
 10  Cabin        1309 non-null   object 
 11  Embarked     1309 non-null   object 
 12  relatives    1309 non-null   int64  
 13  not_alone    1309 non-null   int64  
 14  Title        1309 non-null   object 
 15  Deck         1309 non-null   int64  
dtypes: float64(3), int64(7), object(6)
memory usage: 163.8+ KB
</code></pre> 
<h3>
<a id="24__SibSp__Parch___FamilySize_1570"></a>2.4 处理特征 SibSp 和 Parch - 创建新的特征 FamilySize</h3> 
<pre><code class="prism language-python"><span class="token comment"># 同行家庭数 (包括乘客本身)</span>
titanic<span class="token punctuation">[</span><span class="token string">'FamilySize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Parch'</span><span class="token punctuation">]</span> <span class="token operator">+</span> titanic<span class="token punctuation">[</span><span class="token string">'SibSp'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
</code></pre> 
<h3>
<a id="25__Cabin___Deck_1578"></a>2.5 处理特征 Cabin - 创建新的特征 Deck</h3> 
<p>船舱号码’C123’，看起来字母代表的是甲板号。因此，我们要提取这些并创建一个新的特征，其中包含一个人的甲板区域</p> 
<pre><code class="prism language-python">titanic<span class="token punctuation">[</span><span class="token string">'Deck'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
titanic<span class="token punctuation">[</span><span class="token string">'Deck'</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code>0       U
1       C
2       U
3       C
4       U
       ..
1304    U
1305    C
1306    U
1307    U
1308    U
Name: Deck, Length: 1309, dtype: object
</code></pre> 
<pre><code class="prism language-python">titanic<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<div> 
</div> 
<table border="1" class="dataframe">
<thead><tr>
<th></th>
<th>PassengerId</th>
<th>Survived</th>
<th>Pclass</th>
<th>Name</th>
<th>Sex</th>
<th>Age</th>
<th>SibSp</th>
<th>Parch</th>
<th>Ticket</th>
<th>Fare</th>
<th>Cabin</th>
<th>Embarked</th>
<th>relatives</th>
<th>not_alone</th>
<th>Title</th>
<th>Deck</th>
<th>FamilySize</th>
</tr></thead>
<tbody>
<tr>
<th>0</th>
<td>1</td>
<td>0.0</td>
<td>3</td>
<td>Braund, Mr. Owen Harris</td>
<td>male</td>
<td>22.0</td>
<td>1</td>
<td>0</td>
<td>A/5 21171</td>
<td>7.2500</td>
<td>U0</td>
<td>S</td>
<td>1</td>
<td>0</td>
<td>Mr</td>
<td>U</td>
<td>2</td>
</tr>
<tr>
<th>1</th>
<td>2</td>
<td>1.0</td>
<td>1</td>
<td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>
<td>female</td>
<td>38.0</td>
<td>1</td>
<td>0</td>
<td>PC 17599</td>
<td>71.2833</td>
<td>C85</td>
<td>C</td>
<td>1</td>
<td>0</td>
<td>Mrs</td>
<td>C</td>
<td>2</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>1.0</td>
<td>3</td>
<td>Heikkinen, Miss. Laina</td>
<td>female</td>
<td>26.0</td>
<td>0</td>
<td>0</td>
<td>STON/O2. 3101282</td>
<td>7.9250</td>
<td>U0</td>
<td>S</td>
<td>0</td>
<td>1</td>
<td>Miss</td>
<td>U</td>
<td>1</td>
</tr>
<tr>
<th>3</th>
<td>4</td>
<td>1.0</td>
<td>1</td>
<td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td>female</td>
<td>35.0</td>
<td>1</td>
<td>0</td>
<td>113803</td>
<td>53.1000</td>
<td>C123</td>
<td>S</td>
<td>1</td>
<td>0</td>
<td>Mrs</td>
<td>C</td>
<td>2</td>
</tr>
<tr>
<th>4</th>
<td>5</td>
<td>0.0</td>
<td>3</td>
<td>Allen, Mr. William Henry</td>
<td>male</td>
<td>35.0</td>
<td>0</td>
<td>0</td>
<td>373450</td>
<td>8.0500</td>
<td>U0</td>
<td>S</td>
<td>0</td>
<td>1</td>
<td>Mr</td>
<td>U</td>
<td>1</td>
</tr>
</tbody>
</table> 
<h3>
<a id="26__1757"></a>2.6 编码</h3> 
<p>在开始建模之前，我们要执行的最后一步是将我们所有的分类特征转换为数字，因为我们的算法只能接受一个数字数组作为输入，而不是名字或字母。我们有几个列要转换。我们使用Pandas的pd.get_dummies()方法，将分类特征转换为数字特征。</p> 
<p>Label-Encoding, One-Hot-Encoder 编码区别<br> <a href="https://towardsdatascience.com/categorical-encoding-using-label-encoding-and-one-hot-encoder-911ef77fb5bd">Categorical encoding using Label-Encoding and One-Hot-Encoder</a></p> 
<pre><code class="prism language-python"><span class="token comment"># 将性别转化为整数形式</span>
titanic<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span> <span class="token operator">=</span> titanic<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"male"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"female"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 类别变量转化为dummy 变量</span>
pclass_dummies <span class="token operator">=</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>titanic<span class="token punctuation">.</span>Pclass<span class="token punctuation">,</span> prefix<span class="token operator">=</span><span class="token string">"Pclass"</span><span class="token punctuation">)</span>
title_dummies <span class="token operator">=</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>titanic<span class="token punctuation">.</span>Title<span class="token punctuation">,</span> prefix<span class="token operator">=</span><span class="token string">"Title"</span><span class="token punctuation">)</span>
deck_dummies <span class="token operator">=</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>titanic<span class="token punctuation">.</span>Deck<span class="token punctuation">,</span> prefix<span class="token operator">=</span><span class="token string">"Deck"</span><span class="token punctuation">)</span>
embarked_dummies <span class="token operator">=</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>titanic<span class="token punctuation">.</span>Embarked<span class="token punctuation">,</span> prefix<span class="token operator">=</span><span class="token string">"Embarked"</span><span class="token punctuation">)</span>

<span class="token comment"># 合并 dummy 列和原数据集</span>
titanic_dummies <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>titanic<span class="token punctuation">,</span> pclass_dummies<span class="token punctuation">,</span> title_dummies<span class="token punctuation">,</span> deck_dummies<span class="token punctuation">,</span> embarked_dummies<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 删除类别字段</span>
titanic_dummies<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Pclass'</span><span class="token punctuation">,</span> <span class="token string">'Title'</span><span class="token punctuation">,</span> <span class="token string">'Cabin'</span><span class="token punctuation">,</span><span class="token string">'Deck'</span><span class="token punctuation">,</span><span class="token string">'Embarked'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Ticket'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

titanic_dummies<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<div> 
</div> 
<table border="1" class="dataframe">
<thead><tr>
<th></th>
<th>PassengerId</th>
<th>Survived</th>
<th>Sex</th>
<th>Age</th>
<th>SibSp</th>
<th>Parch</th>
<th>Fare</th>
<th>relatives</th>
<th>not_alone</th>
<th>FamilySize</th>
<th>...</th>
<th>Deck_C</th>
<th>Deck_D</th>
<th>Deck_E</th>
<th>Deck_F</th>
<th>Deck_G</th>
<th>Deck_T</th>
<th>Deck_U</th>
<th>Embarked_C</th>
<th>Embarked_Q</th>
<th>Embarked_S</th>
</tr></thead>
<tbody>
<tr>
<th>0</th>
<td>1</td>
<td>0.0</td>
<td>0</td>
<td>22.0</td>
<td>1</td>
<td>0</td>
<td>7.2500</td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>2</td>
<td>1.0</td>
<td>1</td>
<td>38.0</td>
<td>1</td>
<td>0</td>
<td>71.2833</td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>2</th>
<td>3</td>
<td>1.0</td>
<td>1</td>
<td>26.0</td>
<td>0</td>
<td>0</td>
<td>7.9250</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>3</th>
<td>4</td>
<td>1.0</td>
<td>1</td>
<td>35.0</td>
<td>1</td>
<td>0</td>
<td>53.1000</td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>4</th>
<td>5</td>
<td>0.0</td>
<td>0</td>
<td>35.0</td>
<td>0</td>
<td>0</td>
<td>8.0500</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table> 
<p>5 rows × 31 columns</p> 
<p>我们的数据现在已经是我们需要的格式，使用之前的 train_idx 和 test_idx 索引分离训练集和测试集。</p> 
<p>还将把训练集分成X，代表预测变量，y 代表我们的目标变量，即 Survived 特征。</p> 
<ul>
<li>？问题：Survived 特征合并前是 int64 的格式，为什么合并后变成了 float64 的格式</li>
<li>？问题：警告需要解决</li>
</ul> 
<pre><code class="prism language-python"><span class="token comment"># 分离训练集和测试集</span>
train <span class="token operator">=</span> titanic_dummies<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span> <span class="token punctuation">:</span>train_idx<span class="token punctuation">]</span>
test <span class="token operator">=</span> titanic_dummies<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>test_idx<span class="token punctuation">:</span> <span class="token punctuation">]</span>

<span class="token comment"># 转化 Survived 特征为整数型</span>
train<span class="token punctuation">.</span>Survived <span class="token operator">=</span> train<span class="token punctuation">.</span>Survived<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>

<span class="token comment"># 训练集分成 X 和 Y(目标变量：Survived) </span>
x_train <span class="token operator">=</span> train<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'Survived'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values 
y_train <span class="token operator">=</span> train<span class="token punctuation">.</span>Survived<span class="token punctuation">.</span>values

<span class="token comment"># 测试集删除，训练集的目标变量：Survived</span>
x_test <span class="token operator">=</span> test<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'Survived'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values

<span class="token keyword">print</span><span class="token punctuation">(</span>train<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>train<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>   PassengerId  Survived  Sex   Age  SibSp  Parch     Fare  relatives  
0            1         0    0  22.0      1      0   7.2500          1   
1            2         1    1  38.0      1      0  71.2833          1   
2            3         1    1  26.0      0      0   7.9250          0   
3            4         1    1  35.0      1      0  53.1000          1   
4            5         0    0  35.0      0      0   8.0500          0   

   not_alone  FamilySize  ...  Deck_C  Deck_D  Deck_E  Deck_F  Deck_G  Deck_T  
0          0           2  ...       0       0       0       0       0       0   
1          0           2  ...       1       0       0       0       0       0   
2          1           1  ...       0       0       0       0       0       0   
3          0           2  ...       1       0       0       0       0       0   
4          1           1  ...       0       0       0       0       0       0   

   Deck_U  Embarked_C  Embarked_Q  Embarked_S  
0       1           0           0           1  
1       0           1           0           0  
2       1           0           0           1  
3       0           0           0           1  
4       1           0           0           1  

[5 rows x 31 columns]
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 891 entries, 0 to 890
Data columns (total 31 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   PassengerId    891 non-null    int64  
 1   Survived       891 non-null    int64  
 2   Sex            891 non-null    int64  
 3   Age            891 non-null    float64
 4   SibSp          891 non-null    int64  
 5   Parch          891 non-null    int64  
 6   Fare           891 non-null    float64
 7   relatives      891 non-null    int64  
 8   not_alone      891 non-null    int64  
 9   FamilySize     891 non-null    int64  
 10  Pclass_1       891 non-null    uint8  
 11  Pclass_2       891 non-null    uint8  
 12  Pclass_3       891 non-null    uint8  
 13  Title_Master   891 non-null    uint8  
 14  Title_Miss     891 non-null    uint8  
 15  Title_Mr       891 non-null    uint8  
 16  Title_Mrs      891 non-null    uint8  
 17  Title_Officer  891 non-null    uint8  
 18  Title_Royalty  891 non-null    uint8  
 19  Deck_A         891 non-null    uint8  
 20  Deck_B         891 non-null    uint8  
 21  Deck_C         891 non-null    uint8  
 22  Deck_D         891 non-null    uint8  
 23  Deck_E         891 non-null    uint8  
 24  Deck_F         891 non-null    uint8  
 25  Deck_G         891 non-null    uint8  
 26  Deck_T         891 non-null    uint8  
 27  Deck_U         891 non-null    uint8  
 28  Embarked_C     891 non-null    uint8  
 29  Embarked_Q     891 non-null    uint8  
 30  Embarked_S     891 non-null    uint8  
dtypes: float64(2), int64(8), uint8(21)
memory usage: 88.0 KB
None


/opt/conda/lib/python3.7/site-packages/pandas/core/generic.py:5303: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  self[name] = value
</code></pre> 
<h2>
<a id="3__2054"></a>3 建模</h2> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV

forrest_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>     
    max_depth <span class="token operator">=</span> <span class="token punctuation">[</span>n <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     
    min_samples_split <span class="token operator">=</span> <span class="token punctuation">[</span>n <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
    min_samples_leaf <span class="token operator">=</span> <span class="token punctuation">[</span>n <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     
    n_estimators <span class="token operator">=</span> <span class="token punctuation">[</span>n <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

forrest <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>

forest_cv <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>estimator<span class="token operator">=</span>forrest<span class="token punctuation">,</span> param_grid<span class="token operator">=</span>forrest_params<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> 
forest_cv<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best score: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>forest_cv<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Optimal params: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>forest_cv<span class="token punctuation">.</span>best_estimator_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>Best score: 0.8417801770133702
Optimal params: RandomForestClassifier(bootstrap=True, ccp_alpha=0.0, class_weight=None,
                       criterion='gini', max_depth=11, max_features='auto',
                       max_leaf_nodes=None, max_samples=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=2, min_samples_split=6,
                       min_weight_fraction_leaf=0.0, n_estimators=10,
                       n_jobs=None, oob_score=False, random_state=None,
                       verbose=0, warm_start=False)
</code></pre> 
<pre><code class="prism language-python">forrest_pred <span class="token operator">=</span> forest_cv<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>

kaggle <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'PassengerId'</span><span class="token punctuation">:</span> passengerId<span class="token punctuation">,</span> <span class="token string">'Survived'</span><span class="token punctuation">:</span> forrest_pred<span class="token punctuation">}</span><span class="token punctuation">)</span>

kaggle<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'submission.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Submitted successfully"</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>Submitted successfully
</code></pre> 
<h1>
<a id="_2101"></a>结束语</h1> 
<p>看完这篇，还有更多案例分享给你哦，自己慢慢找哈，就在下面链接。</p> 
<br> 
<p><font color="blue" size="5"><strong>推荐关注的专栏</strong></font></p> 
<p>?‍?‍?‍? <a href="https://blog.csdn.net/qq_44186838/category_11346644.html"><font color="gree" size="4"><strong>机器学习：分享机器学习实战项目和常用模型讲解</strong></font></a><br> ?‍?‍?‍? <a href="https://blog.csdn.net/qq_44186838/category_11176363.html"><font color="red" size="4"><strong>数据分析：分享数据分析实战项目和常用技能整理</strong></font></a><br> <br></p> 
<p><font color="blue" size="5"><strong>往期内容回顾</strong></font></p> 
<p>? <a href="https://blog.csdn.net/qq_44186838/article/details/120941026"> <font color="gree" size="4"><strong>学习Python全套代码【超详细】Python入门、核心语法、数据结构、Python进阶【致那个想学好Python的你】</strong></font></a><br> ❤️ <a href="https://blog.csdn.net/qq_44186838/article/details/121034752"><font color="red" size="4"><strong>学习pandas全套代码【超详细】数据查看、输入输出、选取、集成、清洗、转换、重塑、数学和统计方法、排序</strong></font></a><br> ? <a href="https://blog.csdn.net/qq_44186838/article/details/121036582"> <font color="blue" size="4"><strong>学习pandas全套代码【超详细】分箱操作、分组聚合、时间序列、数据可视化</strong></font></a><br> ? <a href="https://blog.csdn.net/qq_44186838/article/details/121192230"> <font color="purple" size="4"><strong>学习NumPy全套代码【超详细】基本操作、数据类型、数组运算、复制和试图、索引、切片和迭代、形状操作、通用函数、线性代数</strong></font></a></p> 
<br> 
<font color="blue" size="4">关注我，了解更多相关知识！ </font>
<br> 
<p align="right">CSDN<a href="https://blog.csdn.net/qq_44186838"><font color="blue" size="4">@报告，今天也有好好学习</font></a></p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
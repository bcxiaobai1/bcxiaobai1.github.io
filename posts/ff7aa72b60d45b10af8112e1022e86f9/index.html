<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>iOS 基于 AVFoundation 制作的用于剪辑视频项目 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">iOS 基于 AVFoundation 制作的用于剪辑视频项目</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <h2>
<a id="_0"></a>写在前面</h2> 
<p>最近做了一个剪辑视频的小项目，踩了一些小坑，但还是有惊无险的实现了功能。<br> 其实 Apple 官方也给了一个 UIVideoEditController 让我们来做视频的处理，但难以进行扩展或者自定义，所以咱们就用 Apple 给的一个框架 AVFoundation 来开发自定义的视频处理。<br> 而且发现网上并没有相关的并且比较系统的资料，于是写下了本文，希望能对也在做视频处理方面的新手（比如我）能带来帮助。</p> 
<h2>
<a id="_4"></a>项目效果图</h2> 
<p>项目的功能大概就是对视频轨道的撤销、分割、删除还有拖拽视频块来对视频扩展或者回退的功能<br> <img src="https://images2.imgbox.com/5c/69/Jsn93gG9_o.gif" alt="请添加图片描述"></p> 
<h2>
<a id="_7"></a>功能实现</h2> 
<h3>
<a id="_8"></a>一、选取视频并播放</h3> 
<p>通过 UIImagePickerController 选取视频并且跳转到自定义的编辑控制器<br> 这一部分没什么好说的<br> 示例：</p> 
<pre><code class="prism language-swift"> <span class="token comment">//选择视频</span>
       <span class="token atrule">@objc</span> <span class="token keyword">func</span> <span class="token function">selectVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
           <span class="token keyword">if</span> <span class="token builtin">UIImagePickerController</span><span class="token punctuation">.</span><span class="token function">isSourceTypeAvailable</span><span class="token punctuation">(</span><span class="token punctuation">.</span>photoLibrary<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
               <span class="token comment">//初始化图片控制器</span>
               <span class="token keyword">let</span> imagePicker <span class="token operator">=</span> <span class="token function">UIImagePickerController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token comment">//设置代理</span>
               imagePicker<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>
               <span class="token comment">//指定图片控制器类型</span>
               imagePicker<span class="token punctuation">.</span>sourceType <span class="token operator">=</span> <span class="token punctuation">.</span>photoLibrary
               <span class="token comment">//只显示视频类型的文件</span>
               imagePicker<span class="token punctuation">.</span>mediaTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">kUTTypeMovie</span> <span class="token keyword">as</span> <span class="token builtin">String</span><span class="token punctuation">]</span>
               <span class="token comment">//弹出控制器，显示界面</span>
               <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">present</span><span class="token punctuation">(</span>imagePicker<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> completion<span class="token punctuation">:</span> <span class="token constant">nil</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span>
           <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
               <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"读取相册错误"</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function">imagePickerController</span><span class="token punctuation">(</span><span class="token number">_</span> picker<span class="token punctuation">:</span> <span class="token builtin">UIImagePickerController</span><span class="token punctuation">,</span> didFinishPickingMediaWithInfo info<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">UIImagePickerController</span><span class="token punctuation">.</span><span class="token builtin">InfoKey</span> <span class="token punctuation">:</span> <span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获取视频路径（选择后视频会自动复制到app临时文件夹下）</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> videoURL <span class="token operator">=</span> info<span class="token punctuation">[</span><span class="token builtin">UIImagePickerController</span><span class="token punctuation">.</span><span class="token builtin">InfoKey</span><span class="token punctuation">.</span>mediaURL<span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token constant">URL</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> pathString <span class="token operator">=</span> videoURL<span class="token punctuation">.</span>relativePath
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"视频地址：<span class="token interpolation"><span class="token delimiter variable">(</span>pathString<span class="token delimiter variable">)</span></span>"</span><span class="token punctuation">)</span>

        <span class="token comment">//图片控制器退出</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">dismiss</span><span class="token punctuation">(</span>animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> completion<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> editorVC <span class="token operator">=</span> <span class="token builtin">EditorVideoViewController</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> videoURL<span class="token punctuation">)</span>

            editorVC<span class="token punctuation">.</span>modalPresentationStyle <span class="token operator">=</span> <span class="token builtin">UIModalPresentationStyle</span><span class="token punctuation">.</span>fullScreen
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">present</span><span class="token punctuation">(</span>editorVC<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3>
<a id="_51"></a>二、按帧获取缩略图初始化视频轨道</h3> 
<h4>
<a id="CMTime_52"></a>CMTime</h4> 
<p>在讲实现方法之前先介绍一下 CMTime，CMTime 可以用于描述更精确的时间，比如我们想表达视频中的一个瞬间例如 1：01 大多数时候你可以用 NSTimeInterval t = 61.0 这是没有什么大问题的，但浮点数有个比较严重的问题就是无法精确的表达10的-6次方比如将一百万个0.0000001相加，运算结果可能会变成1.0000000000079181，在视频流传输的过程中伴随着大量的数据加减，这样就会造成误差，所以我们需要另一种表达时间的方式，那就是 CMTime</p> 
<p>CMTime是一种C函数结构体，有4个成员。<br> typedef struct {<!-- --><br> CMTimeValue value; // 当前的CMTimeValue 的值<br> CMTimeScale timescale; // 当前的CMTimeValue 的参考标准 (比如:1000)<br> CMTimeFlags flags;<br> CMTimeEpoch epoch;<br> } CMTime;<br> 比如说平时我们所说的如果 timescale = 1000,那么 CMTimeValue = 1000 * 1 = 100</p> 
<p>CMTimeScale timescale： 当前的CMTimeValue 的参考标准,它表示1秒的时间被分成了多少份。因为整个CMTime的精度是由它控制的所以它显的尤为重要。例如，当timescale为1的时候，CMTime不能表示1秒一下的时间和1秒内的增长。相同的，当timescale为1000的时候，每秒钟便被分成了1000份，CMTime的value便代表了多少毫秒。</p> 
<h4>
<a id="_66"></a>实现方法</h4> 
<p>调用方法 <code>generateCGImagesAsynchronously(forTimes requestedTimes: [NSValue], completionHandler handler: @escaping AVAssetImageGeneratorCompletionHandler)</code></p> 
<pre><code class="prism language-swift"> <span class="token comment">/**
    	@method			generateCGImagesAsynchronouslyForTimes:completionHandler:
    	@abstract		Returns a series of CGImageRefs for an asset at or near the specified times.
    	@param			requestedTimes
    					An NSArray of NSValues, each containing a CMTime, specifying the asset times at which an image is requested.
    	@param			handler
    					A block that will be called when an image request is complete.
    	@discussion		Employs an efficient "batch mode" for getting images in time order.
    					The client will receive exactly one handler callback for each requested time in requestedTimes.
    					Changes to generator properties (snap behavior, maximum size, etc...) will not affect outstanding asynchronous image generation requests.
    					The generated image is not retained.  Clients should retain the image if they wish it to persist after the completion handler returns.
    */</span>
    open <span class="token keyword">func</span> <span class="token function">generateCGImagesAsynchronously</span><span class="token punctuation">(</span>forTimes requestedTimes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">NSValue</span><span class="token punctuation">]</span><span class="token punctuation">,</span> completionHandler handler<span class="token punctuation">:</span> @escaping <span class="token builtin">AVAssetImageGeneratorCompletionHandler</span><span class="token punctuation">)</span>
</code></pre> 
<p>浏览官方的注释，可以看出需要传入两个参数 ：<br> <code>requestedTimes: [NSValue]</code>：请求时间的数组（类型为 NSValue）每一个元素包含一个 CMTime，用于指定请求视频的时间。<br> <code>completionHandler handler: @escaping AVAssetImageGeneratorCompletionHandler</code>： 图像请求完成时将调用的块，由于方法是异步调用的，所以需要返回主线程更新 UI。</p> 
<p>示例：</p> 
<pre><code class="prism language-swift"><span class="token keyword">func</span> <span class="token function">splitVideoFileUrlFps</span><span class="token punctuation">(</span>splitFileUrl<span class="token punctuation">:</span><span class="token constant">URL</span><span class="token punctuation">,</span> fps<span class="token punctuation">:</span><span class="token builtin">Float</span><span class="token punctuation">,</span> splitCompleteClosure<span class="token punctuation">:</span>@escaping <span class="token punctuation">(</span><span class="token builtin">Bool</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token builtin">UIImage</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> splitImages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UIImage</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		
		<span class="token comment">//初始化 Asset</span>
        <span class="token keyword">let</span> optDict <span class="token operator">=</span> <span class="token function">NSDictionary</span><span class="token punctuation">(</span>object<span class="token punctuation">:</span> <span class="token function">NSNumber</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token builtin">AVURLAssetPreferPreciseDurationAndTimingKey</span> <span class="token keyword">as</span> <span class="token builtin">NSCopying</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> urlAsset <span class="token operator">=</span> <span class="token function">AVURLAsset</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> splitFileUrl<span class="token punctuation">,</span> options<span class="token punctuation">:</span> optDict <span class="token keyword">as</span><span class="token operator">?</span> <span class="token punctuation">[</span><span class="token builtin">String</span> <span class="token punctuation">:</span> <span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">let</span> cmTime <span class="token operator">=</span> urlAsset<span class="token punctuation">.</span>duration
        <span class="token keyword">let</span> durationSeconds<span class="token punctuation">:</span> <span class="token builtin">Float64</span> <span class="token operator">=</span> <span class="token function">CMTimeGetSeconds</span><span class="token punctuation">(</span>cmTime<span class="token punctuation">)</span>

        <span class="token keyword">var</span> times <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">NSValue</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> totalFrames<span class="token punctuation">:</span> <span class="token builtin">Float64</span> <span class="token operator">=</span> durationSeconds <span class="token operator">*</span> <span class="token function">Float64</span><span class="token punctuation">(</span>fps<span class="token punctuation">)</span>
        <span class="token keyword">var</span> timeFrame<span class="token punctuation">:</span> <span class="token builtin">CMTime</span>

		<span class="token comment">//定义 CMTime 即请求缩略图的时间间隔</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span>totalFrames<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            timeFrame <span class="token operator">=</span> <span class="token function">CMTimeMake</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token function">Int64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> timescale<span class="token punctuation">:</span> <span class="token function">Int32</span><span class="token punctuation">(</span>fps<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> timeValue <span class="token operator">=</span> <span class="token function">NSValue</span><span class="token punctuation">(</span>time<span class="token punctuation">:</span> timeFrame<span class="token punctuation">)</span>

            times<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>timeValue<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> imageGenerator <span class="token operator">=</span> <span class="token function">AVAssetImageGenerator</span><span class="token punctuation">(</span>asset<span class="token punctuation">:</span> urlAsset<span class="token punctuation">)</span>
        imageGenerator<span class="token punctuation">.</span>requestedTimeToleranceBefore <span class="token operator">=</span> <span class="token builtin">CMTime</span><span class="token punctuation">.</span>zero
        imageGenerator<span class="token punctuation">.</span>requestedTimeToleranceAfter <span class="token operator">=</span> <span class="token builtin">CMTime</span><span class="token punctuation">.</span>zero

        <span class="token keyword">let</span> timesCount <span class="token operator">=</span> times<span class="token punctuation">.</span><span class="token builtin">count</span>
		
		<span class="token comment">//调用获取缩略图的方法</span>
        imageGenerator<span class="token punctuation">.</span><span class="token function">generateCGImagesAsynchronously</span><span class="token punctuation">(</span>forTimes<span class="token punctuation">:</span> times<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">(</span>requestedTime<span class="token punctuation">,</span> image<span class="token punctuation">,</span> actualTime<span class="token punctuation">,</span> result<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token keyword">in</span>

        <span class="token keyword">var</span> isSuccess <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token builtin">AVAssetImageGenerator</span><span class="token punctuation">.</span><span class="token builtin">Result</span><span class="token punctuation">.</span>cancelled<span class="token punctuation">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"cancelled------"</span><span class="token punctuation">)</span>

        <span class="token keyword">case</span> <span class="token builtin">AVAssetImageGenerator</span><span class="token punctuation">.</span><span class="token builtin">Result</span><span class="token punctuation">.</span>failed<span class="token punctuation">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"failed++++++"</span><span class="token punctuation">)</span>

        <span class="token keyword">case</span> <span class="token builtin">AVAssetImageGenerator</span><span class="token punctuation">.</span><span class="token builtin">Result</span><span class="token punctuation">.</span>succeeded<span class="token punctuation">:</span>

            <span class="token keyword">let</span> framImg <span class="token operator">=</span> <span class="token function">UIImage</span><span class="token punctuation">(</span>cgImage<span class="token punctuation">:</span> image<span class="token operator">!</span><span class="token punctuation">)</span>

            splitImages<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">flipImage</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> framImg<span class="token punctuation">,</span> orientaion<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Int</span><span class="token punctuation">(</span>requestedTime<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>timesCount<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//最后一帧时 回调赋值</span>
                isSuccess <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token function">splitCompleteClosure</span><span class="token punctuation">(</span>isSuccess<span class="token punctuation">,</span> splitImages<span class="token punctuation">)</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"completed"</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

				<span class="token comment">//调用时利用回调更新 UI</span>
<span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">splitVideoFileUrlFps</span><span class="token punctuation">(</span>splitFileUrl<span class="token punctuation">:</span> url<span class="token punctuation">,</span> fps<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">(</span>isSuccess<span class="token punctuation">,</span> splitImgs<span class="token punctuation">)</span> <span class="token keyword">in</span>
            <span class="token keyword">if</span> isSuccess <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//由于方法是异步的，所以需要回主线程更新 UI</span>
                <span class="token builtin">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>async <span class="token punctuation">{<!-- --></span>
                
                    <span class="token punctuation">}</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"图片总数目imgcount:<span class="token interpolation"><span class="token delimiter variable">(</span><span class="token function">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>imageArr<span class="token punctuation">.</span><span class="token builtin">count</span><span class="token punctuation">)</span><span class="token delimiter variable">)</span></span>"</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h3>
<a id="_153"></a>三、视频指定时间跳转</h3> 
<pre><code class="prism language-swift"> <span class="token comment">/**
     @method			seekToTime:toleranceBefore:toleranceAfter:
     @abstract			Moves the playback cursor within a specified time bound.
     @param				time
     @param				toleranceBefore
     @param				toleranceAfter
     @discussion		Use this method to seek to a specified time for the current player item.
    					The time seeked to will be within the range [time-toleranceBefore, time+toleranceAfter] and may differ from the specified time for efficiency.
    					Pass kCMTimeZero for both toleranceBefore and toleranceAfter to request sample accurate seeking which may incur additional decoding delay. 
    					Messaging this method with beforeTolerance:kCMTimePositiveInfinity and afterTolerance:kCMTimePositiveInfinity is the same as messaging seekToTime: directly.
     */</span>
    open <span class="token keyword">func</span> <span class="token function">seek</span><span class="token punctuation">(</span>to time<span class="token punctuation">:</span> <span class="token builtin">CMTime</span><span class="token punctuation">,</span> toleranceBefore<span class="token punctuation">:</span> <span class="token builtin">CMTime</span><span class="token punctuation">,</span> toleranceAfter<span class="token punctuation">:</span> <span class="token builtin">CMTime</span><span class="token punctuation">)</span>
</code></pre> 
<p>三个传入的参数 <code>time: CMTime, toleranceBefore: CMTime, tolearnceAfter: CMTime</code> ，time 参数很好理解，即为想要跳转的时间。那么后面两个参数，按照官方的注释理解，简单来说为“误差的容忍度”，他将会在你拟定的这个区间内跳转，即为 [time-toleranceBefore, time+toleranceAfter] ，当然如果你传 kCMTimeZero（在我当前的版本这个参数被被改为了 CMTime.zero），即为精确搜索，但是这会导致额外的解码时间。</p> 
<p>示例：</p> 
<pre><code class="prism language-swift">	<span class="token keyword">let</span> totalTime <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>avPlayer<span class="token punctuation">.</span>currentItem<span class="token operator">?</span><span class="token punctuation">.</span>duration
	<span class="token keyword">let</span> scale <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>avPlayer<span class="token punctuation">.</span>currentItem<span class="token operator">?</span><span class="token punctuation">.</span>duration<span class="token punctuation">.</span>timescale
	
	<span class="token comment">//width：跳转到的视频轨长度 videoWidth：视频轨总长度</span>
 	<span class="token keyword">let</span> process <span class="token operator">=</span> width <span class="token operator">/</span> videoWidth
 	
      <span class="token comment">//快进函数</span>
 	<span class="token keyword">self</span><span class="token punctuation">.</span>avPlayer<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token function">CMTimeMake</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token function">Int64</span><span class="token punctuation">(</span>totalTime <span class="token operator">*</span> process <span class="token operator">*</span> scale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timescale<span class="token punctuation">:</span> scale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toleranceBefore<span class="token punctuation">:</span> <span class="token builtin">CMTime</span><span class="token punctuation">.</span>zero<span class="token punctuation">,</span> toleranceAfter<span class="token punctuation">:</span> <span class="token builtin">CMTime</span><span class="token punctuation">.</span>zero<span class="token punctuation">)</span>
</code></pre> 
<h3>
<a id="_182"></a>四、播放器监听</h3> 
<p>通过播放器的监听我们可以改变控制轨道的移动，达到视频播放器和视频轨道的联动</p> 
<pre><code class="prism language-swift"><span class="token comment">/**
    	@method			addPeriodicTimeObserverForInterval:queue:usingBlock:
    	@abstract		Requests invocation of a block during playback to report changing time.
    	@param			interval
    	  The interval of invocation of the block during normal playback, according to progress of the current time of the player.
    	@param			queue
    	  The serial queue onto which block should be enqueued.  If you pass NULL, the main queue (obtained using dispatch_get_main_queue()) will be used.  Passing a
    	  concurrent queue to this method will result in undefined behavior.
    	@param			block
    	  The block to be invoked periodically.
    	@result
    	  An object conforming to the NSObject protocol.  You must retain this returned value as long as you want the time observer to be invoked by the player.
    	  Pass this object to -removeTimeObserver: to cancel time observation.
    	@discussion		The block is invoked periodically at the interval specified, interpreted according to the timeline of the current item.
    					The block is also invoked whenever time jumps and whenever playback starts or stops.
    					If the interval corresponds to a very short interval in real time, the player may invoke the block less frequently
    					than requested. Even so, the player will invoke the block sufficiently often for the client to update indications
    					of the current time appropriately in its end-user interface.
    					Each call to -addPeriodicTimeObserverForInterval:queue:usingBlock: should be paired with a corresponding call to -removeTimeObserver:.
    					Releasing the observer object without a call to -removeTimeObserver: will result in undefined behavior.
    */</span>
    open <span class="token keyword">func</span> <span class="token function">addPeriodicTimeObserver</span><span class="token punctuation">(</span>forInterval interval<span class="token punctuation">:</span> <span class="token builtin">CMTime</span><span class="token punctuation">,</span> queue<span class="token punctuation">:</span> <span class="token builtin">DispatchQueue</span><span class="token operator">?</span><span class="token punctuation">,</span> using block<span class="token punctuation">:</span> @escaping <span class="token punctuation">(</span><span class="token builtin">CMTime</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Void</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Any</span>
</code></pre> 
<p>比较重要的一个参数是 <code>interval: CMTime</code> 这决定了代码回调的间隔时间，同时如果你在这个回调里改变视频轨道的 frame 那么这也会决定视频轨道移动的流畅度</p> 
<p>示例：</p> 
<pre><code class="prism language-swift"><span class="token comment">//player的监听</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>avPlayer<span class="token punctuation">.</span><span class="token function">addPeriodicTimeObserver</span><span class="token punctuation">(</span>forInterval<span class="token punctuation">:</span> <span class="token function">CMTimeMake</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> timescale<span class="token punctuation">:</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span> queue<span class="token punctuation">:</span> <span class="token builtin">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token keyword">in</span>
                <span class="token comment">//与轨道的联动操作</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h4>
<a id="_217"></a>与快进方法冲突的问题</h4> 
<p>这个监听方法和第三点中的快进方法会造成一个问题：当你拖动视频轨道并且去快进的时候也会触发这个回调于是就造成了 拖动视频轨道 frame （改变 frame） -&gt; 快进方法 -&gt; 触发回调 -&gt; 改变 frame 这一个死循环。那么就得添加判断条件来不去触发这个回调。</p> 
<h4>
<a id="_219"></a>快进方法与播放器联动带来的问题</h4> 
<p>播放视频是异步的，并且快进方法解码视频需要时间，所以就导致了在双方联动的过程中带来的时间差。并且当你认为视频已经快进完成的时候，想要去改变视频轨道的位置，由于解码带来的时间，导致了在回调的时候会传入几个错误的时间，使得视频轨道来回晃动。所以当前项目的做法是，回调时需要判断将要改变的 frame 是否合法（是否过大、过小）</p> 
<p>ps：如果关于这两个问题有更好的解决办法，欢迎一起讨论！</p> 
<h3>
<a id="_224"></a>五、导出视频</h3> 
<pre><code class="prism language-swift"> <span class="token comment">/**
        @method         insertTimeRange:ofTrack:atTime:error:
        @abstract       Inserts a timeRange of a source track into a track of a composition.
        @param          timeRange
                        Specifies the timeRange of the track to be inserted.
        @param          track
                        Specifies the source track to be inserted. Only AVAssetTracks of AVURLAssets and AVCompositions are supported (AVCompositions starting in MacOS X 10.10 and iOS 8.0).
        @param          startTime
                        Specifies the time at which the inserted track is to be presented by the composition track. You may pass kCMTimeInvalid for startTime to indicate that the timeRange should be appended to the end of the track.
        @param          error
                        Describes failures that may be reported to the user, e.g. the asset that was selected for insertion in the composition is restricted by copy-protection.
        @result         A BOOL value indicating the success of the insertion.
        @discussion
          You provide a reference to an AVAssetTrack and the timeRange within it that you want to insert. You specify the start time in the target composition track at which the timeRange should be inserted.
    
          Note that the inserted track timeRange will be presented at its natural duration and rate. It can be scaled to a different duration (and presented at a different rate) via -scaleTimeRange:toDuration:.
    */</span>
    open <span class="token keyword">func</span> <span class="token function">insertTimeRange</span><span class="token punctuation">(</span><span class="token number">_</span> timeRange<span class="token punctuation">:</span> <span class="token builtin">CMTimeRange</span><span class="token punctuation">,</span> of track<span class="token punctuation">:</span> <span class="token builtin">AVAssetTrack</span><span class="token punctuation">,</span> at startTime<span class="token punctuation">:</span> <span class="token builtin">CMTime</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>
</code></pre> 
<p>传入的三个参数：<br> <code>timeRange: CMTimeRange:</code>指定要插入的视频的时间范围<br> <code>track: AVAssetTrack:</code>指定要插入的视频轨道。仅支持AVURLAssets和AVCompositions的AvassetTrack（从MacOS X 10.10和iOS 8.0开始的AVCompositions）。<br> <code>starTime: CMTime:</code> 指定合成视频插入的时间点。可以传递kCMTimeInvalid 参数，以指定视频应附加到前一个视频的末尾。</p> 
<p>示例：</p> 
<pre><code class="prism language-swift">	<span class="token keyword">let</span> composition <span class="token operator">=</span> <span class="token function">AVMutableComposition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//合并视频、音频轨道</span>
    <span class="token keyword">let</span> videoTrack <span class="token operator">=</span> composition<span class="token punctuation">.</span><span class="token function">addMutableTrack</span><span class="token punctuation">(</span>
                        withMediaType<span class="token punctuation">:</span> <span class="token builtin">AVMediaType</span><span class="token punctuation">.</span>video<span class="token punctuation">,</span> preferredTrackID<span class="token punctuation">:</span> <span class="token function">CMPersistentTrackID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  	<span class="token keyword">let</span> audioTrack <span class="token operator">=</span> composition<span class="token punctuation">.</span><span class="token function">addMutableTrack</span><span class="token punctuation">(</span>
                        withMediaType<span class="token punctuation">:</span> <span class="token builtin">AVMediaType</span><span class="token punctuation">.</span>audio<span class="token punctuation">,</span> preferredTrackID<span class="token punctuation">:</span> <span class="token function">CMPersistentTrackID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


 	<span class="token keyword">let</span> asset <span class="token operator">=</span> <span class="token builtin">AVAsset</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>url<span class="token punctuation">)</span>

	<span class="token keyword">var</span> insertTime<span class="token punctuation">:</span> <span class="token builtin">CMTime</span> <span class="token operator">=</span> <span class="token builtin">CMTime</span><span class="token punctuation">.</span>zero

 	<span class="token keyword">let</span> timeScale <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>avPlayer<span class="token punctuation">.</span>currentItem<span class="token operator">?</span><span class="token punctuation">.</span>duration<span class="token punctuation">.</span>timescale

			<span class="token comment">//循环每个片段的信息</span>
	<span class="token keyword">for</span> clipsInfo <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>clipsInfoArr <span class="token punctuation">{<!-- --></span>
            
            <span class="token comment">//片段的总时间</span>
		<span class="token keyword">let</span> clipsDuration <span class="token operator">=</span> <span class="token function">Double</span><span class="token punctuation">(</span><span class="token function">Float</span><span class="token punctuation">(</span>clipsInfo<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">self</span><span class="token punctuation">.</span>videoWidth<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>totalTime
            
            <span class="token comment">//片段的开始时间</span>
		<span class="token keyword">let</span> startDuration <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">Float</span><span class="token punctuation">(</span>clipsInfo<span class="token punctuation">.</span>offset<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">self</span><span class="token punctuation">.</span>perSecondLength

      	<span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>
           	<span class="token keyword">try</span> videoTrack<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">insertTimeRange</span><span class="token punctuation">(</span><span class="token function">CMTimeRangeMake</span><span class="token punctuation">(</span>start<span class="token punctuation">:</span> <span class="token function">CMTimeMake</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token function">Int64</span><span class="token punctuation">(</span>startDuration <span class="token operator">*</span> <span class="token function">Float</span><span class="token punctuation">(</span>timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timescale<span class="token punctuation">:</span> timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">,</span> duration<span class="token punctuation">:</span><span class="token function">CMTimeMake</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token function">Int64</span><span class="token punctuation">(</span>clipsDuration <span class="token operator">*</span> <span class="token function">Double</span><span class="token punctuation">(</span>timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timescale<span class="token punctuation">:</span> timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> of<span class="token punctuation">:</span> asset<span class="token punctuation">.</span><span class="token function">tracks</span><span class="token punctuation">(</span>withMediaType<span class="token punctuation">:</span> <span class="token builtin">AVMediaType</span><span class="token punctuation">.</span>video<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> at<span class="token punctuation">:</span> insertTime<span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token number">_</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

		<span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>
         	<span class="token keyword">try</span> audioTrack<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">insertTimeRange</span><span class="token punctuation">(</span><span class="token function">CMTimeRangeMake</span><span class="token punctuation">(</span>start<span class="token punctuation">:</span> <span class="token function">CMTimeMake</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token function">Int64</span><span class="token punctuation">(</span>startDuration <span class="token operator">*</span> <span class="token function">Float</span><span class="token punctuation">(</span>timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timescale<span class="token punctuation">:</span> timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">,</span> duration<span class="token punctuation">:</span><span class="token function">CMTimeMake</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token function">Int64</span><span class="token punctuation">(</span>clipsDuration <span class="token operator">*</span> <span class="token function">Double</span><span class="token punctuation">(</span>timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timescale<span class="token punctuation">:</span> timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> of<span class="token punctuation">:</span> asset<span class="token punctuation">.</span><span class="token function">tracks</span><span class="token punctuation">(</span>withMediaType<span class="token punctuation">:</span> <span class="token builtin">AVMediaType</span><span class="token punctuation">.</span>audio<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> at<span class="token punctuation">:</span> insertTime<span class="token punctuation">)</span>
      		 <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token number">_</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
   		insertTime <span class="token operator">=</span> <span class="token function">CMTimeAdd</span><span class="token punctuation">(</span>insertTime<span class="token punctuation">,</span> <span class="token function">CMTimeMake</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token function">Int64</span><span class="token punctuation">(</span>clipsDuration <span class="token operator">*</span> <span class="token function">Double</span><span class="token punctuation">(</span>timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timescale<span class="token punctuation">:</span> timeScale<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

  		videoTrack<span class="token operator">?</span><span class="token punctuation">.</span>preferredTransform <span class="token operator">=</span> <span class="token function">CGAffineTransform</span><span class="token punctuation">(</span>rotationAngle<span class="token punctuation">:</span> <span class="token builtin">CGFloat</span><span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>

            <span class="token comment">//获取合并后的视频路径</span>
  		<span class="token keyword">let</span> documentsPath <span class="token operator">=</span> <span class="token function">NSSearchPathForDirectoriesInDomains</span><span class="token punctuation">(</span><span class="token punctuation">.</span>documentDirectory<span class="token punctuation">,</span><span class="token punctuation">.</span>userDomainMask<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

  		<span class="token keyword">let</span> destinationPath <span class="token operator">=</span> documentsPath <span class="token operator">+</span> "<span class="token operator">/</span>mergeVideo<span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">arc4random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mov"
     	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"合并后的视频：<span class="token interpolation"><span class="token delimiter variable">(</span>destinationPath<span class="token delimiter variable">)</span></span>"</span><span class="token punctuation">)</span>
</code></pre> 
<p>end：通过这几个 API 再加上交互的逻辑就能实现完整的剪辑功能啦！如果文中有不足的地方，欢迎指出！</p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
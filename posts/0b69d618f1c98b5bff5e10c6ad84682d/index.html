<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>记录学习Android基础的心得09：常用控件（高级篇） - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">记录学习Android基础的心得09：常用控件（高级篇）</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-light">
                    
                        
                    
                    <p></p>
<div class="toc">
 <h3>文章目录</h3>
 <ul>
<li><a href="#_7">前言</a></li>
<li><a href="#_17">一、屏幕显示</a></li>
<li>
<ul>
<li><a href="#1_18">1.显示屏的硬件参数</a></li>
<li><a href="#2Android_32">2.Android系统对屏幕参数的管理</a></li>
</ul>
  </li>
<li><a href="#_73">二、自定义控件</a></li>
<li>
<ul>
<li><a href="#1_82">1.分析控件</a></li>
<li><a href="#2_90">2.声明属性</a></li>
<li><a href="#3_140">3.构造对象</a></li>
<li><a href="#4_256">4.测量尺寸</a></li>
<li><a href="#5_339">5.定位坐标</a></li>
<li><a href="#6_499">6.绘制控件</a></li>
</ul>
  </li>
<li><a href="#_823">三、页面布局优化</a></li>
<li>
<ul>
<li><a href="#1_824">1.减少重复布局</a></li>
<li><a href="#2_834">2.按需加载布局资源</a></li>
<li><a href="#3_845">3.自定义主题</a></li>
</ul>
  </li>
<li><a href="#_857">四、自定义通知栏</a></li>
<li>
<ul>
<li><a href="#1_858">1.在通知栏显示通知</a></li>
<li><a href="#2_929">2.自定义通知栏的视图</a></li>
</ul>
  </li>
<li><a href="#_1016">五、碎片</a></li>
<li>
<ul>
<li><a href="#1Fragment_1020">1.Fragment的生命周期</a></li>
<li><a href="#2Fragment_1028">2.Fragment的管理</a></li>
<li><a href="#3Fragment_1041">3.Fragment的使用</a></li>
<li><a href="#4FragmentActivity_1171">4.Fragment与Activity通信</a></li>
</ul>
  </li>
<li><a href="#_1182">总结</a></li>
</ul>
</div>
<br> 
<font color="#ff0000"><br> 活着就要做有意义的事；有意义的事就是好好活着。–《士兵突击》<br> </font>
<p></p> 
<hr size='1"'> 
<h1>
<a id="_7"></a>前言</h1> 
<font color="#999AAA"> 高级篇是系统总结常用控件系列四部曲的最后一章，内容包括：屏幕显示，自定义控件，页面布局优化，自定义通知栏，碎片。关于控件的更多知识可参考专业的工具书，当然，更高级的技巧也不像本系列文章的大白话一样，肯定涉及到复杂的系统代码和数学计算，学习起来也困难得多，好了，不多 BB，进入本文正题。 </font> 
<hr size='1"'> 
<h1>
<a id="_17"></a>一、屏幕显示</h1> 
<h2>
<a id="1_18"></a>1.显示屏的硬件参数</h2> 
<p>大部分人都知道，显示屏是由像素阵列组成的，用英寸表示显示屏的尺寸大小，用分辨率表示显示屏的成像质量。可能还有部分人对这些概念还不太了解，那么接下来就系统总结一下关于显示屏的各个参数含义：<br> (1) 像素<br> 显示屏的像素指一个最小的发光单元，即便尺寸相同的显示屏的像素长宽值也会由于分辨率的不同而不同。如图是 OLED显示屏的像素结构：<br> <img src="https://images2.imgbox.com/d6/b7/80fRNcm3_o.png" alt="在这里插入图片描述"><br> (2) 分辨率<br> 显示屏的分辨率指“行像素值 x 列像素值”，如小米6屏幕的分辨率为1920x1080表示该显示屏每一行有1080个像素，每一列有1920个像素。显然，相同尺寸的显示屏的分辨率越大，那么它的发光单元越多，显示的图像就越清晰。<br> (3) 色彩深度<br> 色彩深度指显示屏的一个像素发光的颜色有多少种，一般用“位”(bit)来表示。如单色屏的每个像素有亮或灭两种状态(即2种颜色)，那么用1个数据位就可以表示该像素的所有状态，所以它的色彩深度为1bit，其它常见的显示屏色深为16bit、24bit。<br> (4) 显示屏尺寸<br> 显示屏的大小一般以英寸（1英寸=2.54厘米）表示，这个长度是指屏幕对角线的长度，通过屏幕的对角线长度及长宽比即可确定屏幕的实际长宽尺寸。<br> (5) 点距<br> 点距指两个相邻像素之间的距离，它会影响画质的细腻度及观看距离，点距越小，画质越细腻。如LED点阵显示屏的点距一般都比较大，所以适合远距离观看。</p> 
<h2>
<a id="2Android_32"></a>2.Android系统对屏幕参数的管理</h2> 
<p>(1) Android的尺寸单位<br> 获取手机屏幕的尺寸信息需使用<a href="https://www.apiref.com/android-zh/android/util/DisplayMetrics.html"> DisplayMetrics</a>，它的常用属性有：<br> ①heightPixels：计算屏幕的高度值（以像素px为单位）。<br> ②widthPixels：计算屏幕的宽度值（以像素px为单位）。<br> ③density：像素密度，表示1dp单位包含多少个px单位。<br> 比如，获取屏幕的宽度（像素点数）可通过以下方式（其他属性的获取同理）：</p> 
<pre><code class="prism language-java">    <span class="token comment">// 获得屏幕的宽度</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getScreenWidth</span><span class="token punctuation">(</span><span class="token class-name">Context</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 从系统服务中获取窗口管理器</span>
        <span class="token class-name">WindowManager</span> wm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WindowManager</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>WINDOW_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DisplayMetrics</span> dm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从窗口管理器中获取显示参数保存到dm对象中</span>
        wm<span class="token punctuation">.</span><span class="token function">getDefaultDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMetrics</span><span class="token punctuation">(</span>dm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dm<span class="token punctuation">.</span>widthPixels<span class="token punctuation">;</span> <span class="token comment">// 返回屏幕的宽度</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>上面提到的dp是大家在XML文件中经常使用的，它是一种与具体屏幕分辨率无关的尺寸单位，只与屏幕自身e的尺寸大小有关。尺寸相同，分辨率不同的屏幕，以dp为单位计量的图形最终显示的尺寸相同。通常Android中类有关尺寸的方法采用的是px单位，而XML文件使用的是dp单位，故有时需要使用DisplayMetrics的density属性进行单位换算：当density=1，表示1dp=1px，density=1.5，表示2dp=3px，density=2，表示1dp=2px，具体代码如下：</p> 
<pre><code class="prism language-java">    <span class="token comment">// 从 dp 单位 转成为 px(像素)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">dip2px</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token keyword">float</span> dpValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取当前手机的像素密度</span>
        <span class="token keyword">final</span> <span class="token keyword">float</span> scale <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>density<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>dpValue <span class="token operator">*</span> scale <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 四舍五入取整</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 从 px(像素) 单位 转成为 dp</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">px2dip</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token keyword">float</span> pxValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取当前手机的像素密度</span>
        <span class="token keyword">final</span> <span class="token keyword">float</span> scale <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>density<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>pxValue <span class="token operator">/</span> scale <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 四舍五入取整</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>Android还支持的尺寸单位有：in（英寸），mm（毫米），pt（磅,1pt=1/72 in），sp（文字尺寸），其中sp是专门用于设置文字尺寸的单位，被设置成该单位的文字会随着系统设置的字体大小而变大或变小（若使用其他单位设置字体大小，则不会随系统设置变化而变化）。<br> （2）Android像素的颜色<br> 像素作为一个基本的发光单元，它可以显示由不同光强的红，绿，蓝三原色混合而成的不同颜色。在Android中，颜色值由透明度AA，三原色RGB组成，有6位十六进制（RRGGBB），8位十六进制（AARRGGBB）两种编码。透明度AA的值为FF时，表示完全不透明，为00时表示完全透明，三原色数值（00-FF）越大，则对应的光成分占比越多，数值越小则占比越少，当三原色的数值都相等但不为最大值或最小值时，会变成灰色光。<br> 在XML文件中使用十六进制的颜色值需要添加前缀"#"，即"#(AA)RRGGBB"，在代码中直接使用颜色数值需要注意：<strong>只能使用8位的颜色编码，6位的十六进制颜色默认是完全透明的，故相当于没有效果。</strong></p> 
<h1>
<a id="_73"></a>二、自定义控件</h1> 
<p>当Android提供的原生UI控件不能满足使用需求时，开发者往往需要自定义控件。比如，上一篇文章中自定义了一个能同时绘制矩形和圆形的控件（虽然没卵用）。个人觉得自定义控件涉及到的知识应该是Android基础知识中最难的一部分了，其次是四大组件中的ContentProvider，其实我自己对于自定义控件也不是很熟练。</p> 
<p>自定义控件通常分为两种情况：（1）基于现有的控件，只优化部分外观和功能，优化后的控件保留着原有控件的大部分特征。比如前文使用过的翻页标题栏 PagerTabStrip不支持在XML文件中设置标题的文字样式，那么完全可以继承PagerTabStrip类，在它的基础上添加一些方法来支持XML文件中的文字样式设置。<br> （2）基于View或者ViewGroup，完全由开发者自己绘制控件的外观，处理控件的回调事件。这种自定义控件往往有特殊的外观和功能，比如，显示信号的示波器控件，控制方向的摇杆控件等根据需求定制的控件。</p> 
<p><strong>按照我自己的理解，自定义视图的流程通常分为六个步骤：分析控件，声明属性，构造对象，测量尺寸，定位坐标，绘制控件。</strong> 接下来自定义一个摇杆控件的例子来熟悉一下自定义控件的流程，先看一下效果动图（下图可能有点模糊，这是由于我先录屏然后再转成gif格式的图片。。）：</p> 
<p><img src="https://images2.imgbox.com/95/f3/EoGVJVS1_o.gif" alt="在这里插入图片描述"></p> 
<h2>
<a id="1_82"></a>1.分析控件</h2> 
<p>（1）外观分析<br> 肉眼望去，本例子中摇杆外观可分为四个部分组成：摇杆的正方形底盘（方向背景贴图），摇杆的杆，摇杆的球，和球所处的高亮扇形区域。本摇杆控件以正方形为边界，在控件里面绘制了方向背景贴图，摇杆的中间是一个可以拽动的小球，当手指触摸滑动摇杆控件所处的区域时，小球会追踪手指轨迹，并在正方形的内切圆边上移动，小球的圆心和控件的中心还会绘制一条一定宽度的线段（摇杆的杆），同时，会高亮显示小球所处的区域。可以看到，这两个摇杆控件的四个组成部分都不相同，表示此控件的这四个部分是可以自定义的。那么这里先自己绘制两个（丑陋的）方向背景贴图：<br> <img src="https://images2.imgbox.com/9c/6c/z9D5M5r7_o.png" alt="在这里插入图片描述"><br> （2）功能分析<br> 最基本的功能是作为一个实时跟踪手指移动轨迹的自定义控件，其次外界可以获取本控件的高亮区域。<br> 显然，这种外观由几个简单图形组成，功能单一的自定义控件，继承View来开发就完全可以了，那么同时定义摇杆控件的类名就叫RockerView吧（和系统UI控件采用相同风格命名）。</p> 
<h2>
<a id="2_90"></a>2.声明属性</h2> 
<p>控件的自定义属性大多与控件的外观有关，声明属性有两个方面：①在XML属性资源文件中声明属性。②在自定义控件类中声明属性。<br> 一般来说，XML文件中自定义的属性在类中都要有一一对应的变量，此外，在自定义的控件类中还需要一些其他的属性。这样，我们不仅可以在XML布局文件中创建该控件，也能在Java代码中创建。<br> 由于是继承自View，故View中有用的通用属性我们不需要重新声明，我们只需抽离出自定义控件的特有属性即可，比如，摇杆控件的尺寸大小完全可用View的layout_xxx属性设置，但特有属性：摇杆的方向背景贴图，摇杆的杆的粗细，杆的颜色，摇杆的球的大小，球的颜色，控件均分的扇形区域数量，扇形区域的高亮颜色需要我们自定义（本例只做演示功能，后来者可以基于实际情况定义更多的属性，让摇杆有更漂亮的外观）。<br> （1）在XML属性资源文件中声明属性<br> 首先，在res/values目录下新建一个attrs.xml的属性资源文件，指定文件的根标签为resources，resources标签可以添加两个子标签：<br> ①attr：声明控件的一个属性，attr标签可以指定name表示属性的名称，format表示属性的值的格式（数据类型）。<br> ②declare-styleable：定义一个styleable对象，它是一组attr标签的集合，用于组合多个属性，此标签的name属性通常设置为自定义控件的类名。<br> 那么从以上的控件分析很容易得到摇杆控件的属性如下：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>RockerView<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rocker_bar_color<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--&gt;摇杆的杆的颜色&lt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rocker_bar_width<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>integer<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--&gt;摇杆的杆的宽度&lt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rocker_ball_color<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--&gt;摇杆的球的颜色&lt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rocker_ball_radius<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>integer<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--&gt;摇杆的球的半径&lt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rocker_plate_background<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reference<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--&gt;摇杆的底盘的背景贴图&lt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rocker_sector_num<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>integer<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--&gt;摇杆的底盘平均分为多少个扇形区域&lt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rocker_sector_color<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--&gt;摇杆的扇形区域的颜色&lt;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>在自定义好属性文件之后，怎么使用属性资源文件所定义的属性，取决于自定义控件类的方法实现，即如何从布局文件中获取控件的自定义属性的值呢？答案是可以在自定义控件的构造方法中通过它的参数<a href="https://www.apiref.com/android-zh/android/util/AttributeSet.html"> AttributeSet</a>获取在XML布局文件中设置的这些属性值。<br> （2）在自定义控件类中声明属性<br> 要在自定义控件类中创建与自定义的属性一一对应的变量，并添加一些额外的必要属性变量。如摇杆控件中属性变量如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RockerView</span> <span class="token keyword">extends</span> <span class="token class-name">View</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Context</span> mContext<span class="token punctuation">;</span> <span class="token comment">// 声明一个上下文对象</span>
    <span class="token comment">//！！摇杆的背景贴图，扇形区域，杆，球的各种属性，如果在XML文件中未指定这些属性，则使用以下默认值：</span>
    <span class="token keyword">private</span> <span class="token class-name">Bitmap</span> rockerPlate<span class="token punctuation">;</span> <span class="token comment">// 摇杆的底盘的背景贴图</span>
    <span class="token keyword">private</span> <span class="token class-name">Region</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sectorRegions<span class="token punctuation">;</span><span class="token comment">//保存摇杆均分的每个区域</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerSectorNum <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token comment">//摇杆的底盘默认平均分为8个扇形区域</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerSectorColor <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>CYAN<span class="token punctuation">;</span><span class="token comment">// 摇杆的球所落在区域的颜色</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerBarColor <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>GREEN<span class="token punctuation">;</span> <span class="token comment">// 摇杆的杆的颜色</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerBarWidth <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">// 摇杆的杆的宽度</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerBallColor <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>RED<span class="token punctuation">;</span> <span class="token comment">// 摇杆的球的颜色</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerBallRadius <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token comment">// 摇杆的球的半径(即小圆的半径：r )</span>
    <span class="token comment">//！！</span>
    <span class="token keyword">private</span> <span class="token class-name">Matrix</span> rockerPlateMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//此矩阵用于背景贴图的缩放变换以填满本视图</span>
    <span class="token keyword">private</span> <span class="token class-name">Paint</span> rockerPlatePaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绘制背景贴图的画笔</span>
    <span class="token keyword">private</span> <span class="token class-name">Paint</span> rockerSectorPaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绘制扇形区域的画笔</span>
    <span class="token keyword">private</span> <span class="token class-name">Paint</span> rockerBarPaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绘制摇杆的杆的画笔</span>
    <span class="token keyword">private</span> <span class="token class-name">Paint</span> rockerBallPaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绘制摇杆的球的画笔</span>

<span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="3_140"></a>3.构造对象</h2> 
<p>在大脑中构想好控件的外观和功能后，需要在类中通过方法实现出来，首先重写构造方法获取控件的属性值和初始化控件的各种变量，开发者一般重写三个不同参数的构造方法：<br> ①只带一个参数（Context）的方法，此方法在从代码中生成控件时被调用。<br> ②带两个参数（Context，AttributeSet）的方法，此方法在从XML布局文件中生成控件时被调用。参数AttributeSet是从XML布局文件中获取的该控件已经设置好的属性集合。<br> ③带三个参数（Context，AttributeSet，int）的方法，在方法②的基础上，并且还要从代码中指定默认的风格生成控件时，一般可以不重写该方法。</p> 
<p>要获取控件已经设置好的属性的值，需要用到Context的方法先获取TypedArray对象：<br> <em>public final TypedArray obtainStyledAttributes(AttributeSet set, int[] attrs)</em>：第一个参数是在XML布局文件设置的该控件的所有属性集（AttributeSet），第二个参数表示描述该控件自定义属性的文件ID（R.styleable.xxx，即第二步中自定义的属性文件）。<br> 从布局文件中获取<a href="https://www.apiref.com/android-zh/android/content/res/TypedArray.html">属性数组 TypedArray</a>后，然后用该对象的getxxx方法获取各种属性的值，最后回收属性数组。<br> TypedArray的getxxx方法用于获取属性集中指定属性名称的值，第一个参数为R.styleable.属性文件名_属性名，这种命名方式是Android SDK自动生成的，开发者不必奇怪。第二个参数是指定属性为空时使用的默认值。<br> 不同数据类型的属性值对应的获取方法如下：<br> boolean：布尔，获取方法为getBoolean；<br> integer：整型，获取方法为getInteger；<br> float：小数，获取方法为getFloat；<br> string：字符串，获取方法为getString；<br> eum：枚举值，获取方法为getInt；<br> flag：标志位，获取方法为getInt；<br> color：颜色值，取值为开头带#的6或8位的十六进制数，获取方法为getColor；<br> dimension：尺寸，取值为末尾带尺寸单位的值，获取方法为getDimension；<br> fraction：百分数，取值为末尾带%的数，获取方法为getFraction；<br> reference：资源目录下的文件引用，获取此ID的方法为getResourceId。</p> 
<p>获取控件的属性值之后，接着初始化控件的各种变量。那么写出自定义的摇杆控件的构造方法如下：</p> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token class-name">RockerView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//在含有两个参数的构造函数中获取XML文件中设置该控件的属性值</span>
    <span class="token keyword">public</span> <span class="token class-name">RockerView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>attrs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 根据RockerView的属性定义，从布局文件中获取属性数组</span>
            <span class="token class-name">TypedArray</span> attrArray <span class="token operator">=</span> mContext<span class="token punctuation">.</span><span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span>attrs<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的底盘的背景贴图</span>
            rockerPlate <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span>mContext<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    attrArray<span class="token punctuation">.</span><span class="token function">getResourceId</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_plate_background<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>rocker_plate_background1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆平均划分的扇形区域</span>
            rockerSectorNum <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_sector_num<span class="token punctuation">,</span> rockerSectorNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的扇形区域的颜色</span>
            rockerSectorColor <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_sector_color<span class="token punctuation">,</span> rockerSectorColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的杆的颜色</span>
            rockerBarColor <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_bar_color<span class="token punctuation">,</span> rockerBarColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的杆的宽度</span>
            rockerBarWidth <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_bar_width<span class="token punctuation">,</span> rockerBarWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的球的颜色</span>
            rockerBallColor <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_ball_color<span class="token punctuation">,</span> rockerBallColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的球的半径</span>
            rockerBallRadius <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_ball_radius<span class="token punctuation">,</span> rockerBallRadius<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 回收属性数组</span>
            attrArray<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//根据从XML总获取的属性值设置相关画笔，一般绘制图片的画笔不需要特别的设置参数</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔为无锯齿</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setDither</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔为防抖动</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>rockerBarColor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔的颜色</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setStrokeWidth</span><span class="token punctuation">(</span>rockerBarWidth<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔的线宽</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setStrokeCap</span><span class="token punctuation">(</span><span class="token class-name">Paint<span class="token punctuation">.</span>Cap</span><span class="token punctuation">.</span>ROUND<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置线段的端点形状</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token class-name">Paint<span class="token punctuation">.</span>Style</span><span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔的类型：STROKE表示空心，FILL表示实心</span>
        rockerBallPaint<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerBallPaint<span class="token punctuation">.</span><span class="token function">setDither</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerBallPaint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>rockerBallColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerBallPaint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token class-name">Paint<span class="token punctuation">.</span>Style</span><span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerSectorPaint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>rockerSectorColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerSectorPaint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token class-name">Paint<span class="token punctuation">.</span>Style</span><span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><mark>注意：</mark> 在XML布局文件中使用自定义控件时，需要在布局文件的根标签中添加命名空间的声明：<code>xmlns:app="http://schemas.android.com/apk/res-auto"</code><br> 这里xmlns:后面的app为命名空间的简短别名前缀，开发者可以自定义该名称。在布局文件中添加自定义控件时，必须使用该控件的全路径名称（再说一遍，开发者只需输入关键字母，AS会弹出备选框供我们选择，十分方便）。</p> 
<p>要实现动图中的布局效果，页面布局文件的代码如下：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span>
	<span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
	
	<span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
	
	<span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
	<span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.example.myapplication.widget.RockerView</span>
		<span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/rockerView1<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>400px<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>400px<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">android:</span>layout_marginLeft</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50px<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50px<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_ball_color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/red<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_ball_radius</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>40<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_bar_color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/green<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_bar_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_sector_num</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_sector_color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/white<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_plate_background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/rocker_plate_background1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.example.myapplication.widget.RockerView</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.example.myapplication.widget.RockerView</span>
		<span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/rockerView2<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500px<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500px<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">android:</span>layout_marginLeft</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50px<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000px<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_ball_color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/blue<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_ball_radius</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_bar_color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/purple<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_bar_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>40<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_sector_num</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_sector_color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/black<span class="token punctuation">"</span></span>
		<span class="token attr-name"><span class="token namespace">app:</span>rocker_plate_background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/rocker_plate_background2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.example.myapplication.widget.RockerView</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FrameLayout</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<h2>
<a id="4_256"></a>4.测量尺寸</h2> 
<p>重写onMeasure测量方法，计算控件的宽和高。众所周知，在布局文件中对控件的宽和高有三种赋值方式：match_parent，wrap_content和具体带单位的尺寸值，在Java代码中分别对应<a href="https://www.apiref.com/android-zh/android/view/ViewGroup.LayoutParams.html">布局参数 ViewGroup.LayoutParams</a>的MATCH_PARENT，WRAP_CONTENT和具体整型数值。其中控件如果被设置为match_parent和具体的数值的话，都很容易计算出控件的尺寸：被设置为具体带单位的尺寸值的话，就直接获取该值就行了。被设置为match_parent时，就是与父控件的尺寸相同，当前控件就不需要计算自己的尺寸了。至于wrap_content的情况则需要开发者自己计算本控件的尺寸。<br> 一般来说，自定义控件的内部中的主要内容有三类：文字，图片，子控件。不同内容的测量方式如下：<br> （1）文字<br> 文字的宽度使用Paint类的measureText方法测得，至于文字的高度则稍微复杂点，大家都知道我们在学习写英文字母的时候，使用的是四线格来练习的：<br> <img src="https://images2.imgbox.com/e5/f6/PKF9AMdF_o.png" alt="在这里插入图片描述"><br> 四线格从上往下的第三条线称作基线，使用四线格可以规范字母的位置，比如确定了一行文字基线的位置，那么该行文字的位置也就确定了。而在Android中对文字的定位正是以基线为参考线的（比如使用Canvas的drawText方法绘制文字时，其参数Y坐标就是基线在屏幕的Y坐标），如图：<br> <img src="https://images2.imgbox.com/a2/c5/mOBkkDLS_o.png" alt="在这里插入图片描述"><br> 除了基线外，还有四条辅助线：<br> top: 文字所在行的最高高度所在线。<br> ascent: 单个文字的最高高度所在线。<br> descent:单个文字的的最低高度所在线。<br> bottom: 文字所在行的最低高度所在线。</p> 
<p><a href="https://www.apiref.com/android-zh/android/graphics/Paint.FontMetrics.html">字体尺寸 Paint.FontMetrics</a>提供了与这几条线相关的属性：<br> top，行顶与基线的距离。<br> ascent，字符顶与基线的距离。<br> descent，字符低与基线的距离。<br> bottom，行低与基线的距离。<br> leading，行间距。<br> <mark>注意，top，ascent，descent，bottom的值都是相对于基线的距离而得到的，并不是在屏幕坐标系下的Y坐标的值，即只有确定了基线的Y坐标，这四条辅助线的Y坐标才能确定。</mark></p> 
<p>那么要得到文字自身的高度，可用descent减去ascent，要得到文字所在行的高度，可用bottom减去top，再加上leading。测量文本尺寸的代码如下：</p> 
<pre><code class="prism language-java"> <span class="token comment">// 获取文本的宽度</span>
    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getTextWidth</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">,</span> <span class="token keyword">float</span> textSize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Paint</span> paint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个画笔对象</span>
        paint<span class="token punctuation">.</span><span class="token function">setTextSize</span><span class="token punctuation">(</span>textSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔的文本大小</span>
        <span class="token keyword">return</span> paint<span class="token punctuation">.</span><span class="token function">measureText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 利用画笔丈量指定文本的宽度</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 获取文本的高度</span>
    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getTextHeight</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">,</span> <span class="token keyword">float</span> textSize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Paint</span> paint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个画笔对象</span>
        paint<span class="token punctuation">.</span><span class="token function">setTextSize</span><span class="token punctuation">(</span>textSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔的文本大小</span>
        <span class="token class-name">FontMetrics</span> fm <span class="token operator">=</span> paint<span class="token punctuation">.</span><span class="token function">getFontMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取画笔默认字体的度量衡</span>
        <span class="token keyword">return</span> fm<span class="token punctuation">.</span>descent <span class="token operator">-</span> fm<span class="token punctuation">.</span>ascent<span class="token punctuation">;</span> <span class="token comment">// 返回文本自身的高度</span>
        <span class="token comment">//return fm.bottom - fm.top + fm.leading;  // 返回文本所在行的行高</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>（2）图形尺寸的测量：若图形是用位图对象Bitmap表示的，可通过位图对象的getWidth和getHeight方法获取宽高。若图形是Drawable对象表示的，则可通过它的getIntrinsicWidth和getIntrinsicHeight方法获取宽高。</p> 
<p>（3）子控件的测量<br> 自定义控件中可能含有许多其他的子控件，如果一个个去测量这些子控件的尺寸的话，那开发者就太难受了，好在View默认提供了一种对所有子控件的测量思路：实现了在整个控件树中从父控件向子控件的遍历测量，每个控件在遍历过程中将自身的尺寸信息保存起来，然后向下传递，这样遍历一次整个控件树，就得到了所有控件的尺寸信息。<br> <em>protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec)</em> 是该测量思路的主要实现方法，它的两个参数是从父控件传过来的值，是父控件想让子控件的宽高满足的建议值，这种值由mode + size两部分组成：<br> ①mode的获取通过MeasureSpec的getMode方法获取，mode的取值有三种：<br> MeasureSpec.UNSPECIFIED：对应在XML布局文件中将该控件的尺寸设置为wrap_content的情况，这时父控件没有办法给出适当的建议尺寸值，故需要开发者自己计算本控件的尺寸。<br> MeasureSpec.EXACTLY：父控件给出具体的建议尺寸数值。<br> MeasureSpec.AT_MOST：父控件给出当前控件可以被设置的最大宽高。<br> ②size的获取通过MeasureSpec的getSize方法。当mode取值为EXACTLY或者AT_MOST时，可得到具体的size。<br> 当开发者在XML布局文件中将控件尺寸设置好之后，然后在onMeasure中计算好控件的宽和高之后，还需要在onMeasure方法中最后调用setMeasuredDimension方法设置控件最终的尺寸。</p> 
<p>本例中摇杆控件尺寸的测量过程如下：</p> 
<pre><code class="prism language-java">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> ROCKER_VIEW_SIZE <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span><span class="token comment">//本视图默认的尺寸大小</span>

    <span class="token comment">//通过onMeasure函数测量本视图大小</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMeasure</span><span class="token punctuation">(</span><span class="token keyword">int</span> widthMeasureSpec<span class="token punctuation">,</span> <span class="token keyword">int</span> heightMeasureSpec<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onMeasure</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//获取上级视图给出的关于本视图大小的测量模式</span>
         <span class="token keyword">int</span> widthMode <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> heightMode <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> rockerViewMinSize<span class="token punctuation">;</span><span class="token comment">//本视图占据的区域是一个正方形，故长宽应该一致</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>widthMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>UNSPECIFIED <span class="token operator">||</span>
                 heightMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>UNSPECIFIED<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//上级视图未指定本视图的尺寸大小，则使用默认的尺寸</span>
             rockerViewMinSize <span class="token operator">=</span> ROCKER_VIEW_SIZE<span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//若上级视图给出本视图确定的宽高尺寸，那么取宽高中最小值作为本视图的区域</span>
             rockerViewMinSize <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//向上级视图确认提交本视图的尺寸大小</span>
         <span class="token function">setMeasuredDimension</span><span class="token punctuation">(</span>rockerViewMinSize<span class="token punctuation">,</span>rockerViewMinSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="5_339"></a>5.定位坐标</h2> 
<p>测量好控件尺寸后，就可以在屏幕上找个地方把控件放下了，但问题是：放哪？下面这个抽象方法可以告诉你答案。<br> <em>protected void onLayout(boolean changed, int left, int top, int right, int bottom)</em> ：可以让控件按指定的规则在屏幕上布局。参数 left，top，right，bottom分别表示：本控件距离父控件的左，上，右，下边的位置。<br> <strong>这里涉及到一个小知识：屏幕的坐标系和控件自身的坐标系，众所周知，屏幕的坐标系是以左上顶点作为坐标原点，向右为X的正方向，向下为Y的正方向。控件占据一个矩形区域，在这个区域内可以自由绘制控件的外观，控件的坐标系和屏幕的坐标系大体相似，即以该控件占据的区域的左上顶点作为坐标原点，向控件右方为X的正方向，向控件下方为Y的正方向。</strong><br> <img src="https://images2.imgbox.com/96/69/mXM4bGtX_o.png" alt="在这里插入图片描述"><br> 显然，当控件恰好占据整个屏幕区域，那么两者的坐标系就是相同的，不过当子控件被嵌套进父控件里面，那么它就会使用基于父控件的坐标系来布局。比如我们自定义控件里重写onLayout方法时，如果有子控件的时候，那么就必须注意子控件的布局是按照当前控件的坐标系来定位的，而不是根据屏幕的坐标系。</p> 
<p>当然，第四步和第五步是在自定义控件中有子控件的情况下才会变得困难的，本例中的摇杆控件直接继承自View，而且没有任何子控件，故也不需要考虑子控件导致的尺寸和坐标问题。那么摇杆控件的onLayout方法就可以不加修改，如下：</p> 
<pre><code class="prism language-java"><span class="token comment">//通过onLayout函数确定本视图在屏幕的位置坐标</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onLayout</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> changed<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> top<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onLayout</span><span class="token punctuation">(</span>changed<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>那大家可能有疑惑，不是在第一步中分析控件外观的时候，把一个摇杆控件分为了：摇杆的方向背景贴图，摇杆的杆，摇杆的球，和摇杆的球所处的扇形区域这四个部分吗？这些既然不算子控件，那么该如何计算这些组成部分的尺寸和位置坐标呢？</p> 
<p>其实当本控件在屏幕的尺寸和位置坐标确定之后，首先，我们知道方向背景贴图始终填满本控件，故它的尺寸和位置与控件相同，其次，摇杆的杆是连接摇杆的球和控件中心的一条线段，故确定了球的位置也就确定了杆的位置。摇杆的球所处的扇形区域是随着摇杆的球位置变化而变化的，同样的，确定了球的位置也就确定了该区域的位置。<br> 那么，综上，只需要求出摇杆的球的位置坐标就行了，而球的坐标是随着手指在本控件的触摸位置而变化的。手指在本控件的触摸位置可通过重写onTouchEvent方法来获得。那么，已知手指触摸位置，怎么求摇杆球的位置呢？</p> 
<p>这其实是一个简单的数学问题，经过一定的抽象：将本控件占据的正方形区域的内切圆称为大圆，其圆心为点a（Xa，Ya），将手指按下位置称为点b（Xb，Yb），将摇杆的球占据的区域称为小圆，其圆心为c（Xc，Yc），将小圆的圆心的移动轨迹称为中圆，它和大圆是同心圆。示意图如下：<br> <img src="https://images2.imgbox.com/10/fa/BjhQX1lt_o.png" alt="在这里插入图片描述"><br> 那么，该数学问题的描述和解如下：<br> <img src="https://images2.imgbox.com/43/a6/3N7BVENY_o.png" alt="在这里插入图片描述"><br> 由上述的解题方法很容易编码，计算小圆圆心轨迹如下：</p> 
<pre><code class="prism language-java">    <span class="token comment">//手指按压点b的坐标</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> pressPointX<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> pressPointY<span class="token punctuation">;</span>
    <span class="token comment">//ab连线所在的直线与中圆的交点，即小圆的圆心c的坐标</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> smallCirclePointX<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> smallCirclePointY<span class="token punctuation">;</span>

    <span class="token comment">//计算小圆的圆心坐标</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">calSmallCirclePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//ab所在的直线穿过大圆，必有两个交点c1,c2</span>
        <span class="token comment">//交点c1的坐标</span>
        <span class="token keyword">float</span> interPointX1<span class="token punctuation">;</span>
        <span class="token keyword">float</span> interPointY1<span class="token punctuation">;</span>
        <span class="token comment">//交点c2的坐标</span>
        <span class="token keyword">float</span> interPointX2<span class="token punctuation">;</span>
        <span class="token keyword">float</span> interPointY2<span class="token punctuation">;</span>
        <span class="token comment">//Xc1,2 =Xa±R/√(1+((Ya-Yb)/(Xa-Xb))^2)</span>
        interPointX1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">+</span> <span class="token punctuation">(</span>middleCircleRadius <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        interPointX2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> <span class="token punctuation">(</span>middleCircleRadius <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Yc1,2 =Ya±R/√(1+((Ya-Yb)/(Xa-Xb))^2)*((Ya-Yb))</span>
        interPointY1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bigCirclePointY <span class="token operator">+</span> <span class="token punctuation">(</span>middleCircleRadius <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        interPointY2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> <span class="token punctuation">(</span>middleCircleRadius <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//bc1的长度，bc2的长度</span>
        <span class="token keyword">float</span> bc1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>pressPointX <span class="token operator">-</span> interPointX1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>pressPointY <span class="token operator">-</span> interPointY1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> bc2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>pressPointX <span class="token operator">-</span> interPointX2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>pressPointY <span class="token operator">-</span> interPointY2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//选择c1和c2中距离按压点b最近的点</span>
        smallCirclePointX <span class="token operator">=</span> bc1 <span class="token operator">&lt;</span> bc2 <span class="token operator">?</span> interPointX1 <span class="token operator">:</span> interPointX2<span class="token punctuation">;</span>
        smallCirclePointY <span class="token operator">=</span> <span class="token punctuation">(</span>smallCirclePointX <span class="token operator">==</span> interPointX1<span class="token punctuation">)</span> <span class="token operator">?</span> interPointY1 <span class="token operator">:</span> interPointY2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>至于摇杆占据的正方形边界，区域划分，大圆圆心坐标等一些初始位置信息，可通过onLayout方法中给的参数计算而来，那么将onLayout方法补充完整（好家伙，倒叙手法记笔记了属于是），如下：</p> 
<pre><code class="prism language-java"><span class="token comment">//使用RectF用来保存摇杆视图（正方形区域）在屏幕坐标系下的位置(暂时没用到该对象！)</span>
    <span class="token keyword">private</span> <span class="token class-name">RectF</span> rockerViewRectF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//正方形的内切圆的半径和圆心:(X-Xa)^2 + (Y-Ya)^2 = R^2</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> bigCircleRadius<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> bigCirclePointX<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> bigCirclePointY<span class="token punctuation">;</span>
    <span class="token comment">//中圆（小圆的圆心轨迹）的半径</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> middleCircleRadius<span class="token punctuation">;</span>

    <span class="token comment">//通过onLayout函数确定本视图在屏幕的位置坐标</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onLayout</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> changed<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> top<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onLayout</span><span class="token punctuation">(</span>changed<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取摇杆视图在屏幕坐标系下占据的正方形区域的布局位置</span>
        rockerViewRectF<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span>top<span class="token punctuation">,</span>right<span class="token punctuation">,</span>bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取大圆在本视图的坐标系下的布局位置</span>
        <span class="token comment">//大圆半径为视图边长的一半</span>
        bigCircleRadius <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token comment">//圆心的X坐标为视图的边长的一半</span>
        bigCirclePointX <span class="token operator">=</span> bigCircleRadius<span class="token punctuation">;</span>
        <span class="token comment">//圆心的Y坐标为为视图的边长的一半</span>
        bigCirclePointY <span class="token operator">=</span>  bigCircleRadius<span class="token punctuation">;</span>
        <span class="token comment">/** 注意不要用以下方法求大圆的圆心坐标：
         * bigCirclePointY = top + bigCircleRadius;
         * bigCirclePointX = left + bigCircleRadius;
         *这是由于屏幕的坐标系和视图的坐标系是分开的，这里只用到视图的坐标系
         * 视图的坐标系同样以视图左上角为原点，向右为X正方向，向下为Y正方向
         */</span>
        <span class="token comment">//中圆和大圆是同心圆，且中圆半径为R-r，中圆的方程：(X-Xa)^2 + (Y-Ya)^2 = (R-r)^2</span>
        middleCircleRadius <span class="token operator">=</span> bigCircleRadius <span class="token operator">-</span> rockerBallRadius<span class="token punctuation">;</span>

        <span class="token comment">//缩放背景贴图来填满本视图</span>
        rockerPlateMatrix<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> scaleX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> rockerPlate<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> scaleY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> rockerPlate<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerPlateMatrix<span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span>scaleX<span class="token punctuation">,</span>scaleY<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//计算并填充均分的每个扇形区域</span>
        <span class="token function">calSectorRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//开始绘制时，手指还没有触摸本视图，所以摇杆的球默认位于本视图中心</span>
        <span class="token function">onFingerUP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//根据扇形区域数量计算的每个扇形区域的坐标信息</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">calSectorRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        sectorRegions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">[</span>rockerSectorNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Path</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sectorPaths <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">[</span>rockerSectorNum<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//每个扇形区域的轮廓</span>
        <span class="token keyword">int</span> sweepAngle <span class="token operator">=</span> <span class="token number">360</span> <span class="token operator">/</span> rockerSectorNum<span class="token punctuation">;</span><span class="token comment">//每个扇形的张开的角度</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sectorPaths<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//勾勒扇形轮廓</span>
            sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addArc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bigCircleRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>bigCircleRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    i <span class="token operator">*</span> sweepAngle<span class="token punctuation">,</span>sweepAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>bigCirclePointX<span class="token punctuation">,</span>bigCirclePointY<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//将扇形轮廓通过一定的裁剪填充进对应的区域：clipRegion1是摇杆视图占据的正方形区域，clipRegion2是圆心不可能在的区域</span>
        <span class="token class-name">Region</span> clipRegion1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCircleRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCircleRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Region</span> clipRegion2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//摇杆球的圆心不可能在此圆形区域内</span>
        <span class="token class-name">Path</span> awayBallPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        awayBallPath<span class="token punctuation">.</span><span class="token function">addCircle</span><span class="token punctuation">(</span>bigCirclePointX<span class="token punctuation">,</span>bigCirclePointX<span class="token punctuation">,</span>bigCircleRadius <span class="token operator">-</span> rockerBallRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Path<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>CW<span class="token punctuation">)</span><span class="token punctuation">;</span>
        clipRegion2<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>awayBallPath<span class="token punctuation">,</span>clipRegion1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sectorRegions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>clipRegion1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//取两区域的差</span>
            sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">op</span><span class="token punctuation">(</span>clipRegion2<span class="token punctuation">,</span> <span class="token class-name">Region<span class="token punctuation">.</span>Op</span><span class="token punctuation">.</span>DIFFERENCE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//重写该函数，获取手指在该视图的触摸信息</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_MOVE<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">onFingerDown</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">onFingerUP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//当手指触摸本视图时，则重新计算小圆的圆心坐标，然后重新绘制本视图</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onFingerDown</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token class-name">X</span><span class="token punctuation">,</span> <span class="token keyword">float</span> <span class="token class-name">Y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pressPointX <span class="token operator">=</span> <span class="token class-name">X</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pressPointY <span class="token operator">=</span> <span class="token class-name">Y</span><span class="token punctuation">;</span>
        <span class="token function">calSmallCirclePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//手指离开本视图时，将小圆的圆心则放在视图中心，然后重新绘制</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onFingerUP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        smallCirclePointX <span class="token operator">=</span> bigCirclePointX<span class="token punctuation">;</span>
        smallCirclePointY <span class="token operator">=</span> bigCirclePointY<span class="token punctuation">;</span>
        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="6_499"></a>6.绘制控件</h2> 
<p><em>protected void onDraw(Canvas canvas)</em> 和 <em>protected void dispatchDraw(Canvas canvas)</em> 都是和画图有关的方法，都提供了画布Canvas，区别在于dispatchDraw方法是在onDraw之后调用的。<strong>故如果自定义控件是继承自ViewGroup时，需要重写dispatchDraw，避免父控件的一些区域被后来绘制的子控件遮挡。如果自定义控件是继承自View时，虽然两方法最终效果相同，不过还是建议重写onDraw方法。</strong></p> 
<p>画图嘛，现实生活中，必须要有画布和画笔对吧，同样，在Android中对应Canvas和Paint。<br> Paint类定义了画笔的颜色，填充样式，线条粗细，线条阴影和抗锯齿等属性。<br> Canvas提供了三类方法：①划定可绘制区域。②绘制各种图形。③对图层进行控制操作（如旋转，缩放，平移，存取图层）。<br> Canvas的两个控制操作：<br> *public int save() * ：调用之后，会将当前Canvas绘制内容作为一个图层保存进栈中。<br> <em>public void restore()</em>：调用之后，将当前绘制的图层替换为从栈顶弹出的图层。<br> 我们在Java基础中都学过使用画布，画笔来画图的知识，这里不再展开多讲，只提出几点与图层有关的注意项：<br> <mark>①每当调用Canvas的drawxxx方法绘制时，都会在Canvas的区域中生成一个大小相同的新的透明图层，并在这个透明图层上绘制，绘制结束后，再将这个图层与Canvas进行叠加。<br> ②对当前图层进行控制操作后，当前图层中即将绘制的内容在当前图层的参考坐标系并不会改变，即始终以当前图层的左上顶点为坐标原点，向右为X正方向，向下为Y正方向。不过这是相对于当前图层的自身绘制内容而言的，而相对于Canvas（或者屏幕坐标系）来说，这些绘制的内容的坐标系已经变化了。同时，对当前图层的控制效果将一直持续影响之后生成的新图层。<br> ③绘制完成后，当Canvas与屏幕进行合成并显示时，图层中超过屏幕范围的内容将不会显示。</mark></p> 
<p>本例中摇杆控件使用onDraw方法绘制外观的实现如下：</p> 
<pre><code class="prism language-java"><span class="token comment">//onDraw函数提供了本视图占据区域的画布</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDraw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//每次绘制前清空本视图</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//绘制摇杆的底盘背景贴图，按照缩放规则填满本视图</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>rockerPlate<span class="token punctuation">,</span> rockerPlateMatrix<span class="token punctuation">,</span>rockerPlatePaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//绘制摇杆的球所在的扇形区域</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawPath</span><span class="token punctuation">(</span><span class="token function">getBallOfRegion</span><span class="token punctuation">(</span>smallCirclePointX<span class="token punctuation">,</span>smallCirclePointY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBoundaryPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rockerSectorPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//绘制摇杆的杆</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>bigCirclePointX<span class="token punctuation">,</span>bigCirclePointY<span class="token punctuation">,</span>smallCirclePointX<span class="token punctuation">,</span>smallCirclePointY<span class="token punctuation">,</span>rockerBarPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//绘制摇杆的球</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>smallCirclePointX<span class="token punctuation">,</span>smallCirclePointY<span class="token punctuation">,</span>rockerBallRadius<span class="token punctuation">,</span>rockerBallPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//检测摇杆的球所在的区域</span>
    <span class="token keyword">private</span> <span class="token class-name">Region</span> <span class="token function">getBallOfRegion</span><span class="token punctuation">(</span><span class="token keyword">float</span> smallCirclePointX<span class="token punctuation">,</span><span class="token keyword">float</span> smallCirclePointY<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sectorRegions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> smallCirclePointX<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> smallCirclePointY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>mListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//通知监听器摇杆球的位置</span>
                   mListener<span class="token punctuation">.</span><span class="token function">getSectorOfBall</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">return</span> sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//摇杆的球默认在视图中心,</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCirclePointX<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCirclePointY<span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCirclePointX<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCirclePointY<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>那么，一个完整的自定义控件便横空出世了，完整的RockerView类代码如下（绝不是为了水文章字数。。）：<br> <img src="https://images2.imgbox.com/a9/db/8w0yTpNQ_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RockerView</span> <span class="token keyword">extends</span> <span class="token class-name">View</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Context</span> mContext<span class="token punctuation">;</span> <span class="token comment">// 声明一个上下文对象</span>
    <span class="token comment">//！！摇杆的背景贴图，扇形区域，杆，球的各种属性，如果在XML文件中未指定这些属性，则使用以下默认值：</span>
    <span class="token keyword">private</span> <span class="token class-name">Bitmap</span> rockerPlate<span class="token punctuation">;</span> <span class="token comment">// 摇杆的底盘的背景贴图</span>
    <span class="token keyword">private</span> <span class="token class-name">Region</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sectorRegions<span class="token punctuation">;</span><span class="token comment">//保存摇杆均分的每个区域</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerSectorNum <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token comment">//摇杆的底盘默认平均分为8个扇形区域</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerSectorColor <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>CYAN<span class="token punctuation">;</span><span class="token comment">// 摇杆的球所落在区域的颜色</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerBarColor <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>GREEN<span class="token punctuation">;</span> <span class="token comment">// 摇杆的杆的颜色</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerBarWidth <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">// 摇杆的杆的宽度</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerBallColor <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>RED<span class="token punctuation">;</span> <span class="token comment">// 摇杆的球的颜色</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rockerBallRadius <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token comment">// 摇杆的球的半径(即小圆的半径：r )</span>
    <span class="token comment">//！！</span>

    <span class="token keyword">private</span> <span class="token class-name">Matrix</span> rockerPlateMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//此矩阵用于背景贴图的缩放变换以填满本视图</span>
    <span class="token keyword">private</span> <span class="token class-name">Paint</span> rockerPlatePaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绘制背景贴图的画笔</span>
    <span class="token keyword">private</span> <span class="token class-name">Paint</span> rockerSectorPaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绘制扇形区域的画笔</span>
    <span class="token keyword">private</span> <span class="token class-name">Paint</span> rockerBarPaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绘制摇杆的杆的画笔</span>
    <span class="token keyword">private</span> <span class="token class-name">Paint</span> rockerBallPaint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绘制摇杆的球的画笔</span>

    <span class="token keyword">public</span> <span class="token class-name">RockerView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//在含有两个参数的构造函数中获取XML文件中设置的该控件的属性值</span>
    <span class="token keyword">public</span> <span class="token class-name">RockerView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>attrs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 根据RockerView的属性定义，从布局文件中获取属性数组</span>
            <span class="token class-name">TypedArray</span> attrArray <span class="token operator">=</span> mContext<span class="token punctuation">.</span><span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span>attrs<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的底盘的背景贴图</span>
            rockerPlate <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span>mContext<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    attrArray<span class="token punctuation">.</span><span class="token function">getResourceId</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_plate_background<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>rocker_plate_background1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆平均划分的扇形区域</span>
            rockerSectorNum <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_sector_num<span class="token punctuation">,</span> rockerSectorNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的扇形区域的颜色</span>
            rockerSectorColor <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_sector_color<span class="token punctuation">,</span> rockerSectorColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的杆的颜色</span>
            rockerBarColor <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_bar_color<span class="token punctuation">,</span> rockerBarColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的杆的宽度</span>
            rockerBarWidth <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_bar_width<span class="token punctuation">,</span> rockerBarWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的球的颜色</span>
            rockerBallColor <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_ball_color<span class="token punctuation">,</span> rockerBallColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取布局文件中的摇杆的球的半径</span>
            rockerBallRadius <span class="token operator">=</span> attrArray<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>RockerView_rocker_ball_radius<span class="token punctuation">,</span> rockerBallRadius<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 回收属性数组</span>
            attrArray<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//根据从XML总获取的属性值设置相关画笔，一般绘制图片的画笔不需要特别的设置参数</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔为无锯齿</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setDither</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔为防抖动</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>rockerBarColor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔的颜色</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setStrokeWidth</span><span class="token punctuation">(</span>rockerBarWidth<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔的线宽</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setStrokeCap</span><span class="token punctuation">(</span><span class="token class-name">Paint<span class="token punctuation">.</span>Cap</span><span class="token punctuation">.</span>ROUND<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置线段的端点形状</span>
        rockerBarPaint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token class-name">Paint<span class="token punctuation">.</span>Style</span><span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置画笔的类型：STROKE表示空心，FILL表示实心</span>
        rockerBallPaint<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerBallPaint<span class="token punctuation">.</span><span class="token function">setDither</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerBallPaint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>rockerBallColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerBallPaint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token class-name">Paint<span class="token punctuation">.</span>Style</span><span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerSectorPaint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>rockerSectorColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerSectorPaint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token class-name">Paint<span class="token punctuation">.</span>Style</span><span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> ROCKER_VIEW_SIZE <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span><span class="token comment">//本视图默认的尺寸大小</span>

    <span class="token comment">//通过onMeasure函数测量本视图大小</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMeasure</span><span class="token punctuation">(</span><span class="token keyword">int</span> widthMeasureSpec<span class="token punctuation">,</span> <span class="token keyword">int</span> heightMeasureSpec<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onMeasure</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//获取上级视图给出的关于本视图大小的测量模式</span>
         <span class="token keyword">int</span> widthMode <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> heightMode <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> rockerViewMinSize<span class="token punctuation">;</span><span class="token comment">//本视图占据的区域是一个正方形，故长宽应该一致</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>widthMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>UNSPECIFIED <span class="token operator">||</span>
                 heightMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>UNSPECIFIED<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//上级视图未指定本视图的尺寸大小，则使用默认的尺寸</span>
             rockerViewMinSize <span class="token operator">=</span> ROCKER_VIEW_SIZE<span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//若上级视图给出本视图确定的宽高尺寸，那么取宽高中最小值作为本视图的区域</span>
             rockerViewMinSize <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//向上级视图确认提交本视图的尺寸大小</span>
         <span class="token function">setMeasuredDimension</span><span class="token punctuation">(</span>rockerViewMinSize<span class="token punctuation">,</span>rockerViewMinSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//使用RectF用来保存摇杆视图（正方形区域）在屏幕坐标系下的位置(暂时没用到该对象！)</span>
    <span class="token keyword">private</span> <span class="token class-name">RectF</span> rockerViewRectF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//正方形的内切圆的半径和圆心:(X-Xa)^2 + (Y-Ya)^2 = R^2</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> bigCircleRadius<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> bigCirclePointX<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> bigCirclePointY<span class="token punctuation">;</span>
    <span class="token comment">//中圆（小圆的圆心轨迹）的半径</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> middleCircleRadius<span class="token punctuation">;</span>

    <span class="token comment">//通过onLayout函数确定本视图在屏幕的位置坐标</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onLayout</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> changed<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> top<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onLayout</span><span class="token punctuation">(</span>changed<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取摇杆视图在屏幕坐标系下占据的正方形区域的布局位置</span>
        rockerViewRectF<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span>top<span class="token punctuation">,</span>right<span class="token punctuation">,</span>bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取大圆在本视图的坐标系下的布局位置</span>
        <span class="token comment">//大圆半径为视图边长的一半</span>
        bigCircleRadius <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token comment">//圆心的X坐标为视图的边长的一半</span>
        bigCirclePointX <span class="token operator">=</span> bigCircleRadius<span class="token punctuation">;</span>
        <span class="token comment">//圆心的Y坐标为为视图的边长的一半</span>
        bigCirclePointY <span class="token operator">=</span>  bigCircleRadius<span class="token punctuation">;</span>
        <span class="token comment">/** 注意不要用以下方法求大圆的圆心坐标：
         * bigCirclePointY = top + bigCircleRadius;
         * bigCirclePointX = left + bigCircleRadius;
         *这是由于屏幕的坐标系和视图的坐标系是分开的，这里只用到视图的坐标系
         * 视图的坐标系同样以视图左上角为原点，向右为X正方向，向下为Y正方向
         */</span>
        <span class="token comment">//中圆和大圆是同心圆，且中圆半径为R-r，中圆的方程：(X-Xa)^2 + (Y-Ya)^2 = (R-r)^2</span>
        middleCircleRadius <span class="token operator">=</span> bigCircleRadius <span class="token operator">-</span> rockerBallRadius<span class="token punctuation">;</span>

        <span class="token comment">//缩放背景贴图来填满本视图</span>
        rockerPlateMatrix<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> scaleX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> rockerPlate<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> scaleY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> rockerPlate<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerPlateMatrix<span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span>scaleX<span class="token punctuation">,</span>scaleY<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//计算并填充均分的每个扇形区域</span>
        <span class="token function">calSectorRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//开始绘制时，手指还没有触摸本视图，所以摇杆的球默认位于本视图中心</span>
        <span class="token function">onFingerUP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//根据扇形区域数量计算的每个扇形区域的坐标信息</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">calSectorRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        sectorRegions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">[</span>rockerSectorNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Path</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sectorPaths <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">[</span>rockerSectorNum<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//每个扇形区域的轮廓</span>
        <span class="token keyword">int</span> sweepAngle <span class="token operator">=</span> <span class="token number">360</span> <span class="token operator">/</span> rockerSectorNum<span class="token punctuation">;</span><span class="token comment">//每个扇形的张开的角度</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sectorPaths<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//勾勒扇形轮廓</span>
            sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addArc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bigCircleRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>bigCircleRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    i <span class="token operator">*</span> sweepAngle<span class="token punctuation">,</span>sweepAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>bigCirclePointX<span class="token punctuation">,</span>bigCirclePointY<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//将扇形轮廓通过一定的裁剪填充进对应的区域：clipRegion1是摇杆视图占据的正方形区域，clipRegion2是圆心不可能在的区域</span>
        <span class="token class-name">Region</span> clipRegion1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCircleRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCircleRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Region</span> clipRegion2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//摇杆球的圆心不可能在此圆形区域内</span>
        <span class="token class-name">Path</span> awayBallPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        awayBallPath<span class="token punctuation">.</span><span class="token function">addCircle</span><span class="token punctuation">(</span>bigCirclePointX<span class="token punctuation">,</span>bigCirclePointX<span class="token punctuation">,</span>bigCircleRadius <span class="token operator">-</span> rockerBallRadius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Path<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>CW<span class="token punctuation">)</span><span class="token punctuation">;</span>
        clipRegion2<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>awayBallPath<span class="token punctuation">,</span>clipRegion1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sectorRegions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>sectorPaths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>clipRegion1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//取两区域的差</span>
            sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">op</span><span class="token punctuation">(</span>clipRegion2<span class="token punctuation">,</span> <span class="token class-name">Region<span class="token punctuation">.</span>Op</span><span class="token punctuation">.</span>DIFFERENCE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//手指按压点b的坐标</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> pressPointX<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> pressPointY<span class="token punctuation">;</span>
    <span class="token comment">//ab连线所在的直线与中圆的交点，即小圆的圆心c的坐标</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> smallCirclePointX<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> smallCirclePointY<span class="token punctuation">;</span>

    <span class="token comment">//计算小圆的圆心坐标</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">calSmallCirclePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//ab所在的直线穿过大圆，必有两个交点c1,c2</span>
        <span class="token comment">//交点c1的坐标</span>
        <span class="token keyword">float</span> interPointX1<span class="token punctuation">;</span>
        <span class="token keyword">float</span> interPointY1<span class="token punctuation">;</span>
        <span class="token comment">//交点c2的坐标</span>
        <span class="token keyword">float</span> interPointX2<span class="token punctuation">;</span>
        <span class="token keyword">float</span> interPointY2<span class="token punctuation">;</span>
        <span class="token comment">//Xc1,2 =Xa±R/√(1+((Ya-Yb)/(Xa-Xb))^2)</span>
        interPointX1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">+</span> <span class="token punctuation">(</span>middleCircleRadius <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        interPointX2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> <span class="token punctuation">(</span>middleCircleRadius <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Yc1,2 =Ya±R/√(1+((Ya-Yb)/(Xa-Xb))^2)*((Ya-Yb))</span>
        interPointY1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bigCirclePointY <span class="token operator">+</span> <span class="token punctuation">(</span>middleCircleRadius <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        interPointY2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> <span class="token punctuation">(</span>middleCircleRadius <span class="token operator">/</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bigCirclePointX <span class="token operator">-</span> pressPointX<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>bigCirclePointY <span class="token operator">-</span> pressPointY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//bc1的长度，bc2的长度</span>
        <span class="token keyword">float</span> bc1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>pressPointX <span class="token operator">-</span> interPointX1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>pressPointY <span class="token operator">-</span> interPointY1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> bc2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>pressPointX <span class="token operator">-</span> interPointX2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>pressPointY <span class="token operator">-</span> interPointY2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//选择c1和c2中距离按压点b最近的点</span>
        smallCirclePointX <span class="token operator">=</span> bc1 <span class="token operator">&lt;</span> bc2 <span class="token operator">?</span> interPointX1 <span class="token operator">:</span> interPointX2<span class="token punctuation">;</span>
        smallCirclePointY <span class="token operator">=</span> <span class="token punctuation">(</span>smallCirclePointX <span class="token operator">==</span> interPointX1<span class="token punctuation">)</span> <span class="token operator">?</span> interPointY1 <span class="token operator">:</span> interPointY2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//重写该函数，获取手指在该视图的触摸信息</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_MOVE<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">onFingerDown</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">onFingerUP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//当手指触摸本视图时，则重新计算小圆的圆心坐标，然后重新绘制本视图</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onFingerDown</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token class-name">X</span><span class="token punctuation">,</span> <span class="token keyword">float</span> <span class="token class-name">Y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pressPointX <span class="token operator">=</span> <span class="token class-name">X</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pressPointY <span class="token operator">=</span> <span class="token class-name">Y</span><span class="token punctuation">;</span>
        <span class="token function">calSmallCirclePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//手指离开本视图时，将小圆的圆心则放在视图中心，然后重新绘制</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onFingerUP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        smallCirclePointX <span class="token operator">=</span> bigCirclePointX<span class="token punctuation">;</span>
        smallCirclePointY <span class="token operator">=</span> bigCirclePointY<span class="token punctuation">;</span>
        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//onDraw函数提供了本视图占据区域的画布</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDraw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//每次绘制前清空本视图</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//绘制摇杆的底盘背景贴图，按照缩放规则填满本视图</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>rockerPlate<span class="token punctuation">,</span> rockerPlateMatrix<span class="token punctuation">,</span>rockerPlatePaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//绘制摇杆的球所在的扇形区域</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawPath</span><span class="token punctuation">(</span><span class="token function">getBallOfRegion</span><span class="token punctuation">(</span>smallCirclePointX<span class="token punctuation">,</span>smallCirclePointY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBoundaryPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rockerSectorPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//绘制摇杆的杆</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>bigCirclePointX<span class="token punctuation">,</span>bigCirclePointY<span class="token punctuation">,</span>smallCirclePointX<span class="token punctuation">,</span>smallCirclePointY<span class="token punctuation">,</span>rockerBarPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//绘制摇杆的球</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>smallCirclePointX<span class="token punctuation">,</span>smallCirclePointY<span class="token punctuation">,</span>rockerBallRadius<span class="token punctuation">,</span>rockerBallPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//检测摇杆的球所在的区域</span>
    <span class="token keyword">private</span> <span class="token class-name">Region</span> <span class="token function">getBallOfRegion</span><span class="token punctuation">(</span><span class="token keyword">float</span> smallCirclePointX<span class="token punctuation">,</span><span class="token keyword">float</span> smallCirclePointY<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sectorRegions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> smallCirclePointX<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> smallCirclePointY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>mListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//通知监听器摇杆球的位置</span>
                   mListener<span class="token punctuation">.</span><span class="token function">getSectorOfBall</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">return</span> sectorRegions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//摇杆的球默认在视图中心,</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCirclePointX<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCirclePointY<span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCirclePointX<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> bigCirclePointY<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//设置一个监听小球所在区域的监听器</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OnRockerBallMoveListener</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">void</span> <span class="token function">getSectorOfBall</span><span class="token punctuation">(</span><span class="token keyword">int</span> whichSector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">OnRockerBallMoveListener</span> mListener<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOnRockerBallMOveListener</span><span class="token punctuation">(</span><span class="token class-name">OnRockerBallMoveListener</span> listener<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        mListener <span class="token operator">=</span> listener<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>在最后加入了一个扇形区域变化监听器，在Activity页面代码使用此控件如下：</p> 
<pre><code class="prism language-java">        <span class="token class-name">RockerView</span> rockerView1 <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>rockerView1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RockerView</span> rockerView2 <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>rockerView2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rockerView1<span class="token punctuation">.</span><span class="token function">setOnRockerBallMOveListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RockerView<span class="token punctuation">.</span>OnRockerBallMoveListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getSectorOfBall</span><span class="token punctuation">(</span><span class="token keyword">int</span> whichSector<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"rockerView1的球当前所在区域是："</span><span class="token operator">+</span>whichSector<span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>编码过程中，可以实时观察AS右侧窗口的控件预览，如图是一个完整的摇杆控件的预览：<br> <img src="https://images2.imgbox.com/8a/da/zeyIaU2A_o.png" alt="在这里插入图片描述"><br> 后来者可以基于此代码改进得到一个更好看，更好用的摇杆控件。<br> 我总结的自定义控件的内容可能不够丰富，但至少是准确的，这也是我记笔记的原则：内容可能不全，但一定要准确。这里推荐关于一位自定义控知识的大佬，即<a href="https://qijian.blog.csdn.net/">《Android自定义控件入门与实战》的作者启舰</a>，可以买书，也可以看<a href="https://blog.csdn.net/harvic880925/article/details/50995268">他在CSDN的博文</a>。</p> 
<h1>
<a id="_823"></a>三、页面布局优化</h1> 
<h2>
<a id="1_824"></a>1.减少重复布局</h2> 
<p>我们在进行页面UI布局时，有时可能会在布局文件中重复布局一组控件，那么可以把这组控件抽离出来作为公共布局文件，方便其他布局文件引用。在引用该公共布局时，需要使用include标签，并将该标签的layout属性设置为公共布局文件的名称。<br> 公共布局文件的顶级节点一般使用merge标签，它表示一个占位的合并标签，引用该公共布局的父布局将忽略merge，父布局只将该节点下的所有控件抽离出来并放置。这样，APP在渲染界面时会将merge节点下的所有控件导入，但不对merge根布局的尺寸的计算和调整，从而提高界面渲染速度。</p> 
<p>举个简单的例子说明这两个标签的用法，如下，一个公共布局中包含2个按钮：<br> <img src="https://images2.imgbox.com/73/2e/Yz0o91jz_o.png" alt="在这里插入图片描述"><br> 然后在两个线性布局中引用该布局，创建一个2X2的按钮阵列：<br> <img src="https://images2.imgbox.com/64/66/g3bHNwbS_o.png" alt="在这里插入图片描述"><br> 呐，使用起来就这么简单。</p> 
<h2>
<a id="2_834"></a>2.按需加载布局资源</h2> 
<p>当把视图的可视属性设置为View.GONE时，虽然此视图在屏幕上消失了，但APP在渲染界面时，还是将此视图加载进内存了，这在内存紧张的手机里是浪费行为。如果要在渲染开始前就不加载视图资源，只有当满足一定条件时才加载，可以使用ViewStub作为父布局，它容纳的子布局由layout属性指定。在APP加载页面时，ViewStub中的内容并不会预先加载，只有在代码中显式调用该ViewStub对象的inflate方法，才会将指定的布局加载进内存中。<br> 举个简单例子说下用法吧，页面布局如下，可以从右边的预览图看到ViewStub是默认不加载内容的：<br> <img src="https://images2.imgbox.com/b3/54/bOCdO11T_o.png" alt="在这里插入图片描述"><br> 在Activity代码中加载ViewStub的内容如下：</p> 
<pre><code class="prism language-java">        <span class="token class-name">ViewStub</span> vs_common <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>vs_common<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 从布局文件中获取名叫vs_common的占位视图</span>
        vs_common<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 展开占位视图</span>
</code></pre> 
<h2>
<a id="3_845"></a>3.自定义主题</h2> 
<p>样式和主题资源都用于对APP的外观进行美化，它们的概念类似于Word，即主题包含各种样式，样式包含各种格式。<br> 一个样式代表一组格式的集合，当为某一控件设置样式后，该样式所包含的所有格式将作用于该控件。样式资源和主题资源都放在放在res/values目录下的styles.xml文件中，该文件根标签是resources，可以包含多个style子标签，style标签既可以作为一个样式又可以作为一个主题，它有两个属性：<br> ①name：样式或者主题的名称。<br> ②parent：样式或者主题的父样式或父主题，指定之后，获得父样式或父主题的所有格式，当然也可以覆盖其中的格式。<br> 每个style标签包含多个item子标签，表示一个格式。<br> 大家都能很熟练地为控件指定样式，要为一个Activity页面使用主题可通过：<br> ①在配置文件AndroidManifest.xml中，在application节点中设置theme属性，表示对该APP所有的页面应用该主题。<br> ②同样在配置文件中，对activity节点设置theme属性，表示此活动页面单独应用该主题。<br> ③在Activity的onCreate方法中,在setContentView方法之前调用setTheme方法设置该Activity的主题。</p> 
<h1>
<a id="_857"></a>四、自定义通知栏</h1> 
<h2>
<a id="1_858"></a>1.在通知栏显示通知</h2> 
<p>大家在日常生活中使用手机时，肯定被部分APP在通知栏推送的各种广告搞得烦不胜烦（什么大满减，什么送现金之类的，唉，哪怕要是有一个是真的，我也不会这么穷）。那么作为开发者，如何让自己的APP在通知栏推送消息呢？<br> <a href="https://www.apiref.com/android-zh/android/app/Notification.html">通知 Notification</a>可以在通知栏显示消息，它是一种全局效果的通知，开发者一般通过 <a href="https://www.apiref.com/android-zh/android/app/NotificationManager.html">通知管理器 NotificationManager</a>来推送Notification到通知栏，<a href="https://www.apiref.com/android-zh/android/app/Notification.Builder.html">通知的构造类 Notification.Builder</a>可通过一系列setxxx方法设置Notification的各种属性，从而最终组合成一个Notification，它的setxxx方法有很多，这里只列举部分：<br> ①<em>Notification.Builder setDefaults(int defaults)</em>：选择哪种通知属性将使用系统默认值，defaults取值范围： DEFAULT_SOUND （声音），DEFAULT_VIBRATE （震动），DEFAULT_LIGHTS（闪光灯）。<br> ②<em>Notification.Builder setAutoCancel(boolean autoCancel)</em>：设置当用户触摸该通知时，该通知是否自动消失。<br> ③<em>Notification.Builder setContentTitle(CharSequence title)</em>：设置通知的标题文字。<br> ④<em>Notification.Builder setContentText(CharSequence text)</em>：设置通知的内容文字。<br> ⑤<em>Notification.Builder setLargeIcon(Bitmap b)<br> Notification.Builder setLargeIcon(Icon icon)</em>：设置通知的大图标。<br> ⑥<em>Notification.Builder setSmallIcon(int icon, int level)<br> Notification.Builder setSmallIcon(int icon)<br> Notification.Builder setSmallIcon(Icon icon)</em>：设置通知的小图标。<br> ⑦<em>Notification.Builder setTicker(CharSequence tickerText)</em>：设置本条通知在无障碍服务的“ticker”文本。<br> ⑧<em>Notification.Builder setContentIntent(PendingIntent intent)</em>：设置单击通知时将要启动的组件。<br> ⑨<em>Notification.Builder setContent(RemoteViews views)</em>：提供一个自定义远程视图RemoteViews来代替Notification.Builder默认的通知样式模板。<br> ⑩<em>Notification build()</em>：组合所有已设置的通知参数并返回一个 Notification对象。</p> 
<p>Android 8之后根据通知的重要程度，划分了<a href="https://developer.android.google.cn/reference/kotlin/android/app/NotificationChannel?hl=en">通知渠道 NotificationChannel</a>，从而方便用户管理泛滥的通知，那么开发者就必须老实的为每条通知分配对应重要程度的渠道。除此之外，通知的声音，闪光灯，震动都由NotificationChannel管理了，还有在创建Notification.Builder对象时也要指定通知渠道。<br> 那么，发送一条通知的步骤如下：<br> ①调用getSystemService方法指定NOTIFICATION_SERVICE服务并获取通知管理器NotificationManager的实例对象。<br> ②创建通知渠道 NotificationChannel，并在管理器中声明该渠道。<br> ③通过构造器创建通知构造类Notification.Builder对象。<br> ④为Notification.Builder对象设置各种参数，并调用build方法生成Notification实例对象。<br> ⑤通过NotificationManager结合通知渠道发送Notification。<br> 那么基于以上步骤，得到一个通用的发送通知的模板如下：</p> 
<pre><code class="prism language-java"><span class="token comment">// 发送一条通知到手机的通知栏（包括通知标题和通知内容）</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendOneNotification</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建一个跳转到活动页面的意图</span>
        <span class="token class-name">Intent</span> clickIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个用于页面跳转的延迟意图</span>
        <span class="token class-name">PendingIntent</span> contentIntent <span class="token operator">=</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>
                <span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">,</span> clickIntent<span class="token punctuation">,</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span>FLAG_UPDATE_CURRENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个通知的构造器</span>
        <span class="token class-name">Notification<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Android 8.0开始必须给每个通知分配对应的渠道</span>
            builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        builder<span class="token punctuation">.</span><span class="token function">setContentIntent</span><span class="token punctuation">(</span>contentIntent<span class="token punctuation">)</span> <span class="token comment">// 设置内容的点击意图</span>
                <span class="token punctuation">.</span><span class="token function">setAutoCancel</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 设置是否允许自动清除</span>
                <span class="token punctuation">.</span><span class="token function">setSmallIcon</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>ic_launcher<span class="token punctuation">)</span> <span class="token comment">// 设置状态里的小图标</span>
                <span class="token comment">//.setSubText("副本文字") // 设置通知里面的附加说明文本</span>
                <span class="token punctuation">.</span><span class="token function">setTicker</span><span class="token punctuation">(</span><span class="token string">"提示文字"</span><span class="token punctuation">)</span> <span class="token comment">// 设置通知里面的提示文本</span>
                <span class="token punctuation">.</span><span class="token function">setWhen</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 设置推送时间，格式为“小时：分钟”</span>
                <span class="token punctuation">.</span><span class="token function">setLargeIcon</span><span class="token punctuation">(</span><span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>ic_launcher<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 设置通知里面的大图标</span>
                <span class="token punctuation">.</span><span class="token function">setContentTitle</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token comment">// 设置通知里面的标题文本</span>
                <span class="token punctuation">.</span><span class="token function">setContentText</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置通知里面的内容文本</span>
        <span class="token class-name">Notification</span> notify <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 根据通知构造器构建一个通知对象</span>
        <span class="token comment">// 从系统服务中获取通知管理器</span>
        <span class="token class-name">NotificationManager</span> notifyMgr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NotificationManager</span><span class="token punctuation">)</span>
                <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建指定的通知渠道</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 创建一个默认重要性的通知渠道</span>
            <span class="token class-name">NotificationChannel</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NotificationChannel</span><span class="token punctuation">(</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">"Channel"</span><span class="token punctuation">,</span> <span class="token class-name">NotificationManager</span><span class="token punctuation">.</span>IMPORTANCE_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">setSound</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置推送通知之时的铃声。null表示静音推送</span>
            channel<span class="token punctuation">.</span><span class="token function">enableLights</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置在桌面图标右上角展示小红点</span>
            channel<span class="token punctuation">.</span><span class="token function">setLightColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>RED<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置小红点的颜色</span>
            channel<span class="token punctuation">.</span><span class="token function">setShowBadge</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在长按桌面图标时显示该渠道的通知</span>
            notifyMgr<span class="token punctuation">.</span><span class="token function">createNotificationChannel</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在通知管理器中声明该渠道</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 使用通知管理器推送通知，然后在手机的通知栏就会看到</span>
        notifyMgr<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">,</span> notify<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>那么通过该方法推送一条通知，效果如下，当点击该通知后，通知消失，然后会跳转到Intent 指定的组件中：<br> <img src="https://images2.imgbox.com/9c/0d/6RMYlEVo_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="2_929"></a>2.自定义通知栏的视图</h2> 
<p>通知可以通过setContent方法设置自定义的<a href="https://developer.android.google.cn/reference/android/widget/RemoteViews?hl=en">远程视图 RemoteViews</a>来代替Notification.Builder默认的通知样式模板。Android界面中要用到RemoteViews的场景主要在通知栏和桌面，而且RemoteViews只支持内嵌几种布局：AdapterViewFlipper，FrameLayout，GridLayout，GridView，LinearLayout，ListView，RelativeLayout，StackView，ViewFlipper。只支持内嵌几种控件：TextView，ImageView，Button，ProgressBar，Chronometer，AnalogClock。而且不支持内嵌第三方控件。这些内嵌控件的内容只能通过RemoteViews对象的setxxx方法修改。RemoteViews的常用方法如下：<br> ①<em>RemoteViews(String packageName, int layoutId)</em>：构造方法，packageName是包名，layoutId是布局文件ID。<br> ②<em>void setViewVisibility(int viewId, int visibility)</em>：设置指定ID的控件是否可见。<br> ③<em>void setViewPadding(int viewId, int left, int top, int right, int bottom)</em>：设置指定ID的控件的内边距。<br> ④<em>void setTextViewText(int viewId, CharSequence text)<br> void setTextViewTextSize(int viewId, int units, float size)</em>：设置指定ID的文本视图或者按钮的文字和大小。<br> ⑤<em>void setTextColor(int viewId, int color)</em>：设置指定ID控件的文字颜色。<br> ⑥<em>void setTextViewCompoundDrawables(int viewId, int left, int top, int right, int bottom)<br> void setTextViewCompoundDrawablesRelative(int viewId, int start, int top, int end, int bottom)</em>：设置指定ID的文本视图的四周的图标。<br> ⑦<em>void setImageViewResource(int viewId, int srcId)</em>：设置指定ID的图形视图的图像来源。<br> ⑧<em>void setChronometer(int viewId, long base, String format, boolean started)</em>：设置指定ID的计时器信息。<br> ⑨<em>void setProgressBar(int viewId, int max, int progress, boolean indeterminate)</em>：设置指定ID的进度条的信息。<br> ⑩<em>void setOnClickPendingIntent(int viewId, PendingIntent pendingIntent)</em>：设置指定ID的控件的点击响应意图。<br> 接下来举个例子熟悉一下自定义通知栏吧，比如在通知栏显示一个音乐播放状态的通知。<br> 首先，通知内容的布局文件notify_music.xml如下：<br> <img src="https://images2.imgbox.com/cd/5e/KDkpujcx_o.png" alt="在这里插入图片描述"><br> 其次，在代码中发送该通知内容到通知栏的方法如下：</p> 
<pre><code class="prism language-java">    <span class="token keyword">private</span> <span class="token class-name">Notification</span> <span class="token function">getNotification</span><span class="token punctuation">(</span><span class="token class-name">Context</span> ctx<span class="token punctuation">,</span> <span class="token class-name">String</span> event<span class="token punctuation">,</span> <span class="token class-name">String</span> song<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isPlaying<span class="token punctuation">,</span> <span class="token keyword">int</span> progress<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建一个广播事件的意图</span>
        <span class="token class-name">Intent</span> intent1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个用于广播的延迟意图</span>
        <span class="token class-name">PendingIntent</span> broadIntent <span class="token operator">=</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getBroadcast</span><span class="token punctuation">(</span>
                ctx<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">,</span> intent1<span class="token punctuation">,</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span>FLAG_UPDATE_CURRENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据布局文件notify_music.xml生成远程视图对象</span>
        <span class="token class-name">RemoteViews</span> notify_music <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RemoteViews</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>notify_music<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isPlaying<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 正在播放</span>
            notify_music<span class="token punctuation">.</span><span class="token function">setTextViewText</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_play<span class="token punctuation">,</span> <span class="token string">"暂停"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置按钮文字</span>
            notify_music<span class="token punctuation">.</span><span class="token function">setTextViewText</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_play<span class="token punctuation">,</span> song <span class="token operator">+</span> <span class="token string">"正在播放"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置文本文字</span>
            notify_music<span class="token punctuation">.</span><span class="token function">setChronometer</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>chr_play<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置计数器</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 不在播放</span>
            notify_music<span class="token punctuation">.</span><span class="token function">setTextViewText</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_play<span class="token punctuation">,</span> <span class="token string">"继续"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置按钮文字</span>
            notify_music<span class="token punctuation">.</span><span class="token function">setTextViewText</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_play<span class="token punctuation">,</span> song <span class="token operator">+</span> <span class="token string">"暂停播放"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置文本文字</span>
            notify_music<span class="token punctuation">.</span><span class="token function">setChronometer</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>chr_play<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置计数器</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 设置远程视图内部的进度条属性</span>
        notify_music<span class="token punctuation">.</span><span class="token function">setProgressBar</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>pb_play<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> progress<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置单个控件的点击广播意图，一旦点击该控件，就发出对应事件的广播。具体回调处理则可定义一个广播接收器，本例不再展开举例</span>
        notify_music<span class="token punctuation">.</span><span class="token function">setOnClickPendingIntent</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_play<span class="token punctuation">,</span> broadIntent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个跳转到活动页面的意图</span>
        <span class="token class-name">Intent</span> intent2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个用于页面跳转的延迟意图</span>
        <span class="token class-name">PendingIntent</span> clickIntent <span class="token operator">=</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span>
                <span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">,</span> intent2<span class="token punctuation">,</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span>FLAG_UPDATE_CURRENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个通知消息的构造器</span>
        <span class="token class-name">Notification<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Android 8.0开始必须给每个通知分配对应的渠道</span>
            builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        builder<span class="token punctuation">.</span><span class="token function">setContentIntent</span><span class="token punctuation">(</span>clickIntent<span class="token punctuation">)</span> <span class="token comment">// 设置内容的点击意图</span>
                <span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>notify_music<span class="token punctuation">)</span> <span class="token comment">// 设置内容视图</span>
                <span class="token punctuation">.</span><span class="token function">setTicker</span><span class="token punctuation">(</span>song<span class="token punctuation">)</span> <span class="token comment">// 设置状态栏里面的提示文本</span>
                <span class="token punctuation">.</span><span class="token function">setSmallIcon</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>qq<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置状态栏里的小图标</span>
        <span class="token comment">// 根据消息构造器构建一个通知对象</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> PAUSE_EVENT <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">// “暂停/继续”事件的标识串</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendSongNotification</span><span class="token punctuation">(</span><span class="token class-name">String</span> songName<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取自定义消息的通知对象</span>
        <span class="token class-name">Notification</span> notify <span class="token operator">=</span> <span class="token function">getNotification</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> PAUSE_EVENT<span class="token punctuation">,</span>songName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从系统服务中获取通知管理器</span>
        <span class="token class-name">NotificationManager</span> notifyMgr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NotificationManager</span><span class="token punctuation">)</span>
                <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>NOTIFICATION_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 创建一个默认重要性的通知渠道</span>
            <span class="token class-name">NotificationChannel</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NotificationChannel</span><span class="token punctuation">(</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">"Channel"</span><span class="token punctuation">,</span> <span class="token class-name">NotificationManager</span><span class="token punctuation">.</span>IMPORTANCE_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">setSound</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置推送通知之时的铃声。null表示静音推送</span>
            channel<span class="token punctuation">.</span><span class="token function">enableLights</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置在桌面图标右上角展示小红点</span>
            channel<span class="token punctuation">.</span><span class="token function">setLightColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>RED<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置小红点的颜色</span>
            channel<span class="token punctuation">.</span><span class="token function">setShowBadge</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在长按桌面图标时显示该渠道的通知</span>
            notifyMgr<span class="token punctuation">.</span><span class="token function">createNotificationChannel</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在通知管理器中声明该渠道</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 使用通知管理器推送通知，然后在手机的通知栏就会看到该消息</span>
        notifyMgr<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">,</span> notify<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<p>最后在通知栏显示的音乐播放状态的通知效果如图：<br> <img src="https://images2.imgbox.com/dd/bd/yO69GKbI_o.png" alt="在这里插入图片描述"><br> 本例没有对播放控制按钮添加相关的回调方法，开发者可自定义一个广播接收器来接收广播并进行相关回调处理。</p> 
<h1>
<a id="_1016"></a>五、碎片</h1> 
<p>使用<a href="https://www.apiref.com/android-zh/android/app/Fragment.html">碎片 Fragment</a>是为了更好的适应大屏幕的平板，由于平板的页面可以容纳更多的UI控件，不过随之而来的问题是处理控件之间更加复杂的交互。Fragment可以对UI组件进行分组，模块化管理，让开发者可以宏观的删除，替换，添加屏幕的某一区域内容，从而更方便的动态更新Activity的界面。<br> Fragment是Activity的一个子模块，有自己的生命周期，但同时受到宿主Activity的生命周期的影响。如宿主Activity暂停时，寄生的Fragment也会暂停，宿主Activity销毁时，寄生的Fragment也会销毁。一个宿主Activity可以容纳多个寄生的Fragment，当然一个Fragment可以被多个宿主Activity使用。</p> 
<h2>
<a id="1Fragment_1020"></a>1.Fragment的生命周期</h2> 
<p>Fragment作为Activity的寄生体，Activity拥有的所有生命周期回调方法，寄生的Fragment当然也拥有。除此之外，Fragment还多出了五个额外的生命周期方法：<br> ①<em>public void onAttach(@NonNull Context context)</em>：寄生的Fragment与宿主Activity结合时回调，该方法只会被调用一次，可以在这里获取宿主Activity的实例对象。<br> ②<em>public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</em>：每次创建Fragment的视图内容时回调该此方法。<br> ③<em>public void onActivityCreated(@Nullable Bundle savedInstanceState)</em>：当宿主Activity创建之后回调。<br> ④<em>public void onDestroyView()</em>：销毁该Fragment的视图内容时回调该此方法。<br> ⑤<em>public void onDetach()</em>：当寄生的Fragment被宿主Activity删除，替换时回调此方法。<br> Fragment具体的生命周期方法的调用顺序可通过日志打印来观察，这里不再详述。</p> 
<h2>
<a id="2Fragment_1028"></a>2.Fragment的管理</h2> 
<p>一个宿主Activity中包含多个寄生的Fragment，可以通过<a href="https://www.apiref.com/android-zh/android/app/FragmentManager.html">碎片管理器 FragmentManager</a>使用碎片栈来管理，FragmentManager的常用方法有：<br> ①<em>abstract Fragment findFragmentById(int id)<br> abstract Fragment findFragmentByTag(String tag)</em>：通过ID或者标签从宿主Activity中查找获取Fragment实例对象。<br> ②<em>abstract void popBackStack()</em>：从栈中弹出栈顶的Fragment实例对象，用户按手机的返回键也和该方法效果相同。<br> ③<em>abstract void addOnBackStackChangedListener(FragmentManager.OnBackStackChangedListener listener)</em>：为碎片栈添加一个状态变化监听器。<br> ④<em>abstract FragmentTransaction beginTransaction()</em>：在与FragmentManager关联的碎片上开始一系列编辑操作，即获取一个碎片事务。<br> 要添加，删除，替换Fragment，需要使用<a href="https://www.apiref.com/android-zh/android/app/FragmentTransaction.html">碎片事务 FragmentTransaction</a>，这里的事务的概念和数据库中的事务概念相同，它的常用方法有：<br> ①<em>FragmentTransaction add (int containerViewId, Fragment fragment, String tag)</em>：向宿主Activity添加一个Fragment 。<br> ②<em>abstract FragmentTransaction addToBackStack(String name)</em>：将一个Fragment 添加进栈中。<br> ③<em>abstract FragmentTransaction remove(Fragment fragment)</em>：从宿主Activity删除一个Fragment 。<br> ④<em>abstract FragmentTransaction replace(int containerViewId, Fragment fragment, String tag)</em>：替换宿主Activity中的一个Fragment 。<br> ⑤<em>abstract int commit()</em>：提交碎片事务。</p> 
<h2>
<a id="3Fragment_1041"></a>3.Fragment的使用</h2> 
<p>Fragment的创建过程和Activity类似，都需要有类和布局，碎片类可以通过继承Fragment基类，重写一部分方法来定义自己的碎片，之后创建一个与碎片类对应的布局文件。显然，手动创建太麻烦了，我们可通过AS自动创建常见页面布局的碎片，只在需要存放碎片的目录下鼠标右键-&gt;New-&gt;Fragment，然后出现：<br> <img src="https://images2.imgbox.com/b5/27/Klfb2Kge_o.png" alt="在这里插入图片描述"><br> 可以看到支持自动生成的碎片种类其实不多，当我们点击其中一个种类的碎片时，AS会弹出一个配置窗口供我们设置碎片的页面布局，名称等初始参数。分别点击空白，列表，登录种类的碎片的配置窗口如下：<br> <img src="https://images2.imgbox.com/46/98/cGCXu9bn_o.png" alt="在这里插入图片描述"><br> 这里我们定义一个空白碎片BlankFragment，空白碎片的页面完全自定义，扩展性很强。当我们点击配置窗口的Finish后，AS会自动生成BlankFragment的部分代码，并且给出了注释。我们只需按照这些提示填充自定义碎片的代码就行了。看一下AS帮我们自动生成的代码中：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * Use this factory method to create a new instance of
     * this fragment using the provided parameters.
     *
     * @param param1 Parameter 1.
     * @param param2 Parameter 2.
     * @return A new instance of fragment BlankFragment.
     */</span>
    <span class="token comment">// TODO: Rename and change types and number of parameters</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BlankFragment</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">String</span> param1<span class="token punctuation">,</span> <span class="token class-name">String</span> param2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">BlankFragment</span> fragment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlankFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Bundle</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>ARG_PARAM1<span class="token punctuation">,</span> param1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>ARG_PARAM2<span class="token punctuation">,</span> param2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fragment<span class="token punctuation">.</span><span class="token function">setArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fragment<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mParam1 <span class="token operator">=</span> <span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>ARG_PARAM1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mParam2 <span class="token operator">=</span> <span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>ARG_PARAM2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>按照注释，我们需要使用该类的newInstance方法传递相关参数并生成碎片实例对象，该方法是先通过构造函数生成碎片对象，然后调用它的setArguments方法设置参数的。在生成对象的过程中，即碎片生命周期onCreate方法中通过getArguments获取设置的参数，然后根据这些参数设置碎片对象。</p> 
<p>与使用普通的控件视图相比，Fragment的作用还是在屏幕显示内容，该内容就是在创建Fragment时指定的与之关联的布局文件，所以它就是一个特别一点点的视图而已。Fragment既可以直接在布局文件中使用，也可以在Java代码中手动创建并添加到屏幕上。</p> 
<p>在布局文件中通过添加fragment标签，然后指定该碎片的id，name（碎片的全路径类名）和其他的布局属性就可以了，和普通控件没啥大的区别。</p> 
<p>这里举个例子来说明在Java代码中动态创建Fragment，让Fragment搭配前文的翻页视图ViewPager共同使用，如此，翻页视图的每一页就是一个Fragment。</p> 
<p>首先需要修改一下自动生成的空白碎片BlankFragment的页面布局，插入一个图形视图和文本视图：<br> <img src="https://images2.imgbox.com/74/f7/M6QeKkJY_o.png" alt="在这里插入图片描述"><br> 其次需要根据碎片的布局显示的内容，修改一下AS自动生成的BlankFragment类：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlankFragment</span> <span class="token keyword">extends</span> <span class="token class-name">Fragment</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> <span class="token class-name">View</span> mView<span class="token punctuation">;</span> <span class="token comment">// 声明一个视图对象</span>
    <span class="token keyword">protected</span> <span class="token class-name">Context</span> mContext<span class="token punctuation">;</span> <span class="token comment">// 声明一个上下文对象</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> mImageId<span class="token punctuation">;</span> <span class="token comment">// 图片的资源编号</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mDesc<span class="token punctuation">;</span> <span class="token comment">// 文字描述</span>

    <span class="token comment">// 获取该碎片的一个实例</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BlankFragment</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">int</span> image_id<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">BlankFragment</span> fragment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlankFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建该碎片的一个实例</span>
        <span class="token class-name">Bundle</span> bundle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个新包裹</span>
        bundle<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token string">"image_id"</span><span class="token punctuation">,</span> image_id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往包裹存入图片的资源编号</span>
        bundle<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"desc"</span><span class="token punctuation">,</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往包裹存入软件的文字描述</span>
        fragment<span class="token punctuation">.</span><span class="token function">setArguments</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 把包裹塞给碎片</span>
        <span class="token keyword">return</span> fragment<span class="token punctuation">;</span> <span class="token comment">// 返回碎片实例</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建碎片视图</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span> inflater<span class="token punctuation">,</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">,</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mContext <span class="token operator">=</span> <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取活动页面的上下文</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果碎片携带有包裹，则打开包裹获取参数信息</span>
            mImageId <span class="token operator">=</span> <span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"image_id"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mDesc <span class="token operator">=</span> <span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"desc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 根据布局文件fragment_blank.xml生成视图对象</span>
        mView <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fragment_blank<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ImageView</span> iv_pic <span class="token operator">=</span> mView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>iv_pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TextView</span> tv_desc <span class="token operator">=</span> mView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        iv_pic<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>mImageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tv_desc<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>mDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mView<span class="token punctuation">;</span> <span class="token comment">// 返回该碎片的视图对象</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>与碎片搭配的翻页视图需要使用另一个专门的适配器FragmentStatePagerAdapter ，通过继承该适配器，实现的代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SoftwareFragmentPagerAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">FragmentStatePagerAdapter</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SoftwareBean</span><span class="token punctuation">&gt;</span></span> mSoftwareList<span class="token punctuation">;</span> <span class="token comment">// 声明一个工具软件队列</span>
    <span class="token comment">// 碎片页适配器的构造函数，传入碎片管理器与软件队列</span>
    <span class="token keyword">public</span> <span class="token class-name">SoftwareFragmentPagerAdapter</span><span class="token punctuation">(</span><span class="token class-name">FragmentManager</span> fm<span class="token punctuation">,</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SoftwareBean</span><span class="token punctuation">&gt;</span></span> software_list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>fm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mSoftwareList <span class="token operator">=</span> software_list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取碎片Fragment的个数</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> mSoftwareList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取指定位置的碎片Fragment</span>
    <span class="token keyword">public</span> <span class="token class-name">Fragment</span> <span class="token function">getItem</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">BlankFragment</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>mSoftwareList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span>image<span class="token punctuation">,</span> mSoftwareList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获得指定碎片页的标题文本</span>
    <span class="token keyword">public</span> <span class="token class-name">CharSequence</span> <span class="token function">getPageTitle</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> mSoftwareList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后使用这对组合时，只需在Activity的页面布局中添加一个翻页视图和一个翻页标题栏：<br> <img src="https://images2.imgbox.com/cf/62/XJmVJKQt_o.png" alt="在这里插入图片描述"><br> 在Activity中初始化这对组合的代码如下：</p> 
<pre><code class="prism language-java"> <span class="token comment">// 初始化翻页视图</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initViewPager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SoftwareBean</span><span class="token punctuation">&gt;</span></span> goodsList <span class="token operator">=</span> <span class="token class-name">SoftwareBean</span><span class="token punctuation">.</span><span class="token function">getDefaultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 构建一个碎片翻页适配器</span>
        <span class="token class-name">SoftwareFragmentPagerAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftwareFragmentPagerAdapter</span><span class="token punctuation">(</span>
                <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> goodsList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从布局视图中获取名叫vp_content的翻页视图</span>
        <span class="token class-name">ViewPager</span> vp_content <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>vp_content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 给vp_content设置碎片适配器</span>
        vp_content<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置vp_content默认显示第一个页面</span>
        vp_content<span class="token punctuation">.</span><span class="token function">setCurrentItem</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>最终的显示效果其实和前面效果一样，不过是将翻页视图的每一页换成了碎片而已：<br> <img src="https://images2.imgbox.com/97/a0/bP19TXZv_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="4FragmentActivity_1171"></a>4.Fragment与Activity通信</h2> 
<p>宿主Activity和寄生的Fragment通常需要双向传送数据，比如Fragment中的按钮被点击时要及时将该点击信息发送给Activity，Activity作出响应后，要改变Fragment中某一控件的内容时也要向Fragment发送数据。通常，有两种方法可以实现它们之间的双向通信：<br> （1）方法一<br> 寄生的Fragment可通过getActivity方法获取宿主Activity的实例，宿主Activity可通过与自身关联的碎片管理器的findFragmentById或者findFragmentByTag方法获取寄生的Fragment的实例。于是，如果宿主Activity需要向寄生的Fragment发送数据，则可调用Fragment对象的的setArguments方法，如果寄生的Fragment需要向宿主Activity发送数据，则可以定义一个内部回调接口，再让宿主Activity实现该接口就可以实现通信了。<br> （2）方法二<br> 估计小部分开发者看到方法一觉得稍微有点难度，其实由于Fragment也有生命周期，故使用广播来实现双向通信就很简单了。此外，广播还可以实现Fragment与Fragment之间，Fragment与其他组件的通信，这里就不再举例了。<br> 所以说，Android的广播真的是一种简单，高效的通信方式，面对这种相互通信的场景时，别老想着定义回调接口，要优先考虑广播。<br> <img src="https://images2.imgbox.com/fa/82/LBuBtbFT_o.png" alt="在这里插入图片描述"></p> 
<hr size='10"'> 
<h1>
<a id="_1182"></a>总结</h1> 
<font color="#999AAA"> 本文粗略的总结了屏幕显示，自定义控件，页面布局优化，自定义通知栏，碎片五个部分，常用控件从常识篇到高级篇共四篇文章足以应对工具类APP的GUI开发了。还是那句话，控件的学习要先建立感性的认识，要知道该控件有着怎样的外观和作用，其次才是学习关于它的API，这样的话，假如有一天去别的平台如Windows或Linux或嵌入式等，它们的GUI部分也是大同小异的，学习起来也是触类旁通的。 </font>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Android事件分发初探 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android事件分发初探</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-light">
                    
                        
                    
                    <p></p>
<div class="toc">
 <h3>事件分发初探</h3>
 <ul>
<li><a href="#_1">一、概述</a></li>
<li>
<ul>
<li><a href="#11__3">1.1 事件分发概述</a></li>
<li><a href="#12__7">1.2 事件的类型</a></li>
<li><a href="#13__16">1.3 什么是事件序列？</a></li>
<li><a href="#14__24">1.4 事件分发过程中共同协作的方法。</a></li>
<li><a href="#15__37">1.5 事件在哪些对象之间传递？传递的顺序是什么？</a></li>
<li><a href="#16__41">1.6 事件的传递过程</a></li>
<li>
<ul>
<li><a href="#1_43">1.由上而下的传递过程</a></li>
<li><a href="#2_50">2.由下而上的传递过程</a></li>
</ul>
   </li>
<li><a href="#17_ViewGroupdispatchTouchEventonTouchEvent_54">1.7 ViewGroup怎么通过dispatchTouchEvent()把事件传递给自己的onTouchEvent？</a></li>
<li><a href="#18_ViewdispatchTouchEvent_58">1.8 View有自己的dispatchTouchEvent()方法吗？</a></li>
<li><a href="#19_dispatchTouchEventonTouchEvent_62">1.9 dispatchTouchEvent()中希望让自己的`onTouchEvent()`处理怎么操作？</a></li>
<li><a href="#110_dispatchTouchEventView_66">1.10 dispatchTouchEvent()中希望传给子View怎么操作？</a></li>
<li><a href="#111__70">1.11 希望不做处理、终止向下传递、开始回溯，怎么操作？</a></li>
<li><a href="#112_onTouchonTouchEvent_74">1.12 onTouch和onTouchEvent的区别是什么？</a></li>
<li><a href="#113__92">1.13 事件分发传递规则</a></li>
</ul>
  </li>
<li><a href="#_102">二、事件分发源码分析</a></li>
<li>
<ul>
<li><a href="#21_1Activity_104">2.1 流程1：Activity的事件分发机制</a></li>
<li><a href="#22_2ViewGroup_147">2.2 流程2：ViewGroup的事件分发机制</a></li>
<li><a href="#23_3View_292">2.3 流程3：View的事件分发机制</a></li>
<li>
<ul><li><a href="#_552">返回值分析：</a></li></ul>
  </li>
</ul>
  </li>
<li><a href="#_560">三、事件分发三个方法的流程图</a></li>
<li>
<ul>
<li><a href="#31_dispatchTouchEvent_562">3.1 dispatchTouchEvent()流程图</a></li>
<li><a href="#32_onInterceptTouchEvent_573">3.2 onInterceptTouchEvent()流程图</a></li>
<li><a href="#33_onTouchEvent_580">3.3 onTouchEvent()流程图</a></li>
</ul>
  </li>
<li><a href="#_588">四、事件传递的几种情况</a></li>
<li>
<ul>
<li><a href="#41__590">4.1 默认情况</a></li>
<li><a href="#42__598">4.2 处理事件</a></li>
<li><a href="#43_DOWN_612">4.3 拦截DOWN事件</a></li>
<li><a href="#44__624">4.4 拦截事件列中间事件</a></li>
</ul>
 </li>
</ul>
</div>
<p></p> 
<h1>
<a id="_1"></a>一、概述</h1> 
<h2>
<a id="11__3"></a>1.1 事件分发概述</h2> 
<p>**答：**当用户触摸屏幕（<code>View</code> 或 <code>ViewGroup</code>派生的控件），将产生点击事件（<code>Touch</code>事件）。<code>Touch</code>事件的相关细节（发生触摸的<code>位置</code>、<code>时间</code>等）被封装成<code>MotionEvent</code>对象，系统需把这个事件传递给一个具体的 View 去处理（消费）以及处理（消费）的整个过程。**即事件传递的过程及处理的整个过程，**其可能经过的对象有最上层Activity，中间层ViewGroup，最下层View。</p> 
<h2>
<a id="12__7"></a>1.2 事件的类型</h2> 
<table>
<thead><tr>
<th>事件类型</th>
<th>具体动作</th>
</tr></thead>
<tbody>
<tr>
<td>MotionEvent.ACTION_DOWN</td>
<td>按下View（所有事件的开始）</td>
</tr>
<tr>
<td>MotionEvent.ACTION_UP</td>
<td>抬起View（与DOWN对应）</td>
</tr>
<tr>
<td>MotionEvent.ACTION_MOVE</td>
<td>滑动View</td>
</tr>
<tr>
<td>MotionEvent.ACTION_CANCEL</td>
<td>结束事件（非人为原因）</td>
</tr>
</tbody>
</table>
<h2>
<a id="13__16"></a>1.3 什么是事件序列？</h2> 
<p><img src="https://images2.imgbox.com/e1/bd/rUh2cp0E_o.png" alt="在这里插入图片描述"></p> 
<p>从手指接触屏幕 至 手指离开屏幕，这个过程产生的一系列事件是同一个事件序列。<br> <strong>一般情况下，事件序列以DOWN事件开始、UP事件结束，中间有无数的MOVE事件.</strong></p> 
<h2>
<a id="14__24"></a>1.4 事件分发过程中共同协作的方法。</h2> 
<p>答：<code>dispatchTouchEvent()</code>、<code>onInterceptTouchEvent()</code>和<code>onTouchEvent()</code>。</p> 
<p><code>dispatch</code>：派遣、发出、传递。<br> <code>intercept</code>：拦截</p> 
<table>
<thead><tr>
<th>方法</th>
<th>作用</th>
<th>调用时刻</th>
</tr></thead>
<tbody>
<tr>
<td>dispatchTouchEvent()</td>
<td>分发（传递）点击事件</td>
<td>点击事件（Touch）传递给当前View时，dispatchTouchEvent()就会被调用。</td>
</tr>
<tr>
<td>onTouchEvent()</td>
<td>处理点击事件</td>
<td>在dispatchTouchEvent()内部调用</td>
</tr>
<tr>
<td>onInterceptTouchEvent()</td>
<td>判断是否拦截了某个事件（只存在于ViewGroup之中）</td>
<td>在ViewGroup的dispatchTouchEvent()内部调用</td>
</tr>
</tbody>
</table>
<h2>
<a id="15__37"></a>1.5 事件在哪些对象之间传递？传递的顺序是什么？</h2> 
<p>答：当产生点击事件后会先由<code>Activity</code>来处理，在<code>Activity</code> ， <code>ViewGroup</code> ， <code>View</code>之间传递。</p> 
<h2>
<a id="16__41"></a>1.6 事件的传递过程</h2> 
<h3>
<a id="1_43"></a>1.由上而下的传递过程</h3> 
<p>当一个<code>View</code>或<code>ViewGroup</code>的<code>onInterceptTouchEvent()</code>返回<code>true</code>，表示它要拦截这个<code>MotionEvent</code>，会调用它的<code>dispatchTouchEvent()</code>，返回false则将<code>MotionEvent</code>传递给子元素的<code>dispatchTouchEvent</code>。最后传给最底层<code>View</code>，无法再向下传递，就由底层<code>View</code>的<code>onTouchEvent()</code>处理。</p> 
<p><img src="https://images2.imgbox.com/fa/42/1zcEP94O_o.png" alt=""></p> 
<h3>
<a id="2_50"></a>2.由下而上的传递过程</h3> 
<p>如果<code>onTouchEvent()</code>返回<code>true</code>表示该View处理了，处理后逐层向<code>dispatchTouchEvent()</code>返回直至结束，返回<code>false</code>则代表没处理，继续向上层<code>View</code>的<code>onTouchEvent()</code>传递，最后由Activity的<code>onTouchEvent()</code>处理，不论处理结果是什么都结束事件分发。</p> 
<h2>
<a id="17_ViewGroupdispatchTouchEventonTouchEvent_54"></a>1.7 ViewGroup怎么通过dispatchTouchEvent()把事件传递给自己的onTouchEvent？</h2> 
<p>答：<code>dispatchTouchEvent()</code>return true或false都不行，只能在其内部通过<code>Interceptor()</code>将事件拦截并调用自己的<code>onTouchEvent()</code>，因此<code>ViewGroup</code>的<code>dispatchTouchEvent()</code>super默认实现就是去调用此<code>ViewGroup</code>的<code>onInterceptTouchEvent()</code>进行拦截。</p> 
<h2>
<a id="18_ViewdispatchTouchEvent_58"></a>1.8 View有自己的dispatchTouchEvent()方法吗？</h2> 
<p>答：有，但View没有<code>onInterceptTouchEvent()</code>来判断是将事件传给子<code>View</code>还是拦截，因此<code>View</code>调用<code>super.dispatchTouchEvent()</code> 时默认把事件传给自己的<code>onTouchEvent()</code>处理（拦截）。<code>dispatchTouchEvent()</code>中返回false就回溯父元素的<code>onTouchEvent()</code>由父元素处理。</p> 
<h2>
<a id="19_dispatchTouchEventonTouchEvent_62"></a>1.9 dispatchTouchEvent()中希望让自己的<code>onTouchEvent()</code>处理怎么操作？</h2> 
<p>答：默认处理<code>super.dispatchTouchEvent()</code>会调用自己的<code>onInterceptTouchEvent()</code>，在其中<code>return true</code>表示拦截就会把<code>MotionEvent</code>分发给自己的<code>onTouchEvent()</code>处理。</p> 
<h2>
<a id="110_dispatchTouchEventView_66"></a>1.10 dispatchTouchEvent()中希望传给子View怎么操作？</h2> 
<p>答：默认处理<code>super.dispatchTouchEvent()</code>会调用自己的<code>onInterceptTouchEvent()</code>，在其中<code>return false</code>（不拦截且不消费），就会将<code>MotionEvent</code>交给子类。</p> 
<h2>
<a id="111__70"></a>1.11 希望不做处理、终止向下传递、开始回溯，怎么操作？</h2> 
<p>答：在每一层View的<code>onTouchEvent()</code>中return false;</p> 
<h2>
<a id="112_onTouchonTouchEvent_74"></a>1.12 onTouch和onTouchEvent的区别是什么？</h2> 
<p>答：两个方法都是在<code>View.dispatchTouchEvent()</code>中调用，源码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mOnTouchListener <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mViewFlags <span class="token operator">&amp;</span> ENABLED_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> ENABLED <span class="token operator">&amp;&amp;</span>
            mOnTouchListener<span class="token punctuation">.</span><span class="token function">onTouch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>可以看到<code>onTouch()</code>优先于<code>onTouchEvent()</code>执行，如果onTouch方法中返回true将事件消费，onTouchEvent就不会执行。</p> 
<p><code>onTouch()</code>的执行需要<code>mOnTouchListener</code>不为空且当前点击的控件为<code>ENABLED</code>，对于<code>非ENABLED控件(不可点击控件)</code>，我们如果想要监听其touch事件应该<code>重写onTouchEvent()</code>，因为它的<code>onTouch()</code>永远不会得到执行！</p> 
<h2>
<a id="113__92"></a>1.13 事件分发传递规则</h2> 
<ol>
<li>一般情况下，一个事件序列只能被一个View拦截消耗，一旦拦截事件序列中所有事件会交给此View处理，不能由两个View同时处理，除非在<code>onTouchEvent()</code>将MotionEvent传递给其他View。</li>
<li>一个<code>View</code>的<code>onTouchEvent()</code>返回了false，那么同一事件序列都不会再交给此View处理，而是重新交给父元素的<code>onTouchEvent()</code>。</li>
<li>一旦某个View决定拦截，此View的<code>onInterceptTouchEvent()</code>不会再被调用,不会再次询问去询问它是否拦截。</li>
<li>当<code>dispatchTouchEvent()</code> 和 <code>onTouchEvent()</code> 都return true,事件传递就到达了终点（被消费），不会再继续传递。</li>
<li>当<code>dispatchTouchEvent()</code>事件分发时，只有前一个事件（如ACTION_DOWN）返回true，才会收到后一个事件（ACTION_MOVE和ACTION_UP）</li>
<li>若对象<code>(Activity、ViewGroup、View)</code>的<code>dispatchTouchEvent()</code>分发事件后消费了事件（返回true），那么收到ACTION_DOWN的函数也能收到ACTION_MOVE和ACTION_UP!</li>
<li>若对象<code>(Activity、ViewGroup、View)</code>的<code>onTouchEvent()</code>处理了事件（<code>返回true</code>），那么ACTION_MOVE、ACTION_UP的事件从上往下传到该<code>View</code>后就不再往下传递，而是直接传给自己的<code>onTouchEvent()</code>，结束本次事件传递过程!</li>
</ol> 
<h1>
<a id="_102"></a>二、事件分发源码分析</h1> 
<h2>
<a id="21_1Activity_104"></a>2.1 流程1：Activity的事件分发机制</h2> 
<p>Android的事件分发机制首先将<code>MotionEvent</code>传递给Activity的<code>dispatchTouchEvent()</code>进行事件分发。</p> 
<pre><code class="prism language-java">	
		<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/*if (ev.getAction() == MotionEvent.ACTION_DOWN) {
            onUserInteraction();
        }*/</span>
<span class="token comment">/***交给Activity附属的Window分发**  
如果getWindow().superDispatchTouchEvent(ev)为true 代表事件循环结束
Activity的dispatchTouchEvent就返回ture
*/</span>
<span class="token comment">//如果getWindow().superDispatchTouchEvent(ev)为false 意味着没处理，执行onTouchEvent()</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">superDispatchTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><code>Window</code>是一个<strong>抽象类</strong>，其<code>DispatchTouchEvent()</code>也是抽象方法，该类可以控制顶级View的外观和行为策略。该类唯一实现是<strong>PhoneWindow</strong>，其中有一个内部类<code>DecorView</code>是一个<code>ViewGroup</code>。<code>PhoneWindow</code>中处理点击事件：</p> 
<pre><code class="prism language-java">	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">superDispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// mDecor 是 顶级View（DecorView）的实例对象</span>
      <span class="token keyword">return</span> mDecor<span class="token punctuation">.</span><span class="token function">superDispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>顶级<code>View</code>，即在<code>Activity</code>中通过<code>setContentView()</code>设置的<code>View</code>，也叫根<code>View</code>,此处调用的是ViewGroup的<code>dispatchTouchEvent()</code>方法，从而实现了事件由Activity→ViewGroup的<code>dispatchTouchEvent()</code>的过程。</p> 
<p>流程图和方法图非常详尽：</p> 
<p><img src="https://images2.imgbox.com/68/8a/rXTESBrx_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/e2/d8/8HRim0Si_o.png" alt="在这里插入图片描述"></p> 
<p><code>ViewGroup</code>的<code>dispatchTouchEvent()</code>什么时候返回<code>true</code> / <code>false</code>？接下来<code>ViewGroup</code>的事件分发流程会进行说明。</p> 
<h2>
<a id="22_2ViewGroup_147"></a>2.2 流程2：ViewGroup的事件分发机制</h2> 
<p>由Activity的事件分发机制可知，<code>Activity.dispatchTouchEvent()</code>中<code>getWindow().superDispatchTouchEvent(ev)</code>中<code>super.dispatchTouchEvent(MotionEvent event)</code>实现了<code>Activity-&gt;ViewGroup</code>的传递，<code>ViewGroup</code>的事件分发机制也由<code>dispatchTouchEvent()</code>进行。</p> 
<pre><code class="prism language-java">		<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">/*调用**ViewGroup的onInterceptTouchEvent()**进行判断，
返回true表示ACTION_DOWN被VIEWGROUP拦截，返回false则表示事件继续传递给子View*/</span>
            
						<span class="token keyword">final</span> <span class="token keyword">boolean</span> intercepted<span class="token punctuation">;</span><span class="token comment">//intercepted变量表示**是否**拦截该次事件</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN
                    <span class="token operator">||</span> mFirstTouchTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">final</span> <span class="token keyword">boolean</span> disallowIntercept <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> FLAG_DISALLOW_INTERCEPT<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>disallowIntercept<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    intercepted <span class="token operator">=</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token function">onInterceptTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">;</span>
                    ev<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// restore action in case it was changed</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    intercepted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// There are no touch targets and this action is not an initial down</span>
                <span class="token comment">// so this view group continues to intercept touches.</span>
                intercepted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canceled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>intercepted<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 没取消也不拦截，即是个有效的touch事件</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN <span class="token comment">// 第一个手指down</span>
                        <span class="token operator">||</span> <span class="token punctuation">(</span>split <span class="token operator">&amp;&amp;</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_POINTER_DOWN<span class="token punctuation">)</span> <span class="token comment">// 接下来的手指down</span>
                        <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_HOVER_MOVE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">final</span> <span class="token keyword">int</span> actionIndex <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getActionIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// always 0 for down</span>
                    <span class="token keyword">final</span> <span class="token keyword">int</span> idBitsToAssign <span class="token operator">=</span> split <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> ev<span class="token punctuation">.</span><span class="token function">getPointerId</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span>
                            <span class="token operator">:</span> <span class="token class-name">TouchTarget</span><span class="token punctuation">.</span>ALL_POINTER_IDS<span class="token punctuation">;</span>

                    <span class="token comment">// Clean up earlier touch targets for this pointer id in case they</span>
                    <span class="token comment">// have become out of sync.</span>
                    <span class="token function">removePointersFromTouchTargets</span><span class="token punctuation">(</span>idBitsToAssign<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">final</span> <span class="token keyword">int</span> childrenCount <span class="token operator">=</span> mChildrenCount<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> childrenCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 基本都成立</span>
                        <span class="token keyword">final</span> <span class="token keyword">float</span> x <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">final</span> <span class="token keyword">float</span> y <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// Find a child that can receive the event.</span>
                        <span class="token comment">// Scan children from front to back.</span>
                        <span class="token keyword">final</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> children <span class="token operator">=</span> mChildren<span class="token punctuation">;</span>

                        <span class="token keyword">final</span> <span class="token keyword">boolean</span> customOrder <span class="token operator">=</span> <span class="token function">isChildrenDrawingOrderEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 从最后一个向第一个遍历ViewGroup下所有子View</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> childrenCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">final</span> <span class="token keyword">int</span> childIndex <span class="token operator">=</span> customOrder <span class="token operator">?</span>
                                    <span class="token function">getChildDrawingOrder</span><span class="token punctuation">(</span>childrenCount<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">:</span> i<span class="token punctuation">;</span>
                            <span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> children<span class="token punctuation">[</span>childIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canViewReceivePointerEvents</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
                                    <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isTransformedTouchPointInView</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> child<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 不满足这2个条件直接跳过，看下一个child</span>
                            <span class="token punctuation">}</span>

                            <span class="token comment">// child view能receive touch事件而且touch坐标也在view边界内</span>

                            newTouchTarget <span class="token operator">=</span> <span class="token function">getTouchTarget</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 查找child对应的TouchTarget</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 比如在同一个child上按下了多跟手指</span>
                                <span class="token comment">// Child is already receiving touch within its bounds.</span>
                                <span class="token comment">// Give it the new pointer in addition to the ones it is handling.</span>

                                <span class="token comment">//子View已经在自己的范围内得到了触摸。</span>
                                <span class="token comment">//除了它正在处理的那个，给它一个新的指针。</span>
                                newTouchTarget<span class="token punctuation">.</span>pointerIdBits <span class="token operator">|=</span> idBitsToAssign<span class="token punctuation">;</span>
                                <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// newTouchTarget已经有了，跳出for循环</span>
                            <span class="token punctuation">}</span>

                            <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// 将此事件交给child处理</span>
                            <span class="token comment">// 有这种情况，一个手指按在了child1上，另一个手指按在了child2上，以此类推</span>
                            <span class="token comment">// 这样TouchTarget的链就形成了</span>
                            <span class="token comment">// 进行子View的分发</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> child<span class="token punctuation">,</span> idBitsToAssign<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token comment">// Child wants to receive touch within its bounds.</span>
                                mLastTouchDownTime <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getDownTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                mLastTouchDownIndex <span class="token operator">=</span> childIndex<span class="token punctuation">;</span>
                                mLastTouchDownX <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                mLastTouchDownY <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token comment">// 如果处理掉了的话，将此child添加到touch链的头部</span>
                                <span class="token comment">// 注意这个方法内部会更新 mFirstTouchTarget</span>
                                newTouchTarget <span class="token operator">=</span> <span class="token function">addTouchTarget</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> idBitsToAssign<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// down或pointer_down事件已经被处理了</span>
                                <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// 可以退出for循环了。</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>

</code></pre> 
<p>ViewGroup会用**onInterceptTouchEvent()**进行判断是否对该事件进行拦截，默认不拦截，如果拦截就用的<code>onInterceptTouchEvent()</code>会向<code>View</code>的<code>dispatchTouchEvent()</code>分发。</p> 
<p>ViewGroup的<strong>onInterceptTouchEvent()源码</strong></p> 
<pre><code class="prism language-java">		<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onInterceptTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span><span class="token function">isFromSource</span><span class="token punctuation">(</span><span class="token class-name">InputDevice</span><span class="token punctuation">.</span>SOURCE_MOUSE<span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN
                <span class="token operator">&amp;&amp;</span> ev<span class="token punctuation">.</span><span class="token function">isButtonPressed</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>BUTTON_PRIMARY<span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token function">isOnScrollbarThumb</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ev<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>ViewGroup的<strong>dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)源码</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">,</span> <span class="token keyword">boolean</span> cancel<span class="token punctuation">,</span>
            <span class="token class-name">View</span> child<span class="token punctuation">,</span> <span class="token keyword">int</span> desiredPointerIdBits<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        
				<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
				<span class="token keyword">final</span> <span class="token keyword">boolean</span> handled<span class="token punctuation">;</span>

       <span class="token comment">//仅分析核心代码</span>
        <span class="token comment">// Perform any necessary transformations and dispatch.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            handled <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>transformedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">final</span> <span class="token keyword">float</span> offsetX <span class="token operator">=</span> mScrollX <span class="token operator">-</span> child<span class="token punctuation">.</span>mLeft<span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token keyword">float</span> offsetY <span class="token operator">=</span> mScrollY <span class="token operator">-</span> child<span class="token punctuation">.</span>mTop<span class="token punctuation">;</span>
            transformedEvent<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span>offsetX<span class="token punctuation">,</span> offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> child<span class="token punctuation">.</span><span class="token function">hasIdentityMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                transformedEvent<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getInverseMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

	<span class="token comment">//分发给子View的dispatchTouchEvent</span>
            handled <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>transformedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Done.</span>
        transformedEvent<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>遍历<code>ViewGroup</code>的子<code>View</code>或子<code>ViewGroup</code>，判断此次点击事件触摸区域是否属于它的子<code>View</code>或子<code>ViewGroup</code>的区域，如果属于子View区域就调用子View的<code>dispatchTouchEvent()</code>，即传递给子View处理，如果属于子ViewGroup，继续遍历子ViewGroup子视图，直到找到处理事件的View。如果遍历到最后还找不到就回调<strong>上一层</strong>的<code>onTouchEvent()</code>直到Activity。</p> 
<p>流程图：</p> 
<p><img src="https://images2.imgbox.com/f5/2b/nJ5KI4BO_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="23_3View_292"></a>2.3 流程3：View的事件分发机制</h2> 
<p>View的事件分发同样由<code>dispatchTouchEvent()</code>开始</p> 
<pre><code class="prism language-java">		<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mInputEventConsistencyVerifier <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mInputEventConsistencyVerifier<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
				<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 一般都成立</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mViewFlags <span class="token operator">&amp;</span> ENABLED_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> ENABLED <span class="token operator">&amp;&amp;</span> <span class="token function">handleScrollBarDragging</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//noinspection SimplifiableIfStatement</span>
            <span class="token class-name">ListenerInfo</span> li <span class="token operator">=</span> mListenerInfo<span class="token punctuation">;</span>
<span class="token comment">//先判断是否设置OnTouchListener,</span>
<span class="token comment">//如果OnTouchListener中onTouch()返回true，onTouchEvent()就不会被调用，</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>li <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> li<span class="token punctuation">.</span>mOnTouchListener <span class="token operator">!=</span> <span class="token keyword">null</span>
                    <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mViewFlags <span class="token operator">&amp;</span> ENABLED_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> ENABLED
                    <span class="token operator">&amp;&amp;</span> li<span class="token punctuation">.</span>mOnTouchListener<span class="token punctuation">.</span><span class="token function">onTouch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
<span class="token comment">//从这里看出，如果既设置了onTouchListener又设置了onClickListener，</span>
<span class="token comment">//如果OnTouchListener中onTouch()返回true，onTouchEvent()不会被调用，onClickListener也不会被触发</span>
<span class="token comment">//onTouch中每次收到Touch事件，但onClickListener只在ACTION_UP来时触发</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result <span class="token operator">&amp;&amp;</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result <span class="token operator">&amp;&amp;</span> mInputEventConsistencyVerifier <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mInputEventConsistencyVerifier<span class="token punctuation">.</span><span class="token function">onUnhandledEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Clean up after nested scrolls if this is the end of a gesture;</span>
        <span class="token comment">// also cancel it if we tried an ACTION_DOWN but we didn't want the rest</span>
        <span class="token comment">// of the gesture.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP <span class="token operator">||</span>
                actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_CANCEL <span class="token operator">||</span>
                <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">stopNestedScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>View的<code>onTouchEvent()</code></p> 
<pre><code class="prism language-java">		<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// View对touch事件的默认处理逻辑</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> ENABLED_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> DISABLED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// DISABLED的状态下</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mPrivateFlags <span class="token operator">&amp;</span> PFLAG_PRESSED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果之前是Pressed状态则复原</span>
            <span class="token punctuation">}</span>
            mPrivateFlags3 <span class="token operator">&amp;=</span> <span class="token operator">~</span>PFLAG3_FINGER_DOWN<span class="token punctuation">;</span>
            <span class="token comment">// A disabled view that is clickable still consumes the touch</span>
            <span class="token comment">// events, it just doesn't respond to them.</span>
            <span class="token keyword">return</span> clickable<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mTouchDelegate <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">//如果有mTouchDelegate，优先交给它处理</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mTouchDelegate<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">// 处理了返回true，否则向下进行</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>clickable <span class="token operator">||</span> <span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> TOOLTIP<span class="token punctuation">)</span> <span class="token operator">==</span> TOOLTIP<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP<span class="token operator">:</span>
                    mPrivateFlags3 <span class="token operator">&amp;=</span> <span class="token operator">~</span>PFLAG3_FINGER_DOWN<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> TOOLTIP<span class="token punctuation">)</span> <span class="token operator">==</span> TOOLTIP<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">handleTooltipUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>clickable<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">removeTapCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">removeLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mInContextButtonPress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        mHasPerformedLongPress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        mIgnoreNextUpEvent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
										<span class="token comment">// 如果外围有可以滚动的parent的话，当按下时会设置这个标志位</span>
                    <span class="token keyword">boolean</span> prepressed <span class="token operator">=</span> <span class="token punctuation">(</span>mPrivateFlags <span class="token operator">&amp;</span> PFLAG_PREPRESSED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
										<span class="token comment">// 按下了或者预按下了</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mPrivateFlags <span class="token operator">&amp;</span> PFLAG_PRESSED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> prepressed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// take focus if we don't have it already and we should in</span>
                        <span class="token comment">// touch mode.</span>
                        <span class="token keyword">boolean</span> focusTaken <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFocusable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFocusableInTouchMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isFocused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            focusTaken <span class="token operator">=</span> <span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>prepressed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// The button is being released before we actually</span>
                            <span class="token comment">// showed it as pressed.  Make it show the pressed</span>
                            <span class="token comment">// state now (before scheduling the click) to ensure</span>
                            <span class="token comment">// the user sees it.</span>
                            <span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mHasPerformedLongPress <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mIgnoreNextUpEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// This is a tap, so remove the longpress check</span>
                            <span class="token function">removeLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">// Only perform take click actions if we were in the pressed state</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>focusTaken<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token comment">// Use a Runnable and post this rather than calling</span>
                                <span class="token comment">// performClick directly. This lets other visual state</span>
                                <span class="token comment">// of the view update before click actions start.</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>mPerformClick <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                    mPerformClick <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">post</span><span class="token punctuation">(</span>mPerformClick<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token function">performClickInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>mUnsetPressedState <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            mUnsetPressedState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnsetPressedState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>prepressed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">postDelayed</span><span class="token punctuation">(</span>mUnsetPressedState<span class="token punctuation">,</span>
                                    <span class="token class-name">ViewConfiguration</span><span class="token punctuation">.</span><span class="token function">getPressedStateDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">post</span><span class="token punctuation">(</span>mUnsetPressedState<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// If the post failed, unpress right now</span>
                            mUnsetPressedState<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token function">removeTapCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    mIgnoreNextUpEvent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">InputDevice</span><span class="token punctuation">.</span>SOURCE_TOUCHSCREEN<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        mPrivateFlags3 <span class="token operator">|=</span> PFLAG3_FINGER_DOWN<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    mHasPerformedLongPress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>clickable<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">checkForLongClick</span><span class="token punctuation">(</span>
                                <span class="token class-name">ViewConfiguration</span><span class="token punctuation">.</span><span class="token function">getLongPressTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                x<span class="token punctuation">,</span>
                                y<span class="token punctuation">,</span>
                                TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__LONG_PRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">performButtonActionOnTouchDown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// Walk up the hierarchy to determine if we're inside a scrolling container.</span>
                    <span class="token keyword">boolean</span> isInScrollingContainer <span class="token operator">=</span> <span class="token function">isInScrollingContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// For views inside a scrolling container, delay the pressed feedback for</span>
                    <span class="token comment">// a short period in case this is a scroll.</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>isInScrollingContainer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 如果是在可以滚动的container里面的话</span>
                        mPrivateFlags <span class="token operator">|=</span> PFLAG_PREPRESSED<span class="token punctuation">;</span><span class="token comment">// 设置PREPRESSED标志位</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPendingCheckForTap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            mPendingCheckForTap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheckForTap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        mPendingCheckForTap<span class="token punctuation">.</span>x <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        mPendingCheckForTap<span class="token punctuation">.</span>y <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">postDelayed</span><span class="token punctuation">(</span>mPendingCheckForTap<span class="token punctuation">,</span> <span class="token class-name">ViewConfiguration</span><span class="token punctuation">.</span><span class="token function">getTapTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// Not inside a scrolling container, so show the feedback right away</span>
                        <span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 否则直接显示pressed feedback</span>
                        <span class="token function">checkForLongClick</span><span class="token punctuation">(</span><span class="token comment">// 启动长按监测</span>
                                <span class="token class-name">ViewConfiguration</span><span class="token punctuation">.</span><span class="token function">getLongPressTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                x<span class="token punctuation">,</span>
                                y<span class="token punctuation">,</span>
                                TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__LONG_PRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_CANCEL<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>针对CANCEL事件，恢复各种状态，移除各种callback
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>clickable<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">removeTapCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">removeLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mInContextButtonPress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    mHasPerformedLongPress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    mIgnoreNextUpEvent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    mPrivateFlags3 <span class="token operator">&amp;=</span> <span class="token operator">~</span>PFLAG3_FINGER_DOWN<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_MOVE<span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>clickable<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">drawableHotspotChanged</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">final</span> <span class="token keyword">int</span> motionClassification <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getClassification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token keyword">boolean</span> ambiguousGesture <span class="token operator">=</span>
                            motionClassification <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>CLASSIFICATION_AMBIGUOUS_GESTURE<span class="token punctuation">;</span>
                    <span class="token keyword">int</span> touchSlop <span class="token operator">=</span> mTouchSlop<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>ambiguousGesture <span class="token operator">&amp;&amp;</span> <span class="token function">hasPendingLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">pointInView</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> touchSlop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 如果移动到view的边界之外，</span>
                            <span class="token comment">// The default action here is to cancel long press. But instead, we</span>
                            <span class="token comment">// just extend the timeout here, in case the classification</span>
                            <span class="token comment">// stays ambiguous.</span>
                            <span class="token function">removeLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">long</span> delay <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">ViewConfiguration</span><span class="token punctuation">.</span><span class="token function">getLongPressTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token operator">*</span> mAmbiguousGestureMultiplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// Subtract the time already spent</span>
                            delay <span class="token operator">-=</span> event<span class="token punctuation">.</span><span class="token function">getEventTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> event<span class="token punctuation">.</span><span class="token function">getDownTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">checkForLongClick</span><span class="token punctuation">(</span>
                                    delay<span class="token punctuation">,</span>
                                    x<span class="token punctuation">,</span>
                                    y<span class="token punctuation">,</span>
                                    TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__LONG_PRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        touchSlop <span class="token operator">*=</span> mAmbiguousGestureMultiplier<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// Be lenient about moving outside of buttons</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">pointInView</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> touchSlop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 如果移动到view的边界之外，</span>
                        <span class="token comment">// Outside button</span>
                        <span class="token comment">// Remove any future long press/tap checks</span>
                        <span class="token function">removeTapCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 则取消Tap callback，这样当你松手的时候onClick不会被触发</span>
                        <span class="token function">removeLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mPrivateFlags <span class="token operator">&amp;</span> PFLAG_PRESSED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 当已经是按下状态的话</span>
                            <span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 恢复按下状态</span>
                        <span class="token punctuation">}</span>
                        mPrivateFlags3 <span class="token operator">&amp;=</span> <span class="token operator">~</span>PFLAG3_FINGER_DOWN<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">final</span> <span class="token keyword">boolean</span> deepPress <span class="token operator">=</span>
                            motionClassification <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>CLASSIFICATION_DEEP_PRESS<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>deepPress <span class="token operator">&amp;&amp;</span> <span class="token function">hasPendingLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// process the long click action immediately</span>
                        <span class="token function">removeLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">checkForLongClick</span><span class="token punctuation">(</span>
                                <span class="token number">0</span> <span class="token comment">/* send immediately */</span><span class="token punctuation">,</span>
                                x<span class="token punctuation">,</span>
                                y<span class="token punctuation">,</span>
                                TOUCH_GESTURE_CLASSIFIED__CLASSIFICATION__DEEP_PRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">// 最后返回true，表示对touch事件被处理，被消费</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// 既不能单击也不能长按的View，返回false，表示不处理touch事件</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/df/otZrFZnY_o.png" alt="在这里插入图片描述"></p> 
<h3>
<a id="_552"></a>返回值分析：</h3> 
<p><img src="https://images2.imgbox.com/36/63/tTO14t2Q_o.png" alt="在这里插入图片描述"></p> 
<ol>
<li>如果<code>getWindow().superDispatchTouchEvent()</code>返回true，也就是<code>ViewGroup.dispatchTouchEvent()</code>返回true，则方法结束，Activity的<code>dispatchTouchEvent()</code>也返回true，代表点击事件顺利从Activity传递到ViewGroup，ViewGroup分发后事件在其中被消费，Activity的分发任务结束，如果<code>Activity的onTouchEvent()</code>返回false，则Activity的<code>dispatchTouchEvent()</code>返回false，则代表事件没有被消费。</li>
<li>如果getWindow().superDispatchTouchEvent()方法返回false，则执行<code>Activity</code>的<code>onTouchEvent()</code>方法，无论该方法返回<code>true</code>还是<code>false</code>，都表示此次事件分发都结束，ture表示点击事件在<code>Window</code>边界外（事件被<code>Activity</code>消费），<code>false</code>在<code>Window</code>边界内（事件不被处理，不算<code>Activity</code>消费）。</li>
</ol> 
<h1>
<a id="_560"></a>三、事件分发三个方法的流程图</h1> 
<h2>
<a id="31_dispatchTouchEvent_562"></a>3.1 dispatchTouchEvent()流程图</h2> 
<p><img src="https://images2.imgbox.com/ce/b3/XV5dVdD8_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/07/38/jKxHg2ix_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/af/a0/SIkKzJ6D_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="32_onInterceptTouchEvent_573"></a>3.2 onInterceptTouchEvent()流程图</h2> 
<p>需要注意：只有<code>ViewGroup</code>有这个方法，<code>Activity</code>和<code>View</code>都没有</p> 
<p><img src="https://images2.imgbox.com/a8/60/rUumv6MH_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="33_onTouchEvent_580"></a>3.3 onTouchEvent()流程图</h2> 
<p><img src="https://images2.imgbox.com/79/83/l2As8ROW_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/38/25/QyUtsJG3_o.png" alt="在这里插入图片描述"></p> 
<h1>
<a id="_588"></a>四、事件传递的几种情况</h1> 
<h2>
<a id="41__590"></a>4.1 默认情况</h2> 
<p>不对控件里的方法（<code>dispatchTouchEvent()</code>、<code>onTouchEvent()</code>、<code>onInterceptTouchEvent()</code>）进行重写。</p> 
<p>需要注意的是：<code>onTouchEvent()</code>如果对<code>DOWN</code>事件返回了false，那么将不会再接收处理事件列的其他事件。但<code>ViewGroup</code>的<code>onInterceptTouchEvent()</code>对<code>DOWN</code>事件返回了<code>false</code>后后续事件仍会传递到它的<code>onInterceptTouchEvent()</code></p> 
<p><img src="https://images2.imgbox.com/62/70/xG4KRlpS_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="42__598"></a>4.2 处理事件</h2> 
<p>如果<code>View V</code>希望处理点击事件，那么设置<code>View V</code>的<code>（Clickable）</code>或重写<code>onTouchEvent（）</code>返回<code>true</code></p> 
<p>事件传递情况</p> 
<ul>
<li>DOWN事件被传递给<code>V</code>的<code>onTouchEvent()</code>并返回true，表示V要处理该事件</li>
<li>V正在处理该事件，所以不会将<code>DOWN</code>传递给<code>ViewGroup</code>和<code>Activity</code>的<code>onTouchEvent()</code>
</li>
<li>事件列中其他事件也会传递给<code>V</code> 的<code>onTouchEvent()</code>
</li>
<li>如下图，也就是逐层向<code>dispatchTouchEvent()</code>返回直至结束。</li>
</ul> 
<p><img src="https://images2.imgbox.com/2f/6f/zthjBwT2_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="43_DOWN_612"></a>4.3 拦截DOWN事件</h2> 
<p>如果希望ViewGroup vg处理该点击事件，重写其onInterceptTouchEvent()返回true，onTouchEvent()返回true。</p> 
<ul>
<li>
<code>onInterceptTouchEvent()</code>返回true表示事件不再向下传递</li>
<li>自身<code>onTouchEvent()</code>处理事件，不会传递给Activity的<code>onTouchEvent()</code>
</li>
<li>事件列内其他事件都传递给vg的<code>onTouchEvnet()</code>,且不会再传递给<code>vg</code>的<code>onInterceptTouchEvent()</code>，因为一旦<code>onInterceptTouchEvent()</code>返回<code>true</code>就再也不会被调用。</li>
<li>逐层向<code>dispatchTouchEvent()</code>返回，结束事件分发。</li>
</ul> 
<p><img src="https://images2.imgbox.com/2e/94/ErTfBrXh_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="44__624"></a>4.4 拦截事件列中间事件</h2> 
<p>如果<code>ViewGroup vg</code>拦截了一个<code>MOVE</code>，那么该事件会变为<code>CANCEL</code>并传递给在处理该事件的<code>子</code>View，且不传递给<code>vg</code>的<code>onTouchEvent()</code>，<code>vg</code>的<code>onTouchEvent()</code>会接收新到来的<code>MOVE</code>事件。</p> 
<p>例如vg的子View v处理DOWN事件(v的<code>onTouchEvent()</code>返回<code>true</code>)，但<code>vg</code>拦截了MOVE事件(<code>vg</code>的<code>onInterceptTouchEvent()</code>返回true拦截了MOVE)，这个MOVE会变成CANCEL传递给v的<code>onTouchEvent()</code>，后续新来的MOVE会传递给vg的<code>onTouchEvent()</code>，而不是vg的<code>onInterceptTouchEvent()</code>。也就是后续事件直接由vg的<code>onTouchEvent()</code>处理。</p> 
<p><img src="https://images2.imgbox.com/6b/32/7CtMszXz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a5/ce/MqrFMTja_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9f/f8/OkPeGRQu_o.png" alt="在这里插入图片描述"></p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>世界500强是如何解决千亿流量留存问题的，《Ceph分布式存储架构》-使用CentOS 7部署 Ceph分布式存储架构-为他们解决什么问题。 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">世界500强是如何解决千亿流量留存问题的，《Ceph分布式存储架构》-使用CentOS 7部署 Ceph分布式存储架构-为他们解决什么问题。</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-dracula">
                    
                        
                    
                    <p></p>
<div class="toc">
 <h3>文章目录</h3>
 <ul>
<li><a href="#Ceph_7">一、Ceph概述</a></li>
<li>
<ul><li>
<ul>
<li><a href="#11__Ceph_9">1.1 Ceph介绍</a></li>
<li><a href="#12__Ceph_60">1.2 Ceph各组件介绍</a></li>
</ul>
  </li></ul>
  </li>
<li><a href="#ceph_100">二、ceph集群部署实验</a></li>
<li>
<ul><li>
<ul>
<li><a href="#21__Ceph_209">2.1 配置Ceph安装源</a></li>
<li><a href="#22__xuegod63cephdeploy_265">2.2 在xuegod63上安装ceph-deploy管理工具</a></li>
<li><a href="#23__ceph_313">2.3 离线安装ceph</a></li>
<li><a href="#24__ceph_monitor_321">2.4 安装ceph monitor</a></li>
<li><a href="#25__osd_347">2.5 部署osd服务</a></li>
<li><a href="#26__ceph_359">2.6 创建ceph文件系统</a></li>
<li><a href="#27__mgr_416">2.7 部署mgr监控</a></li>
</ul>
  </li></ul>
  </li>
<li><a href="#Ceph_428">三、多种Ceph挂载方式</a></li>
<li>
<ul><li>
<ul>
<li><a href="#31__Ceph_430">3.1 内核驱动挂载Ceph文件系统</a></li>
<li><a href="#32__cephfuseCeph_468">3.2 使用ceph-fuse命令挂载Ceph文件系统</a></li>
</ul>
  </li></ul>
  </li>
<li><a href="#Cephdashboard_Web_544">四、Ceph配置dashboard Web监控界面</a></li>
</ul>
</div>
<p></p> 
<hr size='1"'> 
<h1>
<a id="Ceph_7"></a>一、Ceph概述</h1> 
<p><img src="https://images2.imgbox.com/ed/f1/u9dFV0ed_o.png" alt="在这里插入图片描述"></p> 
<h3>
<a id="11__Ceph_9"></a>1.1 Ceph介绍</h3> 
<p>Ceph是一个开源的分布式存储系统，设计初衷是提供较好的性能、可靠性和可扩展性。它还是一个可靠、自动重均衡、自动恢复的分布式存储系统。主要优点是分布式存储，在存储每一个数据时，都会通过计算得出该数据存储的位置，尽量将数据分布均衡，不存在传统的单点故障的问题，可以水平扩展。</p> 
<p>ceph官方文档 <a href="http://docs.ceph.org.cn/">http://docs.ceph.org.cn/</a><br> ceph中文开源社区 <a href="http://ceph.org.cn/">http://ceph.org.cn/</a></p> 
<p>数据大小和对应的存储介绍关系：</p> 
<table>
<thead><tr>
<th>大小</th>
<th>存储介质</th>
</tr></thead>
<tbody>
<tr>
<td>2T</td>
<td>一块硬盘</td>
</tr>
<tr>
<td>10T</td>
<td>一块硬盘</td>
</tr>
<tr>
<td>50T</td>
<td>raid0，1，5 / 存储服务器</td>
</tr>
</tbody>
</table>
<p>假如B站有20000T数据<br> 20000T 一台服务器不行。 一台存储服务器200T*100台服务器。 使用的技术：ceph 分布</p> 
<p>Ceph是一个开源的分布式文件系统。因为它还支持块存储、对象存储，所以很自然的被用做云计算框架openstack或cloudstack整个存储后端。当然也可以单独作为存储，例如部署一套集群作为对象存储、SAN存储、NAS存储等。</p> 
<p><img src="https://images2.imgbox.com/f6/02/V3bcGZy8_o.png" alt="在这里插入图片描述"><br> RADOS自身是一个完整的分布式对象存储系统，它具有可靠、智能、分布式等特性，Ceph的高可靠、高可拓展、高性能、高自动化都是由这一层来提供的，用户数据的存储最终也都是通过这一层来进行存储的，RADOS可以说就是Ceph的核心组件。</p> 
<p>RADOS系统主要由两部分组成，分别是OSD和Monitor。</p> 
<p>基于RADOS层的上一层是LIBRADOS，LIBRADOS是一个库，它允许应用程序通过访问该库来与RADOS系统进行交互，支持多种编程语言，比如C、C++、Python等。</p> 
<p><strong>基于LIBRADOS层开发的又可以看到有三层，分别是RADOSGW、RBD和CEPH FS。3个功能如下：</strong></p> 
<p>1、RADOSGW：RADOSGW是一套基于当前流行的RESTFUL协议的网关，并且兼容S3和Swift。<br> 2、RBD：RBD通过Linux内核客户端和QEMU/KVM驱动来提供一个分布式的块设备。<br> 3、CEPH FS：CEPH FS通过Linux内核客户端和FUSE来提供一个兼容POSIX的文件系统，就像NFS一样，共享文件。</p> 
<p><strong>ceph支持</strong></p> 
<p>1、对象存储：即radosgw,兼容Swift和S3接口。通过rest api上传、下载文件。<br> 2、块存储：即rbd。有kernel rbd和librbd两种使用方式。支持快照、克隆。相当于一块硬盘挂到本地，用法和用途和硬盘一样。<br> 3、文件系统：posix接口。可以将ceph集群看做一个共享文件系统挂载到本地。</p> 
<p><strong>Ceph相比其它分布式存储有哪些优点？</strong></p> 
<p>1、统一存储<br> 虽然ceph底层是一个分布式文件系统，但由于在上层开发了支持对象和块的接口。所以在开源存储软件中，能够一统江湖。</p> 
<p>2、高扩展性<br> 扩容方便、容量大。能够管理上千台服务器、EB级的容量。</p> 
<p>3、可靠性强<br> 支持多份强一致性副本。副本能够垮主机、机架、机房、数据中心存放。所以安全可靠。存储节点可以自动管理、自动修复。无单点故障，容错性强。</p> 
<p>4、高性能<br> 因为是多个副本，因此在读写操作时候能够做到高度并行化。理论上，节点越多，整个集群的IOPS和吞吐量越高。另外一点ceph客户端读写数据直接与存储设备(osd) 交互。</p> 
<h3>
<a id="12__Ceph_60"></a>1.2 Ceph各组件介绍</h3> 
<p><img src="https://images2.imgbox.com/8c/fc/UlYBiS8l_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2a/55/WcVodDVZ_o.png" alt="在这里插入图片描述"><br> Ceph的核心组件包括Client客户端、MON监控服务、MDS元数据服务、OSD存储服务，各组件功能如下：</p> 
<p><strong>1</strong>、Client客户端：负责存储协议的接入，节点负载均衡。</p> 
<p><strong>2</strong>、MON（Monitor）监控服务：监控整个集群Cluster map的状态，维护集群的cluster MAP二进制表，保证集群数据的一致性，维护集群状态的映射，包括监视器映射，管理器映射，OSD映射，MDS映射和CRUSH映射。这些映射是Ceph守护程序相互协调所需的关键群集状态。监视器还负责管理守护程序和客户端之间的身份验证。通常至少需要三个监视器才能实现冗余和高可用性。</p> 
<p><mark>注：元数据：保存了子目录和子文件的名称 及inode编号的数据，通过元数据，可以找到对应的真实的数据，及真实数据所在的服务器。有点像字典前面的索引或yum源的缓存</mark></p> 
<p><strong>3</strong>、MDS元数据服务（可选）：<strong>是元数据的内存缓存，为了加快元数据的访问</strong>。保存了文件系统的元数据(对象里保存了子目录和子文件的名称和inode编号) ，还保存cephfs日志journal，日志是用来恢复mds里的元数据缓存 ，重启mds的时候会通过replay的方式从osd上加载之前缓存的元数据。</p> 
<p>在ceph中，<strong>元数据是存储在osd节点中的</strong>，mds类似于元数据的内存缓存服务器，加快访问速度。</p> 
<p><strong>4</strong>、OSD（对象存储守护程序）：主要功能是存储数据、复制数据、平衡数据、恢复数据，以及与通过检查其他Ceph OSD守护程序的心跳来向Ceph监视器和管理器提供一些监视信息。通常至少需要3个Ceph OSD才能实现冗余和高可用性。</p> 
<p>Ceph要求必须是奇数个Monitor监控节点，一般建议至少是3个（如果是自己私下测试玩玩的话，可以是1个，但是生产环境绝不建议1个）用于维护和监控整个集群的状态，每个Monitor都有一个Cluster Map，只要有这个Map，就能够清楚知道每个对象存储在什么位置了。<strong>客户端会先tcp连接到Monitor，从中获取Cluster Map，并在客户端进行计算，当知道对象的位置后</strong>，再直接与OSD通信（去中心化的思想）。OSD节点平常会向Monitor节点发送简单心跳，只有当添加、删除或者出现异常状况时，才会自动上报信息给Monitor。</p> 
<p>MDS是可选的，只有需要使用Ceph FS的时候才需要配置MDS节点。在Ceph中，元数据也是存放在OSD中的，MDS只相当于元数据的缓存服务器。</p> 
<p>在Ceph中，如果要写数据，只能向主OSD写，然后再由主OSD向从OSD同步地写，只有当从OSD返回结果给主OSD后，主OSD才会向客户端报告写入完成的消息。如果要读数据，不会使用读写分离，而是也需要先向主OSD发请求，以保证数据的强一致性。</p> 
<p><img src="https://images2.imgbox.com/26/30/BE3MEPvh_o.png" alt="在这里插入图片描述"><br> <strong>专业术语缩写总结：</strong></p> 
<p>1、OSD全称Object Storage Device，也就是负责响应客户端请求返回具体数据的进程。一个Ceph集群一般都有很多个OSD。</p> 
<p>2、MDS全称Ceph Metadata Server，是CephFS服务依赖的元数据服务。</p> 
<p>3、PG全称Placement Grouops，是一个逻辑的概念，一个PG包含多个OSD。引入PG这一层其实是为了更好的分配数据和定位数据。</p> 
<p>4、RADOS全称Reliable Autonomic Distributed Object Store，是Ceph集群的精华，用户实现数据分配、Failover等集群操作。</p> 
<p>5、RBD全称RADOS block device，是Ceph对外提供的块设备服务。</p> 
<p>6、RGW全称RADOS gateway，是Ceph对外提供的对象存储服务，接口与S3和Swift兼容。</p> 
<p>7、CephFS全称Ceph File System，是Ceph对外提供的文件系统服务。</p> 
<h1>
<a id="ceph_100"></a>二、ceph集群部署实验</h1> 
<p>主机准备 （禁用selinux, 关闭防火墙）</p> 
<pre><code class="prism language-c">xuegod63 	<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span>      osd<span class="token punctuation">,</span>mds<span class="token punctuation">,</span>mon<span class="token punctuation">,</span>admin部署节点 
xuegod62 	<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.62</span>      osd<span class="token punctuation">,</span>mds<span class="token punctuation">,</span>mon
xuegod64 	<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.64</span>      osd<span class="token punctuation">,</span>mds<span class="token punctuation">,</span>mon
xuegod64 	<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.64</span>		client挂载节点，可以单独一台服务器
</code></pre> 
<p><mark>注：1、admin角色代表ceph部署管理节点，其他节点通过ceph部署结点进行安装。<br> 2、xuegod62、xuegod63、xuegod64 各添加一块硬盘，每个磁盘20G。搭建ceph时会使用新加的磁盘。</mark></p> 
<p><img src="https://images2.imgbox.com/3c/43/uwHpHWlD_o.png" alt="在这里插入图片描述"><br> <strong>编辑hosts文件（所有节点需要操作）：</strong></p> 
<p>(规范系统主机名添加hosts文件实现集群主机名与主机名之间相互能够解析（host 文件添加主机名不要使用fqdn方式）可用hostnamectl set-hostname name设置</p> 
<p>分别打开各节点的/etc/hosts文件，加入这四个节点ip与名称的对应关系</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># vim <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span>    xuegod63		xuegod63<span class="token punctuation">.</span>cn
<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.62</span>    xuegod62		xuegod62<span class="token punctuation">.</span>cn
<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.64</span>    xuegod64		xuegod64<span class="token punctuation">.</span>cn
</code></pre> 
<p><mark>注：/etc/hosts中必须有xueogd63这种短域名，因为后期部署ceph时，ceph安装程序默认只使用xueogd63域名，不使用xueogd63.cn</mark></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># scp <span class="token operator">/</span>etc<span class="token operator">/</span>hosts root@xuegod62<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># scp <span class="token operator">/</span>etc<span class="token operator">/</span>hosts root@xuegod64<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>

SSH免密码登录（所有节点需要操作）
在管理节点使用ssh<span class="token operator">-</span>keygen 生成ssh keys 发布到各节点
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>keygen  	#所有的输入选项都直接回车生成。

<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id xuegod63
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id xuegod62
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># ssh<span class="token operator">-</span>copy<span class="token operator">-</span>id xuegod64
</code></pre> 
<p>配置好网络源</p> 
<p>3台主机上，都更新Centos内核，Ceph的iscsi网关组件最低需要4.16版本的linux内核。 最好离线安装</p> 
<p><strong>导入Public Key</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># rpm <span class="token operator">--</span>import https<span class="token operator">:</span><span class="token comment">//www.elrepo.org/RPM-GPG-KEY-elrepo.org</span>
<span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># rpm <span class="token operator">--</span>import https<span class="token operator">:</span><span class="token comment">//www.elrepo.org/RPM-GPG-KEY-elrepo.org</span>
<span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># rpm <span class="token operator">--</span>import https<span class="token operator">:</span><span class="token comment">//www.elrepo.org/RPM-GPG-KEY-elrepo.org</span>
</code></pre> 
<p><strong>安装elrepo源，通过elrepo源安装新内核</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># yum install https<span class="token operator">:</span><span class="token comment">//www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm -y</span>
<span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># yum install https<span class="token operator">:</span><span class="token comment">//www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm -y</span>
<span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># yum install https<span class="token operator">:</span><span class="token comment">//www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm -y</span>
</code></pre> 
<p><strong>安装新版本内核（ml主线版本，lt长期支持版本）</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># yum <span class="token operator">--</span>enablerepo<span class="token operator">=</span>elrepo<span class="token operator">-</span>kernel install  kernel<span class="token operator">-</span>lt<span class="token operator">-</span>devel kernel<span class="token operator">-</span>lt  <span class="token operator">-</span>y
时间可能会比较长（<span class="token number">3</span>分钟左右）
<span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># yum <span class="token operator">--</span>enablerepo<span class="token operator">=</span>elrepo<span class="token operator">-</span>kernel install  kernel<span class="token operator">-</span>lt<span class="token operator">-</span>devel kernel<span class="token operator">-</span>lt  <span class="token operator">-</span>y
<span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># yum <span class="token operator">--</span>enablerepo<span class="token operator">=</span>elrepo<span class="token operator">-</span>kernel install  kernel<span class="token operator">-</span>lt<span class="token operator">-</span>devel kernel<span class="token operator">-</span>lt  <span class="token operator">-</span>y
查看安装的内核版本：
<span class="token punctuation">[</span>root@xuegod63 yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token punctuation">]</span># rpm <span class="token operator">-</span>qa <span class="token operator">|</span> grep kernel<span class="token operator">-</span>lt
kernel<span class="token operator">-</span>lt<span class="token operator">-</span><span class="token number">5.4</span><span class="token number">.127</span><span class="token operator">-</span><span class="token number">1.</span>el7<span class="token punctuation">.</span>elrepo<span class="token punctuation">.</span>x86_64
kernel<span class="token operator">-</span>lt<span class="token operator">-</span>devel<span class="token operator">-</span><span class="token number">5.4</span><span class="token number">.127</span><span class="token operator">-</span><span class="token number">1.</span>el7<span class="token punctuation">.</span>elrepo<span class="token punctuation">.</span>x86_64
</code></pre> 
<p><strong>配置使用新版本内核启动系统：</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># grub2<span class="token operator">-</span>set<span class="token operator">-</span><span class="token keyword">default</span> <span class="token string">"kernel-lt-5.4.127-1"</span> 
<span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># grub2<span class="token operator">-</span>set<span class="token operator">-</span><span class="token keyword">default</span> <span class="token string">"kernel-lt-5.4.127-1"</span> 
<span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># grub2<span class="token operator">-</span>set<span class="token operator">-</span><span class="token keyword">default</span> <span class="token string">"kernel-lt-5.4.127-1"</span> 

<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># reboot
<span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># reboot
<span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># reboot

<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># uname <span class="token operator">-</span>r 
<span class="token number">5.4</span><span class="token number">.127</span><span class="token operator">-</span><span class="token number">1.</span>el7<span class="token punctuation">.</span>elrepo<span class="token punctuation">.</span>x86_64
</code></pre> 
<p><strong>同步时间：</strong></p> 
<p>使用互联网上提供的NTP服务，把3台主机时间保持一致（主机需要可以访问互联网）<br> 统一安装ntp</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># yum install <span class="token operator">-</span>y ntp
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># yum install <span class="token operator">-</span>y ntp
<span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># yum install <span class="token operator">-</span>y ntp
</code></pre> 
<p>指定阿里云时间服务器，进行时间同步：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># ntpdate  ntp<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com
<span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># ntpdate  ntp<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com
<span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># ntpdate  ntp<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com 
</code></pre> 
<p>添加计划任务定期同步</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># echo <span class="token string">"*/30 * * * * ntpdate  ntp.aliyun.com "</span>  <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>var<span class="token operator">/</span>spool<span class="token operator">/</span>cron<span class="token operator">/</span>root
<span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># crontab <span class="token operator">-</span>l
<span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># echo <span class="token string">"*/30 * * * * ntpdate  ntp.aliyun.com "</span>  <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>var<span class="token operator">/</span>spool<span class="token operator">/</span>cron<span class="token operator">/</span>root
<span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># echo <span class="token string">"*/30 * * * * ntpdate  ntp.aliyun.com "</span>  <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>var<span class="token operator">/</span>spool<span class="token operator">/</span>cron<span class="token operator">/</span>root
</code></pre> 
<h3>
<a id="21__Ceph_209"></a>2.1 配置Ceph安装源</h3> 
<p><strong>方法1：离线安装</strong></p> 
<p>创建本地yum源</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># rz
</code></pre> 
<p><img src="https://images2.imgbox.com/e1/c8/fBoP7qzd_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># tar xf ceph<span class="token operator">-</span><span class="token number">14</span><span class="token operator">-</span>v2<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span>C <span class="token operator">/</span>opt<span class="token operator">/</span>
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># tee  <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>ceph<span class="token punctuation">.</span>repo  <span class="token operator">&lt;&lt;</span> <span class="token constant">EOF</span>
<span class="token punctuation">[</span>ceph<span class="token punctuation">]</span>
name<span class="token operator">=</span>ceph
baseurl<span class="token operator">=</span>file<span class="token operator">:</span><span class="token comment">///opt/ceph-14</span>
enable<span class="token operator">=</span><span class="token number">1</span>
gpgcheck<span class="token operator">=</span><span class="token number">0</span>
<span class="token constant">EOF</span>
复制离线yum仓库至xuegod62
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># scp <span class="token operator">-</span>r <span class="token operator">/</span>opt<span class="token operator">/</span>ceph<span class="token operator">-</span><span class="token number">14</span><span class="token operator">/</span> root@xuegod62<span class="token punctuation">.</span>cn<span class="token operator">:</span><span class="token operator">/</span>opt<span class="token operator">/</span>
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># scp <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>ceph<span class="token punctuation">.</span>repo root@xuegod62<span class="token punctuation">.</span>cn<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>
复制离线yum仓库至xuegod64
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># scp <span class="token operator">-</span>r <span class="token operator">/</span>opt<span class="token operator">/</span>ceph<span class="token operator">-</span><span class="token number">14</span><span class="token operator">/</span> root@xuegod64<span class="token punctuation">.</span>cn<span class="token operator">:</span><span class="token operator">/</span>opt<span class="token operator">/</span>
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># scp <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>ceph<span class="token punctuation">.</span>repo root@xuegod64<span class="token punctuation">.</span>cn<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>
</code></pre> 
<p><strong>方法2：配置在线ceph源</strong></p> 
<p>在线安装</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># vim <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>ceph<span class="token punctuation">.</span>repo
<span class="token punctuation">[</span>ceph<span class="token punctuation">]</span>
name<span class="token operator">=</span>ceph
baseurl<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/</span>
gpgcheck<span class="token operator">=</span><span class="token number">0</span>
priority<span class="token operator">=</span><span class="token number">1</span>
enable<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>ceph<span class="token operator">-</span>noarch<span class="token punctuation">]</span>
name<span class="token operator">=</span>cephnoarch
baseurl<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//mirrors.aliyun.com/ceph/rpm-nautilus/el7/noarch/</span>
gpgcheck<span class="token operator">=</span><span class="token number">0</span>
priority<span class="token operator">=</span><span class="token number">1</span>
enable<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>ceph<span class="token operator">-</span>source<span class="token punctuation">]</span>
name<span class="token operator">=</span>Ceph source packages
baseurl<span class="token operator">=</span>https<span class="token operator">:</span><span class="token comment">//mirrors.aliyun.com/ceph/rpm-nautilus/el7/SRPMS/</span>
gpgcheck<span class="token operator">=</span><span class="token number">0</span>
priority<span class="token operator">=</span><span class="token number">1</span>
enable<span class="token operator">=</span><span class="token number">1</span>

<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># scp <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>ceph<span class="token punctuation">.</span>repo root@xuegod62<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># scp <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>ceph<span class="token punctuation">.</span>repo root@xuegod64<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>
在线安装必须安装epel源
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># yum install <span class="token operator">-</span>y epel<span class="token operator">-</span>release
</code></pre> 
<h3>
<a id="22__xuegod63cephdeploy_265"></a>2.2 在xuegod63上安装ceph-deploy管理工具</h3> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># yum install python<span class="token operator">-</span>setuptools ceph<span class="token operator">-</span>deploy <span class="token operator">-</span>y
开始部署新的集群
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># mkdir <span class="token operator">/</span>etc<span class="token operator">/</span>ceph <span class="token operator">&amp;&amp;</span> cd <span class="token operator">/</span>etc<span class="token operator">/</span>ceph

使用ceph<span class="token operator">-</span>deploy new 命令快速部署<span class="token number">3</span>个ceph结点
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy new xuegod62<span class="token punctuation">.</span>cn xuegod63<span class="token punctuation">.</span>cn xuegod64<span class="token punctuation">.</span>cn
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ls                                #在当前目录下生成，有<span class="token number">3</span>个节点的配置文件
ceph<span class="token punctuation">.</span>conf # Ceph主配置文件；        ceph<span class="token operator">-</span>deploy<span class="token operator">-</span>ceph<span class="token punctuation">.</span>log #日志文件 ；
ceph<span class="token punctuation">.</span>mon<span class="token punctuation">.</span>keyring #monitor密钥

<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># cat ceph<span class="token punctuation">.</span>conf  #查看配置文件
<span class="token punctuation">[</span>global<span class="token punctuation">]</span>
fsid <span class="token operator">=</span> <span class="token number">31051</span>ba5<span class="token operator">-</span><span class="token number">3210</span><span class="token operator">-</span><span class="token number">441f</span><span class="token operator">-</span>ae10<span class="token operator">-</span>be6f70859d30
mon_initial_members <span class="token operator">=</span> xuegod62<span class="token punctuation">,</span> xuegod63<span class="token punctuation">,</span> xuegod64 #指定了后期要对哪些节点进行monitor初始化，注：这里写的是短域名，后期自动部署时，也会使用短域名
mon_host <span class="token operator">=</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.62</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.64</span>   #monitor 节点IP

查看monitor密钥，后期客户端挂载ceph时，通过这个密钥来认证：
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># cat ceph<span class="token punctuation">.</span>mon<span class="token punctuation">.</span>keyring 
<span class="token punctuation">[</span>mon<span class="token punctuation">.</span><span class="token punctuation">]</span>
key <span class="token operator">=</span> AQAqgf5gAAAAABAAPJV2<span class="token operator">+</span>TPknwAl5RY9bK6rAA<span class="token operator">==</span>
caps mon <span class="token operator">=</span> allow <span class="token operator">*</span>
</code></pre> 
<p><strong>修改pool的副本数</strong></p> 
<p>pool概述：pool是ceph存储数据时的逻辑分区，它起到namespace的作用。其他分布式存储系统。每个pool包含一定数量的PG，PG里的对象被映射到不同的OSD上，因此pool是分布到整个集群的。除了隔离数据，我们也可以分别对不同的POOL设置不同的优化策略，比如副本数、数据清洗次数、数据块及对象大小等。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># vim <span class="token operator">/</span>etc<span class="token operator">/</span>ceph<span class="token operator">/</span>ceph<span class="token punctuation">.</span>conf		#配置文件的默认副本数从<span class="token number">3</span>改成<span class="token number">2</span>，这样只有两个osd也能达到active<span class="token operator">+</span>clean状态，把下面这行加入到<span class="token punctuation">[</span>global<span class="token punctuation">]</span>段（可选配置）
<span class="token punctuation">[</span>global<span class="token punctuation">]</span>
fsid <span class="token operator">=</span> <span class="token number">31051</span>ba5<span class="token operator">-</span><span class="token number">3210</span><span class="token operator">-</span><span class="token number">441f</span><span class="token operator">-</span>ae10<span class="token operator">-</span>be6f70859d30
mon_initial_members <span class="token operator">=</span> xuegod62<span class="token punctuation">,</span> xuegod63<span class="token punctuation">,</span> xuegod64
mon_host <span class="token operator">=</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.62</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.64</span>
auth_cluster_required <span class="token operator">=</span> cephx
auth_service_required <span class="token operator">=</span> cephx
auth_client_required <span class="token operator">=</span> cephx
osd_pool_default_size <span class="token operator">=</span> <span class="token number">2</span>
mon clock drift allowed <span class="token operator">=</span> <span class="token number">0.500</span>
mon clock drift warn backoff <span class="token operator">=</span> <span class="token number">10</span>
</code></pre> 
<p><mark>注：<br> osd_pool_default_size = 2 #设置pool的副本数为2个<br> mon clock drift allowed #监视器之间，允许的时钟漂移量，改为，0.5秒。默认值0.05秒<br> mon clock drift warn backoff #时钟偏移警告的退避指数。默认值5<br> ceph对每个mon之间的时间同步延时默认要求在0.05s之间，这个时间有的时候太短了。所以如果ceph集群出现clock问题，就检查ntp时间同步或者适当放宽这个误差时间。</mark></p> 
<h3>
<a id="23__ceph_313"></a>2.3 离线安装ceph</h3> 
<p>在所有节点上安装ceph和ceph-radosgw。RADOSGW是一套基于当前流行的RESTFUL协议的网关，并且兼容S3和Swift。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># yum <span class="token operator">-</span>y install ceph ceph<span class="token operator">-</span>radosgw
<span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># yum <span class="token operator">-</span>y install ceph ceph<span class="token operator">-</span>radosgw
<span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># yum <span class="token operator">-</span>y install ceph ceph<span class="token operator">-</span>radosgw
</code></pre> 
<h3>
<a id="24__ceph_monitor_321"></a>2.4 安装ceph monitor</h3> 
<p><strong>1、安装ceph monitor</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># cd <span class="token operator">/</span>etc<span class="token operator">/</span>ceph<span class="token operator">/</span>
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy mon create<span class="token operator">-</span>initial   #在<span class="token number">3</span>台节点上安装monitor。
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ls <span class="token operator">*</span><span class="token punctuation">.</span>keyring    # keyring是各组件之间秘钥文件
</code></pre> 
<p><mark>注：初始化monitor成员，根据置文件中mon initial members中的monitors。进行部署，直到它们形成表决团，然后搜集keys，并且在这个过程中报告monitor的状态。</mark><br> <img src="https://images2.imgbox.com/39/54/uyxw57B4_o.png" alt="在这里插入图片描述"><br> <strong>2、分发配置文件</strong></p> 
<p>(用ceph-deploy把配置文件和admin密钥拷贝到所有节点，这样每次执行Ceph命令行时就无需指定monitor地址和ceph.client.admin.keyring了）</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy admin xuegod62<span class="token punctuation">.</span>cn xuegod63<span class="token punctuation">.</span>cn xuegod64<span class="token punctuation">.</span>cn 
</code></pre> 
<p>将client.admin的key push到远程主机。将ceph-admin节点下的client.admin keyring push到远程主机/etc/ceph/下面。</p> 
<p><strong>查看复制过来的文件：</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod62 <span class="token operator">~</span><span class="token punctuation">]</span># ls <span class="token operator">/</span>etc<span class="token operator">/</span>ceph<span class="token operator">/</span>
ceph<span class="token punctuation">.</span>client<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>keyring  ceph<span class="token punctuation">.</span>conf  rbdmap  tmp8xZmUE
</code></pre> 
<h3>
<a id="25__osd_347"></a>2.5 部署osd服务</h3> 
<p>使用 create 命令一次完成准备 OSD 、部署到 OSD 节点、并激活它。<br> 将/dev/sdb磁盘准备为OSD，并把部署到相应的OSD节点上。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># cd <span class="token operator">/</span>etc<span class="token operator">/</span>ceph<span class="token operator">/</span>     #必须在这个目录下执行
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy osd create <span class="token operator">--</span>data <span class="token operator">/</span>dev<span class="token operator">/</span>sdb xuegod62<span class="token punctuation">.</span>cn
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy osd create <span class="token operator">--</span>data <span class="token operator">/</span>dev<span class="token operator">/</span>sdb xuegod63<span class="token punctuation">.</span>cn
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy osd create <span class="token operator">--</span>data <span class="token operator">/</span>dev<span class="token operator">/</span>sdb xuegod64<span class="token punctuation">.</span>cn
查看状态：
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy osd list xuegod63 xuegod62 xuegod64
</code></pre> 
<h3>
<a id="26__ceph_359"></a>2.6 创建ceph文件系统</h3> 
<p><strong>创建mds</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy mds create xuegod62<span class="token punctuation">.</span>cn xuegod63<span class="token punctuation">.</span>cn xuegod64<span class="token punctuation">.</span>cn
</code></pre> 
<p><strong>查看ceph当前文件系统</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph fs ls
</code></pre> 
<p><img src="https://images2.imgbox.com/9b/0c/OQbOBRkg_o.png" alt="在这里插入图片描述"><br> 一个cephfs至少要求两个librados存储池，一个为data，一个为metadata。当配置这两个存储池时，注意：</p> 
<ol>
<li>为metadata pool设置较高级别的副本级别，因为metadata的损坏可能导致整个文件系统不用</li>
<li>建议，metadata pool使用低延时存储，比如SSD，因为metadata会直接影响客户端的响应速度。</li>
</ol> 
<p><strong>创建pool存储池</strong></p> 
<p>pg概述：PG，Placement Group，归置组，<br> <mark>Placement [ˈpleɪsmənt] 安置 归置</mark></p> 
<p><strong>例1: 创建名为cephfs_data，pg_num为128的pool</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph osd pool create cephfs_data <span class="token number">128</span>   
pool <span class="token string">'cephfs_data'</span> created
</code></pre> 
<p><strong>例2：创建名为cephfs_metadata，pg_num为128的pool</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph osd pool create cephfs_metadata <span class="token number">128</span>
pool <span class="token string">'cephfs_metadata'</span> created
</code></pre> 
<p><mark>注：通常在创建pool之前，需要覆盖默认的pg_num，官方推荐：<br> *少于 5 个 OSD 时可把 pg_num 设置为 128<br> *OSD 数量在 5 到 10 个时，可把 pg_num 设置为 512<br> *OSD 数量在 10 到 50 个时，可把 pg_num 设置为 4096<br> *OSD 数量大于 50 时，你得理解权衡方法、以及如何自己计算 pg_num 取值<br> *自己计算 pg_num 取值时可借助 pgcalc 工具。</mark></p> 
<p><strong>创建文件系统</strong></p> 
<p>创建好存储池后，你就可以用 fs new 命令创建文件系统了</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph fs new xuegod cephfs_metadata cephfs_data
new fs with metadata pool <span class="token number">2</span> and data pool <span class="token number">1</span>   
注：metadata pool 编号为：<span class="token number">2</span>  ；data pool 编号为：<span class="token number">1</span>
其中：new后的fsname  可自定义

<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph fs ls              #查看创建后的cephfs
name<span class="token operator">:</span> xuegod<span class="token punctuation">,</span> metadata pool<span class="token operator">:</span> cephfs_metadata<span class="token punctuation">,</span> data pools<span class="token operator">:</span> <span class="token punctuation">[</span>cephfs_data <span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph mds stat          #查看mds节点状态
xuegod<span class="token operator">:</span><span class="token number">1</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token operator">=</span>xuegod62<span class="token punctuation">.</span>cn<span class="token operator">=</span>up<span class="token operator">:</span>active<span class="token punctuation">}</span> <span class="token number">2</span> up<span class="token operator">:</span>standby
active是活跃的，另<span class="token number">1</span>个是处于热备份的状态
</code></pre> 
<h3>
<a id="27__mgr_416"></a>2.7 部署mgr监控</h3> 
<p>安装mgr用于后面我们配置dashboard监控，而且避免挂载ceph时可能会提示warring信息。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy mgr create xuegod62<span class="token punctuation">.</span>cn xuegod63<span class="token punctuation">.</span>cn xuegod64<span class="token punctuation">.</span>cn
</code></pre> 
<p>安装后查看集群状态正常</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph <span class="token operator">-</span>s
</code></pre> 
<p><img src="https://images2.imgbox.com/a2/1c/YliJqudb_o.png" alt="在这里插入图片描述"></p> 
<h1>
<a id="Ceph_428"></a>三、多种Ceph挂载方式</h1> 
<h3>
<a id="31__Ceph_430"></a>3.1 内核驱动挂载Ceph文件系统</h3> 
<p><strong>1</strong>、查看存储密钥（如果没有在管理节点使用ceph-deploy拷贝ceph配置文件）</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 <span class="token operator">~</span><span class="token punctuation">]</span># cat <span class="token operator">/</span>etc<span class="token operator">/</span>ceph<span class="token operator">/</span>ceph<span class="token punctuation">.</span>client<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>keyring
<span class="token punctuation">[</span>client<span class="token punctuation">.</span>admin<span class="token punctuation">]</span>
	key <span class="token operator">=</span> AQDNBQFca7UYGxAA6wOfoZR4JWdP5yM56S8DeQ<span class="token operator">==</span>
</code></pre> 
<p><strong>2</strong>、将key对应的值复制下来保存到客户端xueogd64的/etc/ceph/admin.secret中。如果已经有了，就不用复制了。</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 <span class="token operator">~</span><span class="token punctuation">]</span># vim <span class="token operator">/</span>etc<span class="token operator">/</span>ceph<span class="token operator">/</span>admin<span class="token punctuation">.</span>secret  #写入以下内容
AQDNBQFca7UYGxAA6wOfoZR4JWdP5yM56S8DeQ<span class="token operator">==</span>
</code></pre> 
<p>例1：将ceph挂载到/root/test2目录下</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># mkdir <span class="token operator">/</span>root<span class="token operator">/</span>test2
<span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># mount <span class="token operator">-</span>t ceph <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token operator">:</span><span class="token number">6789</span><span class="token operator">:</span><span class="token operator">/</span> <span class="token operator">/</span>root<span class="token operator">/</span>test2<span class="token operator">/</span> <span class="token operator">-</span>o name<span class="token operator">=</span>admin<span class="token punctuation">,</span>secretfile<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>ceph<span class="token operator">/</span>admin<span class="token punctuation">.</span>secret 
<span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># df <span class="token operator">-</span>h
文件系统             容量  已用  可用 已用<span class="token operator">%</span> 挂载点
devtmpfs             <span class="token number">970</span>M     <span class="token number">0</span>  <span class="token number">970</span>M    <span class="token number">0</span><span class="token operator">%</span> <span class="token operator">/</span>dev
tmpfs                <span class="token number">982</span>M     <span class="token number">0</span>  <span class="token number">982</span>M    <span class="token number">0</span><span class="token operator">%</span> <span class="token operator">/</span>dev<span class="token operator">/</span>shm
tmpfs                <span class="token number">982</span>M  <span class="token number">8.8</span>M  <span class="token number">973</span>M    <span class="token number">1</span><span class="token operator">%</span> <span class="token operator">/</span>run
tmpfs                <span class="token number">982</span>M     <span class="token number">0</span>  <span class="token number">982</span>M    <span class="token number">0</span><span class="token operator">%</span> <span class="token operator">/</span>sys<span class="token operator">/</span>fs<span class="token operator">/</span>cgroup
<span class="token operator">/</span>dev<span class="token operator">/</span>sda3             <span class="token number">50</span>G  <span class="token number">2.0</span>G   <span class="token number">49</span>G    <span class="token number">4</span><span class="token operator">%</span> <span class="token operator">/</span>
<span class="token operator">/</span>dev<span class="token operator">/</span>sda1            <span class="token number">497</span>M  <span class="token number">151</span>M  <span class="token number">347</span>M   <span class="token number">31</span><span class="token operator">%</span> <span class="token operator">/</span>boot
<span class="token operator">/</span>dev<span class="token operator">/</span>sr0             <span class="token number">4.3</span>G  <span class="token number">4.3</span>G     <span class="token number">0</span>  <span class="token number">100</span><span class="token operator">%</span> <span class="token operator">/</span>mnt
tmpfs                <span class="token number">197</span>M     <span class="token number">0</span>  <span class="token number">197</span>M    <span class="token number">0</span><span class="token operator">%</span> <span class="token operator">/</span>run<span class="token operator">/</span>user<span class="token operator">/</span><span class="token number">0</span>
tmpfs                <span class="token number">982</span>M   <span class="token number">52</span>K  <span class="token number">982</span>M    <span class="token number">1</span><span class="token operator">%</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>ceph<span class="token operator">/</span>osd<span class="token operator">/</span>ceph<span class="token operator">-</span><span class="token number">2</span>
<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token operator">:</span><span class="token number">6789</span><span class="token operator">:</span><span class="token operator">/</span>   <span class="token number">27</span>G     <span class="token number">0</span>   <span class="token number">27</span>G    <span class="token number">0</span><span class="token operator">%</span> <span class="token operator">/</span>root<span class="token operator">/</span>test2
</code></pre> 
<p><img src="https://images2.imgbox.com/f7/37/mkRx96BK_o.png" alt="在这里插入图片描述"><br> 要取消挂载</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># umount <span class="token operator">/</span>root<span class="token operator">/</span>test2     # 先不卸载
</code></pre> 
<h3>
<a id="32__cephfuseCeph_468"></a>3.2 使用ceph-fuse命令挂载Ceph文件系统</h3> 
<p><strong>登录xuegod64，安装ceph-fuse</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># yum install <span class="token operator">-</span>y ceph<span class="token operator">-</span>fuse
<span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># mkdir <span class="token operator">/</span>root<span class="token operator">/</span>xueogd    #必须创建一个空目录，不能直接挂载有文件的目录下
</code></pre> 
<p><strong>挂载</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>fuse <span class="token operator">-</span>m <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token operator">:</span><span class="token number">6789</span> <span class="token operator">/</span>root<span class="token operator">/</span>xueogd<span class="token operator">/</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a7/f3/6ITTWC6h_o.png" alt="在这里插入图片描述"><br> <strong>取消挂载</strong></p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># fusermount <span class="token operator">-</span>u <span class="token operator">/</span>root<span class="token operator">/</span>xueogd<span class="token operator">/</span>    #先不取消挂载
</code></pre> 
<p>测试两种挂载，显示的存储大小为什么不一样：<br> 没有写入数据时查看大小：<br> <img src="https://images2.imgbox.com/f1/17/AVg6SVjS_o.png" alt="在这里插入图片描述"><br> 写入1G文件</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># dd <span class="token keyword">if</span><span class="token operator">=</span><span class="token operator">/</span>dev<span class="token operator">/</span>zero of<span class="token operator">=</span><span class="token operator">/</span>root<span class="token operator">/</span>test2<span class="token operator">/</span>a<span class="token punctuation">.</span>txt bs<span class="token operator">=</span><span class="token number">1</span>G count<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># df <span class="token operator">-</span>h
</code></pre> 
<p><img src="https://images2.imgbox.com/02/4c/uOEN0uEu_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">文件系统               容量    已用    可用   已用<span class="token operator">%</span>  挂载点
ceph<span class="token operator">-</span>fuse             <span class="token number">60</span>G    <span class="token number">5.0</span>G    <span class="token number">55</span>G    <span class="token number">9</span><span class="token operator">%</span>   <span class="token operator">/</span>root<span class="token operator">/</span>xueogd
<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token operator">:</span><span class="token number">6789</span><span class="token operator">:</span><span class="token operator">/</span>   <span class="token number">27</span>G   <span class="token number">1012</span>M   <span class="token number">26</span>G   <span class="token number">4</span><span class="token operator">%</span>   <span class="token operator">/</span>root<span class="token operator">/</span>test2
</code></pre> 
<p><mark>注：当写入1G文件时，fusermount查看大小，已用空间直接增加2G左右，mount查看大小只增加1G左右。</mark></p> 
<blockquote> 
 <p>总结：由此可以看到mount挂载显示是的用户真实可以使用的磁盘空间大小， fusermount显示的ceph<br> OSD一共的空间，不用户可以使用的大小。我们设置了OSD存储数据，存2个副本，60G/2=27G左右，因为MSD还要占用一些空间。</p> 
</blockquote> 
<p><strong>排错汇总：</strong></p> 
<p>排错1：如查要在新节点xuegod65.cn上挂载，需要将配置文件以及密钥文件拷贝至客户端节点，<br> 用ceph-deploy把配置文件和admin密钥拷贝到新节点，这样每次执行Ceph命令行时就无需指定monitor地址和ceph.client.admin.keyring了）</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>deploy admin  xuegod65<span class="token punctuation">.</span>cn   #分发配置文件
</code></pre> 
<p><strong>不然会报以下错：</strong><br> <img src="https://images2.imgbox.com/99/5d/pgMnoiuF_o.png" alt="在这里插入图片描述"><br> 排错2：</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>fuse <span class="token operator">-</span>m <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token operator">:</span><span class="token number">6789</span> <span class="token operator">/</span>opt      #挂载，报以下错
</code></pre> 
<p><img src="https://images2.imgbox.com/43/34/0ULKxeeD_o.png" alt="在这里插入图片描述"><br> 如果出现以该提示表示你需要使用-o nonempty进行挂载。原因是/opt目录不是空的，因为之前挂载到/opt路径中时会创建一个额外的目录文件夹。所以该提示是为了防止你挂载到存在数据的目录中导致目录中原有数据丢失。</p> 
<p><strong>解决方法2种</strong></p> 
<ol><li>使用-o nonempty参数挂载</li></ol> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>fuse <span class="token operator">-</span>o nonempty <span class="token operator">-</span>m <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token operator">:</span><span class="token number">6789</span> <span class="token operator">/</span>opt
</code></pre> 
<ol start="2"><li>删除目录下的文件</li></ol> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># rm <span class="token operator">-</span>rf <span class="token operator">/</span>opt<span class="token operator">/</span> <span class="token operator">*</span>
<span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>fuse <span class="token operator">-</span>m <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token operator">:</span><span class="token number">6789</span> <span class="token operator">/</span>opt
</code></pre> 
<ol start="3"><li>取消挂载</li></ol> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># fusermount <span class="token operator">-</span>u <span class="token operator">/</span>opt
</code></pre> 
<h1>
<a id="Cephdashboard_Web_544"></a>四、Ceph配置dashboard Web监控界面</h1> 
<p>安装mgr-dashboard插件（ceph节点都要安装）</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod62 ceph<span class="token punctuation">]</span># yum install <span class="token operator">-</span>y ceph<span class="token operator">-</span>mgr<span class="token operator">-</span>dashboard
<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># yum install <span class="token operator">-</span>y ceph<span class="token operator">-</span>mgr<span class="token operator">-</span>dashboard
<span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># yum install <span class="token operator">-</span>y ceph<span class="token operator">-</span>mgr<span class="token operator">-</span>dashboard
</code></pre> 
<p><mark>注：所有节点上必须都安装ceph-mgr-dashboard，不然后无法启动web监控界面。会报以下错：</mark><br> <img src="https://images2.imgbox.com/12/23/CEtcsbzj_o.png" alt="在这里插入图片描述"><br> 启用dashboard插件</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph mgr module enable dashboard
</code></pre> 
<p>创建自签名证书</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph dashboard create<span class="token operator">-</span>self<span class="token operator">-</span><span class="token keyword">signed</span><span class="token operator">-</span>cert
</code></pre> 
<p>创建管理员用户，用户名：xuegod 密码：123456</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph dashboard set<span class="token operator">-</span>login<span class="token operator">-</span>credentials xuegod <span class="token number">123456</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>          WARNING<span class="token operator">:</span> this command is deprecated<span class="token punctuation">.</span>              <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Please use the ac<span class="token operator">-</span>user<span class="token operator">-</span><span class="token operator">*</span> related commands to manage users<span class="token punctuation">.</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
Username and password updated

<span class="token punctuation">[</span>root@xuegod63 ceph<span class="token punctuation">]</span># ceph mgr services
<span class="token punctuation">{<!-- --></span>
    <span class="token string">"dashboard"</span><span class="token operator">:</span> <span class="token string">"https://xuegod63.cn:8443/"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><mark>注：这里的访问地址不是固定的，可能是xuegod62.cn:8443，mgr services中提示的dashboard访问地址为准。</mark><br> 可以通过ip地址访问： https://192.168.1.62:8443/<br> <img src="https://images2.imgbox.com/ea/74/lvn12t4M_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fc/40/j9yXoUnu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/11/b6/QGJR64PJ_o.png" alt="在这里插入图片描述"><br> 拷贝测试数据</p> 
<pre><code class="prism language-c"><span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># mount <span class="token operator">/</span>dev<span class="token operator">/</span>sr0 <span class="token operator">/</span>mnt<span class="token operator">/</span>
<span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># ceph<span class="token operator">-</span>fuse <span class="token operator">-</span>m <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.63</span><span class="token operator">:</span><span class="token number">6789</span> <span class="token operator">/</span>root<span class="token operator">/</span>xueogd<span class="token operator">/</span>
<span class="token punctuation">[</span>root@xuegod64 ceph<span class="token punctuation">]</span># cp <span class="token operator">-</span>r  <span class="token operator">/</span>mnt<span class="token operator">/</span>Packages<span class="token operator">/</span> <span class="token operator">/</span>root<span class="token operator">/</span>xueogd<span class="token operator">/</span>
</code></pre> 
<p><mark>注：这里拷贝1分钟左右就Ctrl+C取消，否则会占用过多的磁盘空间。</mark></p> 
<p>监控界面中Filesystems中可以看到文件系统的详细信息。<br> <img src="https://images2.imgbox.com/c8/a2/Q2uVdJUt_o.png" alt="在这里插入图片描述"><br> 这个图会实时的显示</p> 
<blockquote> 
 <p>看到这里是否对Ceph分布式存储架构有所了解了呢？</p> 
</blockquote> 
<pre><code>                              想要获取文章中的学习视频+笔记和源码的
                                  添加我们的小姐姐就可获取哦!
</code></pre> 
<p><img src="https://images2.imgbox.com/f2/f0/EmAMbREq_o.jpg" alt="在这里插入图片描述"></p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
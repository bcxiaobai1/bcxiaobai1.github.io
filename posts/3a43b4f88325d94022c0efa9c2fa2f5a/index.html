<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>pandas - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pandas</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <h1>
<a id="Pandas_0"></a>Pandas</h1> 
<h2>
<a id="_2"></a>文件读写</h2> 
<h3>
<a id="_4"></a>读取</h3> 
<ul>
<li>
<code>pd.read_csv()</code> 读取csv</li>
<li>
<code>pd.read_excel() </code>读取excel</li>
<li>
<code>pd.read_txt()</code> 读取文本文档</li>
</ul> 
<pre><code class="prism language-markdown">公共参数：
	header=None  从第几行开始读取
    index_col  指定行索引
    usecols  读取那几列 
    parse_dates  把给出的列转化为时间序列 
    nrows 读取的行数
</code></pre> 
<blockquote> 
 <p>在读取txt文件时经常遇到分隔符不是空格，read_table()有一个分隔参数叫<font color="red">sep</font>自定义分隔符(<font color="red">可以写正则表达式</font>)</p> 
</blockquote> 
<h3>
<a id="_21"></a>写入</h3> 
<p><em><strong>一般在写入时把 <code>index</code> 设置为 <code>False</code> ，当索引没有使用意义时就要去掉</strong></em></p> 
<pre><code class="prism language-markdown">普通写入
	to_csv  
	to_excel

以下需要安装tabulate包  
	to_markdown  
	to_latex
</code></pre> 
<h2>
<a id="_37"></a>基本数据结构</h2> 
<h3>
<a id="Series_39"></a>Series</h3> 
<p>​ 是 <strong>一维</strong> 的数据结构</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>data<span class="token punctuation">,</span>index<span class="token punctuation">,</span>dtype<span class="token punctuation">,</span>name<span class="token punctuation">)</span>
参数：
	data <span class="token operator">=</span> 值
    index <span class="token operator">=</span> 索引
    dtype <span class="token operator">=</span> 存储类型
    name <span class="token operator">=</span> 序列名字
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#示例</span>
pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'dict'</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          index <span class="token operator">=</span> pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span>
              <span class="token punctuation">[</span><span class="token string">'id1'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">'thrid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              name<span class="token operator">=</span><span class="token string">'my_index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">,</span> 
          name <span class="token operator">=</span> <span class="token string">'my_name'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">my_index
id1              <span class="token number">100</span>
<span class="token number">20</span>                 a
thrid    <span class="token punctuation">{<!-- --></span><span class="token string">'dict'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span>
Name<span class="token punctuation">:</span> my_name<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<blockquote> 
 <p><font color="red">object类型</font></p> 
 <p>代表一种混合类型，目前pandas把 <em><strong>字符串数组</strong></em> 认为是object类型</p> 
</blockquote> 
<h3>
<a id="Dataframe_74"></a>Dataframe</h3> 
<p>​ 相当于 <strong>二维</strong> 数组,由Series组成</p> 
<pre><code class="prism language-python">data <span class="token operator">=</span>  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">1.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">2.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token number">3.2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>
                index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'row_%d'</span><span class="token operator">%</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'col_0'</span><span class="token punctuation">,</span><span class="token string">'col_1'</span><span class="token punctuation">,</span><span class="token string">'col_2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">       col_0 col_1  col_2
row_0      <span class="token number">1</span>     a    <span class="token number">1.2</span>
row_1      <span class="token number">2</span>     b    <span class="token number">2.2</span>
row_2      <span class="token number">3</span>     c    <span class="token number">3.2</span>
</code></pre> 
<h4>
<a id="_93"></a>属性</h4> 
<ul>
<li>
<code>df.values</code> 查看值</li>
<li>
<code>df.index</code> 查看行索引</li>
<li>
<code>df.dtypes</code> 查看每列的类型</li>
<li>
<code>df.shape</code> 查看形状维度</li>
<li>
<code>df.T</code> <strong>转置</strong>
</li>
</ul> 
<h2>
<a id="_103"></a>常用基本函数</h2> 
<ul>
<li>
<code>df.head(n)</code> 查看数据的<strong>前</strong>n行</li>
<li>
<code>df.tail(n)</code> 查看数据的<strong>后</strong>n行</li>
<li>
<code>df.info()</code> 返回表的信息概况(<strong>如果有中文会报错</strong>)</li>
<li>
<code>df.describe(n)</code> <strong>汇总统计函数</strong>
</li>
</ul> 
<h3>
<a id="_112"></a>统计函数</h3> 
<ul>
<li>
<code>df.std()</code> 标准差</li>
<li>
<code>df.var()</code> 方差</li>
<li>
<code>df.corr()</code> 于原始DataFrame列与列之间<strong>相关性</strong>的DataFrame对象。</li>
<li>
<code>df.quantile()</code> 分位数 
  <ul>
<li>所谓四分位数；即把数值由小到大排列并分成四等份，处于三个分割点位置的数值就是四分位数。</li>
<li>第1四分位数 (Q1)，又称“较小四分位数”，等于该样本中所有数值由小到大排列后第25%的数字。</li>
<li>第2四分位数 (Q2)，又称“<em><strong>中位数</strong></em>”，等于该样本中所有数值由小到大排列后第50%的数字。</li>
<li>第3四分位数 (Q3)，又称“较大四分位数”，等于该样本中所有数值由小到大排列后第75%的数字。</li>
</ul> </li>
<li>
<code>df.count()</code> <strong>非缺失值个数</strong>
</li>
<li>
<code>df.idxmax()</code> 最大值对应的索引</li>
</ul> 
<h3>
<a id="_127"></a>唯一值函数</h3> 
<ul>
<li> <p><code>df.unique()</code> 把<strong>去掉重复值</strong>的数据输出</p> </li>
<li> <p><code>df.nunique()</code> 数据中唯一数据的<strong>个数</strong></p> </li>
<li> <p><code>df.value_counts()</code> 得到<strong>重复值的数据</strong>和他<strong>出现的频数</strong></p> </li>
<li> <p><code>df.drop_duplicates()</code> <strong>多列去重</strong></p> 
  <ul>
<li> <pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
df.drop_duplicates参数
    subset： 列名，可选，默认为None

    keep： {‘first’, ‘last’, False}, 默认值 ‘first’

    first： 保留第一次出现的重复行，删除后面的重复行。
    last： 删除重复项，除了最后一次出现。
    False： 删除所有重复项。
    inplace：布尔值，默认为False，是否直接在原数据上删除重复项或删除重复项后返回副本。（inplace=True表示直接在原来的DataFrame上删除重复项，而默认值False表示生成一个副本。）
'''</span>
</code></pre> </li>
<li> <p><font color="red">df.duplicated()</font>返回是否为<strong>唯一值的布尔列表</strong>,参数与drop_duplicates一致,如果元素是重复的都会标上True，否则False，<u>drop_duplicates等价于把duplicated为True的对应行删除</u></p> </li>
</ul> </li>
</ul> 
<h3>
<a id="_155"></a>替换函数</h3> 
<p>pandas中可以分为三类：</p> 
<p>  映射替换,逻辑替换,数值替换</p> 
<h4>
<a id="_161"></a>映射替换</h4> 
<ul>
<li> <p><code>df.replace(old, new[, max])</code></p> 
  <ul><li> <pre><code class="prism language-markdown">- old -- 将被替换的子字符串。
- new -- 新字符串，用于替换old子字符串。
- max -- 可选字符串, 替换不超过 max 次  
</code></pre> <p>可以直接给予 <strong>字典</strong> 来替换数据</p> </li></ul> </li>
<li> <p><strong>特殊方向替换</strong></p> 
  <ul>
<li> <p>指定method = ffill/bfill</p> </li>
<li> <pre><code class="prism language-markdown">	用 前面最近的未被替换掉 的值进行替换
	用 后面最近的未被替换掉 的值进行替换
</code></pre> </li>
</ul> </li>
</ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ffill:n'</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">'ffill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'nbfill:n'</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">'bfill'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">ffill<span class="token punctuation">:</span>
 <span class="token number">0</span>    a
<span class="token number">1</span>    a
<span class="token number">2</span>    b
<span class="token number">3</span>    b
<span class="token number">4</span>    b
<span class="token number">5</span>    b
<span class="token number">6</span>    a
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>

bfill<span class="token punctuation">:</span>
 <span class="token number">0</span>    a
<span class="token number">1</span>    b
<span class="token number">2</span>    b
<span class="token number">3</span>    a
<span class="token number">4</span>    a
<span class="token number">5</span>    a
<span class="token number">6</span>    a
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<h4>
<a id="_212"></a>逻辑替换</h4> 
<ul>
<li>
<code>df.where(condition)</code> 传入条件为 <font color="red"><code>False</code></font> 的对应<strong>行</strong>进行替换</li>
<li>
<code>df.mask(condition)</code> 传入条件为 <font color="red"><code>True</code></font> 的对应<strong>行</strong>进行替换</li>
</ul> 
<p>传入的条件也可以是Serise对象，只要是<strong>序列一致的布尔序列</strong>即可</p> 
<pre><code class="prism language-python">s_condition <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span>index<span class="token operator">=</span>s<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>mask<span class="token punctuation">(</span>s_condition<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>      <span class="token number">0.00000</span>
<span class="token number">1</span>      <span class="token number">1.23456</span>
<span class="token number">2</span>    <span class="token number">100.00000</span>
<span class="token number">3</span>      <span class="token number">0.00000</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<h4>
<a id="_234"></a>数值替换</h4> 
<ul>
<li> <p><code>df.round(n)</code> 返回小数位为<strong>n</strong>位的<strong>四舍五入</strong>的float值</p> </li>
<li> <p><code>df.abc()</code> 取绝对值</p> </li>
<li> <p><code>df.clip(lower, upper, axis, inplace)</code></p> 
  <ul><li> <pre><code class="prism language-markdown">lower ： float或array_like，默认为None  
	最小阈值。低于此阈值的所有值都将设置为它
upper ： float或array_like，默认为None
	最大阈值。高于此阈值的所有值都将设置为它
axis ： int或string轴名称，可选
	沿给定轴将对象与下部和上部对齐
inplace ： 布尔值，默认为False 
	是否对数据执行操作
</code></pre> </li></ul> </li>
</ul> 
<h3>
<a id="_255"></a>排序函数</h3> 
<ul><li>
<code>sort_values()</code> 值排序</li></ul> 
<p><strong>被排序的列可以是列表来进行多列排序</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'年龄用降序排序，工资用升序排序'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'年龄'</span><span class="token punctuation">,</span><span class="token string">'工资（元）'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#因为在实操种可能有一些数据相同，索引就需要多列排序的操作，排在前面的先拍</span>
</code></pre> 
<pre><code>年龄用降序排序，工资用升序排序
   序号   姓名  年龄  工资（元）
1   2   黄丽  32   3600
0   1   张茜  28   2900
4   5  曾丽萍  27   2500
3   4  邓大海  26   2200
2   3  李海涛  24   2800
</code></pre> 
<ul><li>
<code>sort_index()</code> 索引排序</li></ul> 
<p>可以先指定索引列(level)，字符串排序由<strong>字母顺序</strong>决定</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'以名字进行索引升序排序n'</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token string">'姓名'</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment">#看得出来是A-Z是升序，Z-A是降序</span>
</code></pre> 
<pre><code class="prism language-python">以名字进行索引升序排序

序号	姓名	年龄	工资（元）
<span class="token number">0</span>	<span class="token number">1</span>	张茜	<span class="token number">28</span>	<span class="token number">2900</span>
<span class="token number">1</span>	<span class="token number">2</span>	黄丽	<span class="token number">32</span>	<span class="token number">3600</span>
<span class="token number">2</span>	<span class="token number">3</span>	李海涛	<span class="token number">24</span>	<span class="token number">2800</span>
<span class="token number">3</span>	<span class="token number">4</span>	邓大海	<span class="token number">26</span>	<span class="token number">2200</span>
<span class="token number">4</span>	<span class="token number">5</span>	曾丽萍	<span class="token number">27</span>	<span class="token number">2500</span>
</code></pre> 
<h3>
<a id="apply_302"></a>apply方法</h3> 
<p>​ apply用与DataFrame的 <strong>行迭代</strong> 和 <strong>列迭代</strong></p> 
<ul><li> <p><code>DataFrame.apply(func,axis,raw,result_type)</code></p> 
  <ul><li> <pre><code>func:
        应用于每一列或每一行的函数。

    axis:
        {0 或 'index'，1 或 'columns'}，默认 0
        沿其应用函数的轴：
            0 或“索引”：将函数应用于每一列。
            1 或“列”：将函数应用于每一行。

    raw:
        布尔值，默认为 False
        确定行或列是否作为 Series 或 ndarray 对象传递：
            False: 将每一行或每一列作为一个系列传递给函数。
            True：传递的函数将接收 ndarray 对象。如果您只是应用NumPy 缩减功能，这将获得更好的性能。

    result_type 
    {'expand', 'reduce', 'broadcast','None'}，默认无
        axis=1这些仅在（列）时起作用：
            'expand' : 类似列表的结果将变成列。
            'reduce' ：如果可能，返回一个系列，而不是扩展类似列表的结果。这与“扩展”相反。
            'broadcast' : 结果将被广播到DataFrame的原始形状，原始索引和列将被保留。

        默认行为（None）取决于应用函数的返回值：类似列表的结果将作为这些结果的系列返回。但是，如果应用函数返回一个系列，这些将扩展为列。
</code></pre> </li></ul> </li></ul> 
<pre><code class="prism language-python">df_demo <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'年龄'</span><span class="token punctuation">,</span><span class="token string">'工资（元）'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment">#先把需要遍历的列或行提取出来</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'不用apply函数的平均值:n'</span><span class="token punctuation">,</span>df_demo<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n使用了apply函数的平均值n'</span><span class="token punctuation">,</span>df_demo<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>不用apply函数的平均值:
 年龄         30.763889
工资（元）    3059.722222
dtype: float64

使用了apply函数的平均值
 0     1464.0
1     1816.0
2     1412.0
3     1113.0
4     1263.5
       ...  
67    1919.0
68    1617.0
69    1263.0
70    1917.5
71    2273.0
Length: 72, dtype: float64
</code></pre> 
<blockquote> 
 <p><strong>apply的自由度很高但是代价是性能，所以一般少用apply</strong></p> 
</blockquote> 
<h3>
<a id="mad_371"></a>mad</h3> 
<p>​ <strong><code>mad</code> 函数返回的是一个序列中偏离该序列均值的绝对值大小的均值</strong></p> 
<blockquote> 
 <p>例如序列1,3,7,10中，均值为5.25，每一个元素偏离的绝对值为4.25,2.25,1.75,4.75，这个偏离序列的均值为3.25。</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'mad函数输出n'</span><span class="token punctuation">,</span>df_demo<span class="token punctuation">.</span>mad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n使用apply输出n'</span><span class="token punctuation">,</span>df_demo<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">(</span>x<span class="token operator">-</span>x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>mad函数输出
 年龄         5.515432
工资（元）    600.231481
dtype: float64

使用apply输出
 年龄         5.515432
工资（元）    600.231481
dtype: float64
</code></pre> 
<h2>
<a id="_398"></a>窗口对象</h2> 
<p>​ 滑动窗口<strong>rolling</strong> 扩张窗口<strong>expanding</strong> 指数加权窗口<strong>ewm</strong></p> 
<h3>
<a id="_402"></a>滑动窗口</h3> 
<p><font color="blue"><strong>rolling</strong></font></p> 
<p>​ 滑动窗口将window参数设置为多少，就从<strong>源数据第一个元素向左边数 window参数-1(因为包括它本身) 然后进行运算</strong>，以此向后推</p> 
<pre><code class="prism language-python">num5 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
roller <span class="token operator">=</span> num5<span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>roller<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
    当窗口为2时，从第一个源数据元素向左数 window-1 个位 就是1个位
    因为0索引左边没有任何数[本位数据为1]，所以为缺失值(任何数与缺失值作运算都是缺失值)
    因为1索引向左边数是1(源数据)[本位数据为2],所以求和为3
    因为2索引向左边数是2(源数据)[本位数据为3],所以为5
'''</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     NaN
<span class="token number">1</span>     <span class="token number">3.0</span>
<span class="token number">2</span>     <span class="token number">5.0</span>
<span class="token number">3</span>     <span class="token number">7.0</span>
<span class="token number">4</span>     <span class="token number">9.0</span>
<span class="token number">5</span>    <span class="token number">11.0</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<h4>
<a id="_433"></a>另类窗口函数</h4> 
<p>​ 他们的公共参数：<em><strong>periods=n</strong></em></p> 
<ul><li>
<code>shift</code> 向左取第n个元素的值</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#shift:取向左第n个元素的值</span>
num5 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'shift:n'</span><span class="token punctuation">,</span>num5<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>periods<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n特殊用法(取负数)n'</span><span class="token punctuation">,</span>num5<span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">shift<span class="token punctuation">:</span>
 <span class="token number">0</span>    NaN
<span class="token number">1</span>    NaN
<span class="token number">2</span>    <span class="token number">1.0</span>
<span class="token number">3</span>    <span class="token number">3.0</span>
<span class="token number">4</span>    <span class="token number">6.0</span>
dtype<span class="token punctuation">:</span> float64

特殊用法<span class="token punctuation">(</span>取负数<span class="token punctuation">)</span>
 <span class="token number">0</span>     <span class="token number">3.0</span>
<span class="token number">1</span>     <span class="token number">6.0</span>
<span class="token number">2</span>    <span class="token number">10.0</span>
<span class="token number">3</span>    <span class="token number">15.0</span>
<span class="token number">4</span>     NaN
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<ul><li>
<code>diff</code> 与向左第n个元素做差(与numpy不同，后者表示n阶差分)</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#diff:向左取n个元素做差</span>
num5 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'diff:n'</span><span class="token punctuation">,</span>num5<span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n特殊用法(取负数):n'</span><span class="token punctuation">,</span>num5<span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">diff<span class="token punctuation">:</span>
 <span class="token number">0</span>    NaN
<span class="token number">1</span>    NaN
<span class="token number">2</span>    <span class="token number">5.0</span>
<span class="token number">3</span>    <span class="token number">7.0</span>
<span class="token number">4</span>    <span class="token number">9.0</span>
dtype<span class="token punctuation">:</span> float64

特殊用法<span class="token punctuation">(</span>取负数<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token number">0</span>   <span class="token operator">-</span><span class="token number">5.0</span>
<span class="token number">1</span>   <span class="token operator">-</span><span class="token number">7.0</span>
<span class="token number">2</span>   <span class="token operator">-</span><span class="token number">9.0</span>
<span class="token number">3</span>    NaN
<span class="token number">4</span>    NaN
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<ul><li>
<code>pct_change</code> 与向左第n个元素相比计算增长量(n可以为负，表示反方向的类似操作)</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#pct_change:与向左第n个元素相比计算增长量</span>
num5 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'pct_change:n'</span><span class="token punctuation">,</span>num5<span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n特殊用法(取负数):n'</span><span class="token punctuation">,</span>num5<span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pct_change<span class="token punctuation">:</span>
 <span class="token number">0</span>         NaN
<span class="token number">1</span>         NaN
<span class="token number">2</span>    <span class="token number">5.000000</span>
<span class="token number">3</span>    <span class="token number">2.333333</span>
<span class="token number">4</span>    <span class="token number">1.500000</span>
dtype<span class="token punctuation">:</span> float64

特殊用法<span class="token punctuation">(</span>取负数<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token number">0</span>   <span class="token operator">-</span><span class="token number">0.833333</span>
<span class="token number">1</span>   <span class="token operator">-</span><span class="token number">0.700000</span>
<span class="token number">2</span>   <span class="token operator">-</span><span class="token number">0.600000</span>
<span class="token number">3</span>         NaN
<span class="token number">4</span>         NaN
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<blockquote> 
 <p><em><strong>另类滑窗函数也可以用rolling函数来实现</strong></em></p> 
</blockquote> 
<h3>
<a id="_522"></a>扩展窗口</h3> 
<p><font color="blue"><strong>expanding</strong></font></p> 
<p>​ 累计窗口函数，与滑动窗口不同的是他<strong>的窗口会动态增大，从第一个开始向右边平移n个元素进行计算</strong></p> 
<pre><code class="prism language-python">num5 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
num5<span class="token punctuation">.</span>expanding<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">1.000000</span>
<span class="token number">1</span>    <span class="token number">2.000000</span>
<span class="token number">2</span>    <span class="token number">3.333333</span>
<span class="token number">3</span>    <span class="token number">5.000000</span>
<span class="token number">4</span>    <span class="token number">7.000000</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<h2>
<a id="_546"></a>索引器</h2> 
<h3>
<a id="_548"></a>基本索引</h3> 
<p>####行索引</p> 
<p>​ 一般的索引都是中括号<code>['列名']</code>来索引内容，结果返回Serise(<strong>参数&lt;=1时</strong>),如果<strong>参数&gt;1</strong>就返回DataFrame</p> 
<pre><code class="prism language-python"><span class="token comment">#读取文件</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">,</span>usecols <span class="token operator">=</span> 
<span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span> <span class="token string">'Grade'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">,</span><span class="token string">'Weight'</span><span class="token punctuation">,</span> <span class="token string">'Transfer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">df<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>      Gaopeng Yang
<span class="token number">1</span>    Changqiang You
<span class="token number">2</span>           Mei Sun
<span class="token number">3</span>      Xiaojuan Sun
<span class="token number">4</span>       Gaojuan You
Name<span class="token punctuation">:</span> Name<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<p> 此外，若要取出单列，且列名中<strong>不包含空格</strong>，则可以用 <strong><code>.列名</code></strong> 取出，这和 [列名] 是等价的：</p> 
<h4>
<a id="_577"></a>列索引</h4> 
<p> 如果取出单个索引对应的元素，可以使用<code>[index]</code>,若 <code>Series</code> 只有<u>单个值对应，则返回这个标量值，如果有多个值对应，则返回一个 <code>Series</code></u></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s
</code></pre> 
<pre><code class="prism language-python">a    <span class="token number">1</span>
b    <span class="token number">2</span>
a    <span class="token number">3</span>
a    <span class="token number">4</span>
a    <span class="token number">5</span>
c    <span class="token number">6</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<h5>
<a id="_599"></a>索引切片</h5> 
<p>​ 如果想要取出某两个索引之间的元素，并且这两个索引是在整个索引中 <strong>唯一出现</strong> ，就可以使用 <strong>切片</strong> (注意：索引切片<strong>会包含两个端点</strong> )</p> 
<pre><code class="prism language-python">s<span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python">c    <span class="token number">6</span>
a    <span class="token number">4</span>
b    <span class="token number">2</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<blockquote> 
 <p>如果前后端点的值存在 <strong>重复</strong> ，即 <strong>非唯一值</strong> ，那么需要经过 <em><strong>排序</strong></em> 才能使用切片</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment">#错误案例</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    s<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    Err_Msg <span class="token operator">=</span> e

Err_Msg
</code></pre> 
<pre><code class="prism language-python">KeyError<span class="token punctuation">(</span><span class="token string">'key of type tuple not found and not a MultiIndex'</span><span class="token punctuation">)</span>
</code></pre> 
<p>​ 如果使用<strong>整数切片</strong>，则会取出对应索引 <code>位置</code> 的值，注意这里的整数切片同 Python 中的切片一样 <font color="red"><em><strong>不包含右端点</strong></em></font></p> 
<pre><code class="prism language-python">s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python">b    <span class="token number">2</span>
a    <span class="token number">4</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<blockquote> 
 <p>提示：</p> 
 <p>​ 如果不想陷入麻烦，那么请<strong>不要把纯浮点以及任何混合类型（字符串、整数、浮点类型等的混合作为索引</strong>，否则可能会在具体的操作时报错或者返回非预期的结果，并且在实际的数据分析中也不存在这样做的动机。</p> 
</blockquote> 
<h3>
<a id="loc_648"></a>loc索引器</h3> 
<p>​ 是一种基于 <strong>元素</strong> 的索引器</p> 
<ul><li> <p>语法：<code>df.loc[*,*]</code></p> 
  <ul>
<li> <p>第一个 <strong><code>*</code><strong>代表</strong>行的选择</strong>，第二个 <strong><code>*</code></strong> 代表<strong>列的选择</strong>，如果省略第二个位置写作 loc[ * ] ，这个 <strong><code>*</code></strong> 是指<strong>行的筛选</strong></p> </li>
<li> <p>其中， <strong><code>*</code></strong> 的位置一共有<strong>五类合法对象</strong></p> </li>
</ul> <p>​ 分别是：<strong>单个元素、元素列表、元素切片、布尔列表以及函数</strong></p> </li></ul> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">,</span>usecols <span class="token operator">=</span> 
<span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span> <span class="token string">'Grade'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">,</span><span class="token string">'Weight'</span><span class="token punctuation">,</span> <span class="token string">'Transfer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="left">Grade</th>
<th align="left">Name</th>
<th align="left">Gender</th>
<th align="left">Weight</th>
<th align="left">Transfer</th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Freshman</td>
<td align="left">Gaopeng Yang</td>
<td align="left">Female</td>
<td align="left">46.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">Peking University</td>
<td align="left">Freshman</td>
<td align="left">Changqiang You</td>
<td align="left">Male</td>
<td align="left">70.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Senior</td>
<td align="left">Mei Sun</td>
<td align="left">Male</td>
<td align="left">89.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">Fudan University</td>
<td align="left">Sophomore</td>
<td align="left">Xiaojuan Sun</td>
<td align="left">Female</td>
<td align="left">41.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">Fudan University</td>
<td align="left">Sophomore</td>
<td align="left">Gaojuan You</td>
<td align="left">Male</td>
<td align="left">74.0</td>
<td>N</td>
</tr>
</tbody>
</table>
<p>####行和列</p> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'Qiang Sun'</span><span class="token punctuation">,</span> <span class="token string">'School'</span><span class="token punctuation">]</span> <span class="token comment"># 返回Series，因为第一个是索引列</span>
</code></pre> 
<pre><code class="prism language-python">Name
Qiang Sun              Tsinghua University
Qiang Sun              Tsinghua University
Qiang Sun    Shanghai Jiao Tong University
Name<span class="token punctuation">:</span> School<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'Quan Zhao'</span><span class="token punctuation">,</span> <span class="token string">'School'</span><span class="token punctuation">]</span> <span class="token comment"># 返回单个元素</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token string">'Shanghai Jiao Tong University'</span>
</code></pre> 
<p>####元素列表</p> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Qiang Sun'</span><span class="token punctuation">,</span><span class="token string">'Quan Zhao'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span><span class="token string">'Gender'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token comment">#dataframe</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="left">Gender</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="right">Qiang Sun</td>
<td align="left">Tsinghua University</td>
<td align="left">Female</td>
</tr>
<tr>
<td align="right">Qiang Sun</td>
<td align="left">Tsinghua University</td>
<td align="left">Female</td>
</tr>
<tr>
<td align="right">Qiang Sun</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Female</td>
</tr>
<tr>
<td align="right">Quan Zhao</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Female</td>
</tr>
</tbody>
</table>
<p>####切片</p> 
<p>​ Series 使用字符串索引时提到，如果是<strong>唯一值的起点和终点字符</strong>，那么就可以使用切片，并且<font color="red"><strong>包含两个端点</strong></font>，如果不唯一则报错</p> 
<pre><code class="prism language-python"><span class="token comment">#两个端点都包含</span>
df_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'Gaojuan You'</span><span class="token punctuation">:</span><span class="token string">'Gaoqiang Qian'</span><span class="token punctuation">,</span> <span class="token string">'School'</span><span class="token punctuation">:</span><span class="token string">'Gender'</span><span class="token punctuation">]</span>
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="left">School</th>
<th align="left">Grade</th>
<th align="left">Gender</th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="right">Gaojuan You</td>
<td align="left">Fudan University</td>
<td align="left">Sophomore</td>
<td align="left">Male</td>
</tr>
<tr>
<td align="right">Xiaoli Qian</td>
<td align="left">Tsinghua University</td>
<td align="left">Freshman</td>
<td align="left">Female</td>
</tr>
<tr>
<td align="right">Qiang Chu</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Freshman</td>
<td align="left">Female</td>
</tr>
<tr>
<td align="right">Gaoqiang Qian</td>
<td align="left">Tsinghua University</td>
<td align="left">Junior</td>
<td align="left">Female</td>
</tr>
</tbody>
</table>
<p>​ 需要注意的是，如果 <code>DataFrame</code> 使用<strong>整数索引</strong>，其使用整数切片的时候和上面字符串索引的要求一致，都是 <strong>元素</strong> 切片，<font color="red"><strong>包含两个端点</strong></font>、端点<strong>不允许有重复值</strong></p> 
<pre><code class="prism language-python">df_loc_slice_demo <span class="token operator">=</span> df_demo<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 复制下来</span>
df_loc_slice_demo<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span>df_demo<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#把所以设置为全部元素记录数的降序</span>
df_loc_slice_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token comment"># 定位器切片，两个端点都包含</span>
</code></pre> 
<pre><code class="prism language-python">School	Grade	Gender	Weight	Transfer
<span class="token number">5</span>	Fudan University	Junior	Female	<span class="token number">46.0</span>	N
<span class="token number">4</span>	Tsinghua University	Senior	Female	<span class="token number">50.0</span>	N
<span class="token number">3</span>	Shanghai Jiao Tong University	Senior	Female	<span class="token number">45.0</span>	N
</code></pre> 
<pre><code class="prism language-python">df_loc_slice_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span> 
<span class="token comment"># 没有返回，说明不是整数位置切片，要根据索引排序来切片</span>
</code></pre> 
<pre><code class="prism language-python">School	Grade	Gender	Weight	Transfer
</code></pre> 
<p>####布尔索引</p> 
<p>​  传入 <strong><code>loc</code></strong> 的布尔列表与 <code>DataFrame</code> <u><strong>长度相同</strong></u>，且列表为 <strong><code>True</code></strong> 的位置所<strong>对应的行会被选中</strong>， <strong><code>False</code></strong> 则会被<strong>剔除</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 选出体重超过70kg的学生</span>
df_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df_demo<span class="token punctuation">.</span>Weight<span class="token operator">&gt;</span><span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="center">School</th>
<th align="left">Grade</th>
<th align="left">Gender</th>
<th align="left">Weight</th>
<th align="left">Transfer</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr>
<td align="center">Name</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="center">Mei Sun</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Senior</td>
<td align="left">Male</td>
<td align="left">89.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="center">Gaojuan You</td>
<td align="left">Fudan University</td>
<td align="left">Sophomore</td>
<td align="left">Male</td>
<td align="left">74.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="center">Xiaopeng Zhou</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Freshman</td>
<td align="left">Male</td>
<td align="left">74.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="center">Xiaofeng Sun</td>
<td align="left">Tsinghua University</td>
<td align="left">Senior</td>
<td align="left">Male</td>
<td align="left">71.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="center">Qiang Zheng</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Senior</td>
<td align="left">Male</td>
<td align="left">87.0</td>
<td align="left">N</td>
</tr>
</tbody>
</table>
<ul><li>传入元素列表，也可以通过 **<code>isin</code>**方法返回的布尔列表等价写出</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 选出所有大一和大四的同学信息</span>
df_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df_demo<span class="token punctuation">.</span>Grade<span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Freshman'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#isin是dataframe的一个方法</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="left">Grade</th>
<th align="left">Gender</th>
<th align="left">Weight</th>
<th align="left">Transfer</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="right">Gaopeng Yang</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Freshman</td>
<td align="left">Female</td>
<td align="left">46.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Changqiang You</td>
<td align="left">Peking University</td>
<td align="left">Freshman</td>
<td align="left">Male</td>
<td align="left">70.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Mei Sun</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Senior</td>
<td align="left">Male</td>
<td align="left">89.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Xiaoli Qian</td>
<td align="left">Tsinghua University</td>
<td align="left">Freshman</td>
<td align="left">Female</td>
<td align="left">51.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Qiang Chu</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Freshman</td>
<td align="left">Female</td>
<td align="left">52.0</td>
<td align="left">N</td>
</tr>
</tbody>
</table>
<ul><li>对于复合条件而言，可以用 <strong>|（或）, &amp;（且）, ~（取反）</strong> 的组合来实现</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#选出复旦大学中体重超过70kg的大四学生，或者北大男生中体重超过80kg的非大四的学生</span>
school1 <span class="token operator">=</span> df_demo<span class="token punctuation">.</span>School <span class="token operator">==</span> <span class="token string">'Fudan University'</span>
grade1 <span class="token operator">=</span> df_demo<span class="token punctuation">.</span>Grade <span class="token operator">==</span> <span class="token string">'Senior'</span>
weight1 <span class="token operator">=</span> df_demo<span class="token punctuation">.</span>Weight <span class="token operator">&gt;</span> <span class="token number">70</span>
FD <span class="token operator">=</span> school1 <span class="token operator">&amp;</span> grade1 <span class="token operator">&amp;</span> weight1

school2 <span class="token operator">=</span> df_demo<span class="token punctuation">.</span>School <span class="token operator">==</span> <span class="token string">'Peking University'</span>
grade2 <span class="token operator">=</span> df_demo<span class="token punctuation">.</span>Grade <span class="token operator">==</span> <span class="token string">'Senior'</span>
weight2 <span class="token operator">=</span> df_demo<span class="token punctuation">.</span>Weight <span class="token operator">&gt;</span> <span class="token number">80</span>
BD <span class="token operator">=</span> school2 <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>grade2<span class="token punctuation">)</span> <span class="token operator">&amp;</span> weight2 <span class="token comment"># (~grade2)这里是取反</span>

df_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>FD <span class="token operator">|</span> BD<span class="token punctuation">]</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="left">Grade</th>
<th align="left">Gender</th>
<th align="left">Weight</th>
<th align="left">Transfer</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="right">Qiang Han</td>
<td align="left">Peking University</td>
<td align="left">Freshman</td>
<td align="left">Male</td>
<td align="left">87.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Chengpeng Zhou</td>
<td align="left">Fudan University</td>
<td align="left">Senior</td>
<td align="left">Male</td>
<td align="left">81.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Changpeng Zhao</td>
<td align="left">Peking University</td>
<td align="left">Freshman</td>
<td align="left">Male</td>
<td align="left">83.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Chengpeng Qian</td>
<td align="left">Fudan University</td>
<td align="left">Senior</td>
<td align="left">Male</td>
<td align="left">73.0</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
<h4>
<a id="select_dtypes_827"></a>select_dtypes</h4> 
<ul><li> <p><code>DataFrame.select_dtypes</code></p> <p>参数：</p> <p>​ include : 标量(类型)</p> <p>​ exclude : 列表</p> <p>标量或类似列表的内容，<strong>包括/排除</strong> 的dtypes或字符串的选择。<strong>必须至少提供这些参数之一</strong></p> </li></ul> 
<pre><code class="prism language-markdown">* 要选择所有数字类型，请使用np.number或'number'

* 要选择字符串，您必须使用objectdtype，但请注意，这将返回所有object dtype 列

* 查看numpy dtype 层次结构

* 要选择日期时间，请np.datetime64使用'datetime'或 'datetime64'  
* 要选择时间增量，请np.timedelta64使用'timedelta'或 'timedelta64'  

* 要选择 Pandas 分类数据类型，请使用'category'  

* 要选择 Pandas datetimetz dtypes，请使用'datetimetz'（0.20.0 中的新功能）或'datetime64[ns, tz]'  
</code></pre> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'float64'</span><span class="token punctuation">,</span><span class="token string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="left">Grade</th>
<th align="left">Gender</th>
<th align="left">Weight</th>
<th align="left">Transfer</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="right">Gaopeng Yang</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Freshman</td>
<td align="left">Female</td>
<td align="left">46.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Changqiang You</td>
<td align="left">Peking University</td>
<td align="left">Freshman</td>
<td align="left">Male</td>
<td align="left">70.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Mei Sun</td>
<td align="left">Shanghai Jiao Tong University</td>
<td align="left">Senior</td>
<td align="left">Male</td>
<td align="left">89.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Xiaojuan Sun</td>
<td align="left">Fudan University</td>
<td align="left">Sophomore</td>
<td align="left">Female</td>
<td align="left">41.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Gaojuan You</td>
<td align="left">Fudan University</td>
<td align="left">Sophomore</td>
<td align="left">Male</td>
<td align="left">74.0</td>
<td align="left">N</td>
</tr>
</tbody>
</table>
<blockquote> 
 <p><em><strong>字符串dtypes是不允许的，使用’object’代替</strong></em></p> 
</blockquote> 
<h4>
<a id="_871"></a>函数</h4> 
<p>​  必须以前面的<strong>四种合法形式之一为返回值</strong>,并且函数的<strong>输入值为DataFrame本身</strong>(支持使用 lambda 表达式)</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">condition</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    condition_1_1 <span class="token operator">=</span> x<span class="token punctuation">.</span>School <span class="token operator">==</span> <span class="token string">'Fudan University'</span>
    condition_1_2 <span class="token operator">=</span> x<span class="token punctuation">.</span>Grade <span class="token operator">==</span> <span class="token string">'Senior'</span>
    condition_1_3 <span class="token operator">=</span> x<span class="token punctuation">.</span>Weight <span class="token operator">&gt;</span> <span class="token number">70</span>
    condition_1 <span class="token operator">=</span> condition_1_1 <span class="token operator">&amp;</span> condition_1_2 <span class="token operator">&amp;</span> condition_1_3

    condition_2_1 <span class="token operator">=</span> x<span class="token punctuation">.</span>School <span class="token operator">==</span> <span class="token string">'Peking University'</span>
    condition_2_2 <span class="token operator">=</span> x<span class="token punctuation">.</span>Grade <span class="token operator">==</span> <span class="token string">'Senior'</span>
    condition_2_3 <span class="token operator">=</span> x<span class="token punctuation">.</span>Weight <span class="token operator">&gt;</span> <span class="token number">80</span>
    condition_2 <span class="token operator">=</span> condition_2_1 <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>condition_2_2<span class="token punctuation">)</span> <span class="token operator">&amp;</span> condition_2_3<span class="token comment"># (~condition_2_2) 取反</span>

    result <span class="token operator">=</span> condition_1 <span class="token operator">|</span> condition_2
    <span class="token keyword">return</span> result

df_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>condition<span class="token punctuation">]</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="left">Grade</th>
<th align="left">Gender</th>
<th align="left">Weight</th>
<th align="left">Transfer</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="right">Qiang Han</td>
<td align="left">Peking University</td>
<td align="left">Freshman</td>
<td align="left">Male</td>
<td align="left">87.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Chengpeng Zhou</td>
<td align="left">Fudan University</td>
<td align="left">Senior</td>
<td align="left">Male</td>
<td align="left">81.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Changpeng Zhao</td>
<td align="left">Peking University</td>
<td align="left">Freshman</td>
<td align="left">Male</td>
<td align="left">83.0</td>
<td align="left">N</td>
</tr>
<tr>
<td align="right">Chengpeng Qian</td>
<td align="left">Fudan University</td>
<td align="left">Senior</td>
<td align="left">Male</td>
<td align="left">73.0</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
<ul><li>
<code>slice()</code> 返回切片对象，主要作用在<strong>切片操作函数里的参数传递</strong>,由于函数无法返回<u>(如 start: end: step )</u>的切片形式，故返回切片时要用 <code>slice</code> 对象进行包装</li></ul> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">slice</span><span class="token punctuation">(</span><span class="token string">'Gaojuan You'</span><span class="token punctuation">,</span> <span class="token string">'Gaoqiang Qian'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment">#start:end:step</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th align="right"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Gaojuan You</td>
<td align="right">Fudan University</td>
<td align="right">Sophomore</td>
<td align="right">Male</td>
<td align="right">74.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Xiaoli Qian</td>
<td align="right">Tsinghua University</td>
<td align="right">Freshman</td>
<td align="right">Female</td>
<td align="right">51.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Qiang Chu</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Freshman</td>
<td align="right">Female</td>
<td align="right">52.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Gaoqiang Qian</td>
<td align="right">Tsinghua University</td>
<td align="right">Junior</td>
<td align="right">Female</td>
<td align="right">50.0</td>
<td align="right">N</td>
</tr>
</tbody>
</table>
<blockquote> 
 <p>对于 Series 也可以使用 loc 索引，其遵循的原则与 DataFrame 中用于行筛选的 loc[*] 完全一致</p> 
</blockquote> 
<h4>
<a id="SettingWithCopyWarning_921"></a>SettingWithCopyWarning</h4> 
<p> 在对表或者序列赋值时，应当在<strong>使用一层索引器后直接进行赋值操作</strong>，这样做是由于进行多次索引后赋值是赋在临时返回的 copy 副本上的，而<strong>没有真正修改元素</strong>从而报出 <font color="red"><code>SettingWithCopyWarning</code> </font>警告。</p> 
<pre><code class="prism language-python">df_chain<span class="token punctuation">[</span>df_chain<span class="token punctuation">.</span>A<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>B <span class="token operator">=</span> <span class="token number">1</span>
<span class="token triple-quoted-string string">'''
   这样使用会出问题的原因就是索引后数据在内存中
   再去直接调用属性并赋值pandas就会报出警告并且'不执行'这个语句
   但是可以使用索引器来达到这个目的
'''</span>
</code></pre> 
<pre><code class="prism language-python">C<span class="token punctuation">:</span>Python310libsite<span class="token operator">-</span>packagespandascoregeneric<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">5516</span><span class="token punctuation">:</span> SettingWithCopyWarning<span class="token punctuation">:</span> 
A value <span class="token keyword">is</span> trying to be <span class="token builtin">set</span> on a copy of a <span class="token builtin">slice</span> <span class="token keyword">from</span> a DataFrame<span class="token punctuation">.</span>
Try using <span class="token punctuation">.</span>loc<span class="token punctuation">[</span>row_indexer<span class="token punctuation">,</span>col_indexer<span class="token punctuation">]</span> <span class="token operator">=</span> value instead

See the caveats <span class="token keyword">in</span> the documentation<span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">//</span>pandas<span class="token punctuation">.</span>pydata<span class="token punctuation">.</span>org<span class="token operator">/</span>pandas<span class="token operator">-</span>docs<span class="token operator">/</span>stable<span class="token operator">/</span>user_guide<span class="token operator">/</span>indexing<span class="token punctuation">.</span>html<span class="token comment">#returning-a-view-versus-a-copy</span>
  self<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value
</code></pre> 
<p>​ 但是可以使用<strong>索引器</strong>来达到这个目的</p> 
<pre><code class="prism language-python">df_chain<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df_chain<span class="token punctuation">.</span>A<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
df_chain
</code></pre> 
<pre><code class="prism language-python">	A	B
<span class="token number">0</span>	<span class="token number">0</span>	<span class="token number">0</span>
<span class="token number">1</span>	<span class="token number">1</span>	<span class="token number">1</span>
<span class="token number">2</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">1</span>
</code></pre> 
<h3>
<a id="iloc_959"></a>iloc索引器</h3> 
<p>​ <strong>针对位置</strong>进行筛选/查找，在相应的 * 位置处一共也有五类合法对象，分别是：<strong>整数、整数列表、整数切片、布尔列表以及函数</strong>，函数的返回值必须是前面的四类合法对象中的一个，其输入同样也为 <code>DataFrame</code> 本身</p> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># 第二行第二列</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token string">'Freshman'</span>
</code></pre> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 前两行前两列</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Gaopeng Yang</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Freshman</td>
</tr>
<tr>
<td align="right">Changqiang You</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
</tr>
</tbody>
</table>
<ul><li><strong>切片不包含结束端点</strong></li></ul> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment"># 切片不包含结束端点</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Changqiang You</td>
<td align="right">Male</td>
<td align="right">70.0</td>
</tr>
<tr>
<td align="right">Mei Sun</td>
<td align="right">Male</td>
<td align="right">89.0</td>
</tr>
<tr>
<td align="right">Xiaojuan Sun</td>
<td align="right">Female</td>
<td align="right">41.0</td>
</tr>
</tbody>
</table>
<ul><li><strong>传入切片为返回值的函数</strong></li></ul> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th align="right"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Changqiang You</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Male</td>
<td align="right">70.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Mei Sun</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Male</td>
<td align="right">89.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Xiaojuan Sun</td>
<td align="right">Fudan University</td>
<td align="right">Sophomore</td>
<td align="right">Female</td>
<td align="right">41.0</td>
<td align="right">N</td>
</tr>
</tbody>
</table>
<ul><li> <p><strong>布尔列表</strong></p> <p>​ 在使用布尔列表的时候要特别注意，<strong>不能传入 <code>Series</code> 而必须传入序列的 <code>values</code> <strong>，否则会<u>报错</u>。因此，在使用布尔筛选的时候还是应当</strong>优先考虑 loc 的方式</strong></p> </li></ul> 
<pre><code class="prism language-python">df_demo<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">(</span>df_demo<span class="token punctuation">.</span>Weight<span class="token operator">&gt;</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># .values 将布尔的每个值传入索引器</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th align="right"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">Name</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Mei Sun</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Male</td>
<td align="right">89.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Qiang Zheng</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Male</td>
<td align="right">87.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Qiang Han</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Male</td>
<td align="right">87.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Chengpeng Zhou</td>
<td align="right">Fudan University</td>
<td align="right">Senior</td>
<td align="right">Male</td>
<td align="right">81.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Feng Han</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Sophomore</td>
<td align="right">Male</td>
<td align="right">82.0</td>
<td align="right">N</td>
</tr>
</tbody>
</table>
<blockquote> 
 <p>对 <code>Series</code> 而言同样<strong>也可以</strong>通过 iloc 返回相应位置的值或子序列</p> 
</blockquote> 
<h4>
<a id="query_1037"></a>query方法</h4> 
<p>​ pandas可以支持字符串形式传入 <strong><code>query</code></strong> 方法来查询数据，表达式执行结果<strong>必须返回布尔列表</strong></p> 
<p>​ 优点：使用query方法可以无需重复使用<code>DataFrame</code>的列名来索引，但一般使用的代码长度尽量较少(在不降低可读性的前提下)</p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'((School == "Fudan University")&amp;'</span>
            <span class="token string">' (Grade == "Senior")&amp;'</span>
            <span class="token string">' (Weight &gt; 70))|'</span>
            <span class="token string">'((School == "Peking University")&amp;'</span>
            <span class="token string">' (Grade != "Senior")&amp;'</span>
            <span class="token string">' (Weight &gt; 80))'</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right">Name</th>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td align="right">38</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Qiang Han</td>
<td align="right">Male</td>
<td align="right">87.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">66</td>
<td align="right">Fudan University</td>
<td align="right">Senior</td>
<td align="right">Chengpeng Zhou</td>
<td align="right">Male</td>
<td align="right">81.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">99</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changpeng Zhao</td>
<td align="right">Male</td>
<td align="right">83.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">131</td>
<td align="right">Fudan University</td>
<td align="right">Senior</td>
<td align="right">Chengpeng Qian</td>
<td align="right">Male</td>
<td align="right">73.0</td>
<td>Y</td>
</tr>
</tbody>
</table>
<blockquote> 
 <p> 在 query 表达式中，<strong>自动帮用户注册</strong>了所有来自 <code>DataFrame</code> 的<strong>列名</strong>，所有属于该 <code>Series</code> 的方法都可以被调用，和正常的函数调用并没有区别</p> 
</blockquote> 
<p>对于含有空格的列名，需要使用 ‘<code>col name</code>’ 的(加引号)方式进行引用。</p> 
<ul><li>在 query 中还注册了若干英语的字面用法，帮助提高可读性，例如： <strong><code>or, and, or, is in, not in</code></strong>
</li></ul> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>query<span class="token punctuation">(</span>'<span class="token punctuation">(</span>Grade <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"Freshman"</span><span class="token punctuation">,</span> <span class="token string">"Sophomore"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
         			<span class="token keyword">and</span> <span class="token punctuation">(</span>Gender <span class="token operator">==</span> <span class="token string">"Male"</span><span class="token punctuation">)</span>'<span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right">Name</th>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td align="right">2</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Mei Sun</td>
<td align="right">Male</td>
<td align="right">89.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">16</td>
<td align="right">Tsinghua University</td>
<td align="right">Junior</td>
<td align="right">Xiaoqiang Qin</td>
<td align="right">Male</td>
<td align="right">68.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">17</td>
<td align="right">Tsinghua University</td>
<td align="right">Junior</td>
<td align="right">Peng Wang</td>
<td align="right">Male</td>
<td align="right">65.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">18</td>
<td align="right">Tsinghua University</td>
<td align="right">Senior</td>
<td align="right">Xiaofeng Sun</td>
<td align="right">Male</td>
<td align="right">71.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">21</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Xiaopeng Shen</td>
<td align="right">Male</td>
<td align="right">62.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>
<ul><li>在<strong>字符串中出现与列表的比较</strong>时， <code>==</code> 和 <code>!=</code> 分别表示元素<strong>出现在列表或没有出现在列表</strong>，等价于 <code>is in</code> 和 <code>not in</code>
</li></ul> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'Grade == ["Junior", "Senior"]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right">Name</th>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td align="right">2</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Mei Sun</td>
<td align="right">Male</td>
<td align="right">89.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">7</td>
<td align="right">Tsinghua University</td>
<td align="right">Junior</td>
<td align="right">Gaoqiang Qian</td>
<td align="right">Female</td>
<td align="right">50.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">9</td>
<td align="right">Peking University</td>
<td align="right">Junior</td>
<td align="right">Juan Xu</td>
<td align="right">Female</td>
<td align="right">NaN</td>
<td>N</td>
</tr>
<tr>
<td align="right">11</td>
<td align="right">Tsinghua University</td>
<td align="right">Junior</td>
<td align="right">Xiaoquan Lv</td>
<td align="right">Female</td>
<td align="right">43.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">12</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Peng You</td>
<td align="right">Female</td>
<td align="right">48.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>
<ul><li>对于 query 中的字符串，如果要<strong>引用外部变量</strong>，只需在<strong>变量名</strong>前加 <strong><code>@</code></strong> 符号</li></ul> 
<pre><code class="prism language-python">low<span class="token punctuation">,</span> high <span class="token operator">=</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">80</span>
df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'Weight.between(@low, @high)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right">Name</th>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td align="right">1</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changqiang You</td>
<td align="right">Male</td>
<td align="right">70.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">Fudan University</td>
<td align="right">Sophomore</td>
<td align="right">Gaojuan You</td>
<td align="right">Male</td>
<td align="right">74.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">10</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Freshman</td>
<td align="right">Xiaopeng Zhou</td>
<td align="right">Male</td>
<td align="right">74.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">18</td>
<td align="right">Tsinghua University</td>
<td align="right">Senior</td>
<td align="right">Xiaofeng Sun</td>
<td align="right">Male</td>
<td align="right">71.0</td>
<td>N</td>
</tr>
<tr>
<td align="right">35</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Gaoli Zhao</td>
<td align="right">Male</td>
<td align="right">78.0</td>
<td>N</td>
</tr>
</tbody>
</table>
<h4>
<a id="_1115"></a>随机抽样</h4> 
<p>​ 想要对样本或特征进<strong>随机抽样</strong>就可以用 <code>sample</code> 函数</p> 
<pre><code class="prism language-python">sample<span class="token punctuation">(</span>n <span class="token punctuation">,</span> axis <span class="token punctuation">,</span> frac <span class="token punctuation">,</span> replace <span class="token punctuation">,</span> weights<span class="token punctuation">)</span>
	n<span class="token punctuation">:</span>抽样数量  
    axis<span class="token punctuation">:</span>抽样方向<span class="token punctuation">(</span><span class="token number">0</span>为行，<span class="token number">1</span>为列<span class="token punctuation">)</span>
    frac<span class="token punctuation">:</span>抽样比例<span class="token punctuation">(</span><span class="token number">1</span>为<span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">)</span>
    replace<span class="token punctuation">:</span>是否放回<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token operator">/</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    weights<span class="token punctuation">:</span>每个样本抽样的相对概率
</code></pre> 
<pre><code class="prism language-python">df_sample <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'value'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df_sample
</code></pre> 
<table>
<thead><tr>
<th align="right">id</th>
<th align="right">value</th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">a</td>
<td>1</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">b</td>
<td>2</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">c</td>
<td>3</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">d</td>
<td>4</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">e</td>
<td>90</td>
</tr>
</tbody>
</table>
<p>示例：</p> 
<pre><code class="prism language-python">df_sample<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> replace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> weights <span class="token operator">=</span> df_sample<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
    抽样数量为3，有放回，"weights是把vaolue整列的记录数除以整列的和"
'''</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">id</th>
<th align="right">value</th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td align="right">4</td>
<td align="right">e</td>
<td>90</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">e</td>
<td>90</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">e</td>
<td>90</td>
</tr>
</tbody>
</table>
<h2>
<a id="_1158"></a>多级索引</h2> 
<h3>
<a id="_1160"></a>多级索引及其表的结构</h3> 
<ul><li><strong>创建表便于学习</strong></li></ul> 
<pre><code class="prism language-python"><span class="token comment">#先创建一个表，用来示例，之后会讲到</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
multi_index <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_product<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>df<span class="token punctuation">.</span>Gender<span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'School'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 以笛卡尔积创建行索引</span>
multi_column <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_product<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>df<span class="token punctuation">.</span>Grade<span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Indicator'</span><span class="token punctuation">,</span> <span class="token string">'Grade'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 以笛卡尔积创建列索引</span>
df_multi <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>c_<span class="token punctuation">[</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span> <span class="token operator">+</span> <span class="token number">163</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>index <span class="token operator">=</span> multi_index<span class="token punctuation">,</span>columns <span class="token operator">=</span> multi_column<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">#创建表</span>

df_multi
</code></pre> 
<pre><code class="prism language-python">       	Indicator	Height								Weight
        Grade	Freshman	Senior	Sophomore	Junior	Freshman	Senior	Sophomore	Junior
School	Gender								
    A	Female	<span class="token number">171.8</span>		<span class="token number">165.0</span>		<span class="token number">167.9</span>	<span class="token number">174.2</span>	<span class="token number">60.6</span>		<span class="token number">55.1</span>		<span class="token number">63.3</span>		<span class="token number">65.8</span>
        Male	<span class="token number">172.3</span>		<span class="token number">158.1</span>		<span class="token number">167.8</span>	<span class="token number">162.2</span>	<span class="token number">71.2</span>		<span class="token number">71.0</span>		<span class="token number">63.1</span>		<span class="token number">63.5</span>
    B	Female	<span class="token number">162.5</span>		<span class="token number">165.1</span>		<span class="token number">163.7</span>	<span class="token number">170.3</span>	<span class="token number">59.8</span>		<span class="token number">57.9</span>		<span class="token number">56.5</span>		<span class="token number">74.8</span>
        Male	<span class="token number">166.8</span>		<span class="token number">163.6</span>		<span class="token number">165.2</span>	<span class="token number">164.7</span>	<span class="token number">62.5</span>		<span class="token number">62.8</span>		<span class="token number">58.7</span>		<span class="token number">68.9</span>
    C	Female	<span class="token number">170.5</span>		<span class="token number">162.0</span>		<span class="token number">164.6</span>	<span class="token number">158.7</span>	<span class="token number">56.9</span>		<span class="token number">63.9</span>		<span class="token number">60.5</span>		<span class="token number">66.9</span>
        Male	<span class="token number">150.2</span>		<span class="token number">166.3</span>		<span class="token number">167.3</span>	<span class="token number">159.3</span>	<span class="token number">62.4</span>		<span class="token number">59.1</span>		<span class="token number">64.9</span>		<span class="token number">67.1</span>
    D	Female	<span class="token number">174.3</span>		<span class="token number">155.7</span>		<span class="token number">163.2</span>	<span class="token number">162.1</span>	<span class="token number">65.3</span>		<span class="token number">66.5</span>		<span class="token number">61.8</span>		<span class="token number">63.2</span>
        Male	<span class="token number">170.7</span>		<span class="token number">170.3</span>		<span class="token number">163.8</span>	<span class="token number">164.9</span>	<span class="token number">61.6</span>		<span class="token number">63.2</span>		<span class="token number">60.9</span>		<span class="token number">56.4</span>
</code></pre> 
<p>​ 多级索引与单层索引的表一样，具备<strong>元素值，行索引，列索引</strong>三个部分，<u>行索引和列索引</u>都是**<code>MultiIndex</code><strong>类型，只不过索引中的</strong>元素是元组型** 而不是单层索引中的标量</p> 
<ul><li>索引的 <strong>名字和值属性</strong> 分别可以通过 <strong><code>names</code></strong> 和 <strong><code>values</code></strong> 获得</li></ul> 
<pre><code class="prism language-python">df_multi<span class="token punctuation">.</span>index<span class="token punctuation">.</span>names<span class="token comment">#名字就是最外层的索引</span>
</code></pre> 
<pre><code class="prism language-python">FrozenList<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">df_multi<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>names<span class="token comment">#名字就是最外层的索引</span>
</code></pre> 
<pre><code class="prism language-python">FrozenList<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Indicator'</span><span class="token punctuation">,</span> <span class="token string">'Grade'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">df_multi<span class="token punctuation">.</span>index<span class="token punctuation">.</span>values<span class="token comment">#值属性就是里面内层的索引</span>
</code></pre> 
<pre><code class="prism language-python">array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      dtype<span class="token operator">=</span><span class="token builtin">object</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">df_multi<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>values<span class="token comment">#值属性就是里面内层的索引</span>
</code></pre> 
<pre><code class="prism language-python">array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Freshman'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'Weight'</span><span class="token punctuation">,</span> <span class="token string">'Freshman'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Weight'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'Weight'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Weight'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token builtin">object</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>如果想要得到某一层的索引，则需要通过 <code>get_level_values(n)</code>获得</li></ul> 
<pre><code class="prism language-python">df_multi<span class="token punctuation">.</span>index<span class="token punctuation">.</span>get_level_values<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 里面的参数是层数，以0开始</span>
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'School'</span><span class="token punctuation">)</span>
</code></pre> 
<h3>
<a id="loc_1253"></a>多级索引中的loc索引器</h3> 
<pre><code class="prism language-python"><span class="token comment"># 先把索引设置成第一列和第二列</span>
df_multi <span class="token operator">=</span> df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span> <span class="token string">'Grade'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df_multi<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">Name</th>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th align="right"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">School</td>
<td align="right">Grade</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Freshman</td>
<td align="right">Gaopeng Yang</td>
<td align="right">Female</td>
<td align="right">46.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changqiang You</td>
<td align="right">Male</td>
<td align="right">70.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Mei Sun</td>
<td align="right">Male</td>
<td align="right">89.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Fudan University</td>
<td align="right">Sophomore</td>
<td align="right">Xiaojuan Sun</td>
<td align="right">Female</td>
<td align="right">41.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Sophomore</td>
<td align="right">Gaojuan You</td>
<td align="right">Male</td>
<td align="right">74.0</td>
<td align="right">N</td>
<td align="right"></td>
</tr>
</tbody>
</table>
<ul><li>由于多级索引中的单个元素以元组为单位，之前介绍的 <strong><code>loc</code></strong> 和 <strong><code>iloc</code></strong> 方法<strong>可以完全照搬</strong>，只需把<strong>标量的位置替换成对应的元组</strong>
</li></ul> 
<pre><code class="prism language-python">df_sorted <span class="token operator">=</span> df_multi<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#先排序</span>
</code></pre> 
<pre><code class="prism language-python">df_sorted<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Fudan University'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">						Name	Gender	Weight	Transfer
School			Grade				
Fudan University Junior	Yanli You	Female	<span class="token number">48.0</span>	N
				Junior	Chunqiang Chu	Male	<span class="token number">72.0</span>	N
				Junior	Changfeng Lv	Male	<span class="token number">76.0</span>	N
				Junior	Yanjuan Lv	Female	<span class="token number">49.0</span>	NaN
				Junior	Gaoqiang Zhou	Female	<span class="token number">43.0</span>	N
</code></pre> 
<pre><code class="prism language-python">df_sorted<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Fudan University'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'Shanghai Jiao Tong University'</span><span class="token punctuation">,</span> <span class="token string">'Freshman'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">						Name	Gender	Weight	Transfer
School			 Grade				
Fudan University Senior	Chengpeng Zheng	Female	<span class="token number">38.0</span>	N
                Senior	Feng Zhou	Female	<span class="token number">47.0</span>	N
                Senior	Gaomei Lv	Female	<span class="token number">34.0</span>	N
                Senior	Chunli Lv	Female	<span class="token number">56.0</span>	N
                Senior	Chengpeng Zhou	Male	<span class="token number">81.0</span>	N
</code></pre> 
<pre><code class="prism language-python">df_sorted<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df_sorted<span class="token punctuation">.</span>Weight <span class="token operator">&gt;</span> <span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 布尔列表也是可用的</span>
</code></pre> 
<pre><code class="prism language-python">						Name	Gender	Weight	Transfer
School			  Grade				
Fudan University Freshman	Feng Wang	Male	<span class="token number">74.0</span>	N
                 Junior	Chunqiang Chu	Male	<span class="token number">72.0</span>	N
                 Junior	Changfeng Lv	Male	<span class="token number">76.0</span>	N
                 Senior	Chengpeng Zhou	Male	<span class="token number">81.0</span>	N
                 Senior	Chengpeng Qian	Male	<span class="token number">73.0</span>	Y
</code></pre> 
<pre><code class="prism language-python">df_sorted<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'Fudan University'</span><span class="token punctuation">,</span><span class="token string">'Junior'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">					Name	Gender	Weight	Transfer
School			Grade				
Fudan University Junior	Yanli You	Female	<span class="token number">48.0</span>	N
            Junior	Chunqiang Chu	Male	<span class="token number">72.0</span>	N
            Junior	Changfeng Lv	Male	<span class="token number">76.0</span>	N
            Junior	Yanjuan Lv	Female	<span class="token number">49.0</span>	NaN
            Junior	Gaoqiang Zhou	Female	<span class="token number">43.0</span>	N
</code></pre> 
<ul><li>当使用切片时需要注意，在<strong>单级索引中只要切片端点元素是唯一的</strong>，那么就可以进行切片，但在多级索引中,<u><strong>无论元组在索引中是否重复出现，都必须经过排序才能使用切片，否则报错</strong></u>
</li></ul> 
<pre><code class="prism language-python">df_sorted<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Fudan University'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
    ('Fudan University', 'Senior')这是一个整体，代表这些行后面的所有内容(:)
'''</span>
</code></pre> 
<pre><code class="prism language-python">						Name	Gender	Weight	Transfer
School			  Grade				
Fudan University Senior	Chengpeng Zheng	Female	<span class="token number">38.0</span>	N
                 Senior	Feng Zhou	Female	<span class="token number">47.0</span>	N
                 Senior	Gaomei Lv	Female	<span class="token number">34.0</span>	N
                 Senior	Chunli Lv	Female	<span class="token number">56.0</span>	N
                 Senior	Chengpeng Zhou	Male	<span class="token number">81.0</span>	N
</code></pre> 
<pre><code class="prism language-python">df_unique <span class="token operator">=</span> df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span><span class="token string">'Grade'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span> <span class="token string">'Grade'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df_unique<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">Name</th>
<th align="right">Gender</th>
<th align="right">Height</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th align="right">Test_Number</th>
<th align="right">Test_Date</th>
<th align="right">Time_Record</th>
<th align="right"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">School</td>
<td align="right">Grade</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Freshman</td>
<td align="right">Gaopeng Yang</td>
<td align="right">Female</td>
<td align="right">158.9</td>
<td align="right">46.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/10/5</td>
<td align="right">0:04:34</td>
</tr>
<tr>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changqiang You</td>
<td align="right">Male</td>
<td align="right">166.5</td>
<td align="right">70.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/9/4</td>
<td align="right">0:04:20</td>
</tr>
<tr>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Mei Sun</td>
<td align="right">Male</td>
<td align="right">188.9</td>
<td align="right">89.0</td>
<td align="right">N</td>
<td align="right">2</td>
<td align="right">2019/9/12</td>
<td align="right">0:05:22</td>
</tr>
<tr>
<td align="right">Fudan University</td>
<td align="right">Sophomore</td>
<td align="right">Xiaojuan Sun</td>
<td align="right">Female</td>
<td align="right">NaN</td>
<td align="right">41.0</td>
<td align="right">N</td>
<td align="right">2</td>
<td align="right">2020/1/3</td>
<td align="right">0:04:08</td>
</tr>
<tr>
<td align="right">Tsinghua University</td>
<td align="right">Freshman</td>
<td align="right">Xiaoli Qian</td>
<td align="right">Female</td>
<td align="right">158.0</td>
<td align="right">51.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/10/31</td>
<td align="right">0:03:47</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-python">df_unique<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Fudan University'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
    sort_index()先以索引进行排序
    loc[('Fudan University', 'Senior'):] 定位('Fudan University', 'Senior')这一行后输出这一行和后面所有内容
'''</span>
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">Name</th>
<th align="right">Gender</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th align="right"></th>
</tr></thead>
<tbody>
<tr>
<td align="right">School</td>
<td align="right">Grade</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Fudan University</td>
<td align="right">Senior</td>
<td align="right">Chengpeng Zheng</td>
<td align="right">Female</td>
<td align="right">38.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Sophomore</td>
<td align="right">Xiaojuan Sun</td>
<td align="right">Female</td>
<td align="right">41.0</td>
<td align="right">N</td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changqiang You</td>
<td align="right">Male</td>
<td align="right">70.0</td>
<td align="right">N</td>
</tr>
<tr>
<td align="right">Junior</td>
<td align="right">Juan Xu</td>
<td align="right">Female</td>
<td align="right">NaN</td>
<td align="right">N</td>
<td align="right"></td>
</tr>
<tr>
<td align="right">Senior</td>
<td align="right">Changli Lv</td>
<td align="right">Female</td>
<td align="right">41.0</td>
<td align="right">N</td>
<td align="right"></td>
</tr>
</tbody>
</table>
<ul><li>可对多层的元素进行<strong>交叉组合后索引</strong>， 但同时<strong>需要指定 loc 的列</strong> ，全选则用 <code>:</code> 表示。其中，每一层需要选中的元素用列表存放，传入 loc 的形式为 <code>[(level_0_list, level_1_list), cols]</code>
</li></ul> 
<pre><code class="prism language-python">res <span class="token operator">=</span> df_multi<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Peking University'</span><span class="token punctuation">,</span> <span class="token string">'Fudan University'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'Sophomore'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token triple-quoted-string string">'''
    ['Peking University', 'Fudan University']与['Sophomore', 'Junior']都是条件，但是必须指定列
    ['Peking University', 'Fudan University']是第一层索引
    ['Sophomore', 'Junior']是第二层索引
'''</span>
res<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">						Name	Gender	Weight	Transfer
School				Grade				
Peking University Sophomore	Changmei Xu	Female	<span class="token number">43.0</span>	N
                Sophomore	Xiaopeng Qin	Male	NaN	N
                Sophomore	Mei Xu	Female	<span class="token number">39.0</span>	N
                Sophomore	Xiaoli Zhou	Female	<span class="token number">55.0</span>	N
                Sophomore	Peng Han	Female	<span class="token number">34.0</span>	NaN
</code></pre> 
<h3>
<a id="IndexSlice_1422"></a>IndexSlice对象</h3> 
<p>​ 引入 <code>IndexSlice</code> 对象就能解决对<strong>每层进行切片</strong>,也<strong>允许将切片和布尔列表混合使用</strong>这个问题</p> 
<ul><li> <p><strong>Slice</strong> 对象一共有两种形式:</p> <p>​ 第一种为 <strong><code>loc [ idx [ * , * ] ]</code></strong> 型</p> <p>​ 第二种为 <strong><code>loc [ idx [ * , * ] , idx [ * , * ] ]</code></strong> 型</p> </li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 构造一个索引不重复的表来学习</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
L1<span class="token punctuation">,</span>L2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span>
mul_index1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_product<span class="token punctuation">(</span><span class="token punctuation">[</span>L1<span class="token punctuation">,</span>L2<span class="token punctuation">]</span><span class="token punctuation">,</span>names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Upper'</span><span class="token punctuation">,</span> <span class="token string">'Lower'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
L3<span class="token punctuation">,</span>L4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'D'</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">]</span>
mul_index2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_product<span class="token punctuation">(</span><span class="token punctuation">[</span>L3<span class="token punctuation">,</span>L4<span class="token punctuation">]</span><span class="token punctuation">,</span>names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Big'</span><span class="token punctuation">,</span> <span class="token string">'Small'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df_ex <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>index<span class="token operator">=</span>mul_index1<span class="token punctuation">,</span>columns<span class="token operator">=</span>mul_index2<span class="token punctuation">)</span>

df_ex
</code></pre> 
<pre><code class="prism language-python">		Big		D			E			F
		Small	d	e	f	d	e	f	d	e	f
Upper	Lower									
	A		a	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">5</span>
			b	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">8</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>
			c	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">6</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>
	B		a	<span class="token number">8</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>
			b	<span class="token number">2</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">1</span>
			c	<span class="token number">8</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">5</span>	<span class="token number">0</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>
	C		a	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">3</span>
			b	<span class="token number">1</span>	<span class="token number">2</span>	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">5</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">5</span>
			c	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">5</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">6</span>	<span class="token number">4</span>	<span class="token number">7</span>	<span class="token number">8</span>	<span class="token operator">-</span><span class="token number">4</span>
</code></pre> 
<ul><li>为了使用 <strong><code>silce</code></strong> 对象，先要进行定义</li></ul> 
<pre><code class="prism language-python">idx <span class="token operator">=</span> pd<span class="token punctuation">.</span>IndexSlice
</code></pre> 
<ul><li> <p><strong><code>loc [ idx [ * , * ] ]</code></strong> 型</p> <p>​ 这种情况并<strong>不能</strong>进行多层分别切片，前一个 <strong><code>*</code></strong> 表示<strong>行</strong>的选择，后一个 <strong><code>*</code></strong> 表示<strong>列</strong>的选择，与单纯的 <code>loc</code> 是类似的</p> </li></ul> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>idx<span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token triple-quoted-string string">'''
    idx:
        'C'行之后的所有
        ('D', 'f')列之后的所有
    如果不加冒号，这两个都会成为条件
'''</span>
</code></pre> 
<pre><code class="prism language-python">		Big		D	E			F
		Small	f	d	e	f	d	e	f
Upper	Lower							
    C		a	<span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">3</span>
       		b	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">5</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">5</span>
        	c	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">6</span>	<span class="token number">4</span>	<span class="token number">7</span>	<span class="token number">8</span>	<span class="token operator">-</span><span class="token number">4</span>
</code></pre> 
<p>另外，也支持<strong>布尔序列的索引</strong></p> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>idx<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 列和大于0</span>
</code></pre> 
<pre><code class="prism language-python">			Big		D		F
			Small	d	e	e
Upper		Lower			
   A		    a	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token number">9</span>
                b	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">4</span>
                c	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">9</span>
</code></pre> 
<ul><li> <p><strong><code>loc [ idx [ * , * ] , idx [ * , * ] ]</code></strong> 型</p> <p>​ 这种情况<strong>能够分层进行切片</strong>，前一个 <strong><code>idx</code> <strong>指代的是</strong>行</strong>索引，后一个是<strong>列</strong>索引</p> </li></ul> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>idx<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> idx<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token triple-quoted-string string">'''
    :'A' - 第一层行索引切到A   ，  'b': - 第二层行索引从b开始后面的所有(这里被第一层A限制了，所有才只有b,c)
    'E': - 第一层列索引从E开始切到后面所有   ，   'e': - 第二层列索引从e开始切到后面所有(因为第一层切出两个，所以分别从两个的e开始切)
'''</span>
</code></pre> 
<pre><code class="prism language-python">			Big		E		F
			Small	e	f	e	f
Upper		Lower				
	A			b	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>
				c	<span class="token number">6</span>	<span class="token number">6</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>
</code></pre> 
<blockquote> 
 <p><font color="red"><em><strong>此方法不支持使用函数</strong></em></font></p> 
</blockquote> 
<h3>
<a id="_1537"></a>多级索引的构造</h3> 
<p>​ 常用的有 <code>from_tuples , from_arrays , from_product</code>三种方法，他们都是 <strong><code>pd.MultiIndex</code>对象下的函数</strong></p> 
<ul><li>
<code>from_tuples</code>根据传入由<strong>元组组成的列表</strong>进行构造</li></ul> 
<pre><code class="prism language-python">my_tuple <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_tuples<span class="token punctuation">(</span>my_tuple<span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'First'</span><span class="token punctuation">,</span><span class="token string">'Second'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">MultiIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'First'</span><span class="token punctuation">,</span> <span class="token string">'Second'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>
<code>from_arrays</code>根据传入<strong>列表</strong>对相应层进行构造</li></ul> 
<pre><code class="prism language-python">my_array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'aabb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">]</span>
pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_arrays<span class="token punctuation">(</span>my_array<span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'First'</span><span class="token punctuation">,</span><span class="token string">'Second'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">MultiIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'First'</span><span class="token punctuation">,</span> <span class="token string">'Second'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li> <p><code>from_product</code>根据给定多个列表的笛卡尔积进行构造</p> <p>​ <strong>笛卡尔积</strong>: 就是两个列表的每个元素与另一个列表的每个元素相乘(这里是组合)</p> </li></ul> 
<pre><code class="prism language-python">my_list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span>
my_list2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'cat'</span><span class="token punctuation">,</span><span class="token string">'dog'</span><span class="token punctuation">]</span>
pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_product<span class="token punctuation">(</span><span class="token punctuation">[</span>my_list1<span class="token punctuation">,</span>my_list2<span class="token punctuation">]</span><span class="token punctuation">,</span>names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'First'</span><span class="token punctuation">,</span><span class="token string">'Second'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">MultiIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'First'</span><span class="token punctuation">,</span> <span class="token string">'Second'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>##索引的常用方法</p> 
<h3>
<a id="_1599"></a><strong>层</strong>的交换和删除</h3> 
<pre><code class="prism language-python"><span class="token comment">#创建一个3层索引便于学习</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
L1<span class="token punctuation">,</span>L2<span class="token punctuation">,</span>L3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'alpha'</span><span class="token punctuation">,</span><span class="token string">'beta'</span><span class="token punctuation">]</span>
mul_index1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_product<span class="token punctuation">(</span><span class="token punctuation">[</span>L1<span class="token punctuation">,</span>L2<span class="token punctuation">,</span>L3<span class="token punctuation">]</span><span class="token punctuation">,</span>names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Upper'</span><span class="token punctuation">,</span> <span class="token string">'Lower'</span><span class="token punctuation">,</span><span class="token string">'Extra'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
L4<span class="token punctuation">,</span>L5<span class="token punctuation">,</span>L6 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'cat'</span><span class="token punctuation">,</span><span class="token string">'dog'</span><span class="token punctuation">]</span>
mul_index2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_product<span class="token punctuation">(</span><span class="token punctuation">[</span>L4<span class="token punctuation">,</span>L5<span class="token punctuation">,</span>L6<span class="token punctuation">]</span><span class="token punctuation">,</span>names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Big'</span><span class="token punctuation">,</span> <span class="token string">'Small'</span><span class="token punctuation">,</span> <span class="token string">'Other'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df_ex <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>index<span class="token operator">=</span>mul_index1<span class="token punctuation">,</span>columns<span class="token operator">=</span>mul_index2<span class="token punctuation">)</span>

df_ex
</code></pre> 
<pre><code class="prism language-python">                Big		C				D
                Small	c		d		c		d
                Other	cat	dog	cat	dog	cat	dog	cat	dog
Upper	Lower	Extra								
    A		a	alpha	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">9</span>
           		beta	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">8</span>
        	b	alpha	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">6</span>	<span class="token number">6</span>
            	beta	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">8</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>
    B		a	alpha	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">2</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>
            	beta	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">8</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">5</span>
        	b	alpha	<span class="token number">0</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">3</span>
            	beta	<span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">3</span>	<span class="token number">1</span>
</code></pre> 
<p>​ 索引层交换由 <code>swaplevel</code> 和 <code>reorder_levels</code> 完成，前者只能交换<strong>两个层</strong>，而后者可以交换<strong>任意层</strong>，两者都可以<strong>指定交换轴</strong>，即行索引或列索引</p> 
<ul><li>
<code>swaplevel</code> 交换两个层</li></ul> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.swaplevel(i=- 2, j=- 1, axis=0)
    相会交换索引中的i层和j层，默认是交换索引的两个最内层
    参数：        
        i, j： int 或 str
            交换的索引的两个层级。可以将级别名称作为字符串传递。
            
        axis：{0 或 'index'，1 或 'columns'}，默认 0
            交换级别的轴。0 或 'index' 表示按行，1 或 'columns' 表示按列。
'''</span>
</code></pre> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>swaplevel<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 列索引的第一层和第三层交换</span>
</code></pre> 
<pre><code class="prism language-python">                Other	cat	dog	cat	dog	cat	dog	cat	dog
                Small	c	c	d	d	c	c	d	d
                Big		C	C	C	C	D	D	D	D
Upper	Lower	Extra								
    A		a	alpha	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	 <span class="token number">9</span>
            	beta	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>  	 <span class="token number">8</span>
        	b	alpha	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">6</span>	 <span class="token number">6</span>
            	beta	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">8</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>
    B		a	alpha	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">2</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>
</code></pre> 
<ul><li>
<code>reorder_levels</code>交换任意层级</li></ul> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
	DataFrame.reorder_levels(order, axis=0)
	使用输入顺序重新排列索引层级。 不能降低或复制层级
	参数
        order： int列表 或 str的列表
        	代表新级别顺序的列表。通过数字（位置）或按键（标签）来参考水平。

        axis：{0 或 'index'，1 或 'columns'}，默认 0
        	在哪里重新排序级别。
'''</span>
</code></pre> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>reorder_levels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 列表数字指代原来索引中的层</span>
</code></pre> 
<pre><code class="prism language-python">                Big		C				D
                Small	c		d		c		d
                Other	cat	dog	cat	dog	cat	dog	cat	dog
Extra	Upper	Lower								
    alpha	A		a	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">9</span>
    beta	A		a	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">8</span>
    alpha	A		b	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">6</span>	<span class="token number">6</span>
    beta	A		b	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">8</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>
    alpha	B		a	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">2</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>
</code></pre> 
<blockquote> 
 <p><font color="red">这里只涉及 <strong>行或列索引</strong> 内部的交换</font></p> 
</blockquote> 
<ul><li>若想要<strong>删除</strong>某一层的索引，可以使用 <strong><code>droplevel</code></strong> 方法</li></ul> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>droplevel<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">                Big		C				D
                Other	cat	dog	cat	dog	cat	dog	cat	dog
Upper	Lower	Extra								
    A		a	alpha	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">9</span>
            	beta	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">8</span>
        	b	alpha	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">6</span>	<span class="token number">6</span>
            	beta	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">8</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>
    B		a	alpha	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">2</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>
            	beta	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">8</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">5</span>
        	b	alpha	<span class="token number">0</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">3</span>
            	beta	<span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">3</span>	<span class="token number">1</span>
</code></pre> 
<p>###属性的修改</p> 
<ul><li>
<strong><code>rename_axis</code></strong> 可以对<strong>索引层的名字</strong>进行修改，常用的修改方式是传入<strong>字典</strong>的映射</li></ul> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>rename_axis<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'Upper'</span><span class="token punctuation">:</span><span class="token string">'Changed_row'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'Other'</span><span class="token punctuation">:</span><span class="token string">'Changed_Col'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">                Big			C				D
                Small		c		d		c		d
                Changed_Col	cat	dog	cat	dog	cat	dog	cat	dog
Changed_row	Lower	Extra								
        A		a	alpha	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">9</span>
            	    beta	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">8</span>
            	b	alpha	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">6</span>	<span class="token number">6</span>
            	    beta	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">8</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>
        B		a	alpha	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">2</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>
</code></pre> 
<ul><li>
<strong><code>rename</code><strong>可以对</strong>索引的值</strong>进行修改，如果是<strong>多级索引需要指定层号</strong>(level)</li></ul> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'cat'</span><span class="token punctuation">:</span><span class="token string">'not_cat'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>level<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">               	Big		C						D
                Small	c			d			c			d
                Other	not_cat	dog	not_cat	dog	not_cat	dog	not_cat	dog
Upper	Lower	Extra								
    A		a	alpha	<span class="token number">3</span>		<span class="token number">6</span>		<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>		<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>		<span class="token number">0</span>	<span class="token number">9</span>
            	beta	<span class="token operator">-</span><span class="token number">5</span>		<span class="token operator">-</span><span class="token number">3</span>		<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>		<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>		<span class="token number">5</span>	<span class="token number">8</span>
        	b	alpha	<span class="token operator">-</span><span class="token number">4</span>		<span class="token number">4</span>		<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>		<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>		<span class="token number">6</span>	<span class="token number">6</span>
            	beta	<span class="token operator">-</span><span class="token number">9</span>		<span class="token number">9</span>		<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">8</span>		<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>		<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>
    B		a	alpha	<span class="token number">0</span>		<span class="token operator">-</span><span class="token number">9</span>		<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>		<span class="token number">2</span>	<span class="token number">9</span>		<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>
</code></pre> 
<p>​ 也可以给**<code>rename</code><strong>传入</strong>函数**，<strong>其输入的值就是索引</strong></p> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>level<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">                Big		C				D
                Small	c		d		c		d
                Other	cat	dog	cat	dog	cat	dog	cat	dog
Upper	Lower	Extra								
    A		a	ALPHA	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">9</span>
            	BETA	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">8</span>
        	b	ALPHA	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">6</span>	<span class="token number">6</span>
            	BETA	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">8</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>
    B		a	ALPHA	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">2</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>
</code></pre> 
<p>​ 对于整个索引的元素替换，可以利用<strong>迭代器</strong>实现</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    iter():生成迭代器
    next() 返回迭代器的下一个项目
    next() 函数要和生成迭代器的 iter() 函数一起使用
'''</span>
</code></pre> 
<pre><code class="prism language-PYTHON">new_values = iter(list('abcdefgh'))
df_ex.rename(index=lambda x:next(new_values),level=2)
</code></pre> 
<pre><code class="prism language-python">                Big		C				D
                Small	c		d		c		d
                Other	cat	dog	cat	dog	cat	dog	cat	dog
Upper	Lower	Extra								
    A		a		a	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">9</span>
            		b	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">8</span>
        	b		c	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">6</span>	<span class="token number">6</span>
            		d	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">8</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>
    B		a		e	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">2</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>
            		f	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">8</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">5</span>
        	b		g	<span class="token number">0</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">3</span>
            		h	<span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">3</span>	<span class="token number">1</span>
</code></pre> 
<ul><li> <p><strong><code>map</code><strong>达到</strong>更改索引值</strong></p> <p>​ 它是定义在 <strong><code>Index</code></strong> 上的方法</p> <p>​ 它传入的<strong>不是层的标量值</strong>，而是直接<strong>传入索引的元组</strong></p> </li></ul> 
<pre><code class="prism language-python">df_temp <span class="token operator">=</span> df_ex<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
new_idx <span class="token operator">=</span> df_temp<span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_idx<span class="token punctuation">)</span>
<span class="token comment">#Python upper() 方法将字符串中的小写字母转为大写字母。</span>
<span class="token comment">#把index放进map里面运行</span>

df_temp<span class="token punctuation">.</span>index <span class="token operator">=</span> new_idx
df_temp<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">MultiIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'ALPHA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span>  <span class="token string">'BETA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'ALPHA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span>  <span class="token string">'BETA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'ALPHA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span>  <span class="token string">'BETA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'ALPHA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span>  <span class="token string">'BETA'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Upper'</span><span class="token punctuation">,</span> <span class="token string">'Lower'</span><span class="token punctuation">,</span> <span class="token string">'Extra'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

                Big		C				D
                Small	c		d		c		d
                Other	cat	dog	cat	dog	cat	dog	cat	dog
Upper	Lower	Extra								
    A		a	ALPHA	<span class="token number">3</span>	<span class="token number">6</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">9</span>
         	   	BETA	<span class="token operator">-</span><span class="token number">5</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">3</span>	<span class="token operator">-</span><span class="token number">8</span>	<span class="token operator">-</span><span class="token number">3</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token number">5</span>	<span class="token number">8</span>
        	b	ALPHA	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">4</span>	<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">7</span>	<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">6</span>	<span class="token number">6</span>
            	BETA	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">8</span>	<span class="token number">5</span>	<span class="token operator">-</span><span class="token number">2</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token operator">-</span><span class="token number">8</span>
    B		a	ALPHA	<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">2</span>	<span class="token number">9</span>	<span class="token operator">-</span><span class="token number">7</span>	<span class="token operator">-</span><span class="token number">9</span>
</code></pre> 
<h3>
<a id="_1855"></a>设置与重置</h3> 
<pre><code class="prism language-python"><span class="token comment">#构建新表便于学习</span>
df_new <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'A'</span><span class="token punctuation">:</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'aacd'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">:</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'PQRT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df_new
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
</tr></thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">a</td>
<td align="right">P</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">a</td>
<td align="right">Q</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">c</td>
<td align="right">R</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">d</td>
<td align="right">T</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<ul><li> <p><code>set_index</code>设置索引</p> <p>​ 主要参数是<code>append</code>，表示是否保留原来的索引，直接把设定的索引添加到原来的索引内层</p> </li></ul> 
<pre><code class="prism language-python">df_new<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token comment">#直接把A列设置为索引层</span>
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">B</th>
<th align="right">C</th>
</tr></thead>
<tbody>
<tr>
<td align="right">A</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">a</td>
<td align="right">P</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">a</td>
<td align="right">Q</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">c</td>
<td align="right">R</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">d</td>
<td align="right">T</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-python">df_new<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> append<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment">#列索引A被添加到内层</span>
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right"></th>
<th align="right">B</th>
<th align="right">C</th>
</tr></thead>
<tbody>
<tr>
<td align="right"></td>
<td align="right">A</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">0</td>
<td align="right">a</td>
<td align="right">P</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">a</td>
<td align="right">Q</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">c</td>
<td align="right">R</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">d</td>
<td align="right">T</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<p>如果 <strong>想要添加索引的列</strong> 没有出现在其中，那么可以直接在<strong>参数中</strong>传入相应的 <strong>Series</strong></p> 
<pre><code class="prism language-python">my_index <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'WXYZ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'D'</span><span class="token punctuation">)</span>
df_new <span class="token operator">=</span> df_new<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> my_index<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#my_index 插入了列名为D的列</span>
df_new
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right"></th>
<th align="right">B</th>
<th align="right">C</th>
</tr></thead>
<tbody>
<tr>
<td align="right">A</td>
<td align="right">D</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">a</td>
<td align="right">W</td>
<td align="right">P</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">X</td>
<td align="right">Q</td>
<td align="right">2</td>
<td align="right"></td>
</tr>
<tr>
<td align="right">c</td>
<td align="right">Y</td>
<td align="right">R</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">d</td>
<td align="right">Z</td>
<td align="right">T</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<ul><li> <p><code>reset_index</code>重设索引</p> <p>​ 主要参数是<code>drop</code>，表示<strong>是否要把去掉的索引层丢弃，而不是添加到列中</strong></p> </li></ul> 
<pre><code class="prism language-python">df_new<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#没有丢弃去掉的索引，而是从第二层返回到了第一层</span>
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">D</th>
<th align="right">B</th>
<th align="right">C</th>
</tr></thead>
<tbody>
<tr>
<td align="right">A</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">a</td>
<td align="right">W</td>
<td align="right">P</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">a</td>
<td align="right">X</td>
<td align="right">Q</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">c</td>
<td align="right">Y</td>
<td align="right">R</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">d</td>
<td align="right">Z</td>
<td align="right">T</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-python">df_new<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment">#直接丢弃去掉的索引</span>
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">B</th>
<th align="right">C</th>
</tr></thead>
<tbody>
<tr>
<td align="right">A</td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr>
<td align="right">a</td>
<td align="right">P</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">a</td>
<td align="right">Q</td>
<td align="right">2</td>
</tr>
<tr>
<td align="right">c</td>
<td align="right">R</td>
<td align="right">3</td>
</tr>
<tr>
<td align="right">d</td>
<td align="right">T</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<blockquote> 
 <p>如果 reset_index()不加参数 ，就是重置dataframe的索引，由默认索引(0…，A…)代替</p> 
</blockquote> 
<p>###变形</p> 
<ul>
<li> <p><code>reindex</code>更改<strong>行索引</strong></p> </li>
<li> <p><code>reindex_like</code>仿照<strong>传入的表索引作为自己的表索引</strong></p> <p>​ <strong>没有给出值</strong>的用**<code>np.nan</code>**填充</p> </li>
<li> <p><strong><code>reindex</code></strong></p> </li>
</ul> 
<pre><code class="prism language-python">df_reindex <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"Weight"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"Height"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">176</span><span class="token punctuation">,</span><span class="token number">180</span><span class="token punctuation">,</span><span class="token number">179</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'1001'</span><span class="token punctuation">,</span><span class="token string">'1003'</span><span class="token punctuation">,</span><span class="token string">'1002'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'原表'</span><span class="token punctuation">)</span>
df_reindex
</code></pre> 
<p>原表</p> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">Weight</th>
<th align="right">Height</th>
</tr></thead>
<tbody>
<tr>
<td align="right">1001</td>
<td align="right">60</td>
<td align="right">176</td>
</tr>
<tr>
<td align="right">1003</td>
<td align="right">70</td>
<td align="right">180</td>
</tr>
<tr>
<td align="right">1002</td>
<td align="right">80</td>
<td align="right">179</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'修改后'</span><span class="token punctuation">)</span>
df_reindex<span class="token punctuation">.</span>reindex<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'1001'</span><span class="token punctuation">,</span><span class="token string">'1002'</span><span class="token punctuation">,</span><span class="token string">'1003'</span><span class="token punctuation">,</span><span class="token string">'1004'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Weight'</span><span class="token punctuation">,</span><span class="token string">'Gender'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>修改后</p> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">Weight</th>
<th align="right">Gender</th>
</tr></thead>
<tbody>
<tr>
<td align="right">1001</td>
<td align="right">60.0</td>
<td align="right">NaN</td>
</tr>
<tr>
<td align="right">1002</td>
<td align="right">80.0</td>
<td align="right">NaN</td>
</tr>
<tr>
<td align="right">1003</td>
<td align="right">70.0</td>
<td align="right">NaN</td>
</tr>
<tr>
<td align="right">1004</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
</tbody>
</table>
<ul><li><strong><code>reindex_like</code></strong></li></ul> 
<pre><code class="prism language-python">df_existed <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'1001'</span><span class="token punctuation">,</span><span class="token string">'1002'</span><span class="token punctuation">,</span><span class="token string">'1003'</span><span class="token punctuation">,</span><span class="token string">'1004'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Weight'</span><span class="token punctuation">,</span><span class="token string">'Gender'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'原表'</span><span class="token punctuation">)</span>
df_existed
</code></pre> 
<p>原表</p> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">Weight</th>
<th align="right">Gender</th>
</tr></thead>
<tbody>
<tr>
<td align="right">1001</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr>
<td align="right">1002</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr>
<td align="right">1003</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr>
<td align="right">1004</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'修改后'</span><span class="token punctuation">)</span>
df_reindex<span class="token punctuation">.</span>reindex_like<span class="token punctuation">(</span>df_existed<span class="token punctuation">)</span>
</code></pre> 
<p>修改后</p> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">Weight</th>
<th align="right">Gender</th>
</tr></thead>
<tbody>
<tr>
<td align="right">1001</td>
<td align="right">60.0</td>
<td align="right">NaN</td>
</tr>
<tr>
<td align="right">1002</td>
<td align="right">80.0</td>
<td align="right">NaN</td>
</tr>
<tr>
<td align="right">1003</td>
<td align="right">70.0</td>
<td align="right">NaN</td>
</tr>
<tr>
<td align="right">1004</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
</tbody>
</table>
<p>###运算</p> 
<p>​ 经常会有一种利用集合运算来取出符合条件行的需求，对<strong>索引</strong>可以使用<strong>集合</strong>的运算</p> 
<p>​ 由于集合的<strong>元素是互异的</strong>，但是索引中可能有相同的元素，先用 <strong><code>unique</code></strong> <strong>去重</strong>后再进行运算。</p> 
<pre><code class="prism language-python"><span class="token comment"># 创建表</span>
df_set_1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>index <span class="token operator">=</span> pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'id1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df_set_2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>index <span class="token operator">=</span> pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'id2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 去重</span>
id1<span class="token punctuation">,</span> id2 <span class="token operator">=</span> df_set_1<span class="token punctuation">.</span>index<span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> df_set_2<span class="token punctuation">.</span>index<span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>id1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>id2<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'id1'</span><span class="token punctuation">)</span>
Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'id2'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">id1<span class="token punctuation">.</span>intersection<span class="token punctuation">(</span>id2<span class="token punctuation">)</span><span class="token comment">#交集</span>
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">id1<span class="token punctuation">.</span>union<span class="token punctuation">(</span>id2<span class="token punctuation">)</span><span class="token comment">#并集</span>
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">id1<span class="token punctuation">.</span>difference<span class="token punctuation">(</span>id2<span class="token punctuation">)</span><span class="token comment">#返回一个新的Index，其中Index不在给出元组里面</span>
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">id1<span class="token punctuation">.</span>symmetric_difference<span class="token punctuation">(</span>id2<span class="token punctuation">)</span><span class="token comment">#返回两个index中不一样的元素</span>
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>
</code></pre> 
<h2>
<a id="_2103"></a>分组</h2> 
<p>​ 明确三个要素：<strong>分组依据</strong> 、 <strong>数据来源</strong> 、 <strong>操作及其返回结果</strong></p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>分组依据<span class="token punctuation">)</span><span class="token punctuation">[</span>数据来源<span class="token punctuation">]</span><span class="token punctuation">.</span>使用操作
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#读取表演示</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right">Name</th>
<th align="right">Gender</th>
<th align="right">Height</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th align="right">Test_Number</th>
<th align="right">Test_Date</th>
<th align="right">Time_Record</th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Freshman</td>
<td align="right">Gaopeng Yang</td>
<td align="right">Female</td>
<td align="right">158.9</td>
<td align="right">46.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/10/5</td>
<td>0:04:34</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changqiang You</td>
<td align="right">Male</td>
<td align="right">166.5</td>
<td align="right">70.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/9/4</td>
<td>0:04:20</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Senior</td>
<td align="right">Mei Sun</td>
<td align="right">Male</td>
<td align="right">188.9</td>
<td align="right">89.0</td>
<td align="right">N</td>
<td align="right">2</td>
<td align="right">2019/9/12</td>
<td>0:05:22</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">Fudan University</td>
<td align="right">Sophomore</td>
<td align="right">Xiaojuan Sun</td>
<td align="right">Female</td>
<td align="right">NaN</td>
<td align="right">41.0</td>
<td align="right">N</td>
<td align="right">2</td>
<td align="right">2020/1/3</td>
<td>0:04:08</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">Fudan University</td>
<td align="right">Sophomore</td>
<td align="right">Gaojuan You</td>
<td align="right">Male</td>
<td align="right">174.0</td>
<td align="right">74.0</td>
<td align="right">N</td>
<td align="right"></td>
<td align="right"></td>
<td></td>
</tr>
</tbody>
</table>
<pre><code class="prism language-python"><span class="token comment">#按照性别统计身高中位数</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Gender'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Gender
Female    <span class="token number">159.6</span>
Male      <span class="token number">173.4</span>
Name<span class="token punctuation">:</span> Height<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<ul><li>需要根据多个维度进行分组,只需在 <code>groupby</code> 中传入<strong>相应列名构成的列表</strong>即可</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 根据学校和性别进行分组</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">School                         Gender
Fudan University               Female    <span class="token number">158.776923</span>
                               Male      <span class="token number">174.212500</span>
Peking University              Female    <span class="token number">158.666667</span>
                               Male      <span class="token number">172.030000</span>
Shanghai Jiao Tong University  Female    <span class="token number">159.122500</span>
                               Male      <span class="token number">176.760000</span>
Tsinghua University            Female    <span class="token number">159.753333</span>
                               Male      <span class="token number">171.638889</span>
Name<span class="token punctuation">:</span> Height<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<ul><li>也可以通过<strong>条件</strong>进行分组</li></ul> 
<pre><code class="prism language-python">condition <span class="token operator">=</span> df<span class="token punctuation">.</span>Weight <span class="token operator">&gt;</span> df<span class="token punctuation">.</span>Weight<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Weight
<span class="token boolean">False</span>    <span class="token number">159.034646</span>
<span class="token boolean">True</span>     <span class="token number">172.705357</span>
Name<span class="token punctuation">:</span> Height<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<ul><li>由此可以看出是以分组依据的<code>unique</code>值来分组，<strong>传入的序列都会被去重</strong>
</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 通过 drop_duplicates 就能知道具体的组类别</span>
df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right"></th>
<th align="right">School</th>
<th align="right">Gender</th>
</tr></thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Female</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">Peking University</td>
<td align="right">Male</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">Shanghai Jiao Tong University</td>
<td align="right">Male</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">Fudan University</td>
<td align="right">Female</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">Fudan University</td>
<td align="right">Male</td>
</tr>
<tr>
<td align="right">5</td>
<td align="right">Tsinghua University</td>
<td align="right">Female</td>
</tr>
<tr>
<td align="right">9</td>
<td align="right">Peking University</td>
<td align="right">Female</td>
</tr>
<tr>
<td align="right">16</td>
<td align="right">Tsinghua University</td>
<td align="right">Male</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-python">df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'Gender'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#以上方去去重字段分组</span>
</code></pre> 
<pre><code class="prism language-python">School                         Gender
Fudan University               Female    <span class="token number">158.776923</span>
                               Male      <span class="token number">174.212500</span>
Peking University              Female    <span class="token number">158.666667</span>
                               Male      <span class="token number">172.030000</span>
Shanghai Jiao Tong University  Female    <span class="token number">159.122500</span>
                               Male      <span class="token number">176.760000</span>
Tsinghua University            Female    <span class="token number">159.753333</span>
                               Male      <span class="token number">171.638889</span>
Name<span class="token punctuation">:</span> Height<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>###Groupby对象</p> 
<p>​ 可以先将分组依据定义成对象</p> 
<pre><code class="prism language-python">gb <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'School'</span><span class="token punctuation">,</span> <span class="token string">'Grade'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
gb
</code></pre> 
<pre><code class="prism language-python"><span class="token operator">&lt;</span>pandas<span class="token punctuation">.</span>core<span class="token punctuation">.</span>groupby<span class="token punctuation">.</span>generic<span class="token punctuation">.</span>DataFrameGroupBy <span class="token builtin">object</span> at <span class="token number">0x000001C2A65BD420</span><span class="token operator">&gt;</span>
</code></pre> 
<ul><li>
<code>ngroups</code>属性获取分组个数</li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>ngroups
</code></pre> 
<pre><code class="prism language-python"><span class="token number">16</span>
</code></pre> 
<ul><li>
<code>groups</code>获取 <strong>组名映射到主索引列表</strong> 的字典</li></ul> 
<pre><code class="prism language-python">res <span class="token operator">=</span> gb<span class="token punctuation">.</span>groups
res<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 字典的值由于是索引，元素个数过多，此处只展示字典的键</span>
</code></pre> 
<pre><code class="prism language-python">dict_keys<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Fudan University'</span><span class="token punctuation">,</span> <span class="token string">'Freshman'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Fudan University'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Fudan University'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Fudan University'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Peking University'</span><span class="token punctuation">,</span> <span class="token string">'Freshman'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Peking University'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Peking University'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Peking University'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Shanghai Jiao Tong University'</span><span class="token punctuation">,</span> <span class="token string">'Freshman'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Shanghai Jiao Tong University'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Shanghai Jiao Tong University'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Shanghai Jiao Tong University'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Tsinghua University'</span><span class="token punctuation">,</span> <span class="token string">'Freshman'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Tsinghua University'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Tsinghua University'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Tsinghua University'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>
<code>size</code><strong>统计每个组的元素个数</strong>(在DataFrame中是<strong>表长乘表宽</strong>)</li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">School                         Grade    
Fudan University               Freshman      <span class="token number">9</span>
                               Junior       <span class="token number">12</span>
                               Senior       <span class="token number">11</span>
                               Sophomore     <span class="token number">8</span>
Peking University              Freshman     <span class="token number">13</span>
                               Junior        <span class="token number">8</span>
                               Senior        <span class="token number">8</span>
                               Sophomore     <span class="token number">5</span>
Shanghai Jiao Tong University  Freshman     <span class="token number">13</span>
                               Junior       <span class="token number">17</span>
                               Senior       <span class="token number">22</span>
                               Sophomore     <span class="token number">5</span>
Tsinghua University            Freshman     <span class="token number">17</span>
                               Junior       <span class="token number">22</span>
                               Senior       <span class="token number">14</span>
                               Sophomore    <span class="token number">16</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<ul><li>
<code>get_group</code>直接获取所在组对应的行，<strong>必须给出组的具体名字</strong>
</li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>get_group<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Peking University'</span><span class="token punctuation">,</span> <span class="token string">'Freshman'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<table>
<thead><tr>
<th align="right">School</th>
<th align="right">Grade</th>
<th align="right">Name</th>
<th align="right">Gender</th>
<th align="right">Height</th>
<th align="right">Weight</th>
<th align="right">Transfer</th>
<th align="right">Test_Number</th>
<th align="right">Test_Date</th>
<th align="right">Time_Record</th>
<th></th>
</tr></thead>
<tbody>
<tr>
<td align="right">1</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changqiang You</td>
<td align="right">Male</td>
<td align="right">166.5</td>
<td align="right">70.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/9/4</td>
<td>0:04:20</td>
</tr>
<tr>
<td align="right">32</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Gaopeng Shi</td>
<td align="right">Female</td>
<td align="right">162.9</td>
<td align="right">48.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/9/12</td>
<td>0:04:58</td>
</tr>
<tr>
<td align="right">35</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Gaoli Zhao</td>
<td align="right">Male</td>
<td align="right">175.4</td>
<td align="right">78.0</td>
<td align="right">N</td>
<td align="right">2</td>
<td align="right">2019/10/8</td>
<td>0:03:32</td>
</tr>
<tr>
<td align="right">36</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Xiaojuan Qin</td>
<td align="right">Male</td>
<td align="right">NaN</td>
<td align="right">79.0</td>
<td align="right">Y</td>
<td align="right">1</td>
<td align="right">2019/12/10</td>
<td>0:04:10</td>
</tr>
<tr>
<td align="right">38</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Qiang Han</td>
<td align="right">Male</td>
<td align="right">185.3</td>
<td align="right">87.0</td>
<td align="right">N</td>
<td align="right">3</td>
<td align="right">2020/1/7</td>
<td>0:03:58</td>
</tr>
<tr>
<td align="right">45</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Quan Chu</td>
<td align="right">Female</td>
<td align="right">154.7</td>
<td align="right">43.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/11/28</td>
<td>0:04:47</td>
</tr>
<tr>
<td align="right">54</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Xiaojuan Chu</td>
<td align="right">Male</td>
<td align="right">162.4</td>
<td align="right">58.0</td>
<td align="right">Y</td>
<td align="right">3</td>
<td align="right">2019/11/29</td>
<td>0:03:42</td>
</tr>
<tr>
<td align="right">57</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changquan Chu</td>
<td align="right">Female</td>
<td align="right">159.6</td>
<td align="right">45.0</td>
<td align="right">N</td>
<td align="right">2</td>
<td align="right">2019/12/9</td>
<td>0:04:18</td>
</tr>
<tr>
<td align="right">88</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Xiaopeng Han</td>
<td align="right">Female</td>
<td align="right">164.1</td>
<td align="right">53.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/12/18</td>
<td>0:05:20</td>
</tr>
<tr>
<td align="right">96</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changmei Feng</td>
<td align="right">Female</td>
<td align="right">163.8</td>
<td align="right">56.0</td>
<td align="right">N</td>
<td align="right">3</td>
<td align="right">2019/11/8</td>
<td>0:04:41</td>
</tr>
<tr>
<td align="right">99</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Changpeng Zhao</td>
<td align="right">Male</td>
<td align="right">181.3</td>
<td align="right">83.0</td>
<td align="right">N</td>
<td align="right">2</td>
<td align="right">2019/10/24</td>
<td>0:04:08</td>
</tr>
<tr>
<td align="right">140</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Qiang Zhang</td>
<td align="right">Female</td>
<td align="right">152.7</td>
<td align="right">43.0</td>
<td align="right">N</td>
<td align="right">1</td>
<td align="right">2019/11/30</td>
<td>0:05:27</td>
</tr>
<tr>
<td align="right">185</td>
<td align="right">Peking University</td>
<td align="right">Freshman</td>
<td align="right">Chunmei Wang</td>
<td align="right">Female</td>
<td align="right">151.2</td>
<td align="right">43.0</td>
<td align="right">N</td>
<td align="right">2</td>
<td align="right">2019/12/10</td>
<td>0:04:24</td>
</tr>
</tbody>
</table>
<h3>
<a id="_2312"></a>聚合函数</h3> 
<p>​ <strong>内置聚合函数</strong></p> 
<pre><code class="prism language-python"><span class="token builtin">max</span><span class="token operator">/</span><span class="token builtin">min</span><span class="token operator">/</span>mean<span class="token operator">/</span>median<span class="token operator">/</span>count<span class="token operator">/</span><span class="token builtin">all</span><span class="token operator">/</span><span class="token builtin">any</span><span class="token operator">/</span>idxmax<span class="token operator">/</span>idxmin
mad<span class="token operator">/</span>nunique<span class="token operator">/</span>skew<span class="token operator">/</span>quantile<span class="token operator">/</span><span class="token builtin">sum</span><span class="token operator">/</span>std<span class="token operator">/</span>var<span class="token operator">/</span>sem<span class="token operator">/</span>size<span class="token operator">/</span>prod 
</code></pre> 
<pre><code class="prism language-python">gb <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Gender'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">]</span>
</code></pre> 
<ul><li>
<code>quantile</code>给定数据的<strong>四分位数</strong>
</li></ul> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    所谓四分位数；即把数值由小到大排列并分成四等份，处于三个分割点位置的数值就是四分位数。

    第1四分位数 (Q1)，又称“较小四分位数”，等于该样本中所有数值由小到大排列后第25%的数字。
    第2四分位数 (Q2)，又称“中位数”，等于该样本中所有数值由小到大排列后第50%的数字。
    第3四分位数 (Q3)，又称“较大四分位数”，等于该样本中所有数值由小到大排列后第75%的数字。
'''</span>
</code></pre> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.95</span><span class="token punctuation">)</span><span class="token comment">#给定数据(数组元素)的分位数</span>
</code></pre> 
<ul><li>这些聚合函数当传入的数据来源<strong>包含多个列</strong>时，将按照<strong>列</strong>进行<strong>迭代</strong>计算</li></ul> 
<pre><code class="prism language-python">gb <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Gender'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
gb<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">		Height	Weight
Gender		
Female	<span class="token number">170.2</span>	<span class="token number">63.0</span>
Male	<span class="token number">193.9</span>	<span class="token number">89.0</span>
</code></pre> 
<blockquote> 
 <p><font color="red"><strong>groupby对象必须聚合后才会输出DataFrame</strong></font></p> 
</blockquote> 
<h3>
<a id="agg_2363"></a>agg方法</h3> 
<p>​ 传入函数并运行的是<strong>数据源</strong></p> 
<ul><li> <p>使用<strong>多个函数</strong></p> <p>​ 当使用多个聚合函数时，需要用<strong>列表的形式</strong>把内置聚合函数<strong>对应的字符串传入</strong>，先前提到的所有字符串都是合法的</p> </li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'idxmax'</span><span class="token punctuation">,</span> <span class="token string">'skew'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">       Height					Weight
        <span class="token builtin">sum</span>		idxmax	skew	 	<span class="token builtin">sum</span>	  idxmax	skew
Gender						
Female	<span class="token number">21014.0</span>	 <span class="token number">28</span> 	<span class="token operator">-</span><span class="token number">0.219253</span>	<span class="token number">6469.0</span>	<span class="token number">28</span>	<span class="token operator">-</span><span class="token number">0.268482</span>
Male	<span class="token number">8854.9</span>	 <span class="token number">193</span>	<span class="token number">0.437535</span>	<span class="token number">3929.0</span>	<span class="token number">2</span>	<span class="token operator">-</span><span class="token number">0.332393</span>
</code></pre> 
<blockquote> 
 <p>从结果看，此时列索引为多级索引，第一层为数据源，第二层为使用的聚合方法，分别逐一队列使用聚合，因此结果为6列</p> 
</blockquote> 
<ul><li> <p><strong>对特定的列使用特定的聚合函数</strong></p> <p>​ 通过构造<strong>字典</strong>传入 agg 中实现</p> <p>​ <strong>列名为键，聚合字符串或字符串列表为值</strong></p> </li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Height'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'mean'</span><span class="token punctuation">,</span><span class="token string">'max'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">:</span><span class="token string">'count'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">#列名为键，聚合字符串为值，但是这里只是数据来源，不是分组依据，还是对性别进行分组</span>
</code></pre> 
<pre><code class="prism language-python">        Height				Weight
         mean		<span class="token builtin">max</span>		count
Gender			
Female	<span class="token number">159.19697</span>	<span class="token number">170.2</span>	<span class="token number">135</span>
Male	<span class="token number">173.62549</span>	<span class="token number">193.9</span>	<span class="token number">54</span>		
</code></pre> 
<ul><li> <p><strong>自定义函数</strong></p> <p>​ 必须注意传入函数的<strong>参数是之前数据源中的列，逐列进行计算</strong></p> </li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>x<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Height	Weight
Gender		
Female	<span class="token number">13.79697</span>	<span class="token number">13.918519</span>
Male	<span class="token number">17.92549</span>	<span class="token number">21.759259</span>
</code></pre> 
<p>​ 由于传入的是<strong>列</strong>，因此列上的<strong>方法和属性都是可以在函数中使用的</strong>，只需保证返回值是<strong>标量</strong>即可</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">my_func</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#传入的是列</span>
    res <span class="token operator">=</span> <span class="token string">'High'</span>
    <span class="token keyword">if</span> s<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> df<span class="token punctuation">[</span>s<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> <span class="token string">'Low'</span>
    <span class="token keyword">return</span> res

gb<span class="token punctuation">.</span>agg<span class="token punctuation">(</span>my_func<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">		Height	Weight
Gender		
Female	Low		Low
Male	High	High
</code></pre> 
<ul><li><strong>聚合结果的重命名</strong></li></ul> 
<p>  只需将上述<strong>函数的位置改写成元组</strong>，元组<strong>第一个元素为新名字</strong>，<strong>第二个位置为原来的函数</strong>，也可以使用<strong>聚合字符串和自定义函数</strong></p> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'range'</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>x<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        	<span class="token punctuation">(</span><span class="token string">'my_sum'</span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">		Height			Weight
		<span class="token builtin">range</span>	my_sum	<span class="token builtin">range</span>	my_sum
Gender				
Female	<span class="token number">24.8</span>	<span class="token number">21014.0</span>	<span class="token number">29.0</span>	<span class="token number">6469.0</span>
Male	<span class="token number">38.2</span>	<span class="token number">8854.9</span>	<span class="token number">38.0</span>	<span class="token number">3929.0</span>
</code></pre> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Height'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'my_func'</span><span class="token punctuation">,</span> my_func<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'Weight'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">#Height对应两个聚合的元素</span>
</code></pre> 
<pre><code class="prism language-python">		Height				Weight
		my_func		<span class="token builtin">sum</span>		<span class="token operator">&lt;</span><span class="token keyword">lambda</span><span class="token operator">&gt;</span>
Gender			
Female	Low			<span class="token number">21014.0</span>		<span class="token number">63.0</span>
Male	High		<span class="token number">8854.9</span>		<span class="token number">89.0</span>
</code></pre> 
<ul><li>使用对一个或者多个列使用<strong>单个聚合</strong>的时，<strong>重命名需要加方括号</strong>
</li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'my_sum'</span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#必须加中括号</span>
</code></pre> 
<pre><code class="prism language-python">		Height	Weight
		my_sum	my_sum
Gender		
Female	<span class="token number">21014.0</span>	<span class="token number">6469.0</span>
Male	<span class="token number">8854.9</span>	<span class="token number">3929.0</span>
</code></pre> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Height'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'my_func'</span><span class="token punctuation">,</span> my_func<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'Weight'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'range'</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">		Height				Weight
		my_func		<span class="token builtin">sum</span>		<span class="token builtin">range</span>
Gender			
Female	Low		<span class="token number">21014.0</span>		<span class="token number">63.0</span>
Male	High	<span class="token number">8854.9</span>		<span class="token number">89.0</span>	
</code></pre> 
<h3>
<a id="_2509"></a>变换和过滤</h3> 
<pre><code class="prism language-python"><span class="token comment">#初始化</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>
    <span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">)</span>
gb <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Gender'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<h4>
<a id="transform_2518"></a>transform方法</h4> 
<p>​ 传入的是<strong>数据源</strong>(与agg相同),按照<strong>列</strong>进行计算，且<strong>不能通过传入字典来对指定列</strong>使用特定的变换，运行完成后将其给<code>DataFrame</code>填充</p> 
<p>最常用的内置变换函数是<strong>累计函数</strong>:</p> 
<p>​ <code>cumcount / cumsum / cumprod / cummax / cummin</code></p> 
<p>​ <strong>transform方法与这些是一样的</strong></p> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>cummax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#返回一个DataFrame或Series轴上的累积最大值</span>
</code></pre> 
<pre><code class="prism language-python">	Height	Weight
<span class="token number">0</span>	<span class="token number">158.9</span>	<span class="token number">46.0</span>
<span class="token number">1</span>	<span class="token number">166.5</span>	<span class="token number">70.0</span>
<span class="token number">2</span>	<span class="token number">188.9</span>	<span class="token number">89.0</span>
<span class="token number">3</span>	NaN		<span class="token number">46.0</span>
<span class="token number">4</span>	<span class="token number">188.9</span>	<span class="token number">89.0</span>
</code></pre> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrameGroupBy.transform(func,*args,engine = None,engine_kwargs = None,** kwargs)
        func:函数
        
        *args:传入函数从参数
        
        engine：引擎 默认None
            'cython'：通过 cython 的 C 扩展运行函数。
            'numba': 通过从 numba.JIT 编译的代码运行函数。
            None：默认为'cython'或全局设置compute.use_numba

        engine_kwargs字典，默认None
            对于'cython'引擎，不接受engine_kwargs
                如果engine默认，那就不能接收字典
            对于'numba'引擎，引擎可以接受nopython,nogil 和parallel字典键。
                这些值必须是True或 False。引擎 的默认值engine_kwargs是并将应用
                于函数'numba'{'nopython': True, 'nogil': False, 'parallel': 
                False}
'''</span>
</code></pre> 
<p>示例:</p> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token operator">-</span>x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>x<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">		Height	Weight
<span class="token number">0</span>	<span class="token operator">-</span><span class="token number">0.058760</span>	<span class="token operator">-</span><span class="token number">0.354888</span>
<span class="token number">1</span>	<span class="token operator">-</span><span class="token number">1.010925</span>	<span class="token operator">-</span><span class="token number">0.355000</span>
<span class="token number">2</span>	<span class="token number">2.167063</span>	<span class="token number">2.089498</span>
<span class="token number">3</span>		NaN		<span class="token operator">-</span><span class="token number">1.279789</span>
<span class="token number">4</span>	<span class="token number">0.053133</span>	<span class="token number">0.159631</span>
</code></pre> 
<ul><li>
<code>transform</code>只能返回<strong>同长度的序列</strong>，实际上也可以返回<strong>标量</strong>(函数运行后返回单个值)，这会使得<strong>结果会被广播道整个组</strong>
</li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token string">'mean'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 传入返回标量的函数也是可以的</span>
<span class="token comment">#因为mean是平均值函数返回的是单值，在transform的作用下就会广播成每组求平均值后返回</span>
</code></pre> 
<h4>
<a id="transformagg_2593"></a>transform与agg的区别</h4> 
<ul><li>transform的<strong>数据是填充到分组对象的每列上</strong>，agg只是生成了一个<strong>最终的聚合结果</strong>
</li></ul> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>
    <span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">)</span>
gb <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Gender'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p><strong>transform</strong>:</p> 
<pre><code class="prism language-python">transform <span class="token operator">=</span> gb<span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token string">'mean'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">        Height     Weight
<span class="token number">0</span>    <span class="token number">159.19697</span>  <span class="token number">47.918519</span>
<span class="token number">1</span>    <span class="token number">173.62549</span>  <span class="token number">72.759259</span>
<span class="token number">2</span>    <span class="token number">173.62549</span>  <span class="token number">72.759259</span>
<span class="token number">3</span>    <span class="token number">159.19697</span>  <span class="token number">47.918519</span>
<span class="token number">4</span>    <span class="token number">173.62549</span>  <span class="token number">72.759259</span>

<span class="token triple-quoted-string string">'''
	数据来源是['Height', 'Weight']，但是结果没有给出分组依据，而是把聚合结果直接填充到Gender对应的位置上(Female,Male对应的行填充了对应的值)
'''</span>
</code></pre> 
<p><strong>agg</strong>:</p> 
<pre><code class="prism language-python">agg <span class="token operator">=</span> gb<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token string">'mean'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">           Height     Weight
Gender                      
Female  <span class="token number">159.19697</span>  <span class="token number">47.918519</span>
Male    <span class="token number">173.62549</span>  <span class="token number">72.759259</span>

<span class="token triple-quoted-string string">'''
	直接返回分组结果，不会把值进行每行填充，所以它也不具备直接添加进源DataFrame的功能
'''</span>
</code></pre> 
<blockquote> 
 <p><strong>agg不具备直接添加进源表的功能，transform可以直接添加</strong></p> 
</blockquote> 
<h4>
<a id="_2643"></a>组索引与过滤</h4> 
<p>​ groupby对象中定义了**<code>filter</code><strong>函数进行</strong>组的筛选**，传入的参数也是<strong>数据源</strong>,参数中的<strong>函数只允许返回布尔值</strong></p> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrameGroupBy.filter(func, dropna=True, *args, **kwargs)
    返回DataFrame的副本，不包括过滤的元素。如果组中的元素为False，则会过滤。 
    参数：
        func:函数,返回True/False
        dropna：丢弃为False的组。默认为True
    返回：DataFrame
'''</span>
</code></pre> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>#####apply</p> 
<p> 在设计上， apply 的自定义函数传入参数与 <code>filter</code> <strong>完全一致</strong>，<strong>只不过后者只允许返回布尔值</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 人体的BMI指标</span>
<span class="token keyword">def</span> <span class="token function">BMI</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Height <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">100</span>
    Weight <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'Weight'</span><span class="token punctuation">]</span>
    BMI_value <span class="token operator">=</span> Weight<span class="token operator">/</span>Height<span class="token operator">**</span><span class="token number">2</span>
    <span class="token keyword">return</span> BMI_value<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

gb<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>BMI<span class="token punctuation">)</span>
</code></pre> 
<p>​ <strong>apply函数根据返回值情况来输出不同的结果</strong></p> 
<ul><li> <p><strong>1：返回标量</strong></p> <p>​ 得到结果的是 <code>Series</code> ，索引与 <code>agg</code> 的结果一致</p> </li></ul> 
<pre><code class="prism language-python">gb <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Gender'</span><span class="token punctuation">,</span><span class="token string">'Test_Number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">,</span><span class="token string">'Weight'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
gb<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Gender  Test_Number
Female  <span class="token number">1</span>              <span class="token number">0</span>
        <span class="token number">2</span>              <span class="token number">0</span>
        <span class="token number">3</span>              <span class="token number">0</span>
Male    <span class="token number">1</span>              <span class="token number">0</span>
        <span class="token number">2</span>              <span class="token number">0</span>
        <span class="token number">3</span>              <span class="token number">0</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 虽然是列表，但是作为返回值仍然看作标量</span>
</code></pre> 
<pre><code class="prism language-python">Gender  Test_Number
Female  <span class="token number">1</span>              <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token number">2</span>              <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token number">3</span>              <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
Male    <span class="token number">1</span>              <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token number">2</span>              <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token number">3</span>              <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<ul><li> <p>返回Series</p> <p>​ 得到结果是 <code>DataFrame</code> ，行索引与<strong>标量</strong>情况一致，列索引为 <strong>Series 的索引</strong></p> </li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">					a	b
Gender	Test_Number		
Female			<span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">0</span>
				<span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">0</span>
				<span class="token number">3</span>	<span class="token number">0</span>	<span class="token number">0</span>
Male			<span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">0</span>
				<span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">0</span>
				<span class="token number">3</span>	<span class="token number">0</span>	<span class="token number">0</span>
</code></pre> 
<ul><li> <p>返回DataFrame</p> <p>​ 得到结果是 <code>DataFrame</code> ，行索引最内层在每个组原先 agg 的结果索引上，再加一层返回的 DataFrame 行索引，同时分组结果 DataFrame 的列索引和返回的 DataFrame 列索引一致</p> </li></ul> 
<pre><code class="prism language-python">gb<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>columns<span class="token operator">=</span>pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'w'</span><span class="token punctuation">,</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">						w	y
						x	z
Gender	Test_Number			
Female			<span class="token number">1</span>	a	<span class="token number">1.0</span>	<span class="token number">1.0</span>
					b	<span class="token number">1.0</span>	<span class="token number">1.0</span>
				<span class="token number">2</span>	a	<span class="token number">1.0</span>	<span class="token number">1.0</span>
					b	<span class="token number">1.0</span>	<span class="token number">1.0</span>
				<span class="token number">3</span>	a	<span class="token number">1.0</span>	<span class="token number">1.0</span>
					b	<span class="token number">1.0</span>	<span class="token number">1.0</span>
Male			<span class="token number">1</span>	a	<span class="token number">1.0</span>	<span class="token number">1.0</span>
					b	<span class="token number">1.0</span>	<span class="token number">1.0</span>
				<span class="token number">2</span>	a	<span class="token number">1.0</span>	<span class="token number">1.0</span>
					b	<span class="token number">1.0</span>	<span class="token number">1.0</span>
				<span class="token number">3</span>	a	<span class="token number">1.0</span>	<span class="token number">1.0</span>
					b	<span class="token number">1.0</span>	<span class="token number">1.0</span>
</code></pre> 
<blockquote> 
 <p>最后需要强调的是， apply 函数的灵活性是以牺牲一定性能为代价换得的，除非需要使用跨列处理的分组处理，否则应当使用其他专门设计的 groupby 对象方法，否则在性能上会存在较大的差距。同时，在使用聚合函数和变换函数时，也应当优先使用内置函数，它们经过了高度的性能优化，一般而言在速度上都会快于用自定义函数来实现。</p> 
</blockquote> 
<h2>
<a id="_2775"></a>变形</h2> 
<h3>
<a id="_2777"></a>长宽表的变形</h3> 
<p>​ <strong>所有的变形都是Excel的数据透视表</strong></p> 
<p>概念：</p> 
<p>​ 一个表<strong>把数据存入列</strong>中，他就是<strong>关于列的长表</strong></p> 
<p>​ 一个表把数据作为列名，<strong>列中的元素是与这个列相关的特征数值</strong>，他就是<strong>关于列名的宽表</strong></p> 
<pre><code class="prism language-python">a <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Gender'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Height'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">#长表</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Height: F'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Height: M'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">#宽表</span>
</code></pre> 
<pre><code class="prism language-python"> 	 Gender  Height
<span class="token number">0</span>      F     <span class="token number">163</span>
<span class="token number">1</span>      F     <span class="token number">160</span>
<span class="token number">2</span>      M     <span class="token number">175</span>
<span class="token number">3</span>      M     <span class="token number">180</span>

	Height<span class="token punctuation">:</span> F	Height<span class="token punctuation">:</span> M
<span class="token number">0</span>	<span class="token number">163</span>			<span class="token number">175</span>
<span class="token number">1</span>	<span class="token number">160</span>			<span class="token number">180</span>
</code></pre> 
<blockquote> 
 <p>显然这两张表从信息上是完全等价的，它们包含相同的身高统计数值，只是这些数值的呈现方式不同，而其呈现方式主要又与性别一列选择的布局模式有关，即到底是以 long 的状态存储还是以 wide 的状态存储。因此， pandas 针对此类长宽表的变形操作设计了一些有关的变形函数。</p> 
</blockquote> 
<h4>
<a id="_2809"></a>变形函数</h4> 
<p>#####长表变宽表</p> 
<ul><li>
<strong><code>pivot</code></strong> <strong>长表变宽表</strong>
</li></ul> 
<p>参数:</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.pivot(index=None, columns=None, values=None)
    根据列值重塑数据(生成一个“透视”表)。 使用来自指定索引/列的唯一值来形成结果DataFrame的轴，此函数不支持数据聚合
    参数：
        index：str 或 object 或 list(str) 可选
            用作于新表的行索引。如果没有，则使用现有索引
        
        columns：str 或 object 或 list(str)
            用作于新表的列索引

        values：str 或 object 或 前面的列表 可选
            用作于新表的值 如果没有指定，将使用所有剩余的列，并且结果将具有分层索引的列

        return：返回重构的 DataFrame
'''</span>
</code></pre> 
<p>创建表便于学习</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Class'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span><span class="token string">'Si Li'</span><span class="token punctuation">,</span><span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Subject'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'Chinese'</span><span class="token punctuation">,</span><span class="token string">'Math'</span><span class="token punctuation">,</span><span class="token string">'Chinese'</span><span class="token punctuation">,</span><span class="token string">'Math'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Grade'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">85</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df
</code></pre> 
<pre><code class="prism language-python">	Class	<span class="token class-name">Name</span>	Subject	Grade
<span class="token number">0</span>	<span class="token number">1</span>	San Zhang	Chinese	<span class="token number">80</span>
<span class="token number">1</span>	<span class="token number">1</span>	San Zhang	Math	<span class="token number">75</span>
<span class="token number">2</span>	<span class="token number">2</span>	Si Li		Chinese	<span class="token number">90</span>
<span class="token number">3</span>	<span class="token number">2</span>	Si Li		Math	<span class="token number">85</span>
</code></pre> 
<p>变形最重要的三个要素：</p> 
<p>​ <strong>变形后的行索引、需要转到列索引的列，以及这些列和行索引对应的数值</strong></p> 
<p>他们分别对应了<code>pivot</code>方法中</p> 
<p>​ <code>index,columns,values</code>参数</p> 
<p>​ <strong>列索引</strong>是<code>column</code>对应的列的 <strong>唯一值(unique)</strong></p> 
<p>​ <strong>行索引</strong>是<code>index</code>对应的列的 <strong>唯一值(unique)</strong></p> 
<p>​ 而<code>values</code>对应了<strong>想要展示的数值列</strong></p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'Name'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'Subject'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'Grade'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Subject		Chinese		Math
	Name		
San Zhang		<span class="token number">80</span>		<span class="token number">75</span>
	Si Li		<span class="token number">90</span>		<span class="token number">85</span>
</code></pre> 
<p>由于pivot进行变形操作要满足<font color="red"><strong>唯一性</strong></font>要求，行列对应的值必须唯一，<strong>所以行列的组合必须是唯一的</strong></p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Chinese'</span><span class="token comment">#如果把列索引的Subject改成与值相同的Chinese就会报错</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'Name'</span><span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token string">'Subject'</span><span class="token punctuation">,</span>values<span class="token operator">=</span><span class="token string">'Grade'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    Err_Msg <span class="token operator">=</span> e

Err_Msg
</code></pre> 
<pre><code class="prism language-python">ValueError<span class="token punctuation">(</span><span class="token string">'Index contains duplicate entries, cannot reshape'</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>pivot</code> 相关的三个参数允许传入<strong>列表</strong>，这也意味着会<strong>返回多级索引</strong></p> 
<p>创建表便于学习</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Class'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">,</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Examination'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Mid'</span><span class="token punctuation">,</span> <span class="token string">'Final'</span><span class="token punctuation">,</span> <span class="token string">'Mid'</span><span class="token punctuation">,</span> <span class="token string">'Final'</span><span class="token punctuation">,</span> <span class="token string">'Mid'</span><span class="token punctuation">,</span> <span class="token string">'Final'</span><span class="token punctuation">,</span> <span class="token string">'Mid'</span><span class="token punctuation">,</span> <span class="token string">'Final'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Subject'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Grade'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'rank'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df
</code></pre> 
<pre><code class="prism language-python">	Class	<span class="token class-name">Name</span>	Examination	Subject	Grade	rank
<span class="token number">0</span>		<span class="token number">1</span>	San Zhang	Mid		Chinese		<span class="token number">80</span>	<span class="token number">10</span>
<span class="token number">1</span>		<span class="token number">1</span>	San Zhang	Final	Chinese		<span class="token number">75</span>	<span class="token number">15</span>
<span class="token number">2</span>		<span class="token number">2</span>	Si Li		Mid		Chinese		<span class="token number">85</span>	<span class="token number">21</span>
<span class="token number">3</span>		<span class="token number">2</span>	Si Li		Final	Chinese		<span class="token number">65</span>	<span class="token number">15</span>
<span class="token number">4</span>		<span class="token number">1</span>	San Zhang	Mid		Math		<span class="token number">90</span>	<span class="token number">20</span>
<span class="token number">5</span>		<span class="token number">1</span>	San Zhang	Final	Math		<span class="token number">85</span>	<span class="token number">7</span>
<span class="token number">6</span>		<span class="token number">2</span>	Si Li		Mid		Math		<span class="token number">92</span>	<span class="token number">6</span>
<span class="token number">7</span>		<span class="token number">2</span>	Si Li		Final	Math		<span class="token number">88</span>	<span class="token number">2</span>
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-python">pivot_multi <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">,</span><span class="token string">'Examination'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Grade'</span><span class="token punctuation">,</span><span class="token string">'rank'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
    这其实就是数据透视表，把行和列放进去，对应的就是值，但是必须是唯一值
'''</span>
pivot_multi
</code></pre> 
<pre><code class="prism language-python">				Grade					rank
	Subject		Chinese		Math		Chinese		Math
	Examination	Mid	Final	Mid	Final	Mid	Final	Mid	Final
Class	<span class="token class-name">Name</span>								
<span class="token number">1</span>	San Zhang	<span class="token number">80</span>	<span class="token number">75</span>		<span class="token number">90</span>	<span class="token number">85</span>		<span class="token number">10</span>	<span class="token number">15</span>		<span class="token number">20</span>	<span class="token number">7</span>
<span class="token number">2</span>	Si Li		<span class="token number">85</span>	<span class="token number">65</span>		<span class="token number">92</span>	<span class="token number">88</span>		<span class="token number">21</span>	<span class="token number">15</span>		<span class="token number">6</span>	<span class="token number">2</span>
</code></pre> 
<p>​ 根据唯一性原则，新表的<strong>行索引等价于对index中的多列使用<code>drop_duplicates</code>去重</strong>，而**列索引长度为values中的元素乘以columns的唯一组合数量(**与index类型)</p> 
<ul><li> <p><code>pivot_table</code> <strong>不依赖唯一性</strong>条件的 长表变宽表</p> <p>​ <code>pivot</code> 的使用依赖于<strong>唯一性条件</strong>，那如果不满足唯一性条件，那么<strong>必须通过聚合</strong>操作使得相同行列组合对应的多个值变为一个值。</p> </li></ul> 
<p>创建表方便学习</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'San Zhang'</span><span class="token punctuation">,</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'San Zhang'</span><span class="token punctuation">,</span><span class="token string">'Si Li'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Subject'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">,</span><span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Grade'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df
</code></pre> 
<pre><code class="prism language-python">	Name		Subject	Grade
<span class="token number">0</span>	San Zhang	Chinese	<span class="token number">80</span>
<span class="token number">1</span>	San Zhang	Chinese	<span class="token number">90</span>
<span class="token number">2</span>	San Zhang	Math	<span class="token number">100</span>
<span class="token number">3</span>	San Zhang	Math	<span class="token number">90</span>
<span class="token number">4</span>	Si Li		Chinese	<span class="token number">70</span>
<span class="token number">5</span>	Si Li		Chinese	<span class="token number">80</span>
<span class="token number">6</span>	Si Li		Math	<span class="token number">85</span>
<span class="token number">7</span>	Si Li		Math	<span class="token number">95</span>
</code></pre> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.pivot_table(values=None, index=None, columns=None, aggfunc='mean', fill_value=None, margins=False, dropna=True, margins_name='All', observed=False, sort=True)
    创建一个电子表格风格的数据透视表作为DataFrame,数据透视表中的层将存储在结果DataFrame的索引和列上的MultiIndex对象(分层索引)中
    参数：
        values：需要被聚合的列，可选
        
        index：column 或 Grouper 或 array 或 上个列表
            如果传入一个数组，它必须与数据的长度相同。 列表可以包含任何其他类型(
            列表除外)。 在透视表索引上进行分组的键。 如果传入一个数组，则以与列值
            相同的方式使用它

        columns：column 或 Grouper 或 array 或 上个列表
            如果传入一个数组，它必须与数据的长度相同。 列表可以包含任何其他类型(
            列表除外)。 在透视表列上进行分组的键。 如果传入一个数组，则以与列值
            相同的方式使用它

        aggfunc：function 或 list(functions) 或 dict 默认为 numpy.mean
            如果传递了函数列表，那么结果透视表将有层次结构列，它们的顶层是函数名(
            从函数对象本身推断出来)。如果传递了dict，键是column to aggregate，值
            是function或函数列表

        fill_value：标量 默认NULL
            用于替换缺失值的值（在结果数据透视表中，聚合后）

        margins：布尔值，默认为 False
            不要包括其条目全部为 NaN 的列。

        margins_name：str, 默认 ‘All’
            当边距为True时，包含总计的行/列的名称

        observed：布尔值, 默认 False
            这只适用于任何组别属于分类的情况。 
            如果为True:只显示分类组别的观察值。 
            如果为False:显示分类组别的所有值。  

        sortbool：布尔值, 默认 True
            指定结果是否应该排序
    
    return DataFrame
        一个Excel风格的数据透视表
'''</span>
</code></pre> 
<p>最常用的参数就是 <code>aggfunc</code> 指定聚合</p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token string">'Name'</span><span class="token punctuation">,</span>
                columns <span class="token operator">=</span> <span class="token string">'Subject'</span><span class="token punctuation">,</span>
                values <span class="token operator">=</span> <span class="token string">'Grade'</span><span class="token punctuation">,</span>
                aggfunc <span class="token operator">=</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Subject		Chinese	Math
Name		
San Zhang	<span class="token number">85</span>		<span class="token number">95</span>
Si Li		<span class="token number">75</span>		<span class="token number">90</span>
</code></pre> 
<p>这里<code>aggfunc</code>传入的参数包含所有的<strong>聚合字符串</strong>，此外还可以<strong>传入以序列为输入 标量为输出的聚合函数</strong>来实现自定义操作</p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token string">'Name'</span><span class="token punctuation">,</span>
                columns <span class="token operator">=</span> <span class="token string">'Subject'</span><span class="token punctuation">,</span>
                values <span class="token operator">=</span> <span class="token string">'Grade'</span><span class="token punctuation">,</span>
                aggfunc <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Subject		Chinese	Math
Name		
San Zhang	<span class="token number">85</span>		<span class="token number">95</span>
Si Li		<span class="token number">75</span>		<span class="token number">90</span>	
</code></pre> 
<p>pivot_table具有<strong>边际汇总</strong>的功能，可以通过设置 <code>margins=True</code> 来实现，其中边际聚合方式<strong>与 aggfunc 中给出的聚合方法一致</strong></p> 
<blockquote> 
 <p>边际汇总就是把所有值算出来之后再进行给出聚合字符串再算一遍</p> 
</blockquote> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token string">'Name'</span><span class="token punctuation">,</span>
                columns <span class="token operator">=</span> <span class="token string">'Subject'</span><span class="token punctuation">,</span>
                values <span class="token operator">=</span> <span class="token string">'Grade'</span><span class="token punctuation">,</span>
                aggfunc<span class="token operator">=</span><span class="token string">'mean'</span><span class="token punctuation">,</span>
                margins<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Subject		Chinese	Math	All
Name			
San Zhang	<span class="token number">85</span>		<span class="token number">95.0</span>	<span class="token number">90.00</span>
Si Li		<span class="token number">75</span>		<span class="token number">90.0</span>	<span class="token number">82.50</span>
All			<span class="token number">80</span>		<span class="token number">92.5</span>	<span class="token number">86.25</span>
</code></pre> 
<h5>
<a id="_3075"></a>宽表变长表</h5> 
<ul><li>
<code>melt</code><strong>宽表转长表</strong>
</li></ul> 
<p>创建表以便学习</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Class'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">'Chinese'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">'Math'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df
</code></pre> 
<pre><code class="prism language-python">	Class	<span class="token class-name">Name</span>	Chinese	Math
<span class="token number">0</span>	<span class="token number">1</span>	San Zhang	<span class="token number">80</span>		<span class="token number">80</span>
<span class="token number">1</span>	<span class="token number">2</span>	Si Li		<span class="token number">90</span>		<span class="token number">75</span>
</code></pre> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.melt(id_vars=None, value_vars=None, var_name=None, value_name='value', col_level=None, ignore_index=True)
    将DataFrame从宽格式Unpivot到长格式，可以选择保留标识符集。  
    参数:
        id_vars：元组、列表或 ndarray，可选
            用作标识符变量的列。

        value_vars：元组、列表或 ndarray，可选
            要取消透视的列。如果未指定，则使用所有未设置为id_vars的列。

        var_name：标量
            用于“变量”列的名称。如果 None 它使用 frame.columns.name或“变量”。

        value_name：标量，默认“value”
            用于“value”列的名称。

        col_level： int 或 str，可选
            如果列是 MultiIndex，则使用此级别来融化。

        ignore_index：布尔值，默认为 True
            如果为 True，则忽略原始索引。
            如果为 False，则保留原始索引。
            索引标签将根据需要重复。

    Returns DataFrame
        没有透视DataFrame.
'''</span>
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-python">df_melted <span class="token operator">=</span> df<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>id_vars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">#需要保留不动的列</span>
                    value_vars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">#要动的列(把这个值翻转过来，从字段到数值)</span>
                    var_name <span class="token operator">=</span> <span class="token string">'Subject'</span><span class="token punctuation">,</span><span class="token comment">#反转字段后的列名(字段成为值之后需要给出新字段)</span>
                    value_name <span class="token operator">=</span> <span class="token string">'Grade'</span><span class="token punctuation">)</span><span class="token comment">#因为反转了字段，字段下面的值也有反转，所以这个参数是反转后值的字段</span>
                    <span class="token comment">#保留不动的列根据反转的字段来复制多少个</span>
df_melted
</code></pre> 
<pre><code class="prism language-python">	Class	<span class="token class-name">Name</span>	Subject	Grade
<span class="token number">0</span>	<span class="token number">1</span>	San Zhang	Chinese	<span class="token number">80</span>
<span class="token number">1</span>	<span class="token number">2</span>	Si Li		Chinese	<span class="token number">90</span>
<span class="token number">2</span>	<span class="token number">1</span>	San Zhang	Math	<span class="token number">80</span>
<span class="token number">3</span>	<span class="token number">2</span>	Si Li		Math	<span class="token number">75</span>
</code></pre> 
<p>​ <strong><code>melt</code><strong>和</strong><code>pivot</code><strong>是一组</strong>互逆过程</strong>，那么就一定可以通过pivot操作把</p> 
<p>df_melted转回df的形式</p> 
<pre><code class="prism language-python">df_unmelted <span class="token operator">=</span> df_melted<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                     columns<span class="token operator">=</span><span class="token string">'Subject'</span><span class="token punctuation">,</span>
                                     values<span class="token operator">=</span><span class="token string">'Grade'</span><span class="token punctuation">)</span>
df_unmelted <span class="token comment"># 下面需要恢复索引，并且重命名列索引名称</span>
</code></pre> 
<pre><code class="prism language-python">		Subject	Chinese	Math
Class	<span class="token class-name">Name</span>		
	<span class="token number">1</span>	San Zhang	<span class="token number">80</span>	<span class="token number">80</span>
	<span class="token number">2</span>	Si Li		<span class="token number">90</span>	<span class="token number">75</span>
</code></pre> 
<pre><code class="prism language-python">df_unmelted <span class="token operator">=</span> df_unmelted<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rename_axis<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'Subject'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df_unmelted<span class="token punctuation">.</span>equals<span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token comment">#测试两个对象是否包含相同的元素</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token boolean">True</span>
</code></pre> 
<p><strong>DataFrame.equals</strong></p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.equals(other)
        测试两个对象是否包含相同的元素
        此功能允许将两个 Series 或 DataFrame 相互比较，
        以查看它们是否具有相同的形状和元素。同一位置的 NaN 被认为是相等的。

        行/列索引不需要具有相同的类型，只要值被认为是相等的。对应的列必须具有相同的 dtype。
    
    参数
        other:Series 或者 DataFrame
            要与第一个进行比较的其他 Series 或 DataFrame。

    return 布尔
        如果两个对象中的所有元素都相同，则为 True，否则为 False。
'''</span>
</code></pre> 
<ul><li> <p><code>wide_to_long</code> 宽表转长表</p> <p>创建表以便学习</p> </li></ul> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Class'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Chinese_Mid'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Math_Mid'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Chinese_Final'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Math_Final'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df
</code></pre> 
<pre><code class="prism language-python">	Class	<span class="token class-name">Name</span>	Chinese_Mid	Math_Mid	Chinese_Final	Math_Final
<span class="token number">0</span>		<span class="token number">1</span>	San Zhang	<span class="token number">80</span>			<span class="token number">90</span>			<span class="token number">80</span>				<span class="token number">90</span>
<span class="token number">1</span>		<span class="token number">2</span>	Si Li		<span class="token number">75</span>			<span class="token number">85</span>			<span class="token number">75</span>				<span class="token number">85</span>
</code></pre> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    pandas.wide_to_long(df, stubnames, i, j, sep='', suffix='\d+')
    参数
        df：需要更改的DataFrame

        stubnames：需要拆分字段的前字段

        i：需要保留的字段

        j：需要拆分字段的后字段的列名

        sep：拆分的字段的拆分符号

        suffix：拆分符号后的正则匹配
        
'''</span>
</code></pre> 
<p>示例1：</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>wide_to_long<span class="token punctuation">(</span>df<span class="token punctuation">,</span>
    stubnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Chinese'</span><span class="token punctuation">,</span> <span class="token string">'Math'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    i <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    j<span class="token operator">=</span><span class="token string">'Examination'</span><span class="token punctuation">,</span>
    sep<span class="token operator">=</span><span class="token string">'_'</span><span class="token punctuation">,</span>
    suffix<span class="token operator">=</span><span class="token string">'.+'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">							Chinese	Math
Class	<span class="token class-name">Name</span>	Examination		
<span class="token number">1</span>	San Zhang	Mid				<span class="token number">80</span>	<span class="token number">90</span>
				Final			<span class="token number">80</span>	<span class="token number">90</span>
<span class="token number">2</span>	Si Li		Mid				<span class="token number">75</span>	<span class="token number">85</span>
				Final			<span class="token number">75</span>	<span class="token number">85</span>
</code></pre> 
<p>示例2：</p> 
<pre><code class="prism language-python">res <span class="token operator">=</span> pivot_multi<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
res<span class="token punctuation">.</span>columns <span class="token operator">=</span> res<span class="token punctuation">.</span>columns<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token string">'_'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> res<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> pd<span class="token punctuation">.</span>wide_to_long<span class="token punctuation">(</span>res<span class="token punctuation">,</span> stubnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Grade'</span><span class="token punctuation">,</span> <span class="token string">'rank'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        i <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        j <span class="token operator">=</span> <span class="token string">'Subject_Examination'</span><span class="token punctuation">,</span>
                        sep <span class="token operator">=</span> <span class="token string">'_'</span><span class="token punctuation">,</span>
                        suffix <span class="token operator">=</span> <span class="token string">'.+'</span><span class="token punctuation">)</span>
res
</code></pre> 
<pre><code class="prism language-python">										Grade	rank
Class	<span class="token class-name">Name</span>	Subject_Examination		
<span class="token number">1</span>	San Zhang		Chinese_Mid				<span class="token number">80</span>	<span class="token number">10</span>
                	Chinese_Final			<span class="token number">75</span>	<span class="token number">15</span>
                	Math_Mid				<span class="token number">90</span>	<span class="token number">20</span>
                	Math_Final				<span class="token number">85</span>	<span class="token number">7</span>
<span class="token number">2</span>	Si Li			Chinese_Mid				<span class="token number">85</span>	<span class="token number">21</span>
                	Chinese_Final			<span class="token number">65</span>	<span class="token number">15</span>
                	Math_Mid				<span class="token number">92</span>	<span class="token number">6</span>
                	Math_Final				<span class="token number">88</span>	<span class="token number">2</span>
</code></pre> 
<blockquote> 
 <p>str.join() 方法用于将序列中的元素以指定的字符连接生成一个新的字符串。</p> 
</blockquote> 
<p>示例3：</p> 
<pre><code class="prism language-python">res <span class="token operator">=</span> res<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
res<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">,</span> <span class="token string">'Examination'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">[</span>  
                <span class="token string">'Subject_Examination'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Examination'</span><span class="token punctuation">,</span>
                <span class="token string">'Subject'</span><span class="token punctuation">,</span> <span class="token string">'Grade'</span><span class="token punctuation">,</span> <span class="token string">'rank'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">'Subject'</span><span class="token punctuation">)</span>

res <span class="token operator">=</span> res<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
res
</code></pre> 
<pre><code class="prism language-python">	Class	<span class="token class-name">Name</span>	Examination	Subject	Grade	rank
<span class="token number">0</span>		<span class="token number">1</span>	San Zhang	Mid		Chinese	<span class="token number">80</span>		<span class="token number">10</span>
<span class="token number">1</span>		<span class="token number">1</span>	San Zhang	Final	Chinese	<span class="token number">75</span>		<span class="token number">15</span>
<span class="token number">2</span>		<span class="token number">2</span>	Si Li		Mid		Chinese	<span class="token number">85</span>		<span class="token number">21</span>
<span class="token number">3</span>		<span class="token number">2</span>	Si Li		Final	Chinese	<span class="token number">65</span>		<span class="token number">15</span>
<span class="token number">4</span>		<span class="token number">1</span>	San Zhang	Mid		Math	<span class="token number">90</span>		<span class="token number">20</span>
<span class="token number">5</span>		<span class="token number">1</span>	San Zhang	Final	Math	<span class="token number">85</span>		<span class="token number">7</span>
<span class="token number">6</span>		<span class="token number">2</span>	Si Li		Mid		Math	<span class="token number">92</span>		<span class="token number">6</span>
<span class="token number">7</span>		<span class="token number">2</span>	Si Li		Final	Math	<span class="token number">88</span>		<span class="token number">2</span>
</code></pre> 
<h3>
<a id="_3319"></a>索引的变形</h3> 
<h4>
<a id="stackunstack_3321"></a>stack与unstack</h4> 
<ul><li><code>stack</code></li></ul> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.stack(level=- 1, dropna=True)
    将列中的规定层堆叠到索引。
    返回与当前 DataFrame 相比具有一个或多个新的最内层的多级索引的重构 DataFrame 或 Series。通过旋转当前数据框的列来创建新的最内层
        - 如果列有一个级别，则输出是一个系列；
        - 如果列有多个级别，则新的索引级别是从规定的级别获取的，
            并且输出是一个 DataFrame。
    参数
        level：int，str，list，默认 -1
            从列轴堆叠到索引轴的级别，定义为一个索引或标签，或者索引或标签的列表。

        dropna：布尔值，默认为 True
            是否删除结果帧/系列中缺少值的行。将列级别堆叠到索引轴上可以创建原始数据帧中缺少的索引和列值的组合。
    
    return：DataFrame or Series
'''</span>
</code></pre> 
<ul><li><code>unstack</code></li></ul> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
	DataFrame.unstack(level=- 1, fill_value=None)
    枢轴（必须是分层的）索引标签的级别。
    返回具有新级别列标签的 DataFrame，其最内层由枢轴索引标签组成。
    参数
        level：int、str 或这些列表，默认 -1（最后一级）
            要解栈的索引级别，可以传递级别名称。

        fill_value：int、str 或 dict
            如果unstack产生缺失值，则将NaN 替换为该值。

    return：DataFrame or Series
'''</span>
</code></pre> 
<p>​ 之前提到了利用<code>swaplevel</code>或<code>reorder_levels</code>进行索引内部的层交换，<code>stack/unstack</code>就是<strong>行列索引</strong>交换,由于这种交换带来了<strong>DataFrame维度</strong>上的变化，因此属于变形操作</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                index <span class="token operator">=</span> pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'small'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'small'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'col_1'</span><span class="token punctuation">,</span> <span class="token string">'col_2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#可能会产生缺失值</span>
df
</code></pre> 
<pre><code class="prism language-python">					col_1	col_2
A	cat		big		<span class="token number">1.0</span>		<span class="token number">1.0</span>
	dog		small	<span class="token number">1.0</span>		<span class="token number">1.0</span>
B	cat		big		<span class="token number">1.0</span>		<span class="token number">1.0</span>
	dog		small	<span class="token number">1.0</span>		<span class="token number">1.0</span>
</code></pre> 
<p>​ <strong><code>unstack</code><strong>主要的参数是</strong>移动的层号</strong>，<strong>默认转化最内层</strong>，移动到列索引的最内层，同时支持同时转化多个层</p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">#将最内层转化了，这里也可以写-1，他把第三个行索引转到列索引了</span>
</code></pre> 
<pre><code class="prism language-python">		col_1			col_2
		big		small	big		small
A	cat	<span class="token number">1.0</span>		NaN		<span class="token number">1.0</span>		NaN
	dog	NaN		<span class="token number">1.0</span>		NaN		<span class="token number">1.0</span>
B	cat	<span class="token number">1.0</span>		NaN		<span class="token number">1.0</span>		NaN
	dog	NaN		<span class="token number">1.0</span>		NaN		<span class="token number">1.0</span>
</code></pre> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#把第0层和第2层转到列索引(由行索引起步)</span>
</code></pre> 
<pre><code class="prism language-python">	col_1					col_2
	A			B			A			B
	big	small	big	small	big	small	big	small
cat	<span class="token number">1.0</span>	NaN		<span class="token number">1.0</span>	NaN		<span class="token number">1.0</span>	NaN		<span class="token number">1.0</span>	NaN
dog	NaN	<span class="token number">1.0</span>		NaN	<span class="token number">1.0</span>		NaN	<span class="token number">1.0</span>		NaN	<span class="token number">1.0</span>
</code></pre> 
<ul><li>类似于<code>pivot</code>中的<strong>唯一性</strong>要求，在<code>stack/unstack</code>中必须保证<strong>被转为列索引的行索引层和被保留的行索引层构成的组合是唯一的</strong>，，破坏了唯一性，那么就会报错</li></ul> 
<pre><code class="prism language-python">my_index <span class="token operator">=</span> df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>to_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
my_index<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> my_index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
df<span class="token punctuation">.</span>index <span class="token operator">=</span> pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span>my_index<span class="token punctuation">)</span>
df
</code></pre> 
<pre><code class="prism language-python">				col_1	col_2
A	cat	big		<span class="token number">1.0</span>		<span class="token number">1.0</span>
		big		<span class="token number">1.0</span>		<span class="token number">1.0</span>
B	cat	big		<span class="token number">1.0</span>		<span class="token number">1.0</span>
	dog	small	<span class="token number">1.0</span>		<span class="token number">1.0</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    Err_Msg <span class="token operator">=</span> e
Err_Msg
</code></pre> 
<pre><code class="prism language-python">ValueError<span class="token punctuation">(</span><span class="token string">'Index contains duplicate entries, cannot reshape'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>与unstack相反，stack的作用就是把列索引的层压入行索引，其用法完全类似</li></ul> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    index <span class="token operator">=</span> pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'small'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'small'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'index_1'</span><span class="token punctuation">,</span> <span class="token string">'index_2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T
df
</code></pre> 
<pre><code class="prism language-python">		A			B
		cat	dog		cat	dog
		big	small	big	small
index_1	<span class="token number">1.0</span>	<span class="token number">1.0</span>		<span class="token number">1.0</span>	<span class="token number">1.0</span>
index_2	<span class="token number">1.0</span>	<span class="token number">1.0</span>		<span class="token number">1.0</span>	<span class="token number">1.0</span>
</code></pre> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">				A		B
				cat	dog	cat	dog
index_1	big		<span class="token number">1.0</span>	NaN	<span class="token number">1.0</span>	NaN
		small	NaN	<span class="token number">1.0</span>	NaN	<span class="token number">1.0</span>
index_2	big		<span class="token number">1.0</span>	NaN	<span class="token number">1.0</span>	NaN
		small	NaN	<span class="token number">1.0</span>	NaN	<span class="token number">1.0</span>
</code></pre> 
<p>​ <font color="red"><em><strong>unstack把行索引转到列索引 ， stack把列索引转到行索引</strong></em></font></p> 
<blockquote> 
 <p>聚合与变形的关系</p> 
 <p>​ 在上面介绍的所有函数中，除了带有聚合效果的 pivot_table 以外，所有的函数在变形前后并不会带来 values 个数的改变，只是这些值在呈现的形式上发生了变化</p> 
</blockquote> 
<h4>
<a id="_3502"></a>其他变形函数</h4> 
<p>读取表便于学习：</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	School	Grade	Name	Gender	Height	Weight	Transfer	Test_Number	Test_Date	Time_Record
<span class="token number">0</span>	Shanghai Jiao Tong University	Freshman	Gaopeng Yang	Female	<span class="token number">158.9</span>	<span class="token number">46.0</span>	N	<span class="token number">1</span>	<span class="token number">2019</span><span class="token operator">/</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">5</span>	<span class="token number">0</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">34</span>
<span class="token number">1</span>	Peking University	Freshman	Changqiang You	Male	<span class="token number">166.5</span>	<span class="token number">70.0</span>	N	<span class="token number">1</span>	<span class="token number">2019</span><span class="token operator">/</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">4</span>	<span class="token number">0</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">20</span>
<span class="token number">2</span>	Shanghai Jiao Tong University	Senior	Mei Sun	Male	<span class="token number">188.9</span>	<span class="token number">89.0</span>	N	<span class="token number">2</span>	<span class="token number">2019</span><span class="token operator">/</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">12</span>	<span class="token number">0</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">22</span>
<span class="token number">3</span>	Fudan University	Sophomore	Xiaojuan Sun	Female	NaN	<span class="token number">41.0</span>	N	<span class="token number">2</span>	<span class="token number">2020</span><span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">3</span>	<span class="token number">0</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">08</span>
<span class="token number">4</span>	Fudan University	Sophomore	Gaojuan You	Male	<span class="token number">174.0</span>	<span class="token number">74.0</span>	N	<span class="token number">2</span>	<span class="token number">2019</span><span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span><span class="token number">6</span>	<span class="token number">0</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">22</span>
</code></pre> 
<ul><li>
<code>crosstab</code> 交叉两个或多个序列成为新的表</li></ul> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    pandas.crosstab(index, columns, values=None, rownames=None, colnames=None, aggfunc=None, margins=False, margins_name='All', dropna=True, normalize=False)
    计算两个（或更多）因子的简单交叉表。默认情况下，除非传递值数组和聚合函数，否则会计算因子的频率表。
    参数
        index：array-like, Series, or list of arrays/Series
            行中分组依据的值。

        column：array-like, Series, or list of arrays/Series
            列中分组依据的值。

        values：数组，可选
            根据因子聚合的值数组。需要指定aggfunc。

        rownames，默认无
            如果通过，则必须匹配通过的行数组数。

        colnames序列，默认无
            如果通过，则必须匹配通过的列数组的数量。

        aggfunc函数，可选
            如果指定，则还需要指定值。

        margins布尔值，默认为 False
            添加行/列边距（小计）。

        margins_name str，默认“全部”
            当边距为 True 时将包含总计的行/列的名称。

        dropna布尔值，默认为 True
            不要包括其条目全部为 NaN 的列。

        normalize bool, {'all', 'index', 'columns'} 或 {0,1}，默认 False
            通过将所有值除以值的总和进行归一化。

            - 如果通过 'all' 或True，将对所有值进行标准化。
            - 如果通过“索引”将在每一行上标准化。
            - 如果通过“列”将在每一列上进行规范化。
            - 如果 margins 是True，也将规范化边距值。
'''</span>
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>crosstab<span class="token punctuation">(</span>index <span class="token operator">=</span> df<span class="token punctuation">.</span>School<span class="token punctuation">,</span> columns <span class="token operator">=</span> df<span class="token punctuation">.</span>Transfer<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Transfer						N	Y
School		
Fudan University				<span class="token number">38</span>	<span class="token number">1</span>
Peking University				<span class="token number">28</span>	<span class="token number">2</span>
Shanghai Jiao Tong University	<span class="token number">53</span>	<span class="token number">0</span>
Tsinghua University				<span class="token number">62</span>	<span class="token number">4</span>
</code></pre> 
<p>如果给出了<code>values</code>参数，就必须指定<code>aggfunc</code>聚合参数</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>crosstab<span class="token punctuation">(</span>index <span class="token operator">=</span> df<span class="token punctuation">.</span>School<span class="token punctuation">,</span> columns <span class="token operator">=</span> df<span class="token punctuation">.</span>Transfer<span class="token punctuation">,</span>
            values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>df<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> aggfunc <span class="token operator">=</span> <span class="token string">'count'</span><span class="token punctuation">)</span><span class="token comment">#[0]*df.shape[0]只是把列表0乘以df.shape[0]就是第一维度，那这个表达式表示有第一维度的几个0</span>
</code></pre> 
<pre><code class="prism language-python">Transfer						N		Y
School		
Fudan University				<span class="token number">38.0</span>	<span class="token number">1.0</span>
Peking University				<span class="token number">28.0</span>	<span class="token number">2.0</span>
Shanghai Jiao Tong University	<span class="token number">53.0</span>	NaN
Tsinghua University				<span class="token number">62.0</span>	<span class="token number">4.0</span>
</code></pre> 
<p>可以使用<code>pivot_table</code><strong>进行等价操作</strong>，由于这里统计的是组合的频数，所以<code>values</code>参数无论传入那一个列都<strong>不会影响最后的结果</strong></p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token string">'School'</span><span class="token punctuation">,</span>
                columns <span class="token operator">=</span> <span class="token string">'Transfer'</span><span class="token punctuation">,</span>
                values <span class="token operator">=</span> <span class="token string">'Name'</span><span class="token punctuation">,</span>
                aggfunc <span class="token operator">=</span> <span class="token string">'count'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Transfer						N		Y
School		
Fudan University				<span class="token number">38.0</span>	<span class="token number">1.0</span>
Peking University				<span class="token number">28.0</span>	<span class="token number">2.0</span>
Shanghai Jiao Tong University	<span class="token number">53.0</span>	NaN
Tsinghua University				<span class="token number">62.0</span>	<span class="token number">4.0</span>
</code></pre> 
<blockquote> 
 <p><code>crosstab</code>的对应位置传入的是<strong>具体序列</strong>，而<code>pivot_table</code>传入的是<strong>被调用表的对应名字</strong>，若传入序列对应的值则会报错</p> 
</blockquote> 
<ul><li> <p><code>explode</code>展开表</p> <p>​ explode参数能够对某一列的元素进行<strong>纵向的展开</strong>，被展开的单元格必须存储为 **<code>list, tuple, Series, np.ndarray</code>**中的类型</p> </li></ul> 
<p>创建表以便学习</p> 
<pre><code class="prism language-python">df_ex <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'my_str'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df_ex
</code></pre> 
<pre><code class="prism language-python">	A						B
<span class="token number">0</span>	<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>					<span class="token number">1</span>
<span class="token number">1</span>	my_str					<span class="token number">1</span>
<span class="token number">2</span>	<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>					<span class="token number">1</span>
<span class="token number">3</span>	<span class="token number">0</span> <span class="token number">3</span> <span class="token number">1</span> <span class="token number">4</span> dtype<span class="token punctuation">:</span> int64	<span class="token number">1</span>
</code></pre> 
<p>示例1：</p> 
<pre><code class="prism language-python">df_ex<span class="token punctuation">.</span>explode<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token comment">#以A列把所有的拆分</span>
</code></pre> 
<pre><code class="prism language-python">	A		B
<span class="token number">0</span>	<span class="token number">1</span>		<span class="token number">1</span>
<span class="token number">0</span>	<span class="token number">2</span>		<span class="token number">1</span>
<span class="token number">1</span>	my_str	<span class="token number">1</span>
<span class="token number">2</span>	<span class="token number">1</span>		<span class="token number">1</span>
<span class="token number">2</span>	<span class="token number">2</span>		<span class="token number">1</span>
<span class="token number">3</span>	<span class="token number">3</span>		<span class="token number">1</span>
<span class="token number">3</span>	<span class="token number">4</span>		<span class="token number">1</span>
</code></pre> 
<ul><li>
<code>get_dummies</code>把类别特征转化为指示变量</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#对年级一列转为指示变量，属于某一个年级的对应列标记为1，否则为0：</span>
pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>df<span class="token punctuation">.</span>Grade<span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Freshman	Junior	Senior	Sophomore
<span class="token number">0</span>		<span class="token number">1</span>		<span class="token number">0</span>		<span class="token number">0</span>		<span class="token number">0</span>
<span class="token number">1</span>		<span class="token number">1</span>		<span class="token number">0</span>		<span class="token number">0</span>		<span class="token number">0</span>
<span class="token number">2</span>		<span class="token number">0</span>		<span class="token number">0</span>		<span class="token number">1</span>		<span class="token number">0</span>
<span class="token number">3</span>		<span class="token number">0</span>		<span class="token number">0</span>		<span class="token number">0</span>		<span class="token number">1</span>
<span class="token number">4</span>		<span class="token number">0</span>		<span class="token number">0</span>		<span class="token number">0</span>		<span class="token number">1</span>
</code></pre> 
<p>##连接</p> 
<p>​ pandas的表连接与SQL的表连接相同，提供<code>how</code>参数来代表连接形式，分别为**<code>左连接left，右连接right，内连接inner，外连接outer</code>**</p> 
<h3>
<a id="_3685"></a>值连接</h3> 
<p>​ <strong><code>merge()</code></strong></p> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.merge(right, how='inner', on=None, left_on=None, right_on=None, left_index=False, right_index=False, sort=False, suffixes=('_x', '_y'), copy=True, indicator=False, validate=None)
    
    将DataFrame或命名的 Series 对象与数据库样式的连接合并。
    命名的 Series 对象被视为具有单个命名列的 DataFrame。
    连接是在 列或索引 上完成的。如果在列上连接列，DataFrame 索引将被 '忽略' 。
    否则，如果加入索引上的索引或列上的索引，则索引将被传递。执行交叉合并时，不允许合并列规范。

    warning:
        如果两个键列都包含键为空值的行，则这些行将相互匹配。这与通常的 SQL 连接行为不同，并可能导致意外结果

    参数：
        right：DataFrame 或 普通的Series

        how：连接方式{‘left’, ‘right’, ‘outer’, ‘inner’, ‘cross’}, 默认 ‘inner’
            - left：仅使用左帧中的键，类似于 SQL 左外连接；保留密钥顺序。
            - right：仅使用右框架中的键，类似于 SQL 右外连接；保留密钥顺序。
            - 外部：使用来自两个帧的键并集，类似于 SQL 完全外部联接；按字典顺序对键进行排序。
            - 内部：使用来自两个帧的键的交集，类似于 SQL 内部连接；保留左键的顺序。
            - cross：从两个帧创建笛卡尔积，保留左键的顺序
        
        on：标签 或 list
            要连接的列或索引级别名称。 这些必须在两个 DataFrame 中都找到。 
            如果on为None并且没有在索引上合并，则默认为两个DataFrames中的列的交集。

        left_on：标签 或 列表 或 数组
            行列索引层级的名称连接到左DataFrame。 也可以是一个数
            组或数组的列表长度的左DataFrame。 这些数组被当作列来处理。

        right_on：标签 或 列表 或 数组
            行列索引层级的名称连接到右DataFrame。也可以是一个数
            组或数组列表的长度为正确的DataFrame。 这些数组被当作列来处理  

        left_index：布尔型 默认False
            使用来自左DataFrame的索引作为连接键。 如果它是一个MultiIndex，
            则其他DataFrame中的键的数量(索引或列的数量)必须与级别的数量匹配

        right_index：布尔型 默认False
            使用来自右DataFrame的索引作为连接键。 与left_index相同的注意事项

        sort：布尔型 默认False
            对结果DataFrame中的联接键按字典顺序排序。 如果为False，则连接键的顺序取决于连接类型(how关键字)

        suffixes：列表 默认为 (“_x”, “_y”)
            长度为2的序列，其中每个元素都是可选的字符串，指示要分别添加到左侧和右侧重叠列名的后缀。 
            传递None值而不是字符串来指示从左到右的列名应该保持原样，不带后缀。 至少有一个值不能为None

        copy：布尔型 默认为 True
            如果为False,尽可能避免复制

        indicator：布尔型 或 str 默认值为 False
            如果为True，则在输出DataFrame中添加一个名为“_merge”的列，该列包含关于每行源的信息。 
            通过提供一个字符串参数，可以给列一个不同的名称。 该列将有一个category类型的值为“left_only”，
            用于观察其合并键只出现在左DataFrame，“right_only”用于观察其合并键只出现在右DataFrame，
            如果观察的合并键在两个DataFrame中都发现，则为“both”。 

        validate： str 可选
            如果指定，则检查merge是否为指定类型。  
                - " one_to_one "或" 1:1 ":检查合并键在左右数据集中是否唯一。  
                - " one_to_many "或" 1:m ":检查合并键是否唯一的左数据集。  
                - " many_to_one "或" m:1 ":检查合并键在右数据集中是否唯一。  
                - “many_to_many”或“m:m”:允许，但不进行检查。

    return：DataFrame
        合并了两个对象的DataFrame
'''</span>
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span><span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'Si Li'</span><span class="token punctuation">,</span><span class="token string">'Wu Wang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Gender'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df2<span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'Name'</span><span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">)</span><span class="token comment">#依照Name列做左连接</span>
</code></pre> 
<pre><code class="prism language-python">	Name		Age	Gender
<span class="token number">0</span>	San Zhang	<span class="token number">20</span>	NaN
<span class="token number">1</span>	Si Li		<span class="token number">30</span>	F
</code></pre> 
<p>如果两个表中想要连接的<strong>列不具备相同的列名</strong>，可以通过 <code>left_on</code> 和 <code>right_on</code></p> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'df1_name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span><span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'df2_name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'Si Li'</span><span class="token punctuation">,</span><span class="token string">'Wu Wang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Gender'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> 
            left_on<span class="token operator">=</span><span class="token string">'df1_name'</span><span class="token punctuation">,</span> 
            right_on<span class="token operator">=</span><span class="token string">'df2_name'</span><span class="token punctuation">,</span> 
            how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	df1_name	Age	df2_name	Gender
<span class="token number">0</span>	San Zhang	<span class="token number">20</span>	NaN			NaN
<span class="token number">1</span>	Si Li		<span class="token number">30</span>	Si Li		F
</code></pre> 
<p>出现重复列名可用<code>suffixes</code>参数指定</p> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Grade'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Grade'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> 
            on<span class="token operator">=</span><span class="token string">'Name'</span><span class="token punctuation">,</span> 
            how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span> 
            suffixes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'_Chinese'</span><span class="token punctuation">,</span><span class="token string">'_Math'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Name	Grade_Chinese	Grade_Math
<span class="token number">0</span>	San Zhang	<span class="token number">70</span>				<span class="token number">80</span>
</code></pre> 
<blockquote> 
 <p><em>如果键不是唯一的，那么结果就会产生问题。举例中的行数很少，但如果实际数据中有几十万到上百万行的进行合并时，如果想要保证唯一性，除了用 duplicated 检查是否重复外， merge 中也提供了 validate 参数来检查连接的唯一性模式。这里共有三种模式，即一对一连接 1:1 ，一对多连接 1:m ，多对一连接 m:1 连接，第一个是指左右表的键都是唯一的，后面两个分别指左表键唯一和右表键唯一</em></p> 
</blockquote> 
<h3>
<a id="_3815"></a>索引连接</h3> 
<p>​ <code>join()</code></p> 
<p>示例：</p> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>index<span class="token operator">=</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span><span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'Name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Gender'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>index<span class="token operator">=</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Si Li'</span><span class="token punctuation">,</span><span class="token string">'Wu Wang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'Name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>join<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">			Age		Gender
Name		
San Zhang	<span class="token number">20</span>		NaN
Si Li		<span class="token number">30</span>		F
</code></pre> 
<h3>
<a id="_3836"></a>方向连接</h3> 
<p>​ <code>concat()</code></p> 
<p>​ <strong>仍然关于索引连接</strong>，常用三个参数：<code>axis,join,keys</code>分别表示<strong>拼接方向，连接形式，以及在新表中指示来自于哪一张旧表的名字</strong>意， <code>join</code> 和 <code>keys</code> 与之前提到的 join 函数和键的概念没有任何关系。</p> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    pandas.concat(objs, axis=0, join='outer', ignore_index=False, keys=None, levels=None, names=None, verify_integrity=False, sort=False, copy=True)
    沿特定轴连接pandas对象，并沿a其他轴使用可选的设置逻辑。
    还可以在连接轴上添加一层分层索引，如果标签在传递的轴号
    上相同（或重叠），这可能很有用

    参数
        objs：Series 或 DataFrame 对象的序列或映射
            如果传递了映射，则排序的键将用作键 参数，除非传递，在这
            种情况下将选择值（见下文）。任何 None 对象都将被静默删除
            ，除非它们都是 None 在这种情况下将引发 ValueError 。

        axis：{0/'index', 1/'columns'}，默认 0
            要连接的轴。

        join：{'inner', 'outer'}，默认 'outer'
            如何处理其他轴（或轴）上的索引。

        ignore_index：布尔值，默认为 False
            如果为 True，则不要使用连接轴上的索引值。结果轴将标记为 0,
             ..., n - 1。如果您要连接对象，而连接轴没有有意义的索引信
             息，这将非常有用。请注意，连接中仍然尊重其他轴上的索引值。

        key：序列，默认无
            如果通过了多个级别，则应包含元组。使用传递的键作为最外层构建层次索引。

        level:列表，默认无
            用于构造 MultiIndex 的特定级别（唯一值）。否则，它们将从密钥中推断出来。

        mane：列表，默认无
            生成的分层索引中的级别名称。

        verify_integrity：bool，默认为 False
            检查新的连接轴是否包含重复项。相对于实际的数据连接，这可能非常昂贵。

        sort：布尔值，默认为 False
            如果连接 为“外部”时未对齐，则对非连接轴进行排序。当已经保留了非串联轴的顺序时，这不起作用。join='inner'
            在 1.0.0 版更改:默认情况下更改为不排序。

        copy：bool，默认 True
            如果为 False，则不要不必要地复制数据。

    return object,objects
        当沿着索引 ( axisSeries =0) 连接时， Series返回 a。当objs包含至少
        一个 DataFrame时，DataFrame返回 a。当沿列连接时（axis=1），返回DataFramea 。
'''</span>
</code></pre> 
<p>默认状态下axis=0表示<strong>纵向</strong>连接两个表，常常用于多个样本的连接</p> 
<p>默认状态下axis=1表示<strong>横向</strong>连接多个表，常用于多个字段或特征的拼接</p> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span><span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'Wu Wang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Name		Age
<span class="token number">0</span>	San Zhang	<span class="token number">20</span>
<span class="token number">1</span>	Si Li		<span class="token number">30</span>
<span class="token number">0</span>	Wu Wang		<span class="token number">40</span>
</code></pre> 
<pre><code class="prism language-python">df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Grade'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Gender'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">,</span> df3<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Name		Age		Grade	Gender
<span class="token number">0</span>	San Zhang	<span class="token number">20</span>		<span class="token number">80</span>		M
<span class="token number">1</span>	Si Li		<span class="token number">30</span>		<span class="token number">90</span>		F
</code></pre> 
<p>默认状态下<code>join=outer</code>，表示保留所有列，并将不存在的值设置为<strong>缺失</strong></p> 
<pre><code class="prism language-python">df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'Wu Wang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Name		Age		Gender
<span class="token number">0</span>	San Zhang	<span class="token number">20.0</span>	NaN
<span class="token number">1</span>	Si Li		<span class="token number">30.0</span>	NaN
<span class="token number">0</span>	Wu Wang		NaN		M
</code></pre> 
<pre><code class="prism language-python">df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Grade'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># 1 是axis</span>
</code></pre> 
<pre><code class="prism language-python">	Name		Age		Grade
<span class="token number">0</span>	San Zhang	<span class="token number">20.0</span>	NaN
<span class="token number">1</span>	Si Li		<span class="token number">30.0</span>	<span class="token number">80.0</span>
<span class="token number">2</span>	NaN			NaN		<span class="token number">90.0</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> join<span class="token operator">=</span><span class="token string">'inner'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Name	Age	Grade
<span class="token number">1</span>	Si Li	<span class="token number">30</span>	<span class="token number">80</span>
</code></pre> 
<blockquote> 
 <p>当确认要使用多表连接的方向合并时，尤其是横向的合并，可以先用<strong>reset_index</strong>方法恢复默认整数索引再进行合并，防止出现由索引的<u>误对起和重复索引的笛卡尔积</u>带来的错误结果</p> 
</blockquote> 
<p>key参数是可以标记<strong>生成表的数据来自那些表</strong></p> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span><span class="token string">'Si Li'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'Wu Wang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#key是表明那些数据来自那些表</span>
</code></pre> 
<pre><code class="prism language-python">		Name		Age
one	<span class="token number">0</span>	San Zhang	<span class="token number">20</span>
	<span class="token number">1</span>	Si Li		<span class="token number">21</span>
two	<span class="token number">0</span>	Wu Wang		<span class="token number">21</span>	
</code></pre> 
<h3>
<a id="_3988"></a>序列与表的合并</h3> 
<p>​ 如果想把序列<strong>追加</strong>到表的行末或者列末，可以分别使用<code>append</code>和<code>assign</code>方法</p> 
<ul><li> <p><code>append</code></p> <p>​ 如果原表是默认整数索引，那么可以使用<code>ignore_index=True</code>对新序列对应的索引自动标号，否则<strong>必须对Series指定name属性</strong></p> </li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Wu Wang'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index <span class="token operator">=</span> df1<span class="token punctuation">.</span>columns<span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Name		Age
<span class="token number">0</span>	San Zhang	<span class="token number">20</span>
<span class="token number">1</span>	Si Li		<span class="token number">21</span>
<span class="token number">2</span>	Wu Wang		<span class="token number">21</span>
</code></pre> 
<ul><li> <p><code>assign</code></p> <p>​ 一般通过<code>df['new_col']=...</code>追加新列，缺点是会直接改动原表，所以<strong>assign返回的是一个临时副本</strong></p> </li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>Grade<span class="token operator">=</span>s<span class="token punctuation">)</span><span class="token comment">#追加列</span>
</code></pre> 
<pre><code class="prism language-python">	Name		Age	Grade
<span class="token number">0</span>	San Zhang	<span class="token number">20</span>	<span class="token number">80</span>
<span class="token number">1</span>	Si Li		<span class="token number">21</span>	<span class="token number">90</span>
</code></pre> 
<pre><code class="prism language-python">df1<span class="token punctuation">[</span><span class="token string">'Grade'</span><span class="token punctuation">]</span> <span class="token operator">=</span> s
df1
</code></pre> 
<pre><code class="prism language-python">	Name		Age	Grade
<span class="token number">0</span>	San Zhang	<span class="token number">20</span>	<span class="token number">80</span>
<span class="token number">1</span>	Si Li		<span class="token number">21</span>	<span class="token number">90</span>
</code></pre> 
<h3>
<a id="_4040"></a>类连接操作</h3> 
<h4>
<a id="_4042"></a>比较</h4> 
<p>​ <code>compare()</code></p> 
<p>​ 它能够比较两个表或者序列的<strong>不同处并进行汇总</strong>展示</p> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'Si Li'</span><span class="token punctuation">,</span> <span class="token string">'Wu Wang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span> <span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Class'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'San Zhang'</span><span class="token punctuation">,</span> <span class="token string">'Li Si'</span><span class="token punctuation">,</span> <span class="token string">'Wu Wang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span> <span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'Class'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'Three'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>compare<span class="token punctuation">(</span>df2<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Name			Class
	<span class="token class-name">self</span>	other	self	other
<span class="token number">1</span>	Si Li	Li Si	NaN		NaN
<span class="token number">2</span>	NaN		NaN		three	Three
</code></pre> 
<p>如果<strong>相同则会被填充为缺失值</strong><code>nan</code>,其中<code>other</code>和<code>self</code>分别代指<strong>传入的参数表</strong>和<strong>被调用的表自身</strong></p> 
<p>如果想要<strong>完整显示表中的所有元素的比较情况</strong>，可以设置<code>keep_shape=True</code></p> 
<pre><code class="prism language-python">df1<span class="token punctuation">.</span>compare<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> keep_shape<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Name			Age				Class
	<span class="token class-name">self</span>	other	self	other	self	other
<span class="token number">0</span>	NaN		NaN		NaN		NaN		NaN		NaN
<span class="token number">1</span>	Si Li	Li Si	NaN		NaN		NaN		NaN
<span class="token number">2</span>	NaN		NaN		NaN		NaN		three	Three
</code></pre> 
<h4>
<a id="_4081"></a>组合</h4> 
<p>​ <code>combine</code></p> 
<p>​ 能够让两张表按照一定<strong>规则</strong>进行组合，在进行规则比较的时候<strong>列索引会自动对其</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">choose_min</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s2 <span class="token operator">=</span> s2<span class="token punctuation">.</span>reindex_like<span class="token punctuation">(</span>s1<span class="token punctuation">)</span>
    res <span class="token operator">=</span> s1<span class="token punctuation">.</span>where<span class="token punctuation">(</span>s1<span class="token operator">&lt;</span>s2<span class="token punctuation">,</span> s2<span class="token punctuation">)</span>
    res <span class="token operator">=</span> res<span class="token punctuation">.</span>mask<span class="token punctuation">(</span>s1<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># isna表示是否为缺失值，返回布尔序列</span>
    <span class="token keyword">return</span> res

df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'A'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'B'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>combine<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> choose_min<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	A	B	C	D
<span class="token number">0</span>	NaN	NaN	NaN	NaN
<span class="token number">1</span>	NaN	<span class="token number">4.0</span>	<span class="token number">6.0</span>	NaN
<span class="token number">2</span>	NaN	NaN	NaN	NaN
</code></pre> 
<blockquote> 
 <p>DataFrame.mask() 替换条件为 True 的值</p> 
</blockquote> 
<p><code>overtwrite</code>参数为<code>False</code>可以<strong>保留被调用表中未出现在传入的参数表中的列</strong>，而不会设置为缺失值</p> 
<pre><code class="prism language-python">df1<span class="token punctuation">.</span>combine<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> choose_min<span class="token punctuation">,</span> overwrite<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token comment">#A列是没有进行比较的</span>
</code></pre> 
<pre><code class="prism language-python">	A	B	C	D
<span class="token number">0</span>	<span class="token number">1.0</span>	NaN	NaN	NaN
<span class="token number">1</span>	<span class="token number">2.0</span>	<span class="token number">4.0</span>	<span class="token number">6.0</span>	NaN
<span class="token number">2</span>	NaN	NaN	NaN	NaN
</code></pre> 
<p><code>combine_first</code>方法，在对两张表组合时，若<strong>第二张表中的值在第一张表中对应索引位置的值不是缺失状态</strong>，那么就<strong>使用第一张表的值填充</strong></p> 
<pre><code class="prism language-python">df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'A'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'A'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>combine_first<span class="token punctuation">(</span>df2<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	A	B
<span class="token number">0</span>	<span class="token number">1</span>	<span class="token number">3.0</span>
<span class="token number">1</span>	<span class="token number">2</span>	<span class="token number">7.0</span>
<span class="token number">2</span>	<span class="token number">6</span>	<span class="token number">8.0</span>
</code></pre> 
<h2>
<a id="_4142"></a>缺失值</h2> 
<p>###统计</p> 
<ul><li> <p><code>isna</code> 或 <code>isnull</code></p> <p>​ 查看每个单元格是否缺失</p> </li></ul> 
<p>读取表以便学习</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">,</span>
        usecols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Grade'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">,</span> <span class="token string">'Height'</span><span class="token punctuation">,</span><span class="token string">'Weight'</span><span class="token punctuation">,</span> <span class="token string">'Transfer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Grade	Name	Gender	Height	Weight	Transfer
<span class="token number">0</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>
<span class="token number">1</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>
<span class="token number">2</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>
<span class="token number">3</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">True</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>
<span class="token number">4</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>	<span class="token boolean">False</span>
</code></pre> 
<p>如果想要查看某一列缺失或者非缺失的行，可以利用 Series 上的 <code>isna</code> 或者 <code>notna</code> 进行<font color="red"><strong>布尔索引</strong></font>。</p> 
<pre><code class="prism language-python">df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>Height<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Grade		Name			Gender	Height	Weight	Transfer
<span class="token number">3</span>	Sophomore	Xiaojuan Sun	Female	NaN		<span class="token number">41.0</span>	N
<span class="token number">12</span>	Senior		Peng You		Female	NaN		<span class="token number">48.0</span>	NaN
<span class="token number">26</span>	Junior		Yanli You		Female	NaN		<span class="token number">48.0</span>	N
<span class="token number">36</span>	Freshman	Xiaojuan Qin	Male	NaN		<span class="token number">79.0</span>	Y
<span class="token number">60</span>	Freshman	Yanpeng Lv		Male	NaN		<span class="token number">65.0</span>	N
</code></pre> 
<p>同时对几个列检查缺失情况可以用<code>isna,notna</code>和<code>any,all</code>的组合</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
	any()一个序列中满足一个True，则返回True；
    all()一个序列中所有值为True时，返回True，否则为False
'''</span>
</code></pre> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.any(self, axis=0, bool_only=None, skipna=True, level=None, **kwargs)
        DataFrame.all(self, axis=0, bool_only=None, skipna=True, level=None, **kwargs)
        参数
            参数
            axis：{0 或 'index'，1 或 'columns'，无}，默认 0
                指示应减少哪个轴或多个轴。
                    0 / 'index' : 减少索引，返回一个以原始列标签为索引的系列。
                    1 / 'columns' ：减少列，返回一个索引为原始索引的系列。
                    None：减少所有轴，返回一个标量。
            bool_only：布尔值，默认None
                仅包括布尔列。如果没有，将尝试使用所有内容，然后仅使用布尔数据。未针对系列实施。

            skipna：布尔值，默认为 True
                排除 NA/空值。如果整个行/列为 NA 且 skipna 为 True，则结果将为 False，与空行/列一样。
                如果 skipna 为 False，则 NA 被视为 True，因为它们不等于零。

            level： int 或 层级名称，默认无
                如果轴是 MultiIndex（分层），则沿特定级别计数，折叠成一个系列。

        Returns：Series or DataFrame
            如果指定了level，则返回DataFrame；否则，返回Series
'''</span>
</code></pre> 
<p>示例1：</p> 
<pre><code class="prism language-python">sub_set <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">,</span> <span class="token string">'Transfer'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
df<span class="token punctuation">[</span>sub_set<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># 全部缺失</span>
</code></pre> 
<pre><code class="prism language-python">	Grade	Name			Gender	Height	Weight	Transfer
<span class="token number">102</span>	Junior	Chengli Zhao	Male	NaN		NaN		NaN
</code></pre> 
<p>示例2：</p> 
<pre><code class="prism language-python">df<span class="token punctuation">[</span>sub_set<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 至少有一个缺失</span>
</code></pre> 
<pre><code class="prism language-python">	Grade		Name			Gender	Height	Weight	Transfer
<span class="token number">3</span>	Sophomore	Xiaojuan Sun	Female	NaN		<span class="token number">41.0</span>	N
<span class="token number">9</span>	Junior		Juan Xu			Female	<span class="token number">164.8</span>	NaN		N
<span class="token number">12</span>	Senior		Peng You		Female	NaN		<span class="token number">48.0</span>	NaN
<span class="token number">21</span>	Senior		Xiaopeng Shen	Male	<span class="token number">166.0</span>	<span class="token number">62.0</span>	NaN
<span class="token number">26</span>	Junior		Yanli You		Female	NaN		<span class="token number">48.0</span>	N
</code></pre> 
<p>示例3：</p> 
<pre><code class="prism language-python">df<span class="token punctuation">[</span>sub_set<span class="token punctuation">.</span>notna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 没有缺失</span>
</code></pre> 
<pre><code class="prism language-python">	Grade		Name			Gender	Height	Weight	Transfer
<span class="token number">0</span>	Freshman	Gaopeng Yang	Female	<span class="token number">158.9</span>	<span class="token number">46.0</span>	N
<span class="token number">1</span>	Freshman	Changqiang You	Male	<span class="token number">166.5</span>	<span class="token number">70.0</span>	N
<span class="token number">2</span>	Senior		Mei Sun			Male	<span class="token number">188.9</span>	<span class="token number">89.0</span>	N
<span class="token number">4</span>	Sophomore	Gaojuan You		Male	<span class="token number">174.0</span>	<span class="token number">74.0</span>	N
<span class="token number">5</span>	Freshman	Xiaoli Qian		Female	<span class="token number">158.0</span>	<span class="token number">51.0</span>	N
</code></pre> 
<h3>
<a id="_4270"></a>删除</h3> 
<ul><li> <p><code>dropna</code></p> <p>​ 主要参数为方向**<code>axis</code><strong>(默认为0，即删除行)，删除方式</strong><code>how</code><strong>，删除的非缺失值个数阈值</strong><code>thresh</code><strong>(非缺失值 没有达到这个数量的相应维度会被删除)，备选的删除子集</strong><code>subset</code><strong>，其中</strong><code>how</code>**主要有<code>any</code>和<code>all</code>两种参数可以选择</p> </li></ul> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.dropna(axis=0, how='any', thresh=None, subset=None, inplace=False)
    删除缺失值。
    参数
        axis:{0 或 'index'，1 或 'columns'}，默认 0
            确定是否删除了包含缺失值的行或列。
                0 或 'index' ：删除包含缺失值的行。
                1 或 'columns' ：删除包含缺失值的列。
                (在 1.0.0 版更改：将元组或列表传递到多个轴上。只允许使用单个轴。)

        how：{'any', 'all'}, 默认 'any'
        当我们至少有一个 NA 或全部 NA 时，确定是否从 DataFrame 中删除行或列。
            'any' ：如果存在任何 NA 值，则删除该行或列。
            'all' ：如果所有值都是 NA，则删除该行或列。

        thresh： int，可选
            删除的非缺失值个数阈值，非缺失值 没有达到这个数量的相应维度会被删除
            其实就是删除条件

        subset：列标签或标签序列，可选
            要考虑的沿其他轴的标签，例如，如果您要删除行，这些将是要包含的列列表。

        inplace：bool，默认 False
            如果为 True，则在原地执行操作并返回 None。
'''</span>
</code></pre> 
<p>示例1：</p> 
<pre><code class="prism language-python">res <span class="token operator">=</span> df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>how <span class="token operator">=</span> <span class="token string">'any'</span><span class="token punctuation">,</span> subset <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
res<span class="token punctuation">.</span>shape
</code></pre> 
<pre><code class="prism language-python"><span class="token punctuation">(</span><span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
</code></pre> 
<p>示例2：</p> 
<pre><code class="prism language-python">res <span class="token operator">=</span> df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> thresh<span class="token operator">=</span>df<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token comment"># 身高被删除</span>
res<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#没有达到thresh的条件</span>
</code></pre> 
<pre><code class="prism language-python">	Grade		Name			Gender	Weight	Transfer
<span class="token number">0</span>	Freshman	Gaopeng Yang	Female	<span class="token number">46.0</span>	N
<span class="token number">1</span>	Freshman	Changqiang You	Male	<span class="token number">70.0</span>	N
<span class="token number">2</span>	Senior		Mei Sun			Male	<span class="token number">89.0</span>	N
<span class="token number">3</span>	Sophomore	Xiaojuan Sun	Female	<span class="token number">41.0</span>	N
<span class="token number">4</span>	Sophomore	Gaojuan You		Male	<span class="token number">74.0</span>	N
</code></pre> 
<p>不用<code>dropna</code> 也可以用<strong>布尔索引</strong>完成</p> 
<pre><code class="prism language-python">res <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>notna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
res<span class="token punctuation">.</span>shape
</code></pre> 
<pre><code class="prism language-python"><span class="token punctuation">(</span><span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">res <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">~</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
res<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	Grade		Name			Gender	Weight	Transfer
<span class="token number">0</span>	Freshman	Gaopeng Yang	Female	<span class="token number">46.0</span>	N
<span class="token number">1</span>	Freshman	Changqiang You	Male	<span class="token number">70.0</span>	N
<span class="token number">2</span>	Senior		Mei Sun			Male	<span class="token number">89.0</span>	N
<span class="token number">3</span>	Sophomore	Xiaojuan Sun	Female	<span class="token number">41.0</span>	N
<span class="token number">4</span>	Sophomore	Gaojuan You		Male	<span class="token number">74.0</span>	N
</code></pre> 
<p>###填充</p> 
<ul><li> <p><code>fillna</code></p> <p>​ 最常用三个参数：<code>value,method,limit</code></p> <p>​ 其中<code>value</code>为填充值，可以是标量，也可以是索引到元素的<strong>字典映射</strong></p> <p>​ <code>method</code>为填充给方法，有用**前面的元素填充<code>fill</code><strong>和</strong>后面的元素填充<code>bfill</code>**两种类型</p> <p>​ <code>limit</code> 参数表示连续缺失值的<strong>最大填充次数</strong></p> </li></ul> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.fillna(value=None, method=None, axis=None, inplace=False, limit=None, downcast=None)
    使用指定的方法填充 NA/NaN 值
    参数
        value：标量、dict、Series 或 DataFrame
            用于填充孔的值（例如 0），或者是值的 dict/Series/DataFrame，指定每个索引（对于 Series）或列（对于 DataFrame）使用哪个值。
            不在 dict/Series/DataFrame 中的值将不会被填充。'此值不能是列表'。

        method：{'backfill', 'bfill', 'pad', 'ffill', None}，默认None
            用于填充重新索引系列垫/填充中的孔的方法：
                将最后一个有效观察向前传播到下一个有效回填/bfill：使用下一个有效观察来填充间隙。

        axis：{0 或“索引”、1 或“列”}
            沿其填充缺失值的轴。

        inplace：bool，默认 False
            如果为真，则就地填写。
                注意：这将修改此对象上的任何其他视图（例如，DataFrame 中列的无复制切片）。

        limit： int 默认None
            如果指定了方法，则这是向前/向后填充的连续 NaN 值的最大数量。
            换句话说，如果有超过这个数量的连续 NaN 的间隙，它只会被部分填充。
            如果未指定方法，则这是沿整个轴将填充 NaN 的最大条目数。如果不是无，则必须大于 0。

        downcast：dict，默认为 None
            一个 item-&gt;dtype 的字典，如果可能的话，或者字符串 'infer'，
            它将尝试向下转换为适当的相等类型（例如，如果可能，float64 到 int64）
'''</span>
</code></pre> 
<p>创建表以便学习</p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'aaabcd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s
</code></pre> 
<p>示例1：</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">'ffill'</span><span class="token punctuation">)</span> <span class="token comment"># 用前面的值向后填充</span>
</code></pre> 
<pre><code class="prism language-python">a    NaN
a    <span class="token number">1.0</span>
a    <span class="token number">1.0</span>
b    <span class="token number">1.0</span>
c    <span class="token number">2.0</span>
d    <span class="token number">2.0</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>示例2：</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">'ffill'</span><span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 连续出现的缺失，最多填充一次</span>
</code></pre> 
<pre><code class="prism language-python">a    NaN
a    <span class="token number">1.0</span>
a    <span class="token number">1.0</span>
b    NaN
c    <span class="token number">2.0</span>
d    <span class="token number">2.0</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>示例3：</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>s<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># value为标量</span>
</code></pre> 
<pre><code class="prism language-python">a    <span class="token number">1.5</span>
a    <span class="token number">1.0</span>
a    <span class="token number">1.5</span>
b    <span class="token number">1.5</span>
c    <span class="token number">2.0</span>
d    <span class="token number">1.5</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>示例4：</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 通过索引映射填充的值</span>
</code></pre> 
<pre><code class="prism language-python">a    <span class="token number">100.0</span>
a      <span class="token number">1.0</span>
a    <span class="token number">100.0</span>
b      NaN
c      <span class="token number">2.0</span>
d    <span class="token number">200.0</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>有时为了更加合理地填充，需要先进行<u><strong>分组</strong></u>后再操作</p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Grade'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Height'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">158.900000</span>
<span class="token number">1</span>    <span class="token number">166.500000</span>
<span class="token number">2</span>    <span class="token number">188.900000</span>
<span class="token number">3</span>    <span class="token number">163.075862</span>
<span class="token number">4</span>    <span class="token number">174.000000</span>
Name<span class="token punctuation">:</span> Height<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<h3>
<a id="_4500"></a>插值</h3> 
<p>​ 对于 <code>interpolate</code> 而言，除了插值方法（默认为 linear 线性插值）之外，有与 fillna 类似的两个常用参数，一个是控制方向的 limit_direction ，另一个是控制最大连续缺失值插值个数的 limit 。其中，限制插值的方向默认为 forward ，这与 fillna 的 method 中的 ffill 是类似的，若想要后向限制插值或者双向限制插值可以指定为 backward 或 both 。</p> 
<h3>
<a id="Nullable_4506"></a>Nullable类型</h3> 
<p>####基本概念</p> 
<p>​ 在 python 中的缺失值用 None 表示，<strong>该元素除了等于自己本身之外，与其他任何元素不相等</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token boolean">None</span> <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token boolean">None</span> <span class="token operator">==</span> <span class="token boolean">False</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token boolean">True</span>
<span class="token boolean">False</span>
</code></pre> 
<p>​ 在 numpy 中利用 np.nan 来表示缺失值，<strong>该元素除了不和其他任何元素相等之外，和自身的比较结果也返回 False</strong></p> 
<pre><code class="prism language-python">np<span class="token punctuation">.</span>nan <span class="token operator">==</span> np<span class="token punctuation">.</span>nan
</code></pre> 
<pre><code class="prism language-python"><span class="token boolean">False</span>
</code></pre> 
<blockquote> 
 <p>注意：虽然<strong>在对缺失序列或表格的元素进行比较操作的时候</strong>，<code>np.nan</code>的对应位置会返回**<code>False</code><strong>，但是在使用</strong><code>equals</code><strong>函数进行两张表或两个序列的相同性检验时，会自动</strong>跳过两侧表都是缺失值的位置**，直接返回**<code>True</code>**</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    DataFrame.equals(other)
    测试两个对象是否包含相同的元素。
    此功能允许将两个 Series 或 DataFrame 相互比较，以查看它们是否具
    有相同的形状和元素。同一位置的 NaN 被认为是相等的。
    行/列索引不需要具有相同的类型，只要值被认为是相等的。对应的列必须
    参数
        other：Series或DataFrame
            要与第一个进行比较的其他 Series 或 DataFrame。具有相同的 dtype。

    return：bool
        如果两个对象中的所有元素都相同，则为 True，否则为 False
'''</span>
</code></pre> 
<p>示例1：</p> 
<pre><code class="prism language-python">s1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">)</span>
s2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">)</span>
s1 <span class="token operator">==</span> <span class="token number">1</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     <span class="token boolean">True</span>
<span class="token number">1</span>    <span class="token boolean">False</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
</code></pre> 
<p>示例2：</p> 
<pre><code class="prism language-python">s1<span class="token punctuation">.</span>equals<span class="token punctuation">(</span>s2<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token boolean">False</span>
</code></pre> 
<p>示例3：</p> 
<pre><code class="prism language-python">s1<span class="token punctuation">.</span>equals<span class="token punctuation">(</span>s3<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token boolean">True</span>
</code></pre> 
<p>​ 在<strong>时间序列</strong>的对象中， pandas 利用 <code>pd.NaT</code>来指代缺失值，它的作用和 <strong><code>np.nan</code> 是一致的</strong></p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>to_timedelta<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'30s'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># Timedelta中的NaT</span>
</code></pre> 
<pre><code class="prism language-python">TimedeltaIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'0 days 00:00:30'</span><span class="token punctuation">,</span> NaT<span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'timedelta64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'20200101'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># Datetime中的NaT</span>
</code></pre> 
<pre><code class="prism language-python">DatetimeIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020-01-01'</span><span class="token punctuation">,</span> <span class="token string">'NaT'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>​ 在 pandas 中可以看到 object 类型的对象，而 object 是一种<u><strong>混杂对象</strong></u>类型，如果出现了多个类型的元素同时存储在 Series 中，它的类型就会变成 object</p> 
</blockquote> 
<blockquote> 
 <p>​ <font color="red">NaT的问题根源在于np.nan本身是一种浮点型，<strong>如果浮点型和时间类型混合存储，就会成为object</strong></font></p> 
</blockquote> 
<p>​ 因此，pandas尝试设计了一种新的缺失类型pd.NA以及三种Nullable序列类型来应对，它们分别是<code>Int,boolean和strin</code></p> 
<h4>
<a id="_4619"></a>性质</h4> 
<p>​ Nullable性质就是<strong>序列类型不受缺失值影响</strong>的类型</p> 
<p>​ 在**<code>Int,boolean和strin</code><strong>中存储</strong>缺失值**，pandas都会转为内置的<code>pd.NA</code></p> 
<p>示例1：</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype <span class="token operator">=</span> <span class="token string">'Int64'</span><span class="token punctuation">)</span> <span class="token comment"># "i"是大写的</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token operator">&lt;</span>NA<span class="token operator">&gt;</span>
<span class="token number">1</span>       <span class="token number">1</span>
dtype<span class="token punctuation">:</span> Int64
</code></pre> 
<p>示例2：</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype <span class="token operator">=</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token operator">&lt;</span>NA<span class="token operator">&gt;</span>
<span class="token number">1</span>    <span class="token boolean">True</span>
dtype<span class="token punctuation">:</span> boolean
</code></pre> 
<p>示例3：</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token string">'my_str'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype <span class="token operator">=</span> <span class="token string">'string'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>      <span class="token operator">&lt;</span>NA<span class="token operator">&gt;</span>
<span class="token number">1</span>    my_str
dtype<span class="token punctuation">:</span> string
</code></pre> 
<blockquote> 
 <p>如果在Int类型序列乘以小数，只会是浮点型</p> 
</blockquote> 
<ul><li><strong>pandas的<code>boolean</code>类型 与 python的<code>bool</code>类型的区别</strong></li></ul> 
<p>1 . 带有缺失值的布尔列表无法进行索引器选择，，而**<code>boolean</code>**会把缺失值看作<code>False</code></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s_bool <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#不会把np.nan看成False+</span>
s_boolean <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'boolean'</span><span class="token punctuation">)</span>
<span class="token comment"># s[s_bool] # 报错</span>
s<span class="token punctuation">[</span>s_boolean<span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    a
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<p>2 . 在逻辑运算的时候<strong>bool类型在缺失处返回的永远是<code>False</code></strong>，而<code>boolean</code>会根据逻辑运算是否能确定唯一结果来返回相应的值</p> 
<pre><code class="prism language-python">s_boolean <span class="token operator">&amp;</span> <span class="token boolean">True</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token boolean">True</span>
<span class="token number">1</span>    <span class="token operator">&lt;</span>NA<span class="token operator">&gt;</span>
dtype<span class="token punctuation">:</span> boolean
</code></pre> 
<pre><code class="prism language-python">s_boolean <span class="token operator">|</span> <span class="token boolean">True</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token boolean">True</span>
<span class="token number">1</span>    <span class="token boolean">True</span>
dtype<span class="token punctuation">:</span> boolean
</code></pre> 
<pre><code class="prism language-python"><span class="token operator">~</span>s_boolean <span class="token comment"># 取反操作同样是无法唯一地判断缺失结果</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token boolean">False</span>
<span class="token number">1</span>     <span class="token operator">&lt;</span>NA<span class="token operator">&gt;</span>
dtype<span class="token punctuation">:</span> boolean
</code></pre> 
<ul><li>一般在实际数据处理时，可以在数据集读入后，先通过<code>convert_dtypes</code>转为Nullable类型</li></ul> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>convert_dtypes<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>dtypes
</code></pre> 
<pre><code class="prism language-python">School          string
Grade           string
Name            string
Gender          string
Height         Float64
Weight           Int64
Transfer        string
Test_Number      Int64
Test_Date       string
Time_Record     string
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<h3>
<a id="_4746"></a>计算和分组</h3> 
<p>​ 当调用函数sum,prod使用加法和乘法的时候，缺失数据等价于被<strong>分别视作0和1</strong>，即不改变原来的计算</p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">14.0</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>prod<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">120.0</span>
</code></pre> 
<p>​ 当使用累计函数时，会<strong>自动跳过缺失值所处的位置</strong></p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     <span class="token number">2.0</span>
<span class="token number">1</span>     <span class="token number">5.0</span>
<span class="token number">2</span>     NaN
<span class="token number">3</span>     <span class="token number">9.0</span>
<span class="token number">4</span>    <span class="token number">14.0</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>​ 除了<code>np.nan**0</code> 或 <code>np.nan**1</code> 这两种情况为确定值之外(结果为<code>1.0</code>)，<strong>所有运算返回结果全为缺失</strong>(pd.NA的行为与此一致)，并且<code>np.nan</code>在<strong>比较操作时一定返回<code>False</code></strong>，而**<code>pd.NA</code><strong>返回</strong><code>pd.NA</code>**</p> 
<h3>
<a id="diffpct_change_4792"></a>diff与pct_change</h3> 
<p>​ 前者<strong>凡是缺失计算都设置为缺失值</strong>，后者<strong>缺失位置会被设置为<code>0%</code>的变化率</strong></p> 
<ul><li><code>diff</code></li></ul> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    NaN
<span class="token number">1</span>    <span class="token number">1.0</span>
<span class="token number">2</span>    NaN
<span class="token number">3</span>    NaN
<span class="token number">4</span>    <span class="token number">1.0</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<ul><li><code>pct_change()</code></li></ul> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>         NaN
<span class="token number">1</span>    <span class="token number">0.500000</span>
<span class="token number">2</span>    <span class="token number">0.000000</span>
<span class="token number">3</span>    <span class="token number">0.333333</span>
<span class="token number">4</span>    <span class="token number">0.250000</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<h3>
<a id="_4828"></a>缺失值分组</h3> 
<p>​ 缺失值可以作为一个类别来处理，在分组(<code>groupby</code>)里面的**<code>get_dummies</code><strong>函数来</strong>增加缺失类别**</p> 
<p>创建表便于学习</p> 
<pre><code class="prism language-python">df_nan <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'category'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'value'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df_nan
</code></pre> 
<pre><code class="prism language-python">	category	value
<span class="token number">0</span>		a		<span class="token number">1</span>
<span class="token number">1</span>		a		<span class="token number">3</span>
<span class="token number">2</span>		b		<span class="token number">5</span>
<span class="token number">3</span>		NaN		<span class="token number">7</span>
<span class="token number">4</span>		NaN		<span class="token number">9</span>
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-python"><span class="token comment">#先分组</span>
df_nan<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">,</span>dropna<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># pandas版本大于1.1.0</span>
</code></pre> 
<pre><code class="prism language-python">category
a      <span class="token number">2.0</span>
b      <span class="token number">5.0</span>
NaN    <span class="token number">8.0</span>
Name<span class="token punctuation">:</span> value<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>df_nan<span class="token punctuation">.</span>category<span class="token punctuation">,</span> dummy_na<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	a	b	NaN
<span class="token number">0</span>	<span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">0</span>
<span class="token number">1</span>	<span class="token number">1</span>	<span class="token number">0</span>	<span class="token number">0</span>
<span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">1</span>	<span class="token number">0</span>
<span class="token number">3</span>	<span class="token number">0</span>	<span class="token number">0</span>	<span class="token number">1</span>
<span class="token number">4</span>	<span class="token number">0</span>	<span class="token number">0</span>	<span class="token number">1</span>
</code></pre> 
<h2>
<a id="_4880"></a>文本数据</h2> 
<h3>
<a id="str_4882"></a>str对象</h3> 
<p>​ <strong>str 对象是定义在 Index 或 Series 上的属性</strong>，与python中的str模块类似</p> 
<pre><code class="prism language-python">var <span class="token operator">=</span> <span class="token string">'abcd'</span>
<span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span>var<span class="token punctuation">)</span> <span class="token comment"># Python内置str模块</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token string">'ABCD'</span>
</code></pre> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'abcd'</span><span class="token punctuation">,</span> <span class="token string">'efg'</span><span class="token punctuation">,</span> <span class="token string">'hi'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># pandas中str对象上的upper方法</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    ABCD
<span class="token number">1</span>     EFG
<span class="token number">2</span>      HI
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<p>###string类型</p> 
<h3>
<a id="_4915"></a>文本处理操作</h3> 
<h4>
<a id="_4917"></a>拆分</h4> 
<p>​ <code>str.split()</code></p> 
<p>​ 第一个参数为**<code>正则表达式</code><strong>,第二个参数为从左到右</strong>最大拆分**字数<code>n</code>，是否展开为多个列<code>expand</code></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'上海市黄浦区方浜中路249号'</span><span class="token punctuation">,</span><span class="token string">'上海市宝山区密山路5号'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'[市区路]'</span><span class="token punctuation">)</span><span class="token comment">#正则表达式</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>   	<span class="token punctuation">[</span>上海<span class="token punctuation">,</span> 黄浦<span class="token punctuation">,</span> 方浜中<span class="token punctuation">,</span> <span class="token number">249</span>号<span class="token punctuation">]</span>
<span class="token number">1</span>       <span class="token punctuation">[</span>上海<span class="token punctuation">,</span> 宝山<span class="token punctuation">,</span> 密山<span class="token punctuation">,</span> <span class="token number">5</span>号<span class="token punctuation">]</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'[市区路]'</span><span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment">#n最大拆分次数，expend是否展开多个列</span>
</code></pre> 
<pre><code class="prism language-python">	<span class="token number">0</span>	 <span class="token number">1</span>	   <span class="token number">2</span>
<span class="token number">0</span>	上海	黄浦	方浜中路<span class="token number">249</span>号
<span class="token number">1</span>	上海	宝山	密山路<span class="token number">5</span>号
</code></pre> 
<h4>
<a id="_4948"></a>合并</h4> 
<p>​ <code>str.join()</code></p> 
<p>​ 用某个链接把<code>Series</code>中的字符串列表连起来，列表中出现了<strong>非字符串元素则返回缺失值</strong></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token comment">#因为出现非字符串元素，所以返回了缺失值</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    a<span class="token operator">-</span>b
<span class="token number">1</span>    NaN
<span class="token number">2</span>    NaN
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<p>​ <code>str.cat()</code></p> 
<p>​ 用于<strong>合并两个序列</strong>,主要参数为**<code>连接符sep,连接形式join,缺失值代替符号na_rep</code><strong>，其中连接形式默认为以</strong>索引为键的左连接**</p> 
<pre><code class="prism language-python">s1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'cat'</span><span class="token punctuation">,</span><span class="token string">'dog'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s1<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>cat<span class="token punctuation">(</span>s2<span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    a<span class="token operator">-</span>cat
<span class="token number">1</span>    b<span class="token operator">-</span>dog
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<pre><code class="prism language-python">s2<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
s1<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>cat<span class="token punctuation">(</span>s2<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> na_rep<span class="token operator">=</span><span class="token string">'?'</span><span class="token punctuation">,</span> join<span class="token operator">=</span><span class="token string">'outer'</span><span class="token punctuation">)</span><span class="token comment">#na_rep缺失值代替符号</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>      a<span class="token operator">-</span>?
<span class="token number">1</span>    b<span class="token operator">-</span>cat
<span class="token number">2</span>    ?<span class="token operator">-</span>dog
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<h4>
<a id="_5000"></a>匹配</h4> 
<p>​ <code>str.contains()</code></p> 
<p>​ 返回<strong>每个字符串是否符合正则表达式的布尔索引</strong></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'my cat'</span><span class="token punctuation">,</span> <span class="token string">'he is fat'</span><span class="token punctuation">,</span> <span class="token string">'railway station'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'swat'</span><span class="token punctuation">)</span><span class="token comment">#给出正则模式，查找包含了这个正则的字符串元素，如果找得到就返回True</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     <span class="token boolean">True</span>
<span class="token number">1</span>     <span class="token boolean">True</span>
<span class="token number">2</span>    <span class="token boolean">False</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
</code></pre> 
<p>​ <code>str.startswith()</code>返回以<strong>给定模式开始</strong>的<strong>布尔序列</strong></p> 
<p>​ <code>str.endwith()</code> 返回以<strong>给定模式结束</strong>的<strong>布尔序列</strong></p> 
<p>​ <font color="red"><strong>他们都不支持正则表达式</strong></font></p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'my'</span><span class="token punctuation">)</span><span class="token comment">#指定开始字符</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     <span class="token boolean">True</span>
<span class="token number">1</span>    <span class="token boolean">False</span>
<span class="token number">2</span>    <span class="token boolean">False</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'t'</span><span class="token punctuation">)</span><span class="token comment">#指定结束字符</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     <span class="token boolean">True</span>
<span class="token number">1</span>     <span class="token boolean">True</span>
<span class="token number">2</span>    <span class="token boolean">False</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
</code></pre> 
<p>​ <code>str.match()</code>返回<strong>每组字符串是否符合正则表达式</strong>的<strong>布尔序列</strong></p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">'m|h'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     <span class="token boolean">True</span>
<span class="token number">1</span>     <span class="token boolean">True</span>
<span class="token number">2</span>    <span class="token boolean">False</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">'ta[f|g]|n'</span><span class="token punctuation">)</span> <span class="token comment"># 反转后匹配</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token boolean">False</span>
<span class="token number">1</span>     <span class="token boolean">True</span>
<span class="token number">2</span>     <span class="token boolean">True</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
</code></pre> 
<blockquote> 
 <p>当然，这些也能通过在 str.contains 的正则中使用 ^ 和 <code>$</code> 来实现</p> 
</blockquote> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'^[m|h]'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     <span class="token boolean">True</span>
<span class="token number">1</span>     <span class="token boolean">True</span>
<span class="token number">2</span>    <span class="token boolean">False</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
</code></pre> 
<p><strong>返回索引的匹配函数</strong></p> 
<p>​ <strong><code>str.find()</code></strong> 返回<strong>从左到右</strong>第一次匹配的位置索引，未找到则返回<code>-1</code></p> 
<p>​ <strong><code>str.rfind()</code></strong> 返回<strong>从右到左</strong>第一次匹配的位置索引，未找到则返回<code>-1</code></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'This is an apple. That is not an apple.'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">11</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">33</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<h4>
<a id="_5129"></a>替换</h4> 
<p>​ <code>str.replace()</code></p> 
<p>​ <code>str.replace</code> 和 <code>replace</code> 并不是一个函数，在使用字符串替换时应当使用前者</p> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    Series.str.replace(pat, repl, n=- 1, case=None, flags=0, regex=None)
    替换系列/索引中每次出现的模式/正则表达式
    参数
        pat：str或编译的正则表达式
            字符串可以是字符序列或正则表达式。

        repl：str或可调用
            替换ment字符串或可调用对象。可调用对象传递正则表达式匹配对象，
            并且必须返回要使用的替换字符串。见re.sub()。

        n：int，默认 -1（全部）
            从一开始就进行的更换次数。

        case：布尔值，默认无
            确定替换是否区分大小写：
                如果为 True，则区分大小写（如果pat是字符串，则为默认值）
                设置为 False 不区分大小写
                如果pat是已编译的正则表达式，则无法设置。

        flags：int，默认 0（无标志）
            正则表达式模块标志，例如 re.IGNORECASE。如果pat是已编译的正则表达式，则无法设置。

        regex：bool，默认 True
            确定传入的模式是否是正则表达式：
                如果为 True，则假定传入的模式是正则表达式。
                如果为False ，则将模式视为文字字符串
                如果pat是已编译的正则表达式或repl是可调用的，则不能设置为 False 。
'''</span>
</code></pre> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a_1_b'</span><span class="token punctuation">,</span><span class="token string">'c_?'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'d|?'</span><span class="token punctuation">,</span> <span class="token string">'new'</span><span class="token punctuation">,</span> regex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment">#regex是否使用正则表达式</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    a_new_b
<span class="token number">1</span>      c_new
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<ul><li>当需要对<strong>不同部分</strong>进行<strong>有差别</strong>的替换时，用子组的方法可以通过<strong>传入自定义的替换函数</strong>来分别处理字符串</li></ul> 
<blockquote> 
 <p>注意：group(k)代表匹配到第k个子组</p> 
</blockquote> 
<p>创建表便于学习</p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'上海市黄浦区方浜中路249号'</span><span class="token punctuation">,</span>
                <span class="token string">'上海市宝山区密山路5号'</span><span class="token punctuation">,</span>
                <span class="token string">'北京市昌平区北农路2号'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

pat <span class="token operator">=</span> <span class="token string">'(w+市)(w+区)(w+路)(d+号)'</span>

city <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'上海市'</span><span class="token punctuation">:</span> <span class="token string">'Shanghai'</span><span class="token punctuation">,</span> <span class="token string">'北京市'</span><span class="token punctuation">:</span> <span class="token string">'Beijing'</span><span class="token punctuation">}</span>

district <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'昌平区'</span><span class="token punctuation">:</span> <span class="token string">'CP District'</span><span class="token punctuation">,</span>
            <span class="token string">'黄浦区'</span><span class="token punctuation">:</span> <span class="token string">'HP District'</span><span class="token punctuation">,</span>
            <span class="token string">'宝山区'</span><span class="token punctuation">:</span> <span class="token string">'BS District'</span><span class="token punctuation">}</span>

road <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'方浜中路'</span><span class="token punctuation">:</span> <span class="token string">'Mid Fangbin Road'</span><span class="token punctuation">,</span>
        <span class="token string">'密山路'</span><span class="token punctuation">:</span> <span class="token string">'Mishan Road'</span><span class="token punctuation">,</span>
        <span class="token string">'北农路'</span><span class="token punctuation">:</span> <span class="token string">'Beinong Road'</span><span class="token punctuation">}</span>
</code></pre> 
<p>创建字符串替换函数：</p> 
<pre><code class="prism language-python"><span class="token comment">#创建字符替换函数</span>
<span class="token keyword">def</span> <span class="token function">my_func</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    str_city <span class="token operator">=</span> city<span class="token punctuation">[</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    str_district <span class="token operator">=</span> district<span class="token punctuation">[</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    str_road <span class="token operator">=</span> road<span class="token punctuation">[</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    str_no <span class="token operator">=</span> <span class="token string">'No. '</span> <span class="token operator">+</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>str_city<span class="token punctuation">,</span>
                    str_district<span class="token punctuation">,</span>
                    str_road<span class="token punctuation">,</span>
                    str_no<span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>pat<span class="token punctuation">,</span> my_func<span class="token punctuation">,</span> regex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    Shanghai HP District Mid Fangbin Road No<span class="token punctuation">.</span> <span class="token number">249</span>
<span class="token number">1</span>           Shanghai BS District Mishan Road No<span class="token punctuation">.</span> <span class="token number">5</span>
<span class="token number">2</span>           Beijing CP District Beinong Road No<span class="token punctuation">.</span> <span class="token number">2</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<ul><li>可以使用 <strong>命名子组</strong> 更加清晰地写出子组代表的含义</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#创建正则表达式并给每个组命名</span>
pat <span class="token operator">=</span> <span class="token string">'(?P&lt;市名&gt;w+市)(?P&lt;区名&gt;w+区)(?P&lt;路名&gt;w+路)(?P&lt;编号&gt;d+号)'</span>
<span class="token comment">#&lt;&gt;中间的就是组的名字</span>

<span class="token keyword">def</span> <span class="token function">my_func</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    str_city <span class="token operator">=</span> city<span class="token punctuation">[</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token string">'市名'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    str_district <span class="token operator">=</span> district<span class="token punctuation">[</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token string">'区名'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    str_road <span class="token operator">=</span> road<span class="token punctuation">[</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token string">'路名'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    str_no <span class="token operator">=</span> <span class="token string">'No. '</span> <span class="token operator">+</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token string">'编号'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>str_city<span class="token punctuation">,</span>
                    str_district<span class="token punctuation">,</span>
                    str_road<span class="token punctuation">,</span>
                    str_no<span class="token punctuation">]</span><span class="token punctuation">)</span>

s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>pat<span class="token punctuation">,</span> my_func<span class="token punctuation">,</span> regex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    Shanghai HP District Mid Fangbin Road No<span class="token punctuation">.</span> <span class="token number">249</span>
<span class="token number">1</span>           Shanghai BS District Mishan Road No<span class="token punctuation">.</span> <span class="token number">5</span>
<span class="token number">2</span>           Beijing CP District Beinong Road No<span class="token punctuation">.</span> <span class="token number">2</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<h4>
<a id="_5260"></a>提取</h4> 
<p>​ <code>str.extract(regex)</code></p> 
<p>​ 用正则表达式提取字符串(<strong>只匹配一个</strong>)</p> 
<pre><code class="prism language-python">pat <span class="token operator">=</span> <span class="token string">'(w+市)(w+区)(w+路)(d+号)'</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span>pat<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	<span class="token number">0</span>		<span class="token number">1</span>		<span class="token number">2</span>		<span class="token number">3</span>
<span class="token number">0</span>	上海市	黄浦区	方浜中路	<span class="token number">249</span>号
<span class="token number">1</span>	上海市	宝山区	密山路		<span class="token number">5</span>号
<span class="token number">2</span>	北京市	昌平区	北农路		<span class="token number">2</span>号
</code></pre> 
<ul><li>通过子组的命名，可以<strong>直接对新生成 DataFrame 的列命名</strong>
</li></ul> 
<pre><code class="prism language-python">pat <span class="token operator">=</span> <span class="token string">'(?P&lt;市名&gt;w+市)(?P&lt;区名&gt;w+区)(?P&lt;路名&gt;w+路)(?P&lt;编号&gt;d+号)'</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span>pat<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">	市名	区名		路名		编号
<span class="token number">0</span>	上海市	黄浦区	方浜中路	<span class="token number">249</span>号
<span class="token number">1</span>	上海市	宝山区	密山路		<span class="token number">5</span>号
<span class="token number">2</span>	北京市	昌平区	北农路		<span class="token number">2</span>号
</code></pre> 
<p>​ <code>str.extractall()</code></p> 
<p>​ 它会把所有符合条件的模式<strong>全部匹配</strong>出来，如果存在多个结果，则以<strong>多级索引的方式存储</strong></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A135T15,A26S5'</span><span class="token punctuation">,</span><span class="token string">'B674S2,B25T6'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'my_A'</span><span class="token punctuation">,</span><span class="token string">'my_B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pat <span class="token operator">=</span> <span class="token string">'[A|B](d+)[T|S](d+)'</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>pat<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">			<span class="token number">0</span>	<span class="token number">1</span>
	<span class="token keyword">match</span>		
my_A	<span class="token number">0</span>	<span class="token number">135</span>	<span class="token number">15</span>
		<span class="token number">1</span>	<span class="token number">26</span>	<span class="token number">5</span>
my_B	<span class="token number">0</span>	<span class="token number">674</span>	<span class="token number">2</span>
		<span class="token number">1</span>	<span class="token number">25</span>	<span class="token number">6</span>
</code></pre> 
<pre><code class="prism language-python">pat_with_name <span class="token operator">=</span> <span class="token string">'[A|B](?P&lt;name1&gt;d+)[T|S](?P&lt;name2&gt;d+)'</span>
s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>extractall<span class="token punctuation">(</span>pat_with_name<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">			<span class="token number">0</span>	<span class="token number">1</span>
	<span class="token keyword">match</span>		
my_A	<span class="token number">0</span>	<span class="token number">135</span>	<span class="token number">15</span>
		<span class="token number">1</span>	<span class="token number">26</span>	<span class="token number">5</span>
my_B	<span class="token number">0</span>	<span class="token number">674</span>	<span class="token number">2</span>	
		<span class="token number">1</span>	<span class="token number">25</span>	<span class="token number">6</span>
</code></pre> 
<p>​ <code>str.findall()</code></p> 
<p>​ 也是把所有符合条件的模式<strong>全部匹配</strong>出来，但是它把结果存入<strong>列表</strong>中</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>findall<span class="token punctuation">(</span>pat<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">my_A    <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
my_B     <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">674</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<h3>
<a id="_5349"></a>常用字符串函数</h3> 
<h4>
<a id="_5351"></a>字符串函数</h4> 
<ul>
<li>
<code>str.upper</code>(小写变大写)</li>
<li>
<code>str.lower</code>(大写变小写)</li>
<li>
<code>str.swapcase</code>(小写变大写，大写变小写)</li>
<li>
<code>str.capitalize</code>(句首大写，其余都小写)</li>
<li>
<code>str.title</code>(单词首字母大写，其余都小写)</li>
</ul> 
<h4>
<a id="_5361"></a>数值型函数</h4> 
<p>​ <code>pd.to_numeric</code></p> 
<p>​ <strong>对字符格式的数值进行快速转换和筛选</strong>，其主要参数包括 <code>errors</code> 和 <code>downcast</code> 分别代表了<strong>非数的处理模式</strong>和<strong>转换类型</strong>。其中，对于不能转换为数值的有三种 <code>errors</code> 选项， <code>raise</code>, <code>coerce</code>, <code>ignore</code> 分别表示<strong>直接报错</strong>、<strong>设为缺失</strong>以及<strong>保持原来的字符串</strong></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2.2'</span><span class="token punctuation">,</span> <span class="token string">'2e'</span><span class="token punctuation">,</span> <span class="token string">'??'</span><span class="token punctuation">,</span> <span class="token string">'-2.1'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>s<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>       <span class="token number">1</span>
<span class="token number">1</span>     <span class="token number">2.2</span>
<span class="token number">2</span>      2e
<span class="token number">3</span>      ??
<span class="token number">4</span>    <span class="token operator">-</span><span class="token number">2.1</span>
<span class="token number">5</span>       <span class="token number">0</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>s<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'coerce'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">1.0</span>
<span class="token number">1</span>    <span class="token number">2.2</span>
<span class="token number">2</span>    NaN
<span class="token number">3</span>    NaN
<span class="token number">4</span>   <span class="token operator">-</span><span class="token number">2.1</span>
<span class="token number">5</span>    <span class="token number">0.0</span>
dtype<span class="token punctuation">:</span> float64
</code></pre> 
<ul><li>在<strong>数据清洗</strong>的时候，可以利用**<code>coerce</code><strong>快速查看</strong>非数值型的行**</li></ul> 
<pre><code class="prism language-python">s<span class="token punctuation">[</span>pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>s<span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'coerce'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2</span>    2e
<span class="token number">3</span>    ??
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<h4>
<a id="_5414"></a>统计型函数</h4> 
<p>​ <code>count</code> 和 <code>len</code> 的作用分别是返回出现<strong>正则表达式</strong>匹配的<strong>次数</strong>和<strong>字符串的长度</strong></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'cat rat fat at'</span><span class="token punctuation">,</span> <span class="token string">'get feed sheet heat'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'[r|f]at|ee'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">2</span>
<span class="token number">1</span>    <span class="token number">2</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">14</span>
<span class="token number">1</span>    <span class="token number">19</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<h4>
<a id="_5446"></a>格式型函数</h4> 
<ul>
<li> <p><strong>除空型</strong></p> <p>​ <strong><code>strip()</code></strong> 去除两侧空格</p> <p>​ <strong><code>rstrip()</code></strong> 去除右侧空格</p> <p>​ <strong><code>lstrip()</code></strong> 去除左侧空格</p> </li>
<li> <p><strong>填充型</strong></p> <p>​ <strong>pad()</strong></p> <p>​ 可以选定<strong>字符串长度</strong>，<strong>填充的方向</strong>和<strong>填充内容</strong></p> </li>
</ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>pad<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'left'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token operator">**</span><span class="token operator">**</span>a
<span class="token number">1</span>    <span class="token operator">**</span><span class="token operator">**</span>b
<span class="token number">2</span>    <span class="token operator">**</span><span class="token operator">**</span>c
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<blockquote> 
 <p><code>left,right,both</code>，<code>both</code>是两边一起填充</p> 
</blockquote> 
<ul><li>填充型的pad()可以用<code>rjust,ljust,center</code>来等效完成</li></ul> 
<blockquote> 
 <p><strong><code>ljust</code><strong>是</strong>右填充</strong>，<strong><code>rjust</code><strong>是</strong>左填充</strong></p> 
</blockquote> 
<ul><li>在读取 excel 文件时，经常会出现数字前补0的需求除了可以使用上面的左侧填充函数进行操作之外，还可用 <code>zfill</code> 来实现</li></ul> 
<blockquote> 
 <p>例如证券代码读入的时候会把”000007”作为数值7来处理</p> 
</blockquote> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">,</span> <span class="token number">303000</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">000007</span>
<span class="token number">1</span>    <span class="token number">000155</span>
<span class="token number">2</span>    <span class="token number">303000</span>
dtype<span class="token punctuation">:</span> string
</code></pre> 
<h2>
<a id="_5510"></a>分类数据</h2> 
<h3>
<a id="cat_5512"></a>cat对象</h3> 
<p>​ <strong>分类类型</strong>：<code>category</code></p> 
<p>​ 可以用<code>astype()</code>方法直接转为<code>category</code>类型</p> 
<p>读取表格便于学习</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">,</span>
    usecols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Grade'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Gender'</span><span class="token punctuation">,</span> <span class="token string">'Height'</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">s <span class="token operator">=</span> df<span class="token punctuation">.</span>Grade<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     Freshman
<span class="token number">1</span>     Freshman
<span class="token number">2</span>       Senior
<span class="token number">3</span>    Sophomore
<span class="token number">4</span>    Sophomore
Name<span class="token punctuation">:</span> Grade<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Freshman'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">]</span>
</code></pre> 
<p>​ <strong>分类类型中定义了cat对象</strong>，与str类似，可以使用属性和方法</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>cat 
</code></pre> 
<pre><code class="prism language-python"><span class="token operator">&lt;</span>pandas<span class="token punctuation">.</span>core<span class="token punctuation">.</span>arrays<span class="token punctuation">.</span>categorical<span class="token punctuation">.</span>CategoricalAccessor <span class="token builtin">object</span> at <span class="token number">0x000001C2A8498970</span><span class="token operator">&gt;</span>
</code></pre> 
<p>​</p> 
<p>​ 分类类型具有<strong>两个部分</strong>：</p> 
<p>​ 1 . <code>categories</code> 类别本身(<strong>以Index类型存储</strong>)</p> 
<p>​ 2 . <code>ordered</code> 是否有序</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>categories<span class="token comment">#类别本身</span>
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Freshman'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>ordered<span class="token comment">#是否有序</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token boolean">False</span>
</code></pre> 
<p>​ <code>codes</code>用来访问类别被赋予的<strong>唯一整数编号</strong></p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>codes<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">0</span>
<span class="token number">1</span>    <span class="token number">0</span>
<span class="token number">2</span>    <span class="token number">2</span>
<span class="token number">3</span>    <span class="token number">3</span>
<span class="token number">4</span>    <span class="token number">3</span>
dtype<span class="token punctuation">:</span> int8
</code></pre> 
<p>####增,删,改</p> 
<blockquote> 
 <p><strong>注意：</strong><code>Index</code> 类型是无法用 <code>index_obj[0] = item</code> 来修改的</p> 
</blockquote> 
<ul><li>
<code>add_categories</code> 类别的增加</li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>add_categories<span class="token punctuation">(</span><span class="token string">'Graduate'</span><span class="token punctuation">)</span> <span class="token comment"># 增加一个毕业生类别</span>
s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>categories
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Freshman'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">,</span> <span class="token string">'Graduate'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li> <p><code>remove_categories</code>删除类别</p> <p>​ 原来的序列中该类会被设置为<strong>缺失</strong></p> </li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>remove_categories<span class="token punctuation">(</span><span class="token string">'Freshman'</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>categories
</code></pre> 
<pre><code>Index(['Junior', 'Senior', 'Sophomore', 'Graduate'], dtype='object')
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>          NaN
<span class="token number">1</span>          NaN
<span class="token number">2</span>       Senior
<span class="token number">3</span>    Sophomore
<span class="token number">4</span>    Sophomore
Name<span class="token punctuation">:</span> Grade<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Junior'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">,</span> <span class="token string">'Graduate'</span><span class="token punctuation">]</span>
</code></pre> 
<ul><li> <p><code>set_categories</code><strong>设置</strong>序列的类别</p> <p>​ 原先的类别会<strong>被覆盖</strong>，不满足就会设置为缺失</p> </li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>set_categories<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Sophomore'</span><span class="token punctuation">,</span><span class="token string">'PhD'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 新类别为大二学生和博士</span>
s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>categories
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Sophomore'</span><span class="token punctuation">,</span> <span class="token string">'PhD'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>          NaN
<span class="token number">1</span>          NaN
<span class="token number">2</span>          NaN
<span class="token number">3</span>    Sophomore
<span class="token number">4</span>    Sophomore
Name<span class="token punctuation">:</span> Grade<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Sophomore'</span><span class="token punctuation">,</span> <span class="token string">'PhD'</span><span class="token punctuation">]</span>
</code></pre> 
<ul><li>
<code>remove_unused_categories</code><strong>删除未出现在序列中</strong>的类别</li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>remove_unused_categories<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 移除了未出现的博士生类别</span>
s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>categories<span class="token comment">#序列中只有Sophomore</span>
</code></pre> 
<pre><code class="prism language-python">Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Sophomore'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li> <p><code>rename_categories</code>更改类别</p> <p>​ 以<strong>字典</strong>的方式更改类别</p> <p>​ 这个方法会对<strong>原序列的对应值也进行相应修改</strong></p> </li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>rename_categories<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'Sophomore'</span><span class="token punctuation">:</span><span class="token string">'本科二年级学生'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>        NaN
<span class="token number">1</span>        NaN
<span class="token number">2</span>        NaN
<span class="token number">3</span>    本科二年级学生
<span class="token number">4</span>    本科二年级学生
Name<span class="token punctuation">:</span> Grade<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'本科二年级学生'</span><span class="token punctuation">]</span>
</code></pre> 
<p>###有序分类</p> 
<p>​ <code>as_unordered</code> 有序类别</p> 
<p>​ <code>reorder_categories</code> 无序类别</p> 
<p><strong>无序类别</strong>:</p> 
<p>​ 传入的参数必须是由<strong>当前序列的无序类别构成的列表</strong>，不能够增加新的类别，也不能缺少原来的类别，并且**必须指定参数 <code>ordered=True</code> **，否则方法无效</p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> df<span class="token punctuation">.</span>Grade<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>reorder_categories<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Freshman'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">,</span><span class="token string">'Junior'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ordered<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment">#无序</span>
s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     Freshman
<span class="token number">1</span>     Freshman
<span class="token number">2</span>       Senior
<span class="token number">3</span>    Sophomore
<span class="token number">4</span>    Sophomore
Name<span class="token punctuation">:</span> Grade<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Freshman'</span> <span class="token operator">&lt;</span> <span class="token string">'Sophomore'</span> <span class="token operator">&lt;</span> <span class="token string">'Junior'</span> <span class="token operator">&lt;</span> <span class="token string">'Senior'</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>cat<span class="token punctuation">.</span>as_unordered<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     Freshman
<span class="token number">1</span>     Freshman
<span class="token number">2</span>       Senior
<span class="token number">3</span>    Sophomore
<span class="token number">4</span>    Sophomore
Name<span class="token punctuation">:</span> Grade<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Freshman'</span><span class="token punctuation">,</span> <span class="token string">'Sophomore'</span><span class="token punctuation">,</span> <span class="token string">'Junior'</span><span class="token punctuation">,</span> <span class="token string">'Senior'</span><span class="token punctuation">]</span>
</code></pre> 
<blockquote> 
 <p>如果不想指定 <code>ordered=True</code> 参数，那么可以先用 <code>s.cat.as_ordered()</code> 转化为有序类别，再利用 <code>reorder_categories</code> 进行具体的相对大小调整。</p> 
</blockquote> 
<h4>
<a id="_5756"></a>排序和比较</h4> 
<p>​ 只需把列的类型修改为 <code>category</code> 后，再赋予相应的大小关系，就能正常地使用 <strong><code>sort_index</code></strong> 和 <strong><code>sort_values</code></strong> 进行排序</p> 
<p>​</p> 
<p><code>==</code>, <code>!=</code> , <code>&gt;,&gt;=,&lt;,&lt;=</code> 都能进行比较，返回布尔型</p> 
<h3>
<a id="_5766"></a>区间类别</h3> 
<h4>
<a id="cutqcut_5768"></a>cut/qcut</h4> 
<p><strong>cut</strong></p> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
    pandas.cut(x, bins, right=True, labels=None, retbins=False, precision=3, include_lowest=False, duplicates='raise', ordered=True)
    将值分箱到离散区间中
    参数
        x：array-like
            要装箱的输入数组。必须是一维的。

        bins：int、sequence of scalars(标量序列) 或 IntervalIndex
        要装箱依据的条件。
            int ：定义 x 范围内等宽条柱的数量。x 的范围在每侧扩展 0.1%，以包括 x 的最小值和最大值。
            sequence of scalars(标量序列) ：定义允许非均匀宽度的条柱边。不扩展 x 的范围。
            IntervalIndex(间隔索引) ：定义要使用的确切条柱。请注意，条柱的间隔索引必须是非重叠的。

        right：布尔型 默认为 True
            指示条柱是否包含最右边。如果（默认值），则条柱指示 （1，2]、（2，3]、（3，4）。当条柱是
            间隔索引时，将忽略此参数。right == True[1, 2, 3, 4]

        labels：array 或 False，默认值"None"
            指定返回的条柱的标签。长度必须与生成的条柱相同。如果为 False，则仅返回条柱的整数指示符。
            这会影响输出容器的类型（见下文）。当条柱是间隔索引时，将忽略此参数。如果为 True，则引发错误。当排序=False时，必须提供标签。

        retbins：bool 默认 False
            是否退回垃圾箱。当箱作为标量提供时很有用。

        precision：int 默认值 3
            存储和显示库标签的精度。

        include_lowest：布尔型，默认为 False
            第一个间隔是否应为左包含区间。

        duplicates：{默认 ‘raise’, ‘drop’}，可选
            如果条柱边不唯一，请提高 ValueError 或删除非唯一边。

        ordered：布尔，默认为 True
            标签是否订购。适用于返回的类型"分类"和"系列"（使用分类 dtype）。如果为 True，则将对生成的
            分类进行排序。如果为 False，则生成的分类将是无序的（必须提供标签）。


    返回
        out：Categoryial， Series， or ndarray
            一个类似数组的对象，表示 x 的每个值的相应 bin。类型取决于标签的值。
            None（默认值）：为系列 x 返回一个系列，为所有其他输入返回一个分类。其中存储的值为间隔 dtype。
            标量序列 ：返回序列 x 的序列或所有其他输入的类别。其中存储的值是序列中的任何类型。
            False ：返回整数的 ndarray。

        bins：numpy.ndarray 或 IntervalIndex.
            计算的或指定的条柱。仅当 retbins=True 时才返回。对于标量或序列条柱，这是一个包含计算箱的 ndarray。
            如果设置重复项 = 丢弃，则条柱将丢弃非唯一条柱。对于间隔索引条柱，这等于条柱。
'''</span>
</code></pre> 
<p>​ 最重要的参数是 <code>bins</code>,传入整数 <code>n</code> 代表把整个传入数组的按照最大和最小值<strong>等间距</strong>地分为 <code>n</code> 段</p> 
<blockquote> 
 <p>区间默认是<strong>左开右闭</strong>,需要在调整时<strong>把最小值包含进去</strong></p> 
</blockquote> 
<p>​ pandas中的解决方案是在<strong>值最小的区间左端点</strong>再<em><strong>减去</strong></em>**<code>0.001*(max-min)</code>**</p> 
<p>​ 指定<strong>左闭右开</strong>时，需要把 <code>right</code> 参数设置为 <code>False</code> ，相应的区间调整方法是在<strong>值最大的区间右端点</strong>再<em><strong>加上</strong></em> **<code>0.001*(max-min)</code> **</p> 
<p>示例1:</p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>s<span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
	因为要包含最小值1，所以pandas做了 1-0.001*(2-1) 这个运算(1是左端点)
'''</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token punctuation">(</span><span class="token number">0.999</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span>
<span class="token number">1</span>      <span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span>
dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> interval<span class="token punctuation">[</span>float64<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0.999</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p>示例2：</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>s<span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token comment">#right左闭右开</span>
<span class="token triple-quoted-string string">'''
	因为要包含最大值2，所以pandas做了 2+0.001*(2-1) 这个运算(2是右端点)
'''</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>      <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
<span class="token number">1</span>    <span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.001</span><span class="token punctuation">)</span>
dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> interval<span class="token punctuation">[</span>float64<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.001</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<ul><li> <p><strong>指定区间分割点</strong></p> <p>​ 给<code>bins</code>一个<strong>列表</strong>，<code>np.infty</code>表示无穷大</p> </li></ul> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>s<span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span>np<span class="token punctuation">.</span>infty<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">1.8</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>infty<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token punctuation">(</span><span class="token operator">-</span>inf<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">]</span>
<span class="token number">1</span>     <span class="token punctuation">(</span><span class="token number">1.8</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">]</span>
dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> interval<span class="token punctuation">[</span>float64<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">-</span>inf<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">1.8</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1.8</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">2.2</span><span class="token punctuation">,</span> inf<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<ul><li> <p><strong>分割点常用参数</strong></p> <p>​ <code>labels</code>:指定区间名字</p> <p>​ <code>retbins</code>：是否返回分割点(默认False)</p> <p>​ 指定True之后会返回两个对象，第一个是区间分区，第二个是分割点数组，可以用索引访问</p> </li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>s<span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'small'</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> retbins<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    small
<span class="token number">1</span>      big
dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'small'</span> <span class="token operator">&lt;</span> <span class="token string">'big'</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python">res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># 该元素为返回的分割点</span>
</code></pre> 
<pre><code class="prism language-python">array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.999</span><span class="token punctuation">,</span> <span class="token number">1.5</span>  <span class="token punctuation">,</span> <span class="token number">2.</span>   <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>qcut</strong></p> 
<p>参数：</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
	pandas.qcut(x, q, labels=None, retbins=False, precision=3, duplicates='raise')
	基于分位数的离散化函数。
	根据排名或基于样本分位数将变量离散化为大小相等的桶
	
	参数:
		 x：array-like
            要装箱的输入数组。必须是一维的。
            
         q:int 或 list(float)
			分位数。10 用于十分位数，4 用于四分位数等。交替排列的分位数，例如 [0, .25, .5, .75, 1.] 用于四分位数。
            
         labels:array或False，默认None
			用作结果箱的标签。必须与生成的 bin 长度相同。如果为 False，则仅返回 bin 的整数指示符。如果为 True，则引发错误。
			
		 retbins：bool 默认 False
            是否退回垃圾箱。当箱作为标量提供时很有用。
            
         precision：int 默认 3
            存储和显示库标签的精度。
            
         duplicates：{默认 ‘raise’, ‘drop’}，可选
            如果条柱边不唯一，请提高 ValueError 或删除非唯一边
            
     return:
     	out:如果标签为 False，则输出分类或系列或整数数组返回类型（分类或系列）取决于输入：如果输入是系列，则为类别类型系列，否则为分类。当返回分类数据时，bin 表示为类别。

		bins:浮点数的ndarray
			仅当retbins为 True 时才返回
'''</span>
</code></pre> 
<p>​ <code>qcut</code>只是把<code>bins</code>参数改成<code>q</code>，<code>q</code>参数是指<code>quantile</code>，这里的 <code>q</code> 为<strong>整数</strong> <code>n</code> 时，指按照 <code>n</code> 等分位数把数据分箱，还可以传入<strong>浮点列表指代相应的分位数分割点</strong></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> df<span class="token punctuation">.</span>Weight
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>s<span class="token punctuation">,</span> q<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>      <span class="token punctuation">(</span><span class="token number">44.0</span><span class="token punctuation">,</span> <span class="token number">69.4</span><span class="token punctuation">]</span>
<span class="token number">1</span>      <span class="token punctuation">(</span><span class="token number">69.4</span><span class="token punctuation">,</span> <span class="token number">89.0</span><span class="token punctuation">]</span>
<span class="token number">2</span>      <span class="token punctuation">(</span><span class="token number">69.4</span><span class="token punctuation">,</span> <span class="token number">89.0</span><span class="token punctuation">]</span>
<span class="token number">3</span>    <span class="token punctuation">(</span><span class="token number">33.999</span><span class="token punctuation">,</span> <span class="token number">44.0</span><span class="token punctuation">]</span>
<span class="token number">4</span>      <span class="token punctuation">(</span><span class="token number">69.4</span><span class="token punctuation">,</span> <span class="token number">89.0</span><span class="token punctuation">]</span>
Name<span class="token punctuation">:</span> Weight<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> category
Categories <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> interval<span class="token punctuation">[</span>float64<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">33.999</span><span class="token punctuation">,</span> <span class="token number">44.0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">44.0</span><span class="token punctuation">,</span> <span class="token number">69.4</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">69.4</span><span class="token punctuation">,</span> <span class="token number">89.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p>####区间构造</p> 
<p>​ 三要素：<strong>左端点，右端点，开闭状态</strong></p> 
<p>​ <strong>开闭状态</strong>可以指定 <code>right, left, both, neither</code> 中的一类</p> 
<pre><code class="prism language-python">my_interval <span class="token operator">=</span> pd<span class="token punctuation">.</span>Interval<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'right'</span><span class="token punctuation">)</span>
my_interval
</code></pre> 
<pre><code class="prism language-python">Interval<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> closed<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
</code></pre> 
<p>​</p> 
<p>函数：<code>pd.Interval()</code></p> 
<p>​ 此函数创建的对象属性：</p> 
<p>​ 属性包含了 <code>mid, length, right, left, closed</code> ，分别表示<strong>中点、长度、右端点、左端点和开闭状态</strong></p> 
<p>​ 使用 <code>in</code> 可以判断元素是否属于区间</p> 
<p>​ 使用 <code>overlaps</code> 可以判断两个区间是否有交集</p> 
<ul><li> <p><strong><code>pd.IntervalIndex</code>对象</strong></p> <p>**<code>from_breaks</code>**传入列表，每个元素依次为左右端点</p> </li></ul> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>IntervalIndex<span class="token punctuation">.</span>from_breaks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> closed<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">IntervalIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              closed<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">'interval[int64]'</span><span class="token punctuation">)</span>
</code></pre> 
<p>​ <strong><code>from_arrays</code><strong>传入</strong>两个列表</strong>，两个列表的元素为<strong>对应形式</strong>成立区间</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>IntervalIndex<span class="token punctuation">.</span>from_arrays<span class="token punctuation">(</span>left <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                             right <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                             closed <span class="token operator">=</span> <span class="token string">'neither'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">IntervalIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              closed<span class="token operator">=</span><span class="token string">'neither'</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">'interval[int64]'</span><span class="token punctuation">)</span>
</code></pre> 
<p>​ **<code>from_tuples</code>**传入元组的列表，每个元组为一个区间</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>IntervalIndex<span class="token punctuation">.</span>from_tuples<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                             closed<span class="token operator">=</span><span class="token string">'neither'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">IntervalIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              closed<span class="token operator">=</span><span class="token string">'neither'</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">'interval[int64]'</span><span class="token punctuation">)</span>
</code></pre> 
<p>​ <strong><code>interval_range</code><strong>生成</strong>等差</strong>区间</p> 
<p>​ 参数：<code>start, end, periods, freq</code> 起点、终点、区间个数和区间长度</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>interval_range<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>periods<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">IntervalIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4.0</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4.5</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              closed<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">'interval[float64]'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>interval_range<span class="token punctuation">(</span>end<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>periods<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>freq<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">IntervalIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4.0</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4.5</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              closed<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">'interval[float64]'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>把 <code>Interval</code> 类型的列表组成传入其中转为区间索引，那<strong>么所有的区间会被强制转为指定的 <code>closed</code> 类型</strong>，因为 <code>pd.IntervalIndex</code> <strong>只允许存放同一种开闭区间的</strong> <code>Interval</code> 对象</li></ul> 
<pre><code class="prism language-python">my_interval
</code></pre> 
<pre><code class="prism language-python">Interval<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> closed<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">my_interval_2
</code></pre> 
<pre><code class="prism language-python">Interval<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> closed<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>IntervalIndex<span class="token punctuation">(</span><span class="token punctuation">[</span>my_interval<span class="token punctuation">,</span> my_interval_2<span class="token punctuation">]</span><span class="token punctuation">,</span> closed<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">IntervalIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              closed<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">'interval[float64]'</span><span class="token punctuation">)</span>
</code></pre> 
<h4>
<a id="_6121"></a>区间的属性与方法</h4> 
<p>​ 如果想要具体利用 <code>cut</code> 或者 <code>qcut</code> 的结果进行分析，<strong>那么需要先将其转为该种索引类型</strong></p> 
<pre><code class="prism language-python">id_interval <span class="token operator">=</span> pd<span class="token punctuation">.</span>IntervalIndex<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>​ <code>IntervalIndex</code>的常用属性：<code>left, right, mid, length</code> ，分别表示<strong>左右端点、两端点均值和区间长度</strong></p> 
<pre><code class="prism language-python">id_demo <span class="token operator">=</span> id_interval<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token comment"># 选出前5个展示</span>
id_demo
</code></pre> 
<pre><code class="prism language-python">IntervalIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">33.945</span><span class="token punctuation">,</span> <span class="token number">52.333</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">52.333</span><span class="token punctuation">,</span> <span class="token number">70.667</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">70.667</span><span class="token punctuation">,</span> <span class="token number">89.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">33.945</span><span class="token punctuation">,</span> <span class="token number">52.333</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">70.667</span><span class="token punctuation">,</span> <span class="token number">89.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              closed<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">,</span>
              name<span class="token operator">=</span><span class="token string">'Weight'</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">'interval[float64]'</span><span class="token punctuation">)</span>
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-python">id_demo<span class="token punctuation">.</span>left
</code></pre> 
<pre><code class="prism language-python">Float64Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">33.945</span><span class="token punctuation">,</span> <span class="token number">52.333</span><span class="token punctuation">,</span> <span class="token number">70.667</span><span class="token punctuation">,</span> <span class="token number">33.945</span><span class="token punctuation">,</span> <span class="token number">70.667</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float64'</span><span class="token punctuation">)</span>
</code></pre> 
<p>​ <code>contains</code> 和 <code>overlaps</code> ，分别指逐个判断每个区间是否包含某元素，以及是否和一个 <code>pd.Interval</code> 对象有交集</p> 
<pre><code class="prism language-python">id_demo<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">id_demo<span class="token punctuation">.</span>overlaps<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>Interval<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">array<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h2>
<a id="_6179"></a>时序数据</h2> 
<h3>
<a id="_6181"></a>时间戳</h3> 
<h4>
<a id="Timestamp_6183"></a>Timestamp</h4> 
<p>​ 将日期格式转换成Timestamp类型:<strong><code>pd.Timestamp()</code></strong></p> 
<pre><code class="prism language-python">ts <span class="token operator">=</span> pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'2020/1/1'</span><span class="token punctuation">)</span>
ts
</code></pre> 
<pre><code class="prism language-python">Timestamp<span class="token punctuation">(</span><span class="token string">'2020-01-01 00:00:00'</span><span class="token punctuation">)</span>
</code></pre> 
<p>​ Timestamp类型的属性：<code>year, month, day, hour, min, second</code></p> 
<p>​ Timestamp类型表示的时间范围最大是:<code>585</code>年</p> 
<p>​ <code>pd.Timestamp.max</code> 和 <code>pd.Timestamp.min</code> 可以获取时间戳表示的范围</p> 
<h4>
<a id="Datetime_6204"></a>Datetime序列</h4> 
<ul><li> <p><strong><code>to_datetime</code></strong></p> <p>​ 能够把时间戳格式转化为<code>datetime64[ns]</code>类型的时间序列</p> </li></ul> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020-1-1'</span><span class="token punctuation">,</span> <span class="token string">'2020-1-3'</span><span class="token punctuation">,</span> <span class="token string">'2020-1-6'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>DatetimeIndex(['2020-01-01', '2020-01-03', '2020-01-06'], dtype='datetime64[ns]', freq=None)
</code></pre> 
<p>读取表便于学习</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'C:\Users\Yuan\Desktop\pandas\文件\data\learn_pandas.csv'</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>df<span class="token punctuation">.</span>Test_Date<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">05</span>
<span class="token number">1</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">04</span>
<span class="token number">2</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">12</span>
<span class="token number">3</span>   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">4</span>   <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">06</span>
Name<span class="token punctuation">:</span> Test_Date<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> datetime64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span>
</code></pre> 
<p>​ 时间戳格式如果不满足转换，可以使用**<code>format</code>****强制转换**进行匹配</p> 
<pre><code class="prism language-python">temp <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020\1\1'</span><span class="token punctuation">,</span><span class="token string">'2020\1\3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%Y\%m\%d'</span><span class="token punctuation">)</span>
temp
</code></pre> 
<pre><code class="prism language-python">DatetimeIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020-01-01'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-03'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>列表传入返回<code>DatetimeIndex</code>对象</p> 
 <p>Series传入返回**<code>datetime64[ns]</code>**类型</p> 
</blockquote> 
<p>​ 把表的多列时间属性<strong>拼接</strong>转为时间序列，但是<strong>列名必须与给定的属性关键词相同</strong></p> 
<pre><code class="prism language-python">df_date_cols <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">2020</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                             <span class="token string">'month'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                             <span class="token string">'day'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                             <span class="token string">'hour'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                             <span class="token string">'minute'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                             <span class="token string">'second'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>df_date_cols<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">10</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token number">20</span>
<span class="token number">1</span>   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">20</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">40</span>
dtype<span class="token punctuation">:</span> datetime64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span>
</code></pre> 
<ul><li> <p><strong><code>date_range</code></strong></p> <p>​ 生成连续间隔时间的一种方法</p> <p>​ 参数：``start, end, freq, periods`分别表示<strong>开始时间，结束时间，时间间隔，时间戳个数</strong></p> 
  <blockquote> 
   <p>注意：开始或结束日期如果作为端点,如果计算到端点<strong>则它会被包含</strong></p> 
  </blockquote> </li></ul> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2020-1-1'</span><span class="token punctuation">,</span><span class="token string">'2020-1-21'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'10D'</span><span class="token punctuation">)</span> <span class="token comment"># 包含</span>
</code></pre> 
<pre><code class="prism language-python">DatetimeIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020-01-01'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-11'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-21'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'10D'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2020-1-1'</span><span class="token punctuation">,</span><span class="token string">'2020-2-28'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'10D'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">DatetimeIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020-01-01'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-11'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-21'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-31'</span><span class="token punctuation">,</span><span class="token string">'2020-02-10'</span><span class="token punctuation">,</span> <span class="token string">'2020-02-20'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
dtype<span class="token operator">=</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'10D'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2020-1-1'</span><span class="token punctuation">,</span><span class="token string">'2020-2-28'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token comment"># 由于结束日期无法取到，freq不为10天</span>
</code></pre> 
<pre><code class="prism language-python">DatetimeIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020-01-01 00:00:00'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-12 14:24:00'</span><span class="token punctuation">,</span>
               <span class="token string">'2020-01-24 04:48:00'</span><span class="token punctuation">,</span> <span class="token string">'2020-02-04 19:12:00'</span><span class="token punctuation">,</span>
               <span class="token string">'2020-02-16 09:36:00'</span><span class="token punctuation">,</span> <span class="token string">'2020-02-28 00:00:00'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>这里的 <code>freq</code> 参数与 <code>DateOffset</code> 对象紧密相关</p> 
</blockquote> 
<ul><li> <p>**<code>asfreq</code>**方法</p> <p>​ 改变序列采样频率</p> </li></ul> 
<blockquote> 
 <p><code>datetime64[ns]</code> 本质上可以理解为一个大整数，对于一个该类型的序列，可以使用 <code>max, min, mean</code> ，来取得最大时间戳、最小时间戳和“平均”时间戳</p> 
</blockquote> 
<h4>
<a id="dt_6330"></a>dt对象</h4> 
<ul><li><code>datetime64[ns].dt</code></li></ul> 
<p>​ <code>datetime64[ns]</code> 上的属性</p> 
<p>​ 大致分为三类操作：<strong>取出时间相关的属性、判断时间戳是否满足条件、取整操作</strong></p> 
<p>​ <strong>取出时间相关的属性</strong>：``date, time, year, month, day, hour,minute, second, microsecond, nanosecond, dayofweek, dayofyear, weekofyear, daysinmonth, quarter<code>，**其中 </code>daysinmonth, quarter` 分别表示该月一共有几天和季度。**</p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2020-1-1'</span><span class="token punctuation">,</span><span class="token string">'2020-1-3'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>daysinmonth
</code></pre> 
<ul><li><strong><code>dayofweek</code></strong></li></ul> 
<p>​ 返回周中的星期情况(周一为0、周二为1)</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>dayofweek
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">2</span>
<span class="token number">1</span>    <span class="token number">3</span>
<span class="token number">2</span>    <span class="token number">4</span>
dtype<span class="token punctuation">:</span> int64
</code></pre> 
<p>​ <code>month_name, day_name</code> 返回<strong>英文的月名和星期名</strong>，注意它们<strong>是方法而不是属性</strong></p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>month_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    January
<span class="token number">1</span>    January
<span class="token number">2</span>    January
dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<p>​</p> 
<p><strong>判断时间戳是否满足条件</strong></p> 
<p>​ 测试是否为月/季/年的第一天或者最后一天</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>is_year_start <span class="token comment"># 还可选 is_quarter/month_start</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>     <span class="token boolean">True</span>
<span class="token number">1</span>    <span class="token boolean">False</span>
<span class="token number">2</span>    <span class="token boolean">False</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>is_year_end <span class="token comment"># 还可选 is_quarter/month_end</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token boolean">False</span>
<span class="token number">1</span>    <span class="token boolean">False</span>
<span class="token number">2</span>    <span class="token boolean">False</span>
dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
</code></pre> 
<p><strong>取整操作</strong></p> 
<p>​ <code>round, ceil, floor </code>四舍五入，进入，舍去</p> 
<p>​ 公共参数为 <code>freq</code> ，常用的包括 <code>H, min, S</code> （小时、分钟、秒），所有可选的 <code>freq</code></p> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2020-1-1 20:35:00'</span><span class="token punctuation">,</span>
                            <span class="token string">'2020-1-1 22:35:00'</span><span class="token punctuation">,</span>
                            freq<span class="token operator">=</span><span class="token string">'45min'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>####切片与索引</p> 
<p>​ 索引都是以<strong>布尔索引</strong>为开始</p> 
<p>​ 切片都是用<strong>索引器<code>[]</code></strong></p> 
<ul><li><strong>每月的第一天或者最后一天</strong></li></ul> 
<pre><code class="prism language-python">s<span class="token punctuation">[</span><span class="token punctuation">(</span>idx<span class="token punctuation">.</span>is_month_start<span class="token operator">|</span>idx<span class="token punctuation">.</span>is_month_end<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">29</span>    <span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">0</span>
dtype<span class="token punctuation">:</span> int32
</code></pre> 
<ul><li><strong>双休日</strong></li></ul> 
<pre><code class="prism language-python">s<span class="token punctuation">[</span>idx<span class="token punctuation">.</span>dayofweek<span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">11</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>    <span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">18</span>    <span class="token number">1</span>
dtype<span class="token punctuation">:</span> int32
</code></pre> 
<ul><li><strong>取出单日值</strong></li></ul> 
<pre><code class="prism language-python">s<span class="token punctuation">[</span><span class="token string">'2020-07'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">02</span>    <span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">0</span>
Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int32
</code></pre> 
<ul><li><strong>取出5月初至7月15日</strong></li></ul> 
<pre><code class="prism language-python">s<span class="token punctuation">[</span><span class="token string">'2020-05'</span><span class="token punctuation">:</span><span class="token string">'2020-7-15'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">02</span>    <span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">1</span>
Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int32
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">[</span><span class="token string">'2020-05'</span><span class="token punctuation">:</span><span class="token string">'2020-7-15'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tail<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">11</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">12</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">13</span>    <span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">14</span>    <span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">15</span>    <span class="token number">1</span>
Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int32
</code></pre> 
<h3>
<a id="_6511"></a>时间差</h3> 
<h4>
<a id="Timedelta_6513"></a>Timedelta</h4> 
<p>​ <code>pd.Timedelta</code>是两个时间戳的<strong>差</strong></p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>Timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> minutes<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token comment"># 需要注意加s</span>
</code></pre> 
<pre><code class="prism language-python">Timedelta<span class="token punctuation">(</span><span class="token string">'1 days 00:25:00'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>Timedelta<span class="token punctuation">(</span><span class="token string">'1 days 25 minutes'</span><span class="token punctuation">)</span> <span class="token comment"># 字符串生成</span>
</code></pre> 
<pre><code class="prism language-python">Timedelta<span class="token punctuation">(</span><span class="token string">'1 days 00:25:00'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li> <p><strong><code>pd.to_timedelta</code></strong></p> <p>​ 生成时间差序列，类型为 <code>timedelta64[ns]</code></p> </li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_timedelta<span class="token punctuation">(</span>df<span class="token punctuation">.</span>Time_Record<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">34</span>
<span class="token number">1</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">20</span>
<span class="token number">2</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">22</span>
<span class="token number">3</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">08</span>
<span class="token number">4</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">22</span>
Name<span class="token punctuation">:</span> Time_Record<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> timedelta64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span>
</code></pre> 
<ul><li> <p><strong><code>pd.timedelta_range</code></strong></p> <p>​ 时间差序列，与``date_range`具有一致的参数</p> </li></ul> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>timedelta_range<span class="token punctuation">(</span><span class="token string">'0s'</span><span class="token punctuation">,</span> <span class="token string">'1000s'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'6min'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">TimedeltaIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'0 days 00:00:00'</span><span class="token punctuation">,</span> <span class="token string">'0 days 00:06:00'</span><span class="token punctuation">,</span> <span class="token string">'0 days 00:12:00'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'timedelta64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'6T'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>timedelta_range<span class="token punctuation">(</span><span class="token string">'0s'</span><span class="token punctuation">,</span> <span class="token string">'1000s'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">TimedeltaIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'0 days 00:00:00'</span><span class="token punctuation">,</span> <span class="token string">'0 days 00:08:20'</span><span class="token punctuation">,</span> <span class="token string">'0 days 00:16:40'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'timedelta64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<p>####dt对象</p> 
<p>​ <code>Timedelta</code>序列也定义了dt对象</p> 
<p>​ 属性：<code>days, seconds, mircroseconds, nanoseconds</code></p> 
<blockquote> 
 <p>这里的 <code>seconds</code> 不是指单纯的秒，而是对天数<strong>取余</strong>后剩余的秒数</p> 
</blockquote> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>seconds<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">274</span>
<span class="token number">1</span>    <span class="token number">260</span>
<span class="token number">2</span>    <span class="token number">322</span>
<span class="token number">3</span>    <span class="token number">248</span>
<span class="token number">4</span>    <span class="token number">322</span>
Name<span class="token punctuation">:</span> Time_Record<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64
</code></pre> 
<p>​ 直接对应秒数:<code>total_seconds</code></p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">274.0</span>
<span class="token number">1</span>    <span class="token number">260.0</span>
<span class="token number">2</span>    <span class="token number">322.0</span>
<span class="token number">3</span>    <span class="token number">248.0</span>
<span class="token number">4</span>    <span class="token number">322.0</span>
Name<span class="token punctuation">:</span> Time_Record<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>​ <strong>取整函数</strong>也是可以在 <code>dt</code> 对象上使用</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>to_timedelta<span class="token punctuation">(</span>df<span class="token punctuation">.</span>Time_Record<span class="token punctuation">)</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token string">'min'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">00</span>
<span class="token number">1</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">00</span>
<span class="token number">2</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">00</span>
<span class="token number">3</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">00</span>
<span class="token number">4</span>   <span class="token number">0</span> days <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">00</span>
Name<span class="token punctuation">:</span> Time_Record<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> timedelta64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span>
</code></pre> 
<p>####Timedelta的运算</p> 
<p>​ 三类：<strong>与标量的乘法运算、与时间戳的加减法运算、与时间差的加减法与除法运算</strong></p> 
<p>预设：</p> 
<pre><code class="prism language-python">td1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
td2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
ts <span class="token operator">=</span> pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'20200101'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">ts <span class="token operator">-</span> td1
</code></pre> 
<pre><code class="prism language-python">Timestamp<span class="token punctuation">(</span><span class="token string">'2019-12-31 00:00:00'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">td1 <span class="token operator">*</span> <span class="token number">2</span>
</code></pre> 
<pre><code class="prism language-python">Timedelta<span class="token punctuation">(</span><span class="token string">'2 days 00:00:00'</span><span class="token punctuation">)</span>
</code></pre> 
<p>时间差序列的运算</p> 
<pre><code class="prism language-python">td1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>timedelta_range<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token string">'1 days'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
td2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>timedelta_range<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token string">'12 hours'</span><span class="token punctuation">,</span>freq<span class="token operator">=</span><span class="token string">'2H'</span><span class="token punctuation">,</span>periods<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
ts <span class="token operator">=</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'20200101'</span><span class="token punctuation">,</span> <span class="token string">'20200105'</span><span class="token punctuation">)</span>
</code></pre> 
<p>示例1：</p> 
<pre><code class="prism language-python">td1 <span class="token operator">*</span> <span class="token number">5</span>
</code></pre> 
<pre><code class="prism language-python">TimedeltaIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'5 days'</span><span class="token punctuation">,</span> <span class="token string">'10 days'</span><span class="token punctuation">,</span> <span class="token string">'15 days'</span><span class="token punctuation">,</span> <span class="token string">'20 days'</span><span class="token punctuation">,</span> <span class="token string">'25 days'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'timedelta64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'5D'</span><span class="token punctuation">)</span>
</code></pre> 
<p>示例2：</p> 
<pre><code class="prism language-python">td1 <span class="token operator">*</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 逐个相乘</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>    <span class="token number">0</span> days
<span class="token number">1</span>    <span class="token number">2</span> days
<span class="token number">2</span>    <span class="token number">6</span> days
<span class="token number">3</span>   <span class="token number">12</span> days
<span class="token number">4</span>   <span class="token number">20</span> days
dtype<span class="token punctuation">:</span> timedelta64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span>
</code></pre> 
<p>示例3：</p> 
<pre><code class="prism language-python">td1 <span class="token operator">+</span> ts <span class="token comment"># 逐个相加</span>
</code></pre> 
<pre><code class="prism language-python">DatetimeIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020-01-02'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-04'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-06'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-08'</span><span class="token punctuation">,</span>
               <span class="token string">'2020-01-10'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              dtype<span class="token operator">=</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<h3>
<a id="_6719"></a>日期偏置</h3> 
<h4>
<a id="Offset_6721"></a>Offset对象</h4> 
<p>​ **<code>pd.offsets</code>**定义offset对象</p> 
<p>​ 日期偏置是一种和日历相关的特殊时间差</p> 
<p>示例：</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'20200831'</span><span class="token punctuation">)</span> <span class="token operator">+</span> pd<span class="token punctuation">.</span>offsets<span class="token punctuation">.</span>WeekOfMonth<span class="token punctuation">(</span>week<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>weekday<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Timestamp<span class="token punctuation">(</span><span class="token string">'2020-09-07 00:00:00'</span><span class="token punctuation">)</span>
</code></pre> 
<p>​</p> 
<p>​ <code>+</code> 获取最近的<strong>下</strong>一个日期</p> 
<p>​ <code>-</code> 获取最近的<strong>上</strong>一个日期</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'20200907'</span><span class="token punctuation">)</span> <span class="token operator">-</span> pd<span class="token punctuation">.</span>offsets<span class="token punctuation">.</span>BDay<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Timestamp<span class="token punctuation">(</span><span class="token string">'2020-07-27 00:00:00'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'20200907'</span><span class="token punctuation">)</span> <span class="token operator">+</span> pd<span class="token punctuation">.</span>offsets<span class="token punctuation">.</span>MonthEnd<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Timestamp<span class="token punctuation">(</span><span class="token string">'2020-09-30 00:00:00'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li> <p><strong><code>CDay</code></strong></p> <p>​ 特殊的offset对象</p> <p>​ 参数：</p> <p>​ <code>holidays</code>传入了<strong>需要过滤的日期列表</strong></p> <p>​ <code>weekmask</code> 传入的是三个字母的星期缩写构成的星期字符串，其作用是只<strong>保留字符串中出现的星期</strong></p> </li></ul> 
<pre><code class="prism language-python">my_filter <span class="token operator">=</span> pd<span class="token punctuation">.</span>offsets<span class="token punctuation">.</span>CDay<span class="token punctuation">(</span>n<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>weekmask<span class="token operator">=</span><span class="token string">'Wed Fri'</span><span class="token punctuation">,</span>holidays<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'20200109'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
dr <span class="token operator">=</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'20200108'</span><span class="token punctuation">,</span> <span class="token string">'20200111'</span><span class="token punctuation">)</span>
dr<span class="token punctuation">.</span>to_series<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>dayofweek
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>    <span class="token number">2</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">09</span>    <span class="token number">3</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">10</span>    <span class="token number">4</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">11</span>    <span class="token number">5</span>
Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64
</code></pre> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>i <span class="token operator">+</span> my_filter <span class="token keyword">for</span> i <span class="token keyword">in</span> dr<span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>Timestamp<span class="token punctuation">(</span><span class="token string">'2020-01-10 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 Timestamp<span class="token punctuation">(</span><span class="token string">'2020-01-10 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 Timestamp<span class="token punctuation">(</span><span class="token string">'2020-01-15 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 Timestamp<span class="token punctuation">(</span><span class="token string">'2020-01-15 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<blockquote> 
 <p><strong>不要使用部分</strong> <code>Offset</code>:</p> 
 <p>​ 在当前版本下由于一些 <code>bug</code> ，<strong>不要使用</strong> <code>Day</code> 级别以下的 <code>Offset</code> 对象，比如 <code>Hour, Second</code> 等，请使用对应的 <code>Timedelta</code> 对象来代替</p> 
</blockquote> 
<h4>
<a id="_6804"></a>偏置字符串</h4> 
<p>​ 偏执字符串就是Offset的缩写，作为类型一并给freq参数使用</p> 
<p>示例：</p> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'20200101'</span><span class="token punctuation">,</span><span class="token string">'20200331'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'MS'</span><span class="token punctuation">)</span> <span class="token comment"># 月初</span>
</code></pre> 
<pre><code class="prism language-python">DatetimeIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020-01-01'</span><span class="token punctuation">,</span> <span class="token string">'2020-02-01'</span><span class="token punctuation">,</span> <span class="token string">'2020-03-01'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'MS'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'20200101'</span><span class="token punctuation">,</span><span class="token string">'20200201'</span><span class="token punctuation">,</span>freq<span class="token operator">=</span><span class="token string">'WOM-1MON'</span><span class="token punctuation">)</span> <span class="token comment"># 每月第一个周一</span>
</code></pre> 
<pre><code class="prism language-python">DatetimeIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2020-01-06'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'WOM-1MON'</span><span class="token punctuation">)</span>
</code></pre> 
<p>上面的这些字符串，等价于使用的 <code>Offset</code> 对象</p> 
<h3>
<a id="_6834"></a>时序中的滑窗与分组</h3> 
<h4>
<a id="_6836"></a>滑动窗口</h4> 
<p>​ 时序的滑窗函数，即把滑动窗口用 <code>freq</code> 关键词代替</p> 
<p>​ **<code>shift</code>**函数可以指定freq单位进行滑动（ <code>datetime64</code> 为索引的序列）</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>freq<span class="token operator">=</span><span class="token string">'50D'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">20</span>   <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">21</span>   <span class="token operator">-</span><span class="token number">2</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">22</span>   <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span>   <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">26</span>   <span class="token operator">-</span><span class="token number">2</span>
dtype<span class="token punctuation">:</span> int32
</code></pre> 
<p>​ <strong><code>diff</code></strong></p> 
<p>​ <code>datetime64[ns]</code> 的序列进行 <code>diff</code> 后就能够得到 <code>timedelta64[ns]</code> 的序列</p> 
<pre><code class="prism language-python">my_series <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>s<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
my_series<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>
<span class="token number">1</span>   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>
<span class="token number">2</span>   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>
<span class="token number">3</span>   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>
<span class="token number">4</span>   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>
dtype<span class="token punctuation">:</span> datetime64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python"> my_series<span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">0</span>      NaT
<span class="token number">1</span>   <span class="token number">1</span> days
<span class="token number">2</span>   <span class="token number">1</span> days
<span class="token number">3</span>   <span class="token number">3</span> days
<span class="token number">4</span>   <span class="token number">1</span> days
dtype<span class="token punctuation">:</span> timedelta64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span>

</code></pre> 
<h4>
<a id="_6891"></a>重采样</h4> 
<p>​ <strong><code>pd.resample</code></strong></p> 
<p>​ 与groupby用法类似，是对<strong>时间序列分组</strong>计算的分组对象</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">'10D'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>   <span class="token operator">-</span><span class="token number">2.000000</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">11</span>   <span class="token operator">-</span><span class="token number">3.166667</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">21</span>   <span class="token operator">-</span><span class="token number">3.625000</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">31</span>   <span class="token operator">-</span><span class="token number">4.000000</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">10</span>   <span class="token operator">-</span><span class="token number">0.375000</span>
Freq<span class="token punctuation">:</span> 10D<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>​</p> 
<p>​ 重采样也可以使用**<code>apply</code>**</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">'10D'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>x<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 极差</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">3</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">11</span>    <span class="token number">4</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">21</span>    <span class="token number">4</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token number">2</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">10</span>    <span class="token number">4</span>
Freq<span class="token punctuation">:</span> 10D<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int32
</code></pre> 
<p><strong>resample边界处理</strong></p> 
<p>​ 起始值的计算方法：从给定的最小时间戳的午夜0点开始，一直增加<code>freq</code>，<strong>加到不超过这个时间戳</strong>，就被设置为起始值</p> 
<p>​ 每次<strong>累加的freq参数作为分割节点</strong>进行分组，区间为<strong>左闭右开</strong></p> 
<pre><code class="prism language-python">idx <span class="token operator">=</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'20200101 8:26:35'</span><span class="token punctuation">,</span> <span class="token string">'20200101 9:31:58'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'77s'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>data<span class="token punctuation">,</span>index<span class="token operator">=</span>idx<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">35</span>   <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">27</span><span class="token punctuation">:</span><span class="token number">52</span>   <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">:</span><span class="token number">09</span>   <span class="token operator">-</span><span class="token number">2</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token number">26</span>   <span class="token operator">-</span><span class="token number">3</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">43</span>   <span class="token operator">-</span><span class="token number">4</span>
Freq<span class="token punctuation">:</span> 77S<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int32
</code></pre> 
<blockquote> 
 <p>下面对应的第一个组起始值为 <code>08:24:00</code> ，其是从当天0点增加72个 <code>freq=7 min</code> 得到的，如果再增加一个 <code>freq</code> 则超出了序列的最小时间戳 <code>08:26:35</code></p> 
</blockquote> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">'7min'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">00</span>   <span class="token operator">-</span><span class="token number">1.750000</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">00</span>   <span class="token operator">-</span><span class="token number">2.600000</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">00</span>   <span class="token operator">-</span><span class="token number">2.166667</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">:</span><span class="token number">00</span>    <span class="token number">0.200000</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">:</span><span class="token number">00</span>    <span class="token number">2.833333</span>
Freq<span class="token punctuation">:</span> 7T<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>​ 指定<code>origin</code>为<code>start</code>：最小时间戳开始依次增加 <code>freq</code> 进行分组</p> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">'7min'</span><span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">35</span>   <span class="token operator">-</span><span class="token number">2.333333</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">35</span>   <span class="token operator">-</span><span class="token number">2.400000</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">35</span>   <span class="token operator">-</span><span class="token number">1.333333</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">35</span>    <span class="token number">1.200000</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">35</span>    <span class="token number">3.166667</span>
Freq<span class="token punctuation">:</span> 7T<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<ul><li>返回值一般是组的第一个时间戳，但 <code>M, A, Q, BM, BA, BQ, W</code> 这七个是取对应区间的<strong>最后一个时间戳</strong>
</li></ul> 
<pre><code class="prism language-python">s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">366</span><span class="token punctuation">)</span><span class="token punctuation">,</span>index<span class="token operator">=</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2020-01-01'</span><span class="token punctuation">,</span><span class="token string">'2020-12-31'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token number">0.451613</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">29</span>    <span class="token number">0.448276</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token number">0.516129</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">30</span>    <span class="token number">0.566667</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token number">0.451613</span>
Freq<span class="token punctuation">:</span> M<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<pre><code class="prism language-python">s<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">'MS'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 结果一样，但索引不同</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">0.451613</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">0.448276</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">0.516129</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">0.566667</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">0.451613</span>
Freq<span class="token punctuation">:</span> MS<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<blockquote> 
 <p>归属人:我怕是有点打脑壳<br> 严禁转载</p> 
</blockquote>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
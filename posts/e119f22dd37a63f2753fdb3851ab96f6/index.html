<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>python多任务笔记 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python多任务笔记</h1>
			
		</header>
		<div class="content post__content clearfix">
			


        
                <div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:0cm"><strong><span style="color:#333333">多任务介绍</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">在现实生活中，有很多的场景中的事情是同时进行的，比如跳舞和唱歌是同时进行的。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">在程序中，可以使用代码来模拟唱歌和跳舞的功能：</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> time </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> sleep</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">sing</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">()</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">3</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">正在唱歌...%d"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">%i)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">dance</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">()</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">3</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">正在跳舞...%d"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">%i)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__ == </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    sing() </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c">#</span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">唱歌</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    dance() </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c">#</span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">跳舞</span></span></span></pre> 
<ul>
<li style="text-align:justify"><span style="color:#333333">很显然刚刚的程序并没有完成唱歌和跳舞同时进行的要求</span></li>
<li style="text-align:justify">
<span style="color:#333333">如果想要实现“唱歌跳舞”同时进行，那么就需要一个新的方法，叫做：</span><strong><span style="color:#333333">多任务</span></strong>
</li>
</ul> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">多任务概念</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">什么叫“多任务”呢？简单地说，就是操作系统可以同时运行多个任务。打个比方，你一边在用浏览器上网，一边在听MP3，一边在用Word赶作业，这就是多任务，至少同时有3个任务正在运行。还有很多任务悄悄地在后台同时运行着，只是桌面上没有显示而已。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">现在，多核CPU已经非常普及了，但是，即使过去的单核CPU，也可以执行多任务。由于CPU执行代码都是顺序执行的，那么，单核CPU是怎么执行多任务的呢？</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">答案就是操作系统轮流让各个任务交替执行，任务1执行0.01秒，切换到任务2，任务2执行0.01秒，再切换到任务3，执行0.01秒……这样反复执行下去。表面上看，每个任务都是交替执行的，但是，由于CPU的执行速度实在是太快了，我们感觉就像所有任务都在同时执行一样。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">真正的并行执行多任务只能在多核CPU上实现，但是，由于任务数量远远多于CPU的核心数量，所以，操作系统也会自动把很多任务轮流调度到每个核心上执行。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">对于操作系统来说，一个任务就是一个进程（Process），比如打开一个浏览器就是启动一个浏览器进程，打开一个记事本就启动了一个记事本进程，打开两个记事本就启动了两个记事本进程，打开一个Word就启动了一个Word进程。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">有些进程还不止同时干一件事，比如Word，它可以同时进行打字、拼写检查、打印等事情。在一个进程内部，要同时干多件事，就需要同时运行多个“子任务”，我们把进程内的这些“子任务”称为线程（Thread）。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">由于每个进程至少要干一件事，所以，一个进程至少有一个线程。当然，像Word这种复杂的进程可以有多个线程，多个线程可以同时执行，多线程的执行方式和多进程是一样的，也是由操作系统在多个线程之间快速切换，让每个线程都短暂地交替运行，看起来就像同时执行一样。当然，真正地同时执行多线程需要多核CPU才可能实现。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">我们前面编写的所有的Python程序，都是执行单任务的进程，也就是只有一个线程。如果我们要同时执行多个任务怎么办？</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">有两种解决方案：</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">一种是启动多个进程，每个进程虽然只有一个线程，但多个进程可以一块执行多个任务。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">还有一种方法是启动一个进程，在一个进程内启动多个线程，这样，多个线程也可以一块执行多个任务。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">当然还有第三种方法，就是启动多个进程，每个进程再启动多个线程，这样同时执行的任务就更多了，当然这种模型更复杂，实际很少采用。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">总结一下就是，多任务的实现有3种方式：</span></p> 
<ul>
<li style="text-align:justify"><span style="color:#333333">多进程模式；</span></li>
<li style="text-align:justify"><span style="color:#333333">多线程模式；</span></li>
<li style="text-align:justify"><span style="color:#333333">多进程+多线程模式。</span></li>
</ul> 
<h4 style="margin-left:0cm"><strong><span style="color:#333333">注意：</span></strong></h4> 
<ul>
<li style="text-align:justify"><span style="color:#333333">并发：指的是任务数多余cpu核数，通过操作系统的各种任务调度算法，实现用多个任务“一起”执行（实际上总有一些任务不在执行，因为切换任务的速度相当快，看上去一起执行而已）</span></li>
<li style="text-align:justify"><span style="color:#333333">并行：指的是任务数小于等于cpu核数，即任务真的是一起执行的。</span></li>
</ul> 
<h2 style="margin-left:0cm"></h2> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">线程访问全局变量</span></strong></h2> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> threading</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">g_num = </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0</span></span><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">test</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(n)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">global</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> g_num</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> x </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(n):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        g_num += x</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        g_num -= x</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(g_num)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__ == </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t1 = threading.Thread(target=test, args=(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">10</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t2 = threading.Thread(target=test, args=(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">10</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t1.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t2.start()</span></span></code></span></pre> 
<p style="margin-left:0cm"><span style="color:#333333">在一个进程内的所有线程共享全局变量，很方便在多个线程间共享数据。缺点就是，线程是对全局变量随意遂改可能造成多线程之间对全局变量的混乱（即线程非安全）。</span></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">线程的安全问题</span></strong></h2> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> threading</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> time</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">ticket = </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">20</span></span></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">sell_ticket</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">()</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">global</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ticket</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">while</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">True</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>        </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ticket &gt; </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0.5</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            ticket -= </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">卖了一张票，还剩{}'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(threading.current_thread().name, ticket))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>        </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">else</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">票卖完了'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(threading.current_thread().name))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>            </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">break</span></span></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">5</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t = threading.Thread(target=sell_ticket, name=</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'thread-{}'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(i + </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t.start()</span></span></code></span></pre> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">同步</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">当多个线程几乎同时修改某一个共享数据的时候，需要进行同步控制。同步就是协同步调，按预定的先后次序进行运行。线程同步能够保证多个线程安全访问竞争资源，最简单的同步机制是引入互斥锁。</span></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">互斥锁</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">互斥锁为资源引入一个状态：锁定/非锁定</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">某个线程要更改共享数据时，先将其锁定，此时资源的状态为“锁定”，其他线程不能更改；直到该线程释放资源，将资源的状态变成“非锁定”，其他的线程才能再次锁定该资源。互斥锁保证了每次只有一个线程进行写入操作，从而保证了多线程情况下数据的正确性。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">threading</span><span style="color:#333333">模块中定义了Lock类，可以方便的处理锁定：</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">创建锁</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">mutex = threading.Lock()</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">锁定</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">mutex.acquire()</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">释放</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">mutex.release()</span></span></code></span></pre> 
<h4 style="margin-left:0cm"><strong><span style="color:#333333">注意：</span></strong></h4> 
<ul>
<li style="text-align:justify"><span style="color:#333333">如果这个锁之前是没有上锁的，那么acquire不会堵塞</span></li>
<li style="text-align:justify">
</li>
</ul> 
<p style="margin-left:0cm"><span style="color:#333333">如果在调用acquire对这个锁上锁之前 它已经被 其他线程上了锁，那么此时acquire会堵塞，直到这个锁被解锁为止。</span></p> 
<ul>
<li style="text-align:justify">
</li>
<li style="text-align:justify">
</li>
</ul> 
<p style="margin-left:0cm"><span style="color:#333333">和文件操作一样，Lock也可以使用with语句快速的实现打开和关闭操作。</span></p> 
<ul><li style="text-align:justify"></ul> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">使用互斥锁解决卖票问题</span></strong></h2> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> threading</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> time</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">ticket = </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">20</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">lock = threading.Lock()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">sell_ticket</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">()</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">global</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ticket</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">while</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">True</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        lock.acquire()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>        </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ticket &gt; </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0.5</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            ticket -= </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            lock.release()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">卖了一张票，还剩{}'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(threading.current_thread().name, ticket))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>        </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">else</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">票卖完了'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(threading.current_thread().name))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            lock.release()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>            </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">break</span></span></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">5</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t = threading.Thread(target=sell_ticket, name=</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'thread-{}'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(i + </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t.start()</span></span></code></span></pre> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">上锁过程：</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">当一个线程调用锁的acquire()方法获得锁时，锁就进入“locked”状态。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">每次只有一个线程可以获得锁。如果此时另一个线程试图获得这个锁，该线程就会变为“blocked”状态，称为“阻塞”，直到拥有锁的线程调用锁的release()方法释放锁之后，锁进入“unlocked”状态。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">线程调度程序从处于同步阻塞状态的线程中选择一个来获得锁，并使得该线程进入运行（running）状态。</span></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">总结</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">锁的好处：</span></p> 
<ul><li style="text-align:justify"><span style="color:#333333">确保了某段关键代码只能由一个线程从头到尾完整地执行</span></li></ul> 
<p style="margin-left:0cm"><span style="color:#333333">锁的坏处：</span></p> 
<ul>
<li style="text-align:justify"><span style="color:#333333">阻止了多线程并发执行，包含锁的某段代码实际上只能以单线程模式执行，效率就大大地下降了。</span></li>
<li style="text-align:justify"><span style="color:#333333">由于可以存在多个锁，不同的线程持有不同的锁，并试图获取对方持有的锁时，可能会造成死锁。</span></li>
</ul> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">线程间通信</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">线程之间有时需要通信，操作系统提供了很多机制来实现进程间的通信，其中我们使用最多的是队列Queue.</span></p> 
<h3 style="margin-left:0cm"><strong><span style="color:#333333">Queue</span><span style="color:#333333">的原理</span></strong></h3> 
<p style="margin-left:0cm"><span style="color:#333333">Queue</span><span style="color:#333333">是一个先进先出（First In First Out）的队列，主进程中创建一个Queue对象，并作为参数传入子进程，两者之间通过put( )放入数据，通过get( )取出数据，执行了get( )函数之后队列中的数据会被同时删除，可以使用multiprocessing模块的Queue实现多进程之间的数据传递。</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> threading</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> time</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> queue </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> Queue</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">producer</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(queue)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">100</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">存入了{}'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(threading.current_thread().name, i))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        queue.put(i)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0.1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">return</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">consumer</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(queue)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> x </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">100</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        value = queue.get()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">取到了{}'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(threading.current_thread().name, value))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0.1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>        </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">not</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> value:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>            </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">return</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__ == </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    queue = Queue()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t1 = threading.Thread(target=producer, args=(queue,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t2 = threading.Thread(target=consumer, args=(queue,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t3 = threading.Thread(target=consumer, args=(queue,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t4 = threading.Thread(target=consumer, args=(queue,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t6 = threading.Thread(target=consumer, args=(queue,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t1.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t2.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t3.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t4.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t6.start()</span></span></code></span></pre> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">多线程版聊天</span></strong></h2> 
<p style="margin-left:.0001pt;text-align:justify">import socket</p> 
<p style="margin-left:.0001pt;text-align:justify">import threading</p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</p> 
<p style="margin-left:.0001pt;text-align:justify">s.bind(('0.0.0.0', 8080))</p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify">def send_msg():</p> 
<p style="margin-left:.0001pt;text-align:justify">    ip = input('请输入您要聊天的ip:')</p> 
<p style="margin-left:.0001pt;text-align:justify">    port = int(input('请输入对方的端口号:'))</p> 
<p style="margin-left:.0001pt;text-align:justify">    while True:</p> 
<p style="margin-left:.0001pt;text-align:justify">        msg = input('请输入聊天内容:')</p> 
<p style="margin-left:.0001pt;text-align:justify">        s.sendto(msg.encode('utf-8'), (ip, port))</p> 
<p style="margin-left:.0001pt;text-align:justify">        if msg == "bye":</p> 
<p style="margin-left:.0001pt;text-align:justify">            ip = input('请输入您要聊天的ip:')</p> 
<p style="margin-left:.0001pt;text-align:justify">            port = int(input('请输入对方的端口号:'))</p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify">def recv_msg():</p> 
<p style="margin-left:.0001pt;text-align:justify">    while True:</p> 
<p style="margin-left:.0001pt;text-align:justify">        content, addr = s.recvfrom(1024)</p> 
<p style="margin-left:.0001pt;text-align:justify">        print('接收到了{}主机{}端口的消息:{}'.format(addr[0], addr[1], content.decode('utf-8')),file=open('history.txt', 'a', encoding='utf-8'))</p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify">send_thread = threading.Thread(target=send_msg)</p> 
<p style="margin-left:.0001pt;text-align:justify">recv_thread = threading.Thread(target=recv_msg)</p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify">send_thread.start()</p> 
<p style="margin-left:.0001pt;text-align:justify">recv_thread.start()</p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">进程</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">程序：例如xxx.py这是程序，是一个静态的。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">进程：一个程序运行起来后，代码+用到的资源 称之为进程，它是操作系统分配资源的基本单元。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">不仅可以通过线程完成多任务，进程也是可以的。</span></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">进程的状态</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">工作中，任务数往往大于cpu的核数，即一定有一些任务正在执行，而另外一些任务在等待cpu进行执行，因此导致了有了不同的状态。</span></p> 
<ul>
<li style="text-align:justify"><span style="color:#333333">就绪态：运行的条件都已经满足，正在等在cpu执行。</span></li>
<li style="text-align:justify"><span style="color:#333333">执行态：cpu正在执行其功能。</span></li>
<li style="text-align:justify"><span style="color:#333333">等待态：等待某些条件满足，例如一个程序sleep了，此时就处于等待态。</span></li>
</ul> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">创建进程</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">multiprocessing</span><span style="color:#333333">模块就是跨平台版本的多进程模块，提供了一个Process类来代表一个进程对象，这个对象可以理解为是一个独立的进程，可以执行另外的事情。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">示例：创建一个进程，执行两个死循环。</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> multiprocessing </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> Process</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> time</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">run_proc</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">()</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#718c00">"""</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">子进程要执行的代码"""</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">while</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">True</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"----2----"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__==</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p = Process(target=run_proc)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">while</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">True</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"----1----"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<h4 style="margin-left:0cm"><strong><span style="color:#333333">说明</span></strong></h4> 
<ul><li style="text-align:justify"><span style="color:#333333">创建子进程时，只需要传入一个执行函数和函数的参数，创建一个Process实例，用start()方法启动</span></li></ul> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">方法说明</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">Process( target [, name [, args [, kwargs]]])</span></p> 
<ul>
<li style="text-align:justify">
<span style="color:#333333">target</span><span style="color:#333333">：如果传递了函数的引用，可以任务这个子进程就执行这里的代码</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">args</span><span style="color:#333333">：给target指定的函数传递的参数，以元组的方式传递</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">kwargs</span><span style="color:#333333">：给target指定的函数传递命名参数</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">name</span><span style="color:#333333">：给进程设定一个名字，可以不设定</span>
</li>
</ul> 
<p style="margin-left:0cm"><span style="color:#333333">Process</span><span style="color:#333333">创建的实例对象的常用方法：</span></p> 
<ul>
<li style="text-align:justify">
<span style="color:#333333">start()</span><span style="color:#333333">：启动子进程实例（创建子进程）</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">is_alive()</span><span style="color:#333333">：判断进程子进程是否还在活着</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">join([timeout])</span><span style="color:#333333">：是否等待子进程执行结束，或等待多少秒</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">terminate()</span><span style="color:#333333">：不管任务是否完成，立即终止子进程</span>
</li>
</ul> 
<p style="margin-left:0cm"><span style="color:#333333">Process</span><span style="color:#333333">创建的实例对象的常用属性：</span></p> 
<ul>
<li style="text-align:justify">
<span style="color:#333333">name</span><span style="color:#333333">：当前进程的别名，默认为Process-N，N为从1开始递增的整数</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">pid</span><span style="color:#333333">：当前进程的pid（进程号）</span>
</li>
</ul> 
<p style="margin-left:0cm"><span style="color:#333333">示例：</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> multiprocessing </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> Process</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> os</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> time </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> sleep</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">run_proc</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(name, age, **kwargs)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">10</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">子进程运行中，name= %s,age=%d ,pid=%d...'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % (name, age, os.getpid()))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(kwargs)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0.2</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__==</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p = Process(target=run_proc, args=(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'test'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">,</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">18</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">), kwargs={<!-- --></span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"m"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">20</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">})</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># 1</span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">秒中之后，立即结束子进程</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p.terminate()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p.join()</span></span></code></span></pre> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">Pool</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">开启过多的进程并不能提高你的效率，反而会降低你的效率，假设有500个任务，同时开启500个进程，这500个进程除了不能一起执行之外（cpu没有那么多核），操作系统调度这500个进程，让他们平均在4个或8个cpu上执行，这会占用很大的空间。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">如果要启动大量的子进程，可以用进程池的方式批量创建子进程：</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">task</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(n)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}-----&gt;start'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(n))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}------&gt;end'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(n))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__ == </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p = Pool(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">8</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">创建进程池，并指定线程池的个数，默认是CPU的核数</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>        </code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># p.apply(task, args=(i,)) # </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">同步执行任务，一个一个的执行任务，没有并发效果</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        p.apply_async(task, args=(i,)) </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">异步执行任务，可以达到并发效果</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p.close()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p.join()</span></span></code></span></pre> 
<p style="margin-left:0cm"><span style="color:#333333">进程池获取任务的执行结果:</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">task</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(n)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}-----&gt;start'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(n))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}------&gt;end'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(n))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">return</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> n ** </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2</span></span></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__ == </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p = Pool(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">4</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        res = p.apply_async(task, args=(i,))  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># res </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">是任务的执行结果</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(res.get())  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">直接获取结果的弊端是，多任务又变成同步的了</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">       p.close()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># p.join()  </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">不需要再join了，因为 res.get()本身就是一个阻塞方法</span></span></span></pre> 
<p style="margin-left:0cm"><span style="color:#333333">异步获取线程的执行结果:</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> time</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> multiprocessing.pool </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> Pool</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">task</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(n)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}-----&gt;start'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(n))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'{}------&gt;end'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(n))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">return</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> n ** </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2</span></span></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__ == </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p = Pool(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">4</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    res_list = []</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        res = p.apply_async(task, args=(i,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        res_list.append(res)  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">使用列表来保存进程执行结果</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> re </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> res_list: </span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(re.get())</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p.close()</span></span></code></span></pre> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">进程间不能共享全局变量</span></strong></h2> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> multiprocessing </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> Process</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> os</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">nums = [</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">22</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">]</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">work1</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">()</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#718c00">"""</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">子进程要执行的代码"""</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"in process1 pid=%d ,nums=%s"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % (os.getpid(), nums))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">3</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        nums.append(i)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"in process1 pid=%d ,nums=%s"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % (os.getpid(), nums))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">work2</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">()</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#718c00">"""</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">子进程要执行的代码"""</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    nums.pop()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"in process2 pid=%d ,nums=%s"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % (os.getpid(), nums))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__ == </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p1 = Process(target=work1)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p1.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p1.join()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p2 = Process(target=work2)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    p2.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'in process0 pid={} ,nums={}'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">.format(os.getpid(),nums))</span></span></code></span></pre> 
<p style="margin-left:0cm"><span style="color:#333333">运行结果:</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> process1 pid=</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2707</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ,nums=[</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">22</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">]</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> process1 pid=</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2707</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ,nums=[</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">22</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">]</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> process1 pid=</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2707</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ,nums=[</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">22</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">]</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> process1 pid=</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2707</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ,nums=[</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">22</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">]</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> process0 pid=</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2706</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ,nums=[</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">22</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">]</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> process2 pid=</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2708</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> ,nums=[</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">11</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">]</span></span></code></span></pre> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">线程和进程</span></strong></h2> 
<h3 style="margin-left:0cm"><strong><span style="color:#333333">功能</span></strong></h3> 
<ul>
<li style="text-align:justify"><span style="color:#333333">进程，能够完成多任务，比如 在一台电脑上能够同时运行多个QQ。</span></li>
<li style="text-align:justify"><span style="color:#333333">线程，能够完成多任务，比如 一个QQ中的多个聊天窗口。</span></li>
</ul> 
<h3 style="margin-left:0cm"><strong><span style="color:#333333">定义的不同</span></strong></h3> 
<ul>
<li style="text-align:justify"><span style="color:#333333">进程是系统进行资源分配和调度的一个独立单位.</span></li>
<li style="text-align:justify"><span style="color:#333333">线程是进程的一个实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。</span></li>
</ul> 
<h3 style="margin-left:0cm"><strong><span style="color:#333333">区别</span></strong></h3> 
<ul>
<li style="text-align:justify"><span style="color:#333333">一个程序至少有一个进程,一个进程至少有一个线程.</span></li>
<li style="text-align:justify"><span style="color:#333333">线程的划分尺度小于进程(资源比进程少)，使得多线程程序的并发性高。</span></li>
<li style="text-align:justify"><span style="color:#333333">进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率</span></li>
<li style="text-align:justify"><span style="color:#333333">线线程不能够独立执行，必须依存在进程中</span></li>
<li style="text-align:justify"><span style="color:#333333">可以将进程理解为工厂中的一条流水线，而其中的线程就是这个流水线上的工人</span></li>
</ul> 
<h3 style="margin-left:0cm"><strong><span style="color:#333333">优缺点</span></strong></h3> 
<p style="margin-left:0"><span style="color:#333333">线程和进程在使用上各有优缺点：线程执行开销小，但不利于资源的管理和保护；而进程正相反。</span></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">进程间通信-Queue</span></strong></h2> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> multiprocessing </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> Queue</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">q=Queue(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">3</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">) </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c">#</span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">初始化一个Queue对象，最多可接收三条put消息</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">q.put(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">消息1"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">) </span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">q.put(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">消息2"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">print(q.full())  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c">#False</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">q.put(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">消息3"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">print(q.full()) </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c">#True</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8e908c">#</span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">因为消息列队已满下面的try都会抛出异常，第一个try会等待2秒后再抛出异常，第二个Try会立刻抛出异常</span></span><span style="background-color:#f7f7f7"><span style="color:#8959a8">try</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    q.put(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">消息4"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">,</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">True</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">,</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">except</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">消息列队已满，现有消息数量:%s"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">%q.qsize())</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">try</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    q.put_nowait(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">消息4"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">except</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">消息列队已满，现有消息数量:%s"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">%q.qsize())</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8e908c">#</span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">推荐的方式，先判断消息列队是否已满，再写入</span></span><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">not</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> q.full():</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    q.put_nowait(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">消息4"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8e908c">#</span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">读取消息时，先判断消息列队是否为空，再读取</span></span><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">not</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> q.empty():</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(q.qsize()):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(q.get_nowait())</span></span></code></span></pre> 
<h5 style="margin-left:0cm"><strong><span style="color:#333333">说明</span></strong></h5> 
<p style="margin-left:0cm"><span style="color:#333333">初始化Queue()对象时（例如：q=Queue()），若括号中没有指定最大可接收的消息数量，或数量为负值，那么就代表可接受的消息数量没有上限（直到内存的尽头）；</span></p> 
<ul>
<li style="text-align:justify">
<span style="color:#333333">Queue.qsize()</span><span style="color:#333333">：返回当前队列包含的消息数量；</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">Queue.empty()</span><span style="color:#333333">：如果队列为空，返回True，反之False ；</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">Queue.full()</span><span style="color:#333333">：如果队列满了，返回True,反之False；</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">Queue.get([block[, timeout]])</span><span style="color:#333333">：获取队列中的一条消息，然后将其从列队中移除，block默认值为True；</span>
</li>
</ul> 
<p style="margin-left:0cm"><span style="color:#333333">1</span><span style="color:#333333">）如果block使用默认值，且没有设置timeout（单位秒），消息列队如果为空，此时程序将被阻塞（停在读取状态），直到从消息列队读到消息为止，如果设置了timeout，则会等待timeout秒，若还没读取到任何消息，则抛出"Queue.Empty"异常；</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">2</span><span style="color:#333333">）如果block值为False，消息列队如果为空，则会立刻抛出"Queue.Empty"异常；</span></p> 
<ul>
<li style="text-align:justify">
<span style="color:#333333">Queue.get_nowait()</span><span style="color:#333333">：相当Queue.get(False)；</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">Queue.put(item,[block[, timeout]])</span><span style="color:#333333">：将item消息写入队列，block默认值为True；</span>
</li>
</ul> 
<p style="margin-left:0cm"><span style="color:#333333">1</span><span style="color:#333333">）如果block使用默认值，且没有设置timeout（单位秒），消息列队如果已经没有空间可写入，此时程序将被阻塞（停在写入状态），直到从消息列队腾出空间为止，如果设置了timeout，则会等待timeout秒，若还没空间，则抛出"Queue.Full"异常；</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">2</span><span style="color:#333333">）如果block值为False，消息列队如果没有空间可写入，则会立刻抛出"Queue.Full"异常；</span></p> 
<ul><li style="text-align:justify">
<span style="color:#333333">Queue.put_nowait(item)</span><span style="color:#333333">：相当Queue.put(item, False)；</span>
</li></ul> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">使用Queue实现进程共享</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">我们以Queue为例，在父进程中创建两个子进程，一个往Queue里写数据，一个从Queue里读数据：</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> multiprocessing </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> Process, Queue</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> os, time, random</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">写数据进程执行的代码:</span></span><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">write</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(q)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> value </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> [</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'A'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'B'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">, </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'C'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">]:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'Put %s to queue...'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % value)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        q.put(value)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        time.sleep(random.random())</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">读数据进程执行的代码:</span></span><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">read</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(q)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">while</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">True</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>        </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">not</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> q.empty():</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            value = q.get(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">True</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'Get %s from queue.'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % value)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">            time.sleep(random.random())</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>        </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">else</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>            </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">break</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__==</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'__main__'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">父进程创建Queue，并传给各个子进程：</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    q = Queue()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    pw = Process(target=write, args=(q,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    pr = Process(target=read, args=(q,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">启动子进程pw，写入:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    pw.start()    </span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">等待pw结束:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    pw.join()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">启动子进程pr，读取:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    pr.start()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    pr.join()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">'</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">所有数据都写入并且读完'</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<p style="margin-left:.0001pt;text-align:justify"></p> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">进程池</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">当需要创建的子进程数量不多时，可以直接利用multiprocessing中的Process动态成生多个进程，但如果是上百甚至上千个目标，手动的去创建进程的工作量巨大，此时就可以用到multiprocessing模块提供的Pool方法。</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">初始化Pool时，可以指定一个最大进程数，当有新的请求提交到Pool中时，如果池还没有满，那么就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到指定的最大值，那么该请求就会等待，直到池中有进程结束，才会用之前的进程来执行新的任务，请看下面的实例：</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> multiprocessing </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> Pool</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> os, time, random</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">worker</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(msg)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t_start = time.time()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"%s</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">开始执行,进程号为%d"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % (msg,os.getpid()))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># random.random()</span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">随机生成0~1之间的浮点数</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    time.sleep(random.random()*</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">2</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">) </span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    t_stop = time.time()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(msg,</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">执行完毕，耗时%0.2f"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % (t_stop-t_start))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">po = Pool(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">3</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">定义一个进程池，最大进程数3</span></span><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">,</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">10</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># Pool().apply_async(</span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">要调用的目标,(传递给目标的参数元祖,))</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">每次循环将会用空闲出来的子进程去调用目标</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    po.apply_async(worker,(i,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"----start----"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">po.close()  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">关闭进程池，关闭后po不再接收新的请求</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">po.join()  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">等待po中所有子进程执行完成，必须放在close语句之后</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"-----end-----"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<p style="margin-left:0cm"><span style="color:#333333">运行效果：</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">----start----</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214661</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214682</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214670</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1.013</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214662</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1.244</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214673</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0.565</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214661</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1.686</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214684</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0.677</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214675</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0.838</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214666</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">0.759</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">开始执行,进程号为</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">214687</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1.038</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1.059</span></span><code> </code><code><span style="background-color:#f7f7f7"><span style="color:#333333">执行完毕，耗时</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1.69</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">-----end-----</span></span></code></span></pre> 
<p style="margin-left:0cm"><span style="color:#333333">multiprocessing.Pool</span><span style="color:#333333">常用函数解析：</span></p> 
<ul>
<li style="text-align:justify">
<span style="color:#333333">apply_async(func[, args[, kwds]]) </span><span style="color:#333333">：使用非阻塞方式调用func（并行执行，堵塞方式必须等待上一个进程退出才能执行下一个进程），args为传递给func的参数列表，kwds为传递给func的关键字参数列表；</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">close()</span><span style="color:#333333">：关闭Pool，使其不再接受新的任务；</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">terminate()</span><span style="color:#333333">：不管任务是否完成，立即终止；</span>
</li>
<li style="text-align:justify">
<span style="color:#333333">join()</span><span style="color:#333333">：主进程阻塞，等待子进程的退出， 必须在close或terminate之后使用；</span>
</li>
</ul> 
<h2 style="margin-left:0cm"><strong><span style="color:#333333">进程池中的Queue</span></strong></h2> 
<p style="margin-left:0cm"><span style="color:#333333">如果要使用Pool创建进程，就需要使用multiprocessing.Manager()中的Queue()，而不是multiprocessing.Queue()，否则会得到一条如下的错误信息：</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">RuntimeError: Queue objects should only be shared between processes through inheritance.</span></p> 
<p style="margin-left:0cm"><span style="color:#333333">下面的实例演示了进程池中的进程如何通信：</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">修改import中的Queue为Manager</span></span><span style="background-color:#f7f7f7"><span style="color:#8959a8">from</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> multiprocessing </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> Manager, Pool</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">import</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> os, time, random</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">reader</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(q)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"reader</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">启动(%s),父进程为(%s)"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % (os.getpid(), os.getppid()))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> range(q.qsize()):</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"reader</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">从Queue获取到消息：%s"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % q.get(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">True</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">def</span></span> <span style="background-color:#f7f7f7"><span style="color:#8e908c">writer</span></span><span style="background-color:#f7f7f7"><span style="color:#f5871f">(q)</span></span><span style="background-color:#f7f7f7"><span style="color:#4271ae">:</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"writer</span></span><span style="background-color:#f7f7f7"><span style="color:#718c00">启动(%s),父进程为(%s)"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % (os.getpid(), os.getppid()))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code>    </code><span style="background-color:#f7f7f7"><span style="color:#8959a8">for</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> i </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8959a8">in</span></span><code> </code><span style="background-color:#f7f7f7"><span style="color:#718c00">"helloworld"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">        q.put(i)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><span style="background-color:#f7f7f7"><span style="color:#8959a8">if</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> __name__ == </span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"__main__"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">:</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"(%s) start"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % os.getpid())</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    q = Manager().Queue()  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">使用Manager中的Queue</span></span></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    po = Pool()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    po.apply_async(writer, (q,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    time.sleep(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">1</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)  </span></span></code><span style="background-color:#f7f7f7"><span style="color:#8e908c"># </span></span><span style="background-color:#f7f7f7"><span style="color:#8e908c">先让上面的任务向Queue存入数据，然后再让下面的任务开始从中取数据</span></span></span></pre> 
<pre style="margin-left:.0001pt"></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    po.apply_async(reader, (q,))</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    po.close()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    po.join()</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">    print(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#718c00">"(%s) End"</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333"> % os.getpid())</span></span></code></span></pre> 
<p style="margin-left:0cm"><span style="color:#333333">运行结果:</span></p> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">4171</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">) start</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">writer</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">启动(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">4173</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">),</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">父进程为(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">4171</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">启动(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">4174</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">),</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">父进程为(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">4171</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">)</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：h</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：e</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：l</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：l</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：o</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：w</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：o</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：r</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：l</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">reader</span></span></code><code><span style="background-color:#f7f7f7"><span style="color:#333333">从Queue获取到消息：d</span></span></code></span></pre> 
<pre style="margin-left:.0001pt"><span style="background-color:#f7f7f7"><code><span style="background-color:#f7f7f7"><span style="color:#333333">(</span></span></code><span style="background-color:#f7f7f7"><span style="color:#f5871f">4171</span></span><code><span style="background-color:#f7f7f7"><span style="color:#333333">) End</span></span></code></span></pre> 
<p style="margin-left:.0001pt;text-align:justify"></p>
                </div>

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
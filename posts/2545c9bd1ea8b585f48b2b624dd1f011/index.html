<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>jvm调优 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">jvm调优</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <h1>
<a id="jvm_0"></a>一、jvm内存调优</h1> 
<p>主要的目的是<strong>减小GC的频率和Full GC的次数</strong>。</p> 
<p>1.Full GC</p> 
<blockquote> 
 <p>会对整个堆进行整理，包括Young、Tenured和Perm。Full GC由于须要对整个堆进行回收，因此比较慢，所以应该尽量减小Full GC的次数。数组</p> 
</blockquote> 
<p>2.致使Full GC的缘由缓存</p> 
<blockquote> 
 <p>1)年老代（Tenured）被写满服务器<br> 调优时尽可能让对象在新生代GC时被回收、让对象在新生代多存活一段时间和不要建立过大的对象及数组避免直接在旧生代建立对象 。并发<br> 2)持久代Pemanet Generation空间不足jvm<br> 增大Perm Gen空间，避免太多静态对象 ， 控制好新生代和旧生代的比例高并发<br> 3)System.gc()被显示调用工具<br> 垃圾回收不要手动触发，尽可能依靠JVM自身的机制</p> 
</blockquote> 
<p>在对JVM调优的过程当中，很大一部分工做就是对于FullGC的调节，下面详细介绍对应JVM调优的方法和步骤。</p> 
<h1>
<a id="jvm_20"></a>二、jvm性能调优工具及思路(重要)—面试必看</h1> 
<h2>
<a id="21JVM_22"></a>2.1.JVM调优参数参考</h2> 
<blockquote> 
 <p>1.针对JVM堆的设置，通常能够经过-Xms -Xmx限定其最小、最大值，为了防止垃圾收集器在最小、最大之间收缩堆而产生额外的时间，一般把最大、最小设置为相同的值;<br> 2.年轻代和年老代将根据默认的比例（1：2）分配堆内存， 能够经过调整两者之间的比率NewRadio来调整两者之间的大小，也能够针对回收代。<br> 好比年轻代，经过 -XX:newSize -XX:MaxNewSize来设置其绝对大小。一样，为了防止年轻代的堆收缩，咱们一般会把-XX:newSize -XX:MaxNewSize设置为一样大小。<br> 3.年轻代和年老代设置多大才算合理<br> 1）更大的年轻代必然致使更小的年老代，大的年轻代会延长普通GC的周期，但会增长每次GC的时间；小的年老代会致使更频繁的Full GC<br> 2）更小的年轻代必然致使更大年老代，小的年轻代会致使普通GC很频繁，但每次的GC时间会更短；大的年老代会减小Full GC的频率<br> 如何选择应该依赖应用程序对象生命周期的分布状况： 若是应用存在大量的临时对象，应该选择更大的年轻代；若是存在相对较多的持久对象，年老代应该适当增大。但不少应用都没有这样明显的特性。<br> 在抉择时应该根 据如下两点：<br> （1）本着Full GC尽可能少的原则，让年老代尽可能缓存经常使用对象，JVM的默认比例1：2也是这个道理 。<br> （2）经过观察应用一段时间，看其余在峰值时年老代会占多少内存，在不影响Full GC的前提下，根据实际状况加大年轻代，好比能够把比例控制在1：1。但应该给年老代至少预留1/3的增加空间。<br> 4.在配置较好的机器上（好比多核、大内存），能够为年老代选择并行收集算法： -XX:+UseParallelOldGC 。<br> 5.线程堆栈的设置：每一个线程默认会开启1M的堆栈，用于存放栈帧、调用参数、局部变量等，对大多数应用而言这个默认值太了，通常256K就足用。<br> 理论上，在内存不变的状况下，减小每一个线程的堆栈，能够产生更多的线程，但这实际上还受限于操做系统。</p> 
</blockquote> 
<h2>
<a id="22jpsJava_Virtual_Machine_Process_Status_Tool_38"></a>2.2.调优工具之jps(Java Virtual Machine Process Status Tool)</h2> 
<p>jps主要用来输出JVM中运行的进程状态信息。语法格式如下：</p> 
<pre><code class="prism language-java">jps <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>hostid<span class="token punctuation">]</span>
</code></pre> 
<p>如果不指定hostid就默认为当前主机或服务器。<br> 命令行参数选项说明如下：</p> 
<blockquote> 
 <p>-q 不输出类名、Jar名和传入main方法的参数<br> -m 输出传入main方法的参数<br> -l 输出main类或Jar的全限名<br> -v 输出传入JVM的参数</p> 
</blockquote> 
<p>比如下面：</p> 
<pre><code class="prism language-java">root<span class="token annotation punctuation">@ubuntu</span><span class="token operator">:</span><span class="token operator">/</span># jps <span class="token operator">-</span>m <span class="token operator">-</span>l

<span class="token number">2458</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>artifactory<span class="token punctuation">.</span>standalone<span class="token punctuation">.</span>main<span class="token punctuation">.</span></span>Main</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>artifactory<span class="token operator">-</span><span class="token number">2.2</span><span class="token number">.5</span><span class="token operator">/</span>etc<span class="token operator">/</span>jetty<span class="token punctuation">.</span>xml

<span class="token number">29920</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>hat<span class="token punctuation">.</span></span>Main</span> <span class="token operator">-</span>port <span class="token number">9998</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>dump<span class="token punctuation">.</span>dat

<span class="token number">3149</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>startup<span class="token punctuation">.</span></span>Bootstrap</span> start

<span class="token number">30972</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>jps<span class="token punctuation">.</span></span>Jps</span> <span class="token operator">-</span>m <span class="token operator">-</span>l

<span class="token number">8247</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>startup<span class="token punctuation">.</span></span>Bootstrap</span> start

<span class="token number">25687</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>hat<span class="token punctuation">.</span></span>Main</span> <span class="token operator">-</span>port <span class="token number">9999</span> dump<span class="token punctuation">.</span>dat

<span class="token number">21711</span> mrf<span class="token operator">-</span>center<span class="token punctuation">.</span>jar
</code></pre> 
<h2>
<a id="23jstack_74"></a>2.3.调优工具之jstack</h2> 
<pre><code>jstack主要用来查看某个Java进程内的线程堆栈信息。语法格式如下：
</code></pre> 
<pre><code class="prism language-java">jstack <span class="token punctuation">[</span>option<span class="token punctuation">]</span> pid
</code></pre> 
<pre><code class="prism language-java">jstack <span class="token punctuation">[</span>option<span class="token punctuation">]</span> executable core
</code></pre> 
<pre><code class="prism language-java">jstack <span class="token punctuation">[</span>option<span class="token punctuation">]</span> <span class="token punctuation">[</span>server<span class="token operator">-</span>id@<span class="token punctuation">]</span>remote<span class="token operator">-</span>hostname<span class="token operator">-</span>or<span class="token operator">-</span>ip
</code></pre> 
<pre><code>命令行参数选项说明如下：
</code></pre> 
<blockquote> 
 <p><code>-l long listings</code>，会打印出额外的锁信息，在发生死锁时可以用jstack -l pid来观察锁持有情况<br> <code>-m mixed mode</code>，不仅会输出Java堆栈信息，还会输出C/C++堆栈信息（比如Native方法）</p> 
</blockquote> 
<blockquote> 
 <p>jstack可以定位到线程堆栈，根据堆栈信息我们可以定位到具体代码，所以它在JVM性能调优中使用得非常多。下面我们来一个实例找出某个Java进程中最耗费CPU的Java线程并定位堆栈信息，用到的命令有ps、top、printf、jstack、grep。</p> 
</blockquote> 
<p>第一步先找出Java进程ID，我部署在服务器上的Java应用名称为mrf-center：</p> 
<pre><code class="prism language-java">root<span class="token annotation punctuation">@ubuntu</span><span class="token operator">:</span><span class="token operator">/</span># ps <span class="token operator">-</span>ef <span class="token operator">|</span> grep mrf<span class="token operator">-</span>center <span class="token operator">|</span> grep <span class="token operator">-</span>v grep
</code></pre> 
<pre><code class="prism language-java">root     <span class="token number">21711</span>     <span class="token number">1</span>  <span class="token number">1</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">47</span> pts<span class="token operator">/</span><span class="token number">3</span>    <span class="token number">00</span><span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">10</span> java <span class="token operator">-</span>jar mrf<span class="token operator">-</span>center<span class="token punctuation">.</span>jar
</code></pre> 
<p>得到进程ID为21711，第二步找出该进程内最耗费CPU的线程，可以使用<code>ps -Lfp pid</code>或者<code>ps -mp pid -o THREAD</code>, tid, time或者top -Hp pid，我这里用第三个，输出如下：</p> 
<p><img src="https://images2.imgbox.com/b7/44/IPC5dtOq_o.png" alt="在这里插入图片描述"><br> TIME列就是各个Java线程耗费的CPU时间，CPU时间最长的是线程ID为21742的线程，用</p> 
<pre><code class="prism language-java">printf <span class="token string">"%xn"</span> <span class="token number">21742</span>
</code></pre> 
<p>得到21742的十六进制值为54ee，下面会用到。</p> 
<p>OK，下一步终于轮到jstack上场了，它用来输出进程21711的堆栈信息，然后根据线程ID的十六进制值grep，如下：</p> 
<pre><code class="prism language-java">root<span class="token annotation punctuation">@ubuntu</span><span class="token operator">:</span><span class="token operator">/</span># jstack <span class="token number">21711</span> <span class="token operator">|</span> grep <span class="token number">54</span>ee
</code></pre> 
<pre><code class="prism language-java"><span class="token string">"PollIntervalRetrySchedulerThread"</span> prio<span class="token operator">=</span><span class="token number">10</span> tid<span class="token operator">=</span><span class="token number">0x00007f950043e000</span> nid<span class="token operator">=</span><span class="token number">0x54ee</span> in <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0x00007f94c6eda000</span><span class="token punctuation">]</span>
</code></pre> 
<p>可以看到CPU消耗在PollIntervalRetrySchedulerThread这个类的Object.wait()，我找了下我的代码，定位到下面的代码：</p> 
<pre><code class="prism language-java"><span class="token comment">// Idle wait</span>
<span class="token function">getLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Thread ["</span> <span class="token operator">+</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"] is idle waiting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schedulerThreadState <span class="token operator">=</span> <span class="token class-name">PollTaskSchedulerThreadState<span class="token punctuation">.</span>IdleWaiting</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> waitTime <span class="token operator">=</span> now <span class="token operator">+</span> <span class="token function">getIdleWaitTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> timeUntilContinue <span class="token operator">=</span> waitTime <span class="token operator">-</span> now<span class="token punctuation">;</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span>sigLock<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>halted<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            sigLock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>timeUntilContinue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>它是轮询任务的空闲等待代码，上面的<code>sigLock.wait(timeUntilContinue)</code>就对应了前面的<code>Object.wait()</code>。</p> 
<h2>
<a id="24jmapMemory_MapjhatJava_Heap_Analysis_Tool_150"></a>2.4.调优工具之jmap(Memory Map)和jhat(Java Heap Analysis Tool)</h2> 
<p>jmap用来查看堆内存使用状况，一般结合jhat使用。</p> 
<p>jmap语法格式如下：</p> 
<pre><code class="prism language-java">jmap <span class="token punctuation">[</span>option<span class="token punctuation">]</span> pid
</code></pre> 
<pre><code class="prism language-java">jmap <span class="token punctuation">[</span>option<span class="token punctuation">]</span> executable core
</code></pre> 
<pre><code class="prism language-java">jmap <span class="token punctuation">[</span>option<span class="token punctuation">]</span> <span class="token punctuation">[</span>server<span class="token operator">-</span>id@<span class="token punctuation">]</span>remote<span class="token operator">-</span>hostname<span class="token operator">-</span>or<span class="token operator">-</span>ip
</code></pre> 
<p>如果运行在64位JVM上，可能需要指定-J-d64命令选项参数。</p> 
<pre><code class="prism language-java">jmap <span class="token operator">-</span>permstat pid
</code></pre> 
<p>打印进程的类加载器和类加载器加载的持久代对象信息，输出：类加载器名称、对象是否存活（不可靠）、对象地址、父类加载器、已加载的类大小等信息，如下图：</p> 
<p><img src="https://images2.imgbox.com/f2/1d/SwLaLo8z_o.png" alt="在这里插入图片描述"></p> 
<p>使用jmap -heap pid查看进程堆内存使用情况，包括使用的GC算法、堆配置参数和各代中堆内存使用情况。比如下面的例子：</p> 
<pre><code class="prism language-java">root<span class="token annotation punctuation">@ubuntu</span><span class="token operator">:</span><span class="token operator">/</span># jmap <span class="token operator">-</span>heap <span class="token number">21711</span>
<span class="token class-name">Attaching</span> <span class="token keyword">to</span> <span class="token namespace">process</span> <span class="token class-name">ID</span> <span class="token number">21711</span><span class="token punctuation">,</span> please wait<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Debugger</span> attached <span class="token class-name"><span class="token namespace">successfully<span class="token punctuation">.</span></span>
Server</span> compiler detected<span class="token punctuation">.</span>
JVM version is <span class="token number">20.10</span><span class="token operator">-</span>b01
 
using thread<span class="token operator">-</span>local object <span class="token class-name"><span class="token namespace">allocation<span class="token punctuation">.</span></span>
Parallel</span> GC <span class="token keyword">with</span> <span class="token number">4</span> <span class="token function">thread</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
 
<span class="token class-name">Heap</span> <span class="token class-name">Configuration</span><span class="token operator">:</span>
   <span class="token class-name">MinHeapFreeRatio</span> <span class="token operator">=</span> <span class="token number">40</span>
   <span class="token class-name">MaxHeapFreeRatio</span> <span class="token operator">=</span> <span class="token number">70</span>
   <span class="token class-name">MaxHeapSize</span>      <span class="token operator">=</span> <span class="token number">2067791872</span> <span class="token punctuation">(</span><span class="token number">1972.0</span>MB<span class="token punctuation">)</span>
   <span class="token class-name">NewSize</span>          <span class="token operator">=</span> <span class="token number">1310720</span> <span class="token punctuation">(</span><span class="token number">1.25</span>MB<span class="token punctuation">)</span>
   <span class="token class-name">MaxNewSize</span>       <span class="token operator">=</span> <span class="token number">17592186044415</span> MB
   <span class="token class-name">OldSize</span>          <span class="token operator">=</span> <span class="token number">5439488</span> <span class="token punctuation">(</span><span class="token number">5.1875</span>MB<span class="token punctuation">)</span>
   <span class="token class-name">NewRatio</span>         <span class="token operator">=</span> <span class="token number">2</span>
   <span class="token class-name">SurvivorRatio</span>    <span class="token operator">=</span> <span class="token number">8</span>
   <span class="token class-name">PermSize</span>         <span class="token operator">=</span> <span class="token number">21757952</span> <span class="token punctuation">(</span><span class="token number">20.75</span>MB<span class="token punctuation">)</span>
   <span class="token class-name">MaxPermSize</span>      <span class="token operator">=</span> <span class="token number">85983232</span> <span class="token punctuation">(</span><span class="token number">82.0</span>MB<span class="token punctuation">)</span>
 
<span class="token class-name">Heap</span> <span class="token class-name">Usage</span><span class="token operator">:</span>
PS <span class="token class-name">Young</span> <span class="token class-name">Generation</span>
<span class="token class-name">Eden</span> <span class="token class-name">Space</span><span class="token operator">:</span>
   capacity <span class="token operator">=</span> <span class="token number">6422528</span> <span class="token punctuation">(</span><span class="token number">6.125</span>MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">5445552</span> <span class="token punctuation">(</span><span class="token number">5.1932830810546875</span>MB<span class="token punctuation">)</span>
   free     <span class="token operator">=</span> <span class="token number">976976</span> <span class="token punctuation">(</span><span class="token number">0.9317169189453125</span>MB<span class="token punctuation">)</span>
   <span class="token number">84.78829520089286</span><span class="token operator">%</span> used
<span class="token class-name">From</span> <span class="token class-name">Space</span><span class="token operator">:</span>
   capacity <span class="token operator">=</span> <span class="token number">131072</span> <span class="token punctuation">(</span><span class="token number">0.125</span>MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">98304</span> <span class="token punctuation">(</span><span class="token number">0.09375</span>MB<span class="token punctuation">)</span>
   free     <span class="token operator">=</span> <span class="token number">32768</span> <span class="token punctuation">(</span><span class="token number">0.03125</span>MB<span class="token punctuation">)</span>
   <span class="token number">75.0</span><span class="token operator">%</span> used
<span class="token class-name">To</span> <span class="token class-name">Space</span><span class="token operator">:</span>
   capacity <span class="token operator">=</span> <span class="token number">131072</span> <span class="token punctuation">(</span><span class="token number">0.125</span>MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span>MB<span class="token punctuation">)</span>
   free     <span class="token operator">=</span> <span class="token number">131072</span> <span class="token punctuation">(</span><span class="token number">0.125</span>MB<span class="token punctuation">)</span>
   <span class="token number">0.0</span><span class="token operator">%</span> used
PS <span class="token class-name">Old</span> <span class="token class-name">Generation</span>
   capacity <span class="token operator">=</span> <span class="token number">35258368</span> <span class="token punctuation">(</span><span class="token number">33.625</span>MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">4119544</span> <span class="token punctuation">(</span><span class="token number">3.9287033081054688</span>MB<span class="token punctuation">)</span>
   free     <span class="token operator">=</span> <span class="token number">31138824</span> <span class="token punctuation">(</span><span class="token number">29.69629669189453</span>MB<span class="token punctuation">)</span>
   <span class="token number">11.683876009235595</span><span class="token operator">%</span> used
PS <span class="token class-name">Perm</span> <span class="token class-name">Generation</span>
   capacity <span class="token operator">=</span> <span class="token number">52428800</span> <span class="token punctuation">(</span><span class="token number">50.0</span>MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">26075168</span> <span class="token punctuation">(</span><span class="token number">24.867218017578125</span>MB<span class="token punctuation">)</span>
   free     <span class="token operator">=</span> <span class="token number">26353632</span> <span class="token punctuation">(</span><span class="token number">25.132781982421875</span>MB<span class="token punctuation">)</span>
   <span class="token number">49.73443603515625</span><span class="token operator">%</span> used
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>使用jmap -histo[:live] pid查看堆内存中的对象数目、大小统计直方图，如果带上live则只统计活对象，如下：</p> 
<pre><code class="prism language-java">root<span class="token annotation punctuation">@ubuntu</span><span class="token operator">:</span><span class="token operator">/</span># jmap <span class="token operator">-</span>histo<span class="token operator">:</span>live <span class="token number">21711</span> <span class="token operator">|</span> more
 
 num     #instances         #bytes  <span class="token keyword">class</span> name
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
   <span class="token number">1</span><span class="token operator">:</span>         <span class="token number">38445</span>        <span class="token number">5597736</span>  <span class="token generics"><span class="token punctuation">&lt;</span>constMethodKlass<span class="token punctuation">&gt;</span></span>
   <span class="token number">2</span><span class="token operator">:</span>         <span class="token number">38445</span>        <span class="token number">5237288</span>  <span class="token generics"><span class="token punctuation">&lt;</span>methodKlass<span class="token punctuation">&gt;</span></span>
   <span class="token number">3</span><span class="token operator">:</span>          <span class="token number">3500</span>        <span class="token number">3749504</span>  <span class="token generics"><span class="token punctuation">&lt;</span>constantPoolKlass<span class="token punctuation">&gt;</span></span>
   <span class="token number">4</span><span class="token operator">:</span>         <span class="token number">60858</span>        <span class="token number">3242600</span>  <span class="token generics"><span class="token punctuation">&lt;</span>symbolKlass<span class="token punctuation">&gt;</span></span>
   <span class="token number">5</span><span class="token operator">:</span>          <span class="token number">3500</span>        <span class="token number">2715264</span>  <span class="token generics"><span class="token punctuation">&lt;</span>instanceKlassKlass<span class="token punctuation">&gt;</span></span>
   <span class="token number">6</span><span class="token operator">:</span>          <span class="token number">2796</span>        <span class="token number">2131424</span>  <span class="token generics"><span class="token punctuation">&lt;</span>constantPoolCacheKlass<span class="token punctuation">&gt;</span></span>
   <span class="token number">7</span><span class="token operator">:</span>          <span class="token number">5543</span>        <span class="token number">1317400</span>  <span class="token punctuation">[</span><span class="token class-name">I</span>
   <span class="token number">8</span><span class="token operator">:</span>         <span class="token number">13714</span>        <span class="token number">1010768</span>  <span class="token punctuation">[</span><span class="token class-name">C</span>
   <span class="token number">9</span><span class="token operator">:</span>          <span class="token number">4752</span>        <span class="token number">1003344</span>  <span class="token punctuation">[</span><span class="token class-name">B</span>
  <span class="token number">10</span><span class="token operator">:</span>          <span class="token number">1225</span>         <span class="token number">639656</span>  <span class="token generics"><span class="token punctuation">&lt;</span>methodDataKlass<span class="token punctuation">&gt;</span></span>
  <span class="token number">11</span><span class="token operator">:</span>         <span class="token number">14194</span>         <span class="token number">454208</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span>
  <span class="token number">12</span><span class="token operator">:</span>          <span class="token number">3809</span>         <span class="token number">396136</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Class</span>
  <span class="token number">13</span><span class="token operator">:</span>          <span class="token number">4979</span>         <span class="token number">311952</span>  <span class="token punctuation">[</span><span class="token class-name">S</span>
  <span class="token number">14</span><span class="token operator">:</span>          <span class="token number">5598</span>         <span class="token number">287064</span>  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">I</span>
  <span class="token number">15</span><span class="token operator">:</span>          <span class="token number">3028</span>         <span class="token number">266464</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span>
  <span class="token number">16</span><span class="token operator">:</span>           <span class="token number">280</span>         <span class="token number">163520</span>  <span class="token generics"><span class="token punctuation">&lt;</span>objArrayKlassKlass<span class="token punctuation">&gt;</span></span>
  <span class="token number">17</span><span class="token operator">:</span>          <span class="token number">4355</span>         <span class="token number">139360</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span>$<span class="token class-name">Entry</span>
  <span class="token number">18</span><span class="token operator">:</span>          <span class="token number">1869</span>         <span class="token number">138568</span>  <span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap$<span class="token class-name">Entry</span><span class="token punctuation">;</span>
  <span class="token number">19</span><span class="token operator">:</span>          <span class="token number">2443</span>          <span class="token number">97720</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>LinkedHashMap</span>$<span class="token class-name">Entry</span>
  <span class="token number">20</span><span class="token operator">:</span>          <span class="token number">2072</span>          <span class="token number">82880</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>SoftReference</span>
  <span class="token number">21</span><span class="token operator">:</span>          <span class="token number">1807</span>          <span class="token number">71528</span>  <span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Object<span class="token punctuation">;</span>
  <span class="token number">22</span><span class="token operator">:</span>          <span class="token number">2206</span>          <span class="token number">70592</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>WeakReference</span>
  <span class="token number">23</span><span class="token operator">:</span>           <span class="token number">934</span>          <span class="token number">52304</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>LinkedHashMap</span>
  <span class="token number">24</span><span class="token operator">:</span>           <span class="token number">871</span>          <span class="token number">48776</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>MethodDescriptor</span>
  <span class="token number">25</span><span class="token operator">:</span>          <span class="token number">1442</span>          <span class="token number">46144</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ConcurrentHashMap</span>$<span class="token class-name">HashEntry</span>
  <span class="token number">26</span><span class="token operator">:</span>           <span class="token number">804</span>          <span class="token number">38592</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span>
  <span class="token number">27</span><span class="token operator">:</span>           <span class="token number">948</span>          <span class="token number">37920</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ConcurrentHashMap</span>$<span class="token class-name">Segment</span>
  <span class="token number">28</span><span class="token operator">:</span>          <span class="token number">1621</span>          <span class="token number">35696</span>  <span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Class<span class="token punctuation">;</span>
  <span class="token number">29</span><span class="token operator">:</span>          <span class="token number">1313</span>          <span class="token number">34880</span>  <span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String<span class="token punctuation">;</span>
  <span class="token number">30</span><span class="token operator">:</span>          <span class="token number">1396</span>          <span class="token number">33504</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>LinkedList</span>$<span class="token class-name">Entry</span>
  <span class="token number">31</span><span class="token operator">:</span>           <span class="token number">462</span>          <span class="token number">33264</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Field</span>
  <span class="token number">32</span><span class="token operator">:</span>          <span class="token number">1024</span>          <span class="token number">32768</span>  <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Hashtable</span>$<span class="token class-name">Entry</span>
  <span class="token number">33</span><span class="token operator">:</span>           <span class="token number">948</span>          <span class="token number">31440</span>  <span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>ConcurrentHashMap$<span class="token class-name">HashEntry</span><span class="token punctuation">;</span>
</code></pre> 
<p>class name是对象类型，说明如下：</p> 
<pre><code class="prism language-java"><span class="token class-name">B</span>  <span class="token keyword">byte</span>
<span class="token class-name">C</span>  <span class="token keyword">char</span>
<span class="token class-name">D</span>  <span class="token keyword">double</span>
<span class="token class-name">F</span>  <span class="token keyword">float</span>
<span class="token class-name">I</span>  <span class="token keyword">int</span>
<span class="token class-name">J</span>  <span class="token keyword">long</span>
<span class="token class-name">Z</span>  <span class="token keyword">boolean</span>
<span class="token punctuation">[</span>  数组，如<span class="token punctuation">[</span><span class="token class-name">I</span>表示<span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">L</span><span class="token operator">+</span>类名 其他对象
</code></pre> 
<p>还有一个很常用的情况是：用jmap把进程内存使用情况dump到文件中，再用jhat分析查看。jmap进行dump命令格式如下：</p> 
<pre><code class="prism language-java">jmap <span class="token operator">-</span>dump<span class="token operator">:</span>format<span class="token operator">=</span>b<span class="token punctuation">,</span>file<span class="token operator">=</span>dumpFileName pid
</code></pre> 
<p>我一样地对上面进程ID为21711进行Dump：</p> 
<pre><code class="prism language-java">root<span class="token annotation punctuation">@ubuntu</span><span class="token operator">:</span><span class="token operator">/</span># jmap <span class="token operator">-</span>dump<span class="token operator">:</span>format<span class="token operator">=</span>b<span class="token punctuation">,</span>file<span class="token operator">=</span><span class="token operator">/</span>tmp<span class="token operator">/</span>dump<span class="token punctuation">.</span>dat <span class="token number">21711</span>  
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Dumping</span> heap <span class="token keyword">to</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>dump<span class="token punctuation">.</span>dat <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Heap</span> dump file created
</code></pre> 
<p>dump出来的文件可以用MAT、VisualVM等工具查看，这里用jhat查看：</p> 
<pre><code class="prism language-java">root<span class="token annotation punctuation">@ubuntu</span><span class="token operator">:</span><span class="token operator">/</span># jhat <span class="token operator">-</span>port <span class="token number">9998</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>dump<span class="token punctuation">.</span>dat
<span class="token class-name">Reading</span> from <span class="token operator">/</span>tmp<span class="token operator">/</span>dump<span class="token punctuation">.</span>dat<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Dump</span> file created <span class="token class-name">Tue</span> <span class="token class-name">Jan</span> <span class="token number">28</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">46</span><span class="token operator">:</span><span class="token number">14</span> CST <span class="token number">2014</span>
<span class="token class-name">Snapshot</span> read<span class="token punctuation">,</span> resolving<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Resolving</span> <span class="token number">132207</span> objects<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Chasing</span> references<span class="token punctuation">,</span> expect <span class="token number">26</span> dots<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Eliminating</span> duplicate references<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Snapshot</span> <span class="token class-name"><span class="token namespace">resolved<span class="token punctuation">.</span></span>
Started</span> HTTP server on port <span class="token number">9998</span>
<span class="token class-name">Server</span> is ready
</code></pre> 
<p>注意如果Dump文件太大，可能需要加上<code>-J-Xmx512m</code>这种参数指定最大堆内存，即<code>jhat -J-Xmx512m -port 9998 /tmp/dump.dat</code>。然后就可以在浏览器中输入主机地址:9998查看了：</p> 
<p><img src="https://images2.imgbox.com/e4/e8/sq2HZyVT_o.png" alt="在这里插入图片描述"><br> 上面红线框出来的部分大家可以自己去摸索下，最后一项支持OQL（对象查询语言）</p> 
<h2>
<a id="25jstatJVM_331"></a>2.5.jstat（JVM统计监测工具）</h2> 
<p>语法格式如下：</p> 
<pre><code class="prism language-java">jstat <span class="token punctuation">[</span> generalOption <span class="token operator">|</span> outputOptions vmid <span class="token punctuation">[</span>interval<span class="token punctuation">[</span>s<span class="token operator">|</span>ms<span class="token punctuation">]</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>
</code></pre> 
<p>vmid是Java虚拟机ID，在Linux/Unix系统上一般就是进程ID。interval是采样时间间隔。count是采样数目。比如下面输出的是GC信息，采样时间间隔为250ms，采样数为4：</p> 
<pre><code class="prism language-java">root<span class="token annotation punctuation">@ubuntu</span><span class="token operator">:</span><span class="token operator">/</span># jstat <span class="token operator">-</span>gc <span class="token number">21711</span> <span class="token number">250</span> <span class="token number">4</span>
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT  
<span class="token number">192.0</span>  <span class="token number">192.0</span>   <span class="token number">64.0</span>   <span class="token number">0.0</span>    <span class="token number">6144.0</span>   <span class="token number">1854.9</span>   <span class="token number">32000.0</span>     <span class="token number">4111.6</span>   <span class="token number">55296.0</span> <span class="token number">25472.7</span>    <span class="token number">702</span>    <span class="token number">0.431</span>   <span class="token number">3</span>      <span class="token number">0.218</span>    <span class="token number">0.649</span>
<span class="token number">192.0</span>  <span class="token number">192.0</span>   <span class="token number">64.0</span>   <span class="token number">0.0</span>    <span class="token number">6144.0</span>   <span class="token number">1972.2</span>   <span class="token number">32000.0</span>     <span class="token number">4111.6</span>   <span class="token number">55296.0</span> <span class="token number">25472.7</span>    <span class="token number">702</span>    <span class="token number">0.431</span>   <span class="token number">3</span>      <span class="token number">0.218</span>    <span class="token number">0.649</span>
<span class="token number">192.0</span>  <span class="token number">192.0</span>   <span class="token number">64.0</span>   <span class="token number">0.0</span>    <span class="token number">6144.0</span>   <span class="token number">1972.2</span>   <span class="token number">32000.0</span>     <span class="token number">4111.6</span>   <span class="token number">55296.0</span> <span class="token number">25472.7</span>    <span class="token number">702</span>    <span class="token number">0.431</span>   <span class="token number">3</span>      <span class="token number">0.218</span>    <span class="token number">0.649</span>
<span class="token number">192.0</span>  <span class="token number">192.0</span>   <span class="token number">64.0</span>   <span class="token number">0.0</span>    <span class="token number">6144.0</span>   <span class="token number">2109.7</span>   <span class="token number">32000.0</span>     <span class="token number">4111.6</span>   <span class="token number">55296.0</span> <span class="token number">25472.7</span>    <span class="token number">702</span>    <span class="token number">0.431</span>   <span class="token number">3</span>      <span class="token number">0.218</span>    <span class="token number">0.649</span>
</code></pre> 
<p>要明白上面各列的意义，先看JVM堆内存布局：</p> 
<p><img src="https://images2.imgbox.com/99/bc/n5mP4YVh_o.png" alt="在这里插入图片描述"></p> 
<p>可以看出：</p> 
<blockquote> 
 <p>堆内存 = 年轻代 + 年老代 + 永久代<br> 年轻代 = Eden区 + 两个Survivor区（From和To）</p> 
</blockquote> 
<p>现在来解释各列含义：</p> 
<blockquote> 
 <p><code>S0C、S1C、S0U、S1U</code>：Survivor 0/1区容量（Capacity）和使用量（Used）<br> <code>EC、EU</code>：Eden区容量和使用量<br> <code>OC、OU</code>：年老代容量和使用量<br> <code>PC、PU</code>：永久代容量和使用量<br> <code>YGC、YGT</code>：年轻代GC次数和GC耗时<br> <code>FGC、FGCT</code>：Full GC次数和Full GC耗时<br> <code>GCT</code>：GC总耗时</p> 
</blockquote> 
<h2>
<a id="26hprofHeapCPU_Profiling_Tool_368"></a>2.6.hprof（Heap/CPU Profiling Tool）</h2> 
<p>hprof能够展现CPU使用率，统计堆内存使用情况。</p> 
<p>语法格式如下：</p> 
<pre><code class="prism language-java">java <span class="token operator">-</span>agentlib<span class="token operator">:</span>hprof<span class="token punctuation">[</span><span class="token operator">=</span>options<span class="token punctuation">]</span> <span class="token class-name">ToBeProfiledClass</span>
</code></pre> 
<pre><code class="prism language-java">java <span class="token operator">-</span><span class="token class-name">Xrunprof</span><span class="token punctuation">[</span><span class="token operator">:</span>options<span class="token punctuation">]</span> <span class="token class-name">ToBeProfiledClass</span>
</code></pre> 
<pre><code class="prism language-java">javac <span class="token operator">-</span><span class="token class-name">J</span><span class="token operator">-</span>agentlib<span class="token operator">:</span>hprof<span class="token punctuation">[</span><span class="token operator">=</span>options<span class="token punctuation">]</span> <span class="token class-name">ToBeProfiledClass</span>
</code></pre> 
<p>完整的命令选项如下：</p> 
<pre><code class="prism language-java"><span class="token class-name">Option</span> <span class="token class-name">Name</span> and <span class="token class-name">Value</span>  <span class="token class-name">Description</span>                    <span class="token class-name">Default</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>  <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>                    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
heap<span class="token operator">=</span>dump<span class="token operator">|</span>sites<span class="token operator">|</span>all    heap profiling                 all
cpu<span class="token operator">=</span>samples<span class="token operator">|</span>times<span class="token operator">|</span>old  CPU usage                      off
monitor<span class="token operator">=</span>y<span class="token operator">|</span>n            monitor contention             n
format<span class="token operator">=</span>a<span class="token operator">|</span>b             <span class="token function">text</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span> or binary output     a
file<span class="token operator">=</span><span class="token generics"><span class="token punctuation">&lt;</span>file<span class="token punctuation">&gt;</span></span>            write data <span class="token keyword">to</span> <span class="token namespace">file</span>             java<span class="token punctuation">.</span>hprof<span class="token punctuation">[</span><span class="token punctuation">.</span>txt<span class="token punctuation">]</span>
net<span class="token operator">=</span><span class="token generics"><span class="token punctuation">&lt;</span>host<span class="token punctuation">&gt;</span></span><span class="token operator">:</span><span class="token generics"><span class="token punctuation">&lt;</span>port<span class="token punctuation">&gt;</span></span>      send data over a socket        off
depth<span class="token operator">=</span><span class="token generics"><span class="token punctuation">&lt;</span>size<span class="token punctuation">&gt;</span></span>           stack trace depth              <span class="token number">4</span>
interval<span class="token operator">=</span><span class="token generics"><span class="token punctuation">&lt;</span>ms<span class="token punctuation">&gt;</span></span>          sample interval in ms          <span class="token number">10</span>
cutoff<span class="token operator">=</span><span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>         output cutoff point            <span class="token number">0.0001</span>
lineno<span class="token operator">=</span>y<span class="token operator">|</span>n             line number in traces<span class="token operator">?</span>         y
thread<span class="token operator">=</span>y<span class="token operator">|</span>n             thread in traces<span class="token operator">?</span>              n
doe<span class="token operator">=</span>y<span class="token operator">|</span>n                dump on exit<span class="token operator">?</span>                  y
msa<span class="token operator">=</span>y<span class="token operator">|</span>n                <span class="token class-name">Solaris</span> micro state accounting n
force<span class="token operator">=</span>y<span class="token operator">|</span>n              force output <span class="token keyword">to</span> <span class="token generics"><span class="token punctuation">&lt;</span>file<span class="token punctuation">&gt;</span></span>         y
verbose<span class="token operator">=</span>y<span class="token operator">|</span>n            print messages about dumps     y
</code></pre> 
<p>来几个官方指南上的实例。</p> 
<p>CPU Usage Sampling Profiling(cpu=samples)的例子：</p> 
<pre><code class="prism language-java">java <span class="token operator">-</span>agentlib<span class="token operator">:</span>hprof<span class="token operator">=</span>cpu<span class="token operator">=</span>samples<span class="token punctuation">,</span>interval<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>depth<span class="token operator">=</span><span class="token number">3</span> <span class="token class-name">Hello</span>
</code></pre> 
<p>上面每隔20毫秒采样CPU消耗信息，堆栈深度为3，生成的profile文件名称是<code>java.hprof.txt</code>，在当前目录。</p> 
<p>CPU Usage Times Profiling(cpu=times)的例子，它相对于CPU Usage Sampling Profile能够获得更加细粒度的CPU消耗信息，能够细到每个方法调用的开始和结束，它的实现使用了字节码注入技术（BCI）：</p> 
<pre><code class="prism language-java">javac <span class="token operator">-</span><span class="token class-name">J</span><span class="token operator">-</span>agentlib<span class="token operator">:</span>hprof<span class="token operator">=</span>cpu<span class="token operator">=</span>times <span class="token class-name">Hello</span><span class="token punctuation">.</span>java
</code></pre> 
<p>Heap Allocation Profiling(heap=sites)的例子：</p> 
<pre><code class="prism language-java">javac <span class="token operator">-</span><span class="token class-name">J</span><span class="token operator">-</span>agentlib<span class="token operator">:</span>hprof<span class="token operator">=</span>heap<span class="token operator">=</span>sites <span class="token class-name">Hello</span><span class="token punctuation">.</span>java
</code></pre> 
<p>Heap Dump(heap=dump)的例子，它比上面的Heap Allocation Profiling能生成更详细的Heap Dump信息：</p> 
<pre><code class="prism language-java">javac <span class="token operator">-</span><span class="token class-name">J</span><span class="token operator">-</span>agentlib<span class="token operator">:</span>hprof<span class="token operator">=</span>heap<span class="token operator">=</span>dump <span class="token class-name">Hello</span><span class="token punctuation">.</span>java
</code></pre> 
<p>虽然在JVM启动参数中加入-Xrunprof:heap=sites参数可以生成CPU/Heap Profile文件，但对JVM性能影响非常大，不建议在线上服务器环境使用。</p> 
<h2>
<a id="27jconsolejvisualvm_439"></a>2.7.jconsole、jvisualvm</h2> 
<p>利用jconsole、jvisualvm分析内存信息(各个区如Eden、Survivor、Old等内存变化情况)，如果查看的是远程服务器的JVM，程序启动需要加上如下参数：</p> 
<pre><code class="prism language-java"><span class="token string">"-Dcom.sun.management.jmxremote=true"</span> 
<span class="token string">"-Djava.rmi.server.hostname=12.34.56.78"</span> 
<span class="token string">"-Dcom.sun.management.jmxremote.port=18181"</span> 
<span class="token string">"-Dcom.sun.management.jmxremote.authenticate=false"</span> 
<span class="token string">"-Dcom.sun.management.jmxremote.ssl=false"</span>
</code></pre> 
<p>下图是jconsole界面，概览选项可以观测堆内存使用量、线程数、类加载数和CPU占用率；内存选项可以查看堆中各个区域的内存使用量和左下角的详细描述（内存大小、GC情况等）；线程选项可以查看当前JVM加载的线程，查看每个线程的堆栈信息，还可以检测死锁；VM概要描述了虚拟机的各种详细参数。（jconsole功能演示）</p> 
<p><img src="https://images2.imgbox.com/07/c5/L7979QeW_o.png" alt="在这里插入图片描述"></p> 
<p>下图是jvisualvm的界面，功能比jconsole略丰富一些，不过大部分功能都需要安装插件。概述跟jconsole的VM概要差不多，描述的是jvm的详细参数和程序启动参数；监视展示的和jconsole的概览界面差不多（CPU、堆/方法区、类加载、线程）；线程和jconsole的线程界面差不多；抽样器可以展示当前占用内存的类的排行榜及其实例的个数；Visual GC可以更丰富地展示当前各个区域的内存占用大小及历史信息（下图）(jvisualvm功能演示）</p> 
<p>工具路径：<code>//java/jdk1.8xxx/bin/JVisuaVM.exe</code></p> 
<blockquote> 
 <p>监控本地的Tomcat<br> 监控远程Tomcat<br> 监控普通的JAVA进程</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/1d/5a/exrYwaUl_o.png" alt="在这里插入图片描述"></p> 
<p>这个有不懂得可以看此文:<a href="https://www.cnblogs.com/liuchuanfeng/p/8649151.html">如何利用 JConsole观察分析Java程序的运行，进行排错调优</a></p> 
<h2>
<a id="28jinfo_467"></a>2.8.jinfo</h2> 
<p>jinfo命令主要用于查看应用程序的配置参数，以及打印运行JVM时候所指定的JVM参数。jinfo可以使用-sysprops选项将虚拟机进程中所指定的System.getProperties()的内容打印出来，并且该命令还可以查看未被显示指定的JVM参数的系统默认值，这通过jps -v是无法看到的。同时jinfo命令还能够在运行期修改JVM参数，通过使用 -flag name=value 或者 -flag [+|-]name 来修改一部分运行期可修改的虚拟机参数</p> 
<p><strong>其他的一些工具如BTrace、Reference等有兴趣可以自己查下资料的</strong></p> 
<h2>
<a id="29gc_473"></a>2.9.依赖、参考的数据有系统运行日志、堆栈错误信息、gc日志、线程快照、堆转储快照进行调优</h2> 
<p>此处参考大佬的文章:<a href="https://blog.csdn.net/weixin_42447959/article/details/81637909?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163711280816780261920293%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163711280816780261920293&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-81637909.first_rank_v2_pc_rank_v29&amp;utm_term=jvm%E8%B0%83%E4%BC%98&amp;spm=1018.2226.3001.4187">JVM性能调优</a> 倒也不失为一种思路 大家可根据自己业务场景或者其他因素进行筛选使用</p> 
<blockquote> 
 <p>①系统运行日志：系统运行日志就是在程序代码中打印出的日志，描述了代码级别的系统运行轨迹（执行的方法、入参、返回值等），一般系统出现问题，系统运行日志是首先要查看的日志。</p> 
</blockquote> 
<p>②堆栈错误信息：当系统出现异常后，可以根据堆栈信息初步定位问题所在，比如根据“java.lang.OutOfMemoryError: Java heap space”可以判断是堆内存溢出；根据“java.lang.StackOverflowError”可以判断是栈溢出；根据“java.lang.OutOfMemoryError: PermGen space”可以判断是方法区溢出等。<br> ③GC日志：程序启动时用 -XX:+PrintGCDetails 和 -Xloggc:/data/jvm/gc.log 可以在程序运行时把gc的详细过程记录下来，或者直接配置“-verbose:gc”参数把gc日志打印到控制台，通过记录的gc日志可以分析每块内存区域gc的频率、时间等，从而发现问题，进行有针对性的优化。<br> 比如如下一段GC日志：</p> 
<pre><code class="prism language-java"><span class="token number">2018</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">02</span>T14<span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">11.560</span><span class="token operator">-</span><span class="token number">0800</span><span class="token operator">:</span> <span class="token number">10.171</span><span class="token operator">:</span> <span class="token punctuation">[</span>GC <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">30128</span>K<span class="token operator">-&gt;</span><span class="token function">4091K</span><span class="token punctuation">(</span><span class="token number">30208</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">51092</span>K<span class="token operator">-&gt;</span><span class="token function">50790K</span><span class="token punctuation">(</span><span class="token number">98816</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0140970</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.02</span> sys<span class="token operator">=</span><span class="token number">0.03</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">02</span>T14<span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">11.574</span><span class="token operator">-</span><span class="token number">0800</span><span class="token operator">:</span> <span class="token number">10.185</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token class-name">Full</span> GC <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">4091</span>K<span class="token operator">-&gt;</span><span class="token function">0K</span><span class="token punctuation">(</span><span class="token number">30208</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">ParOldGen</span><span class="token operator">:</span> <span class="token number">46698</span>K<span class="token operator">-&gt;</span><span class="token function">50669K</span><span class="token punctuation">(</span><span class="token number">68608</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">50790</span>K<span class="token operator">-&gt;</span><span class="token function">50669K</span><span class="token punctuation">(</span><span class="token number">98816</span>K<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSPermGen</span><span class="token operator">:</span> <span class="token number">2635</span>K<span class="token operator">-&gt;</span><span class="token function">2634K</span><span class="token punctuation">(</span><span class="token number">21504</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0160030</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.03</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.02</span> secs<span class="token punctuation">]</span> 
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">02</span>T14<span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">14.045</span><span class="token operator">-</span><span class="token number">0800</span><span class="token operator">:</span> <span class="token number">12.656</span><span class="token operator">:</span> <span class="token punctuation">[</span>GC <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">14097</span>K<span class="token operator">-&gt;</span><span class="token function">4064K</span><span class="token punctuation">(</span><span class="token number">30208</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">64766</span>K<span class="token operator">-&gt;</span><span class="token function">64536K</span><span class="token punctuation">(</span><span class="token number">98816</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0117690</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.02</span> sys<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span> 
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">02</span>T14<span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">14.057</span><span class="token operator">-</span><span class="token number">0800</span><span class="token operator">:</span> <span class="token number">12.668</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token class-name">Full</span> GC <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">4064</span>K<span class="token operator">-&gt;</span><span class="token function">0K</span><span class="token punctuation">(</span><span class="token number">30208</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">ParOldGen</span><span class="token operator">:</span> <span class="token number">60471</span>K<span class="token operator">-&gt;</span><span class="token function">401K</span><span class="token punctuation">(</span><span class="token number">68608</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">64536</span>K<span class="token operator">-&gt;</span><span class="token function">401K</span><span class="token punctuation">(</span><span class="token number">98816</span>K<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSPermGen</span><span class="token operator">:</span> <span class="token number">2634</span>K<span class="token operator">-&gt;</span><span class="token function">2634K</span><span class="token punctuation">(</span><span class="token number">21504</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0102020</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.01</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span>
</code></pre> 
<blockquote> 
 <p>上面一共是4条GC日志，来看第一行日志，“2018-08-02T14:39:11.560-0800”是精确到了毫秒级别的UTC 通用标准时间格式，配置了“-XX:+PrintGCDateStamps”这个参数可以跟随gc日志打印出这种时间戳，“10.171”是从JVM启动到发生gc经过的秒数。第一行日志正文开头的“[GC”说明这次GC没有发生Stop-The-World（用户线程停顿），第二行日志正文开头的“[Full GC”说明这次GC发生了Stop-The-World，所以说，[GC和[Full GC跟新生代和老年代没关系，和垃圾收集器的类型有关系，如果直接调用System.gc()，将显示[Full GC(System)。接下来的“[PSYoungGen”、“[ParOldGen”表示GC发生的区域，具体显示什么名字也跟垃圾收集器有关，比如这里的“[PSYoungGen”表示Parallel Scavenge收集器，“[ParOldGen”表示Serial Old收集器，此外，Serial收集器显示“[DefNew”，ParNew收集器显示“[ParNew”等。再往后的“30128K-&gt;4091K(30208K)”表示进行了这次gc后，该区域的内存使用空间由30128K减小到4091K，总内存大小为30208K。每个区域gc描述后面的“51092K-&gt;50790K(98816K), 0.0140970 secs”进行了这次垃圾收集后，整个堆内存的内存使用空间由51092K减小到50790K，整个堆内存总空间为98816K，gc耗时0.0140970秒。<br> ④线程快照：顾名思义，根据线程快照可以看到线程在某一时刻的状态，当系统中可能存在请求超时、死循环、死锁等情况是，可以根据线程快照来进一步确定问题。通过执行虚拟机自带的“jstack pid”命令，可以dump出当前进程中线程的快照信息，更详细的使用和分析网上有很多例，这篇文章写到这里已经很长了就不过多叙述了，贴一篇博客供参考：http://www.cnblogs.com/kongzhongqijing/articles/3630264.html<br> ⑤堆转储快照：程序启动时可以使用 “-XX:+HeapDumpOnOutOfMemory” 和 “-XX:HeapDumpPath=/data/jvm/dumpfile.hprof”，当程序发生内存溢出时，把当时的内存快照以文件形式进行转储（也可以直接用jmap命令转储程序运行时任意时刻的内存快照），事后对当时的内存使用情况进行分析。</p> 
</blockquote> 
<h1>
<a id="jvm_495"></a>三、jvm调优经验总结</h1> 
<h2>
<a id="31_497"></a>3.1.调优的最终目标是什么</h2> 
<blockquote> 
 <p>1.GC的时间足够的小<br> 2.GC的次数足够的少<br> 3.发生Full GC的周期足够的长</p> 
</blockquote> 
<blockquote> 
 <p>前两个目前是相悖的，要想GC时间小<strong>必须要一个更小的堆</strong>，要<strong>保证GC次数足够少</strong>，必须保证一个<strong>更大的堆</strong>，我们只能取其平衡。<br> 更大的年轻代必然导致更小的年老代，大的年轻代会延长普通GC的周期，但会增加每次GC的时间；小的年老代会导致更频繁的Full GC<br> 更小的年轻代必然导致更大年老代，小的年轻代会导致普通GC很频繁，但每次的GC时间会更短；大的年老代会减少Full GC的频率<br> 如何选择应该依赖应用程序对象生命周期的分布情况：<strong>如果应用存在大量的临时对象，应该选择更大的年轻代；如果存在相对较多的持久对象，年老代应该适当增大。</strong><br> 但很多应用都没有这样明显的特性，在抉择时应该根据以下两点：a、本着<strong>Full GC尽量少的原则</strong>，让年<strong>老代尽量缓存常用对象</strong>，JVM的默认比例3:8也是这个道理<br>（B）通过观察应用一段时间，看其他在峰值时年老代会占多少内存，在不影响FullGC的前提下，<strong>根据实际情况加大年轻代</strong>，比如可以把比例控制在1:1。但应该给年老代至少预留1/3的增长空间</p> 
</blockquote> 
<h2>
<a id="32_508"></a>3.2.将新对象预留在年轻代</h2> 
<blockquote> 
 <p>众所周知，由于 Full GC 的成本远远高于 Minor GC，因此某些情况下需要尽可能<strong>将对象分配在年轻代</strong>，这在很多情况下是一个明智的选择。虽然在大部分情况下，JVM 会尝试在 Eden 区分配对象，但是由于空间紧张等问题，很可能不得不将部分年轻对象提前向年老代压缩。因此，<strong>在 JVM 参数调优时可以为应用程序分配一个合理的年轻代空间，以最大限度避免新对象直接进入年老代的情况发生</strong>。</p> 
</blockquote> 
<blockquote> 
 <p>通过设置一个较大的年轻代预留新对象，<strong>设置合理的 Survivor 区并且提供 Survivor 区的使用率，可以将年轻对象保存在年轻代</strong>。一般来说，Survivor 区的空间不够，或者占用量达到 50%时，就会使对象进入年老代(不管它的年龄有多大)</p> 
</blockquote> 
<p>我们可以尝试加上</p> 
<pre><code class="prism language-java"><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">TargetSurvivorRatio</span><span class="token operator">=</span><span class="token number">90</span>
</code></pre> 
<p>参数，这样可以<strong>提高 from 区的利用率</strong>，使 from 区使用到 <strong>90%时</strong>，再<strong>将对象送入年老代</strong></p> 
<h2>
<a id="33_522"></a>3.3.让大对象进入年老代</h2> 
<blockquote> 
 <p>我们在大部分情况下都会选择将对象分配在年轻代。但是，对于占用内存较多的大对象而言，它的选择可能就不是这样的。因为大对象出现在年轻代很可能扰乱年轻代 GC，并破坏年轻代原有的对象结构。因为尝试在年轻代分配大对象，很可能导致空间不足，为了有足够的空间容纳大对象，JVM 不得不将年轻代中的年轻对象挪到年老代。因为大对象占用空间多，所以可能需要移动大量小的年轻对象进入年老代，这对 GC 相当不利。</p> 
</blockquote> 
<blockquote> 
 <p>基于以上原因，可以将大对象直接分配到年老代，保持年轻代对象结构的完整性，这样可以提高 GC 的效率。如果一个大对象同时又是一个短命的对象，假设这种情况出现很频繁，那对于 GC 来说会是一场灾难。原本应该用于存放永久对象的年老代，被短命的对象塞满，这也意味着对堆空间进行了洗牌，扰乱了分代内存回收的基本思路。因此，在软件开发过程中，应该尽可能避免使用短命的大对象。</p> 
</blockquote> 
<p>可以使用参数</p> 
<pre><code class="prism language-java"><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">PetenureSizeThreshold</span>
</code></pre> 
<p>设置大对象直接进入年老代的阈值。当对象的大小超过这个值时，将直接在年老代分配。参数<code>-XX:PetenureSizeThreshold</code> 只对串行收集器和年轻代并行收集器有效，并行回收收集器不识别这个参数。</p> 
<h2>
<a id="34__536"></a>3.4. 设置对象进入年老代的年龄</h2> 
<p>如何设置对象进入年老代的年龄</p> 
<blockquote> 
 <p>堆中的每一个对象都有自己的年龄。一般情况下，年轻对象存放在年轻代，年老对象存放在年老代。为了做到这点，虚拟机为每个对象都维护一个年龄。如果对象在 Eden 区，经过一次 GC 后依然存活，则被移动到 Survivor 区中，对象年龄加 1。以后，如果对象每经过一次 GC 依然存活，则年龄再加 1。当对象年龄达到阈值时，就移入年老代，成为老年对象。</p> 
</blockquote> 
<p>这个阈值的最大值可以通过参数</p> 
<pre><code class="prism language-java"><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MaxTenuringThreshold</span>
</code></pre> 
<p>来设置，默认值是 15。虽然<code>-XX:MaxTenuringThreshold</code> 的值可能是 15 或者更大，但这不意味着新对象非要达到这个年龄才能进入年老代。事实上，对象实际进入年老代的年龄是虚拟机在运行时根据内存使用情况动态计算的，这个参数指定的是阈值年龄的最大值。即，实际晋升年老代年龄等于动态计算所得的年龄与<code>-XX:MaxTenuringThreshold</code> 中较小的那个。</p> 
<h2>
<a id="35_Java__VS__Java__549"></a>3.5.稳定的 Java 堆 VS 动荡的 Java 堆</h2> 
<blockquote> 
 <p>一般来说，稳定的堆大小对垃圾回收是有利的。获得一个稳定的堆大小的方法是<code>使-Xms 和-Xmx 的大小一致</code>，即最大堆和最小堆 (初始堆)一样<br> 如果这样设置，系统在运行时堆大小理论上是恒定的，稳定的堆空间可以减少 GC 的次数。因此，很多服务端应用都会将最大堆和最小堆设置为相同的数值。但是，一个不稳定的堆并非毫无用处。稳定的堆大小虽然可以减少 GC 次数，但同时也增加了每次GC的时间。让堆大小在一个区间中震荡，在系统不需要使用大内存时，压缩堆空间，使 GC 应对一个较小的堆，可以加快单次 GC 的速度。基于这样的考虑，JVM 还提供了两个参数用于压缩和扩展堆空间。</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MinHeapFreeRatio</span>
</code></pre> 
<p>参数用来设置堆空间最小空闲比例，默认值是 40。当堆空间的空闲内存小于这个数值时，JVM 便会扩展堆空间。</p> 
<pre><code class="prism language-java"><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MaxHeapFreeRatio</span>
</code></pre> 
<p>参数用来设置堆空间最大空闲比例，默认值是 70。当堆空间的空闲内存大于这个数值时，便会压缩堆空间，得到一个较小的堆。</p> 
<p>当**-Xmx 和-Xms 相等<strong>时，</strong>-XX:MinHeapFreeRatio 和-XX:MaxHeapFreeRatio 两个参数无效**。</p> 
<h2>
<a id="36_567"></a>3.6.增大吞吐量提升系统性能</h2> 
<p>吞吐量优先的方案将会尽可能减少系统执行垃圾回收的总时间，故可以考虑关注系统吞吐量的并行回收收集器。在拥有高性能的计算机上，进行吞吐量优先优化，可以使用参数：</p> 
<pre><code class="prism language-java">java –<span class="token class-name">Xmx3800m</span> –<span class="token class-name">Xms3800m</span> –<span class="token class-name">Xmn2G</span> –<span class="token class-name">Xss128k</span> –XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseParallelGC</span> 
   –XX<span class="token operator">:</span><span class="token class-name">ParallelGC</span><span class="token operator">-</span><span class="token class-name">Threads</span><span class="token operator">=</span><span class="token number">20</span> –XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseParallelOldGC</span>
</code></pre> 
<blockquote> 
 <p><code>–Xmx380m –Xms3800m</code>：设置 Java 堆的最大值和初始值。一般情况下，为了避免堆内存的频繁震荡，导致系统性能下降，我们的做法是设置最大堆等于最小堆。假设这里把最小堆减少为最大堆的一半，即 1900m，那么 JVM 会尽可能在 1900MB 堆空间中运行，如果这样，发生 GC 的可能性就会比较高；<br> <code>-Xss128k</code>：减少线程栈的大小，这样可以使剩余的系统内存支持更多的线程；<br> <code>-Xmn2g</code>：设置年轻代区域大小为 2GB；<br> <code>–XX:+UseParallelGC</code>：年轻代使用并行垃圾回收收集器。这是一个关注吞吐量的收集器，可以尽可能地减少 GC 时间。<br> <code>–XX:ParallelGC-Threads</code>：设置用于垃圾回收的线程数，通常情况下，可以设置和 CPU 数量相等。但在 CPU 数量比较多的情况下，设置相对较小的数值也是合理的；<br> <code>–XX:+UseParallelOldGC</code>：设置年老代使用并行回收收集器。</p> 
</blockquote> 
<h2>
<a id="37_583"></a>3.7.尝试使用大的内存分页</h2> 
<blockquote> 
 <p>CPU 是通过寻址来访问内存的。32 位 CPU 的寻址宽度是 0~0xFFFFFFFF ，计算后得到的大小是 4G，也就是说可支持的物理内存最大是 4G。但在实践过程中，碰到了这样的问题，程序需要使用 4G 内存，而可用物理内存小于 4G，导致程序不得不降低内存占用。为了解决此类问题，现代 CPU 引入了 MMU（Memory Management Unit 内存管理单元）。MMU 的核心思想是利用虚拟地址替代物理地址，即 CPU 寻址时使用虚址，由 MMU 负责将虚址映射为物理地址。MMU 的引入，解决了对物理内存的限制，对程序来说，就像自己在使用 4G 内存一样。内存分页 (Paging) 是在使用 MMU 的基础上，提出的一种内存管理机制。它将虚拟地址和物理地址按固定大小（4K）分割成页 (page) 和页帧 (page frame)，并保证页与页帧的大小相同。这种机制，从数据结构上，保证了访问内存的高效，并使 OS 能支持非连续性的内存分配。在程序内存不够用时，还可以将不常用的物理内存页转移到其他存储设备上，比如磁盘，这就是大家耳熟能详的虚拟内存。</p> 
</blockquote> 
<p>在 Solaris 系统中，JVM 可以支持 Large Page Size 的使用。使用大的内存分页可以增强 CPU 的内存寻址能力，从而提升系统的性能。</p> 
<pre><code class="prism language-java">java –<span class="token class-name">Xmx2506m</span> –<span class="token class-name">Xms2506m</span> –<span class="token class-name">Xmn1536m</span> –<span class="token class-name">Xss128k</span> –XX<span class="token operator">:</span><span class="token operator">++</span><span class="token class-name">UseParallelGC</span>
 –XX<span class="token operator">:</span><span class="token class-name">ParallelGCThreads</span><span class="token operator">=</span><span class="token number">20</span> –XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseParallelOldGC</span> –XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">LargePageSizeInBytes</span><span class="token operator">=</span><span class="token number">256</span>m
</code></pre> 
<p><code>–XX:+LargePageSizeInBytes</code>：设置大页的大小。</p> 
<p>过大的内存分页会导致 JVM 在计算 Heap 内部分区（perm, new, old）内存占用比例时，会出现超出正常值的划分，最坏情况下某个区会多占用一个页的大小。</p> 
<h2>
<a id="38_598"></a>3.8.使用非占有的垃圾回收器</h2> 
<blockquote> 
 <p>为降低应用软件的垃圾回收时的停顿，首先考虑的是使用关注系统停顿的 CMS 回收器，其次，为了减少 Full GC 次数，应尽可能将对象预留在年轻代，因为年轻代 Minor GC 的成本远远小于年老代的 Full GC。</p> 
</blockquote> 
<pre><code class="prism language-java">java –<span class="token class-name">Xmx3550m</span> –<span class="token class-name">Xms3550m</span> –<span class="token class-name">Xmn2g</span> –<span class="token class-name">Xss128k</span> –XX<span class="token operator">:</span><span class="token class-name">ParallelGCThreads</span><span class="token operator">=</span><span class="token number">20</span>
 –XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseConcMarkSweepGC</span> –XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseParNewGC</span> –XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">SurvivorRatio</span><span class="token operator">=</span><span class="token number">8</span> –XX<span class="token operator">:</span><span class="token class-name">TargetSurvivorRatio</span><span class="token operator">=</span><span class="token number">90</span>
 –XX<span class="token operator">:</span><span class="token class-name">MaxTenuringThreshold</span><span class="token operator">=</span><span class="token number">31</span>
</code></pre> 
<blockquote> 
 <p><code>–XX:ParallelGCThreads=20</code>：设置 20 个线程进行垃圾回收；<br> <code>–XX:+UseParNewGC</code>：年轻代使用并行回收器；<br> <code>–XX:+UseConcMarkSweepGC</code>：年老代使用 CMS 收集器降低停顿；<br> <code>–XX:+SurvivorRatio</code>：设置 Eden 区和 Survivor 区的比例为 8:1。稍大的 Survivor 空间可以提高在年轻代回收生命周期较短的对象的可能性，如果 Survivor 不够大，一些短命的对象可能直接进入年老代，这对系统来说是不利的。<br> <code>–XX:TargetSurvivorRatio=90</code>：设置 Survivor 区的可使用率。这里设置为 90%，则允许 90%的 Survivor 空间被使用。默认值是 50%。故该设置提高了 Survivor 区的使用率。当存放的对象超过这个百分比，则对象会向年老代压缩。因此，这个选项更有助于将对象留在年轻代。<br> <code>–XX:MaxTenuringThreshold</code>：设置年轻对象晋升到年老代的年龄。默认值是 15 次，即对象经过 15 次 Minor GC 依然存活，则进入年老代。这里设置为 31，目的是让对象尽可能地保存在年轻代区域。</p> 
</blockquote> 
<h1>
<a id="JVM_615"></a>四、一些JVM参数</h1> 
<h2>
<a id="41_617"></a>4.1.设定堆内存大小</h2> 
<pre><code class="prism language-java"><span class="token operator">-</span><span class="token class-name">Xms</span>：启动JVM时的堆内存空间。
<span class="token operator">-</span><span class="token class-name">Xmx</span>：堆内存最大限制。
<span class="token operator">-</span><span class="token class-name">Xmn</span>：设置年轻代大小整个堆大小<span class="token operator">=</span>年轻代大小 <span class="token operator">+</span> 年老代大小 <span class="token operator">+</span> 持久代大小，<span class="token class-name">Sun</span>官方推荐配置为整个堆的<span class="token number">3</span><span class="token operator">/</span><span class="token number">8</span>
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">PermSize</span><span class="token operator">=</span><span class="token number">128</span>M设置持久代大小
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MaxPermSize</span><span class="token operator">=</span><span class="token number">128</span>M设置持久代最大值，此值可以设置与<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">PermSize</span>相同，防止持久代内存伸缩，持久代设置很重要，一般预留其使用空间的<span class="token number">1</span><span class="token operator">/</span><span class="token number">3.</span>
</code></pre> 
<h2>
<a id="42_627"></a>4.2.设定新生代大小。</h2> 
<pre><code class="prism language-java"><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">NewRatio</span>：新生代和老年代的占比。
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">NewSize</span>：新生代空间。
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">SurvivorRatio</span>：伊甸园空间和幸存者空间的占比。
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MaxTenuringThreshold</span>：对象进入老年代的年龄阈值。
</code></pre> 
<h2>
<a id="43_636"></a>4.3.设定垃圾回收器</h2> 
<pre><code class="prism language-java"><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseSerialGC</span> 开启串行收集器
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseParallelGC</span>开启年轻代并行收集器，JDK5<span class="token punctuation">.</span><span class="token number">0</span>以上，JVM会根据系统配置自行设置，所以无需再设置此值
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseParallelOldGC</span>开启老年代并行收集器
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseConcMarkSweepGC</span>开启老年代并发收集器<span class="token punctuation">(</span>简称CMS<span class="token punctuation">)</span>，可以和<span class="token class-name">UseParallelGC</span>一起使用
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">CMSInitiatingOccupancyFraction</span><span class="token operator">=</span><span class="token number">70</span>老年代内存使用比例到多少激活CMS收集器，这个数值的设置有很大技巧基本上满足<span class="token punctuation">(</span><span class="token class-name">Xmx</span><span class="token operator">-</span><span class="token class-name">Xmn</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">-</span><span class="token class-name">CMSInitiatingOccupancyFraction</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span class="token operator">&gt;=</span><span class="token class-name">Xmn</span>否则会出现“<span class="token class-name">Concurrent</span> <span class="token class-name">Mode</span> <span class="token class-name">Failure</span>”，promotionfailed，官方建议数值为<span class="token number">68</span>
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseCMSCompactAtFullCollection</span>：使用并发收集器时，开启对年老代的压缩
</code></pre> 
<h2>
<a id="44_647"></a>4.4.其他</h2> 
<pre><code class="prism language-java"><span class="token operator">-</span><span class="token class-name">Xss</span>： 设置每个线程的堆栈大小，设置每个线程的堆栈大小。JDK5<span class="token punctuation">.</span><span class="token number">0</span>以后每个线程堆栈大小为<span class="token number">1</span>M，以前每个线程堆栈大小为<span class="token number">256</span>K。更具应用的线程所需内存大小进行调整。在相同物理内存下，减小这个值能生成更多的线程。但是操作系统对一个进程内的线程数还是有限制的，不能无限生成，经验值在<span class="token number">3000</span><span class="token operator">~</span><span class="token number">5000</span>左右，这个参数对性能的影响比较大的
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MaxTenuringThreshold</span><span class="token operator">=</span><span class="token number">0</span>：设置垃圾最大年龄。如果设置为<span class="token number">0</span>的话，则年轻代对象不经过<span class="token class-name">Survivor</span>区，直接进入年老代。对于年老代比较多的应用，可以提高效率。如果将此值设置为一个较大值，则年轻代对象会在<span class="token class-name">Survivor</span>区进行多次复制，这样可以增加对象再年轻代的存活时间，增加在年轻代即被回收的概论，linux64的java6默认值是<span class="token number">15</span>
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">ParallelGCThreads</span><span class="token operator">=</span>设置并行垃圾回收的线程数。此值可以设置与机器处理器数量相等（逻辑cpu数），这个不确定是物理、还是逻辑使用默认就好
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MaxGCPauseMillis</span><span class="token operator">=</span>指定垃圾回收时的最长暂停时间，单位毫秒，如果指定了此值的话，堆大小和垃圾回收相关参数会进行调整以达到指定值，设定此值可能会减少应用的吞吐量
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">GCTimeRatio</span><span class="token operator">=</span>设定吞吐量为垃圾回收时间与非垃圾回收时间的比值，公式为<span class="token number">1</span><span class="token operator">/</span>（<span class="token number">1</span><span class="token operator">+</span><span class="token class-name">N</span>）。例如，<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">GCTimeRatio</span><span class="token operator">=</span><span class="token number">19</span>时，表示<span class="token number">5</span><span class="token operator">%</span>的时间用于垃圾回收。默认情况为<span class="token number">99</span>，即<span class="token number">1</span><span class="token operator">%</span>的时间用于垃圾回收
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseAdaptiveSizePolicy</span>：设置此选项后，并行收集器会自动选择年轻代区大小和相应的<span class="token class-name">Survivor</span>区比例，以达到目标系统规定的最低相应时间或者收集频率等，此值建议使用并行收集器时，一直打开
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">DisableExplicitGC</span>：禁止 java 程序中的 full gc<span class="token punctuation">,</span> 如<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 的调用<span class="token punctuation">.</span> 最好加上， 防止程序在代码里误用了对性能造成冲击
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCDetails</span> 打应垃圾收集的情况
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCTimeStamps</span> 打应垃圾收集的情况
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCApplicationConcurrentTime</span>：打印每次垃圾回收前，程序未中断的执行时间。可与上面混合使用
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCApplicationStoppedTime</span> 打应垃圾收集时 <span class="token punctuation">,</span> 系统的停顿时间
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGC</span> 打印GC情况
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">PrintHeapAtGC</span><span class="token operator">:</span>打印GC前后的详细堆栈信息
</code></pre> 
<p>参考文章:</p> 
<p>1.<a href="https://blog.csdn.net/weixin_42447959/article/details/81637909?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163721664816780274137225%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=163721664816780274137225&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-81637909.first_rank_v2_pc_rank_v29&amp;utm_term=jvm%E8%B0%83%E4%BC%98&amp;spm=1018.2226.3001.4187">JVM性能调优</a><br> 2.<a href="https://www.jianshu.com/p/c6a04c88900a">JVM性能调优入门</a><br> 3.<a href="https://developer.ibm.com/alert-zh/">https://developer.ibm.com/alert-zh/</a><br> 4.<a href="https://www.ktanx.com/blog/p/3159">https://www.ktanx.com/blog/p/3159</a><br> 5.<a href="https://blog.51cto.com/buguoruci/1287831">https://blog.51cto.com/buguoruci/1287831</a></p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
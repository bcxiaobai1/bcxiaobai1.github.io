<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>java-Nginx与Tomcat安装，配置及优化 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java-Nginx与Tomcat安装，配置及优化</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <h1>
<a id="javaNginxTomcat_1"></a>java-Nginx与Tomcat安装，配置及优化</h1> 
<h2>
<a id="1_javaNginx_3"></a>1. java-Nginx安装，配置及优化</h2> 
<h3>
<a id="11_Nginx_7"></a>1.1 Nginx的安装</h3> 
<p>linux服务器三种安装方式：</p> 
<blockquote> 
 <p>1.rpm（或pkg）安装，类似以与Windows安装程序，是预编译好的程序。</p> 
 <ul>
<li>使用的是通用参数编译，配置参数部署最佳</li>
<li>可控制性不强，比如对程序特定组件的定制性安装</li>
<li>通常安装包间有复杂依赖关系，操作比较复杂</li>
</ul> 
 <p>2.yum（或者apt-get）安装，改良版的rpm，自动联网下载安装包，自动管理依赖关系</p> 
 <p>3.编译安装（方式在各类Linux发行版中差异不大）</p> 
 <ul>
<li>可控制性强，config是可根据当前系统环境优化参数，可定制组件及安装参数</li>
<li>易出错，难度略高</li>
</ul> 
</blockquote> 
<h3>
<a id="12_nginx____28"></a>1.2 nginx 安装 启动 关闭自动启动</h3> 
<p>sbin目录下：</p> 
<p>启动： ./nginx</p> 
<p>关闭： ./nginx -s stop</p> 
<p>重载配置文件： ./nginx -s reload</p> 
<h3>
<a id="13_Nginx_42"></a>1.3 Nginx的配置</h3> 
<p>配置文件位置： conf/nginx.conf</p> 
<h4>
<a id="_50"></a>全局块</h4> 
<h4>
<a id="events_54"></a>events块</h4> 
<h4>
<a id="http_58"></a>http块</h4> 
<p>include: 引入配置文件</p> 
<pre><code class="prism language-nginx">#顶层配置信息管理服务器级别行为
#一般一个进程足够了，你可以把连接数设得很大。如果有SSL、gzip这些比较消耗CPU的工作，而且是多核CPU的话，可以设为和CPU的数量一样。或者要处理很多很多的小文件，而且文件总大小比内存大很多的时候，也可以把进程数增加，以充分利用IO带宽（主要似乎是IO操作有block）
worker_processes 1;

#event指令与时间模型有关，配置处理连接有关信息
events{
    #单个工作进程可以允许同时建立外部连接的数量
    worker_connections 1024;
}

#http指令处理http请求：接受请求
http{
    #mime type 映射
    include             mime.types; #引入另外一个配置文件
    default_type        application/octet-stream; #在mime.type不存在的时候， 默认的文件类型
    
    sendfile            on;
    #tcp_nopush         on;
    
    #keepalive_timeout  0;
    keepalive_timeout   65;
    
    #gzip          on;
    
    
    #server 处理请求 表示一个虚拟主机，一台服务器可配置多个虚拟主机
    #第一个server 除了匹配本身 server_name 指定的域名外， 还匹配其他server都不匹配的域名
    server{
        #监听端口
        listen         80;
        #识别的域名
        server_name    localhost;
        
        #一个关键设置，与url参数乱码问题有关
        charset        utf-8;
        
        #access_log    logs/host.access.log   main;
        
        #一个server下面可以有多个location，每个location有不同的处理行为，根据表达式匹配，请求交个哪个location，
        #根据location里面的表达式，映射到具体的处理行为
        #location  
        
        
        #location表达式：
        #syntax: location [=|~|~*|^~|@] /uri/ {...}
        #分为两种匹配模式，普通字符串匹配，正则匹配
        #无开头引导字符或以=开头标识普通字符串匹配
        #以~或~*开头标识正则匹配，~*标识不区分大小写
        #多个location时匹配规则
        #总体是先普通后正则原则，只识别URI部分，例如请求为/test/1/abc.do?arg=xxx
        #1. 先查找是否有=开头的精确匹配，即location = /test/1/abc.do {...}
        #2. 再查找普通匹配，以最大前缀为规则，如有以下两个location
        #      location /test/ {...}
        #      location /test/1/ {...}
        #   则匹配最后一项
        #3. 匹配到一个普通格式后，搜索并未结束，而是暂存当前结果，并继续再搜索正则模式
        #4. 在所有正则模式location中找到第一个匹配项后，以此匹配项为最终结果
        #   所以正则匹配项规则受定义前后顺序影响，但普通匹配不会
        #5. 如果未找到匹配项，则以3中缓存的结果为最终结果
        #6. 如果一个匹配都没有，返回404
        
        #location =/ {...}  与  location / {...}的差别
        #前一个是精确匹配，只响应/请求，所有/xxx类请求，不会以，前缀匹配形式匹配到它，
        #后一个正相反，所有请求必然都是以/开头，所以没有其他匹配结果的时候一定会执行到它
        
        #location ^~ / {...} ^~意思是非正则，标识匹配到此模式不再继续正则搜索
        #所有如果这样配置，相当于关闭了正则匹配功能
        #因为一个请求在普通匹配规则下没得到其他普通匹配结果时，最终匹配到这里
        #而这个 ^~指令又相当于不允许正则，相当于匹配到此为止
        
        #精确匹配
        location =/test {
            ...
        }
        #普通字符匹配
        location /test {
            ...
        }
        
        location / {
            root       html;  #指定根目录  绝对路径或者相对路径
            index      index.html  index.htm; #请求到达后没有指定具体文件，默认用index指定的顺序，查找文件
            #deny all;  拒绝请求，返回403
            #allow all; 允许请求
        }
        
        location ^~ /test/ {
            deny all;
        }
        
        
        #正则匹配
        location ~ /test/.+.jsp$ {
            #代理
            proxy_pass   http://192.168.1.62:8080;
        }
        
        #正则匹配
        location ~* .jsp$ {
            proxy_pass  http://192.168.1.61:8080;
        }
        
        
        #定义各类错误页
        error_page   404     /404.html;
        
        #redirect server error pages to the static page /50x.html
        #
        error_page  500 502 503 504   /50x.html;
        location = /50x/html {
            root   html;
        }
        
        # @类似于变量定义
        # 错误执行另外一个代理服务器的时候，location 定义一个变量名， 用@符号
        # error_page  403  http://www.121212.com这种定义不允许，所以利用@实现
        error_page  403   @page403;
        location @page403 {
            proxy_pass = http://www.121212.com;
        }
        
    }
}
</code></pre> 
<h4>
<a id="mimetypes_188"></a>mime.types</h4> 
<blockquote> 
 <p>Nginx 会根据mime type定义的对应关系来告诉浏览器如何处理服务器传给浏览器的这个文件，是打开还是下载；如果Web程序没设置，Nginx也没对应文件的扩展名，就用Nginx 里默认的 default_type定义的处理方式。</p> 
 <p>比如Nginx默认的配置中default_type application/octet-stream; 这个就是默认为下载，浏览器访问到未定义的扩展名的时候，就默认为下载该文件；如果将这个设置改成default_type text/html；那就是告诉浏览器默认的打开方式是把所有未设置的扩展名当HTML文件打开，虽然可能这样设置会很多打不开。</p> 
 <p>mime type 和文件扩展名的对应关系一般放在 mime.types这个文件里，然后用 include mime.types; 来加载</p> 
 <p>mime.types文件里是用types指令来定义的，下面是一个完整的定义：</p> 
</blockquote> 
<p>mime.types文件</p> 
<pre><code class="prism language-typescript">types <span class="token punctuation">{<!-- --></span>
    text<span class="token operator">/</span>html                             html htm shtml<span class="token punctuation">;</span>
    text<span class="token operator">/</span>css                              css<span class="token punctuation">;</span>
    text<span class="token operator">/</span>xml                              xml<span class="token punctuation">;</span>
    image<span class="token operator">/</span>gif                             gif<span class="token punctuation">;</span>
    image<span class="token operator">/</span>jpeg                            jpeg jpg<span class="token punctuation">;</span>
    #application<span class="token operator">/</span>x<span class="token operator">-</span>javascript              js<span class="token punctuation">;</span>
    application<span class="token operator">/</span>javascript              js<span class="token punctuation">;</span>
    application<span class="token operator">/</span>atom<span class="token operator">+</span>xml                  atom<span class="token punctuation">;</span>
    application<span class="token operator">/</span>rss<span class="token operator">+</span>xml                   rss<span class="token punctuation">;</span>

    text<span class="token operator">/</span>mathml                           mml<span class="token punctuation">;</span>
    text<span class="token operator">/</span>plain                            txt<span class="token punctuation">;</span>
    text<span class="token operator">/</span>vnd<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>j2me<span class="token punctuation">.</span>app<span class="token operator">-</span>descriptor      jad<span class="token punctuation">;</span>
    text<span class="token operator">/</span>vnd<span class="token punctuation">.</span>wap<span class="token punctuation">.</span>wml                      wml<span class="token punctuation">;</span>
    text<span class="token operator">/</span>x<span class="token operator">-</span>component                      htc<span class="token punctuation">;</span>

    image<span class="token operator">/</span>png                             png<span class="token punctuation">;</span>
    image<span class="token operator">/</span>tiff                            tif tiff<span class="token punctuation">;</span>
    image<span class="token operator">/</span>vnd<span class="token punctuation">.</span>wap<span class="token punctuation">.</span>wbmp                    wbmp<span class="token punctuation">;</span>
    image<span class="token operator">/</span>x<span class="token operator">-</span>icon                          ico<span class="token punctuation">;</span>
    image<span class="token operator">/</span>x<span class="token operator">-</span>jng                           jng<span class="token punctuation">;</span>
    image<span class="token operator">/</span>x<span class="token operator">-</span>ms<span class="token operator">-</span>bmp                        bmp<span class="token punctuation">;</span>
    image<span class="token operator">/</span>svg<span class="token operator">+</span>xml                         svg<span class="token punctuation">;</span>

    application<span class="token operator">/</span>java<span class="token operator">-</span>archive              jar war ear<span class="token punctuation">;</span>
    application<span class="token operator">/</span>mac<span class="token operator">-</span>binhex40              hqx<span class="token punctuation">;</span>
    application<span class="token operator">/</span>msword                    doc<span class="token punctuation">;</span>
    application<span class="token operator">/</span>pdf                       pdf<span class="token punctuation">;</span>
    application<span class="token operator">/</span>postscript                ps eps ai<span class="token punctuation">;</span>
    application<span class="token operator">/</span>rtf                       rtf<span class="token punctuation">;</span>
    application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>ms<span class="token operator">-</span>excel              xls<span class="token punctuation">;</span>
    application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>ms<span class="token operator">-</span>powerpoint         ppt<span class="token punctuation">;</span>
    application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>wap<span class="token punctuation">.</span>wmlc              wmlc<span class="token punctuation">;</span>
    application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>wap<span class="token punctuation">.</span>xhtml<span class="token operator">+</span>xml         xhtml<span class="token punctuation">;</span>
    application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>google<span class="token operator">-</span>earth<span class="token punctuation">.</span>kml<span class="token operator">+</span>xml  kml<span class="token punctuation">;</span>
    application<span class="token operator">/</span>vnd<span class="token punctuation">.</span>google<span class="token operator">-</span>earth<span class="token punctuation">.</span>kmz      kmz<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span><span class="token number">7</span>z<span class="token operator">-</span>compressed           <span class="token number">7</span>z<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>cocoa                   cco<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>java<span class="token operator">-</span>archive<span class="token operator">-</span>diff       jardiff<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>java<span class="token operator">-</span>jnlp<span class="token operator">-</span>file          jnlp<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>makeself                run<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>perl                    pl pm<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>pilot                   prc pdb<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>rar<span class="token operator">-</span>compressed          rar<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>redhat<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">-</span>manager  rpm<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>sea                     sea<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>shockwave<span class="token operator">-</span>flash         swf<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>stuffit                 sit<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>tcl                     tcl tk<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>x509<span class="token operator">-</span>ca<span class="token operator">-</span>cert            der pem crt<span class="token punctuation">;</span>
    application<span class="token operator">/</span>x<span class="token operator">-</span>xpinstall               xpi<span class="token punctuation">;</span>
    application<span class="token operator">/</span>zip                       zip<span class="token punctuation">;</span>

    application<span class="token operator">/</span>octet<span class="token operator">-</span>stream              bin exe dll<span class="token punctuation">;</span>
    application<span class="token operator">/</span>octet<span class="token operator">-</span>stream              deb<span class="token punctuation">;</span>
    application<span class="token operator">/</span>octet<span class="token operator">-</span>stream              dmg<span class="token punctuation">;</span>
    application<span class="token operator">/</span>octet<span class="token operator">-</span>stream              eot<span class="token punctuation">;</span>
    application<span class="token operator">/</span>octet<span class="token operator">-</span>stream              iso img<span class="token punctuation">;</span>
    application<span class="token operator">/</span>octet<span class="token operator">-</span>stream              msi msp msm<span class="token punctuation">;</span>

    audio<span class="token operator">/</span>midi                            mid midi kar<span class="token punctuation">;</span>
    audio<span class="token operator">/</span>mpeg                            mp3<span class="token punctuation">;</span>
    audio<span class="token operator">/</span>x<span class="token operator">-</span>realaudio                     ra<span class="token punctuation">;</span>

    video<span class="token operator">/</span><span class="token number">3</span>gpp                            <span class="token number">3</span>gpp <span class="token number">3</span>gp<span class="token punctuation">;</span>
    video<span class="token operator">/</span>mpeg                            mpeg mpg<span class="token punctuation">;</span>
    video<span class="token operator">/</span>quicktime                       mov<span class="token punctuation">;</span>
    video<span class="token operator">/</span>x<span class="token operator">-</span>flv                           flv<span class="token punctuation">;</span>
    video<span class="token operator">/</span>x<span class="token operator">-</span>mng                           mng<span class="token punctuation">;</span>
    video<span class="token operator">/</span>x<span class="token operator">-</span>ms<span class="token operator">-</span>asf                        asx asf<span class="token punctuation">;</span>
    video<span class="token operator">/</span>x<span class="token operator">-</span>ms<span class="token operator">-</span>wmv                        wmv<span class="token punctuation">;</span>
    video<span class="token operator">/</span>x<span class="token operator">-</span>msvideo                       avi<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>一般在Nginx的配置文件nginx.conf里面的http{}字段中配置即可，注意mime.types是在你的nginx的安装目录下，如果目录不是下面的，那你要自己手工修改：</p> 
</blockquote> 
<p>参考博客： https://blog.csdn.net/qq_37788558/article/details/78621592</p> 
<h4>
<a id="location_289"></a>location</h4> 
<h5>
<a id="url_291"></a>url匹配规则</h5> 
<pre><code>location [=|~|~*|^~|@] /uri/ {
  ...
} 
</code></pre> 
<blockquote> 
 <ul>
<li>= : 表示精确匹配后面的url</li>
<li>~ : 表示正则匹配，但是区分大小写</li>
<li>~* : 正则匹配，不区分大小写</li>
<li>^~ : 表示普通字符匹配，如果该选项匹配，只匹配该选项，不匹配别的选项，一般用来匹配目录</li>
<li>@ : “@” 定义一个命名的 location，使用在内部定向时，例如 error_page</li>
</ul> 
</blockquote> 
<p>上述匹配规则的优先匹配顺序：</p> 
<blockquote> 
 <ol>
<li>= 前缀的指令严格匹配这个查询。如果找到，停止搜索；</li>
<li>所有剩下的常规字符串，最长的匹配。如果这个匹配使用 ^~ 前缀，搜索停止；</li>
<li>正则表达式，在配置文件中定义的顺序；</li>
<li>如果第 3 条规则产生匹配的话，结果被使用。否则，使用第 2 条规则的结果。</li>
</ol> 
</blockquote> 
<p>location表达式：</p> 
<pre><code class="prism language-java">syntax<span class="token operator">:</span> location <span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">|</span><span class="token operator">~</span><span class="token operator">|</span><span class="token operator">~</span><span class="token operator">*</span><span class="token operator">|</span><span class="token operator">^</span><span class="token operator">~</span><span class="token operator">|</span>@<span class="token punctuation">]</span> <span class="token operator">/</span>uri<span class="token operator">/</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre> 
<p>分为两种匹配模式，普通字符串匹配，正则匹配<br> 无开头引导字符或以=开头标识普通字符串匹配</p> 
<pre><code class="prism language-java">以<span class="token operator">~</span>或<span class="token operator">~</span><span class="token operator">*</span>开头标识正则匹配，<span class="token operator">~</span><span class="token operator">*</span>标识不区分大小写
</code></pre> 
<p>多个location时匹配规则</p> 
<blockquote> 
 <p><strong>总体是先普通后正则原则，只识别URI部分</strong>，例如请求为/test/1/abc.do?arg=xxx</p> 
 <ol>
<li>
<strong>先查找是否有=开头的精确匹配</strong>，即location = /test/1/abc.do {…}</li>
<li>
<strong>再查找普通匹配，以最大前缀为规则</strong>，如有以下两个location<br> location /test/ {…}<br> location /test/1/ {…}<br> 则匹配最后一项</li>
<li>匹配到一个普通格式后，搜索并未结束，而是暂存当前结果，并继续再搜索正则模式</li>
<li>
<strong>在所有正则模式location中找到第一个匹配项后，以此匹配项为最终结果</strong><br> 所以正则匹配项规则受定义前后顺序影响，但普通匹配不会</li>
<li>如果未找到匹配项，则以3中缓存的结果为最终结果</li>
<li>如果一个匹配都没有，返回404</li>
</ol> 
</blockquote> 
<p>location =/ {…} 与 location / {…}的差别<br> 前一个是精确匹配，只响应/请求，所有/xxx类请求，不会以，前缀匹配形式匹配到它，<br> 后一个正相反，所有请求必然都是以/开头，所以没有其他匹配结果的时候一定会执行到它</p> 
<pre><code class="prism language-java">location <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token operator">^</span><span class="token operator">~</span>意思是非正则，标识匹配到此模式不再继续正则搜索
所有如果这样配置，相当于关闭了正则匹配功能
</code></pre> 
<p>因为一个请求在普通匹配规则下没得到其他普通匹配结果时，最终匹配到这里<br> 而这个 ^~指令又相当于不允许正则，相当于匹配到此为止</p> 
<pre><code class="prism language-nginx">#精确匹配
        location =/test {...}
        #普通字符匹配
        location /test {...}
        
        location / {
            root       html;  #指定根目录  绝对路径或者相对路径
            index      index.html  index.htm; #请求到达后没有指定具体文件，默认用index指定的顺序，查找文件
            #deny all;  拒绝请求，返回403
            #allow all; 允许请求
        }
        
        location ^~ /test/ {
            deny all;
        }
        
        
        #正则匹配
        location ~ /test/.+.jsp$ {
            #代理
            proxy_pass   http://192.168.1.62:8080;
        }
        
        #正则匹配
        location ~* .jsp$ {
            proxy_pass  http://192.168.1.61:8080;
        }
        
        
        #定义各类错误页
        error_page   404     /404.html;
        
        #redirect server error pages to the static page /50x.html
        #
        error_page  500 502 503 504   /50x.html;
        location = /50x/html {
            root   html;
        }
        
        # @类似于变量定义
        # 错误执行另外一个代理服务器的时候，location 定义一个变量名， 用@符号
        # error_page  403  http://www.121212.com这种定义不允许，所以利用@实现
        error_page  403   @page403;
        location @page403 {
            proxy_pass = http://www.121212.com;
        }
</code></pre> 
<p>@ 类似于变量定义</p> 
<pre><code class="prism language-nginx"> # @类似于变量定义
 # 错误执行另外一个代理服务器的时候，location 定义一个变量名， 用@符号
 # error_page  403  http://www.121212.com这种定义不允许，所以利用@实现
 error_page  403   @page403;
 location @page403 {
      proxy_pass = http://www.121212.com;
 }
</code></pre> 
<h3>
<a id="14_Nginx_419"></a>1.4 Nginx的优化</h3> 
<p>nginx.conf配置文件</p> 
<h4>
<a id="_425"></a>全局块</h4> 
<p>nginx不同于apache服务器，当apache进行了大量优化设置后会有魔术般的明显提升性能效果，nginx在安装完成后，大部分参数都是最优化了，我们需要管理的东西并不多</p> 
<p>阻塞和非阻塞网络模型：</p> 
<blockquote> 
 <p>同步阻塞模型，一请求一进（线）程，当进（线）程增加到一定程度后,更多的CPU时间浪费到切换CPU,性能急剧下降，所以负载率并不高</p> 
 <p>Nginx基于事件的非阻塞多路复用（epoll或kquene）模型,一个进程在段时间内可以响应大量的请求</p> 
</blockquote> 
<p>案例：</p> 
<pre><code class="prism language-nginx">#user   nobody;

#工作进程数量：接受和处理用户请求
#建议值 &lt;= CPU核心数量，一般高于cpu数量不会带来好处，也许还有进程切换开销的负面影响
worker_processes   4;

#将work process 绑定到特定的CPU上，避免进程在cpu间切换的开销
#多少个cpu，每组数字就有多少个数字 0/1
worker_cpu_affinity   0001 0010 0100 1000;
#8核4进程时的设置方法  worker_cpu_affinity   00000001 00000010 00000100 10000000


# 每个进程最大可打开文件描述符数量（linux上文件描述符比较广泛，网络端口，设备，磁盘文件都是）
# 文件描述符用完了，新的连接会拒绝，产生502类错误
# linux 最大可打开文件数可通过ulimit -n FILECNT或 /etc/security/limits.conf配置
# 理论值: 系统最大数量 / 进程数。但进程间工作量并不是平均分配的，所以可以设置的大一些
#越大越好
worker_rlimit_nofile   655350;

events{
    ...
}

</code></pre> 
<h5>
<a id="worker_processes_468"></a>worker_processes</h5> 
<p>工作进程数量：接受和处理用户请求</p> 
<pre><code class="prism language-nginx">#工作进程数量：接受和处理用户请求
#建议值 &lt;= CPU核心数量，一般高于cpu数量不会带来好处，也许还有进程切换开销的负面影响
worker_processes   4;
</code></pre> 
<h5>
<a id="worker_cpu_affinity_478"></a>worker_cpu_affinity</h5> 
<p>将work process 绑定到特定的CPU上</p> 
<pre><code class="prism language-nginx">#将work process 绑定到特定的CPU上，避免进程在cpu间切换的开销
#多少个cpu，每组数字就有多少个数字 0/1
worker_cpu_affinity   0001 0010 0100 1000;
#8核4进程时的设置方法  worker_cpu_affinity   00000001 00000010 00000100 10000000
</code></pre> 
<h5>
<a id="worker_rlimit_nofile_489"></a>worker_rlimit_nofile</h5> 
<p>每个进程最大可打开文件描述符数量</p> 
<pre><code class="prism language-nginx"># 每个进程最大可打开文件描述符数量（linux上文件描述符比较广泛，网络端口，设备，磁盘文件都是）
# 文件描述符用完了，新的连接会拒绝，产生502类错误
# linux 最大可打开文件数可通过ulimit -n FILECNT或 /etc/security/limits.conf配置
# 理论值: 系统最大数量 / 进程数。但进程间工作量并不是平均分配的，所以可以设置的大一些
#越大越好
worker_rlimit_nofile   655350;
</code></pre> 
<h4>
<a id="events_504"></a>events块</h4> 
<pre><code class="prism language-nginx">....

events {
    #并发响应能力的关键配置值 
    #每个进程允许的最大同时连接数，worker_connections * worker_processes = maxConnection;
    #要注意maxConnection不等于可响应的用户数量，
    #因为一般一个浏览器会同时开两条连接，如果反向代理，nginx到后端服务器的连接也要占用连接数
    #所以，做静态服务器时，一般 maxClient = worker_connections * worker_processes /2
    #做反向代理服务器时，maxClient = worker_connections * worker_processes /4
    
    #这个值理论上越大越好，但最多可承受多少请求与配置和网络相关，也可最大可打开文件，最大可用sockets数量
    worker_connections 200000;
    
    #指明使用 epoll 或 kqueue (*BSD)
    use epoll;
    
    #备注：要达到超高负载下最好的网络响应能力，还有必要优化与网络相关的linux 参数
    
}

....
</code></pre> 
<h5>
<a id="worker_connections_534"></a>worker_connections</h5> 
<p>并发响应能力的关键配置值，每个进程允许的最大同时连接数</p> 
<pre><code class="prism language-nginx">    #并发响应能力的关键配置值 
    #每个进程允许的最大同时连接数，worker_connections * worker_processes = maxConnection;
    #要注意maxConnection不等于可响应的用户数量，
    #因为一般一个浏览器会同时开两条连接，如果反向代理，nginx到后端服务器的连接也要占用连接数
    #所以，做静态服务器时，一般 maxClient = worker_connections * worker_processes /2
    #做反向代理服务器时，maxClient = worker_connections * worker_processes /4
    
    #这个值理论上越大越好，但最多可承受多少请求与配置和网络相关，也可最大可打开文件，最大可用sockets数量
    worker_connections 200000;
</code></pre> 
<p><strong>maxClient</strong>：最大客户可用连接数</p> 
<blockquote> 
 <p>maxClient = worker_connections * worker_processes /2</p> 
 <p>做反向代理服务器时，maxClient = worker_connections * worker_processes /4</p> 
</blockquote> 
<h5>
<a id="use_558"></a>use</h5> 
<p>指定事件处理的时候，指定网络模型</p> 
<p>基本不需要设置，nginx自动识别。</p> 
<p><strong>windows无法使用多路复用模型，这也是为什么nginx在windows上，性能不够好的原因</strong></p> 
<pre><code class="prism language-nginx"> #指明使用 epoll 或 kqueue (*BSD)
 use epoll;
</code></pre> 
<h4>
<a id="http_573"></a>http块</h4> 
<pre><code class="prism language-nginx">....

events{
    ...
}

https {
    include         mime.types;
    dafault_type    application/octet-stream;
    
    #访问日式是否记录
    #关闭此项可减少IO开销，但也无法记录访问信息，不利于业务分析，一般运维情况不建议使用
    access_log      off;
    
    #错误日志
    #crit：只记录更为严重的错误日志，可减少IO压力，或者关闭
    error_log  logs/error.log   crit;
    #access_log  logs/access.log    main;
    
    #启用内核复制模式，应该保持开启达到最快IO效率，从磁盘级IO复制到网络级IO，不经过用户级，减少了几次复制过程【零拷贝技术】
    sendfile        on;
    
    #简单说，启动如下两项配置，会在数据包达到一定大小后再发送数据
    #这样会较少网络通信次数，降低阻塞概率，但也会影响响应及时性
    #比较合适于文件下载这类的大数据包通信场景
    #tcp_nohush     on;
    #tcp_nodelay  on|off  on禁用Nagle算法
    
    #HTTP1.1支持持久连接alive
    #连接存活时间： 降低每个连接的alive时间，可在一定程度上提高响应连接数量，所以一般可适当降低此值
    keepalive_timeout  30s;
    
    #启动内容压缩，有效降低网络流量,生产环境打开
    gzip               on;
    
    #内容压缩最小长度：过短的就不要压缩，因为 过短的内容压缩效果不佳，压缩过程还会浪费系统资源
    gzip_min_length    1000;
    
    #可选值1~9，压缩级别越高，压缩率越高，但对系统性能要求越高
    gzip_comp_level    4;
   
    #压缩的内容类别
    gzip_types    text/plain  text/css application/json   application/x-javascript  text/xml ...;
    
    
    #静态文件缓存
    #最大缓存数量，文件未使用存活期
    #open_file_cache 打开文件，max：缓存文件最大个数，
    #"inactive"：文件存活期,"open_file_cache_min_uses"缓存文件在20s内使用至少2次，那么缓存文件不会被替换，是一个命中率有效的文件
    #"open_file_cache_valid":表示多久验证缓存，会释放使用次数少的文件
    open_file_cache max=655350  inactive=20s;
    
    #验证缓存有效期时间间隔
    open_file_cache_valid  30s;
    
    #有效期内文件最少使用次数
    open_file_cache_min_uses  2;
    
    
    server {
        ...
    } 
    
}
</code></pre> 
<h5>
<a id="_642"></a>日志</h5> 
<pre><code class="prism language-nginx">    #访问日式是否记录
    #关闭此项可减少IO开销，但也无法记录访问信息，不利于业务分析，一般运维情况不建议使用
    access_log      off;
    
    #错误日志
    #crit：只记录更为严重的错误日志，可减少IO压力，或者关闭
    error_log  logs/error.log   crit;
    #access_log  logs/access.log    main;
</code></pre> 
<h5>
<a id="_655"></a>内核复制</h5> 
<pre><code class="prism language-nginx">#启用内核复制模式，应该保持开启达到最快IO效率，从磁盘级IO复制到网络级IO，不经过用户级，减少了几次复制过程【零拷贝技术】
    sendfile        on;
</code></pre> 
<h5>
<a id="_662"></a>压缩</h5> 
<pre><code class="prism language-nginx">    #启动内容压缩，有效降低网络流量,生产环境打开
    gzip               on;
    
    #内容压缩最小长度：果断的就不要压缩，因为 过短的内容压缩效果不佳，压缩过程还会浪费系统资源
    gzip_min_length    1000;
    
    #可选值1~9，压缩级别越高，压缩率越高，但对系统性能要求越高
    gzip_comp_level    4;
   
    #压缩的内容类别
    gzip_types    text/plain  text/css application/json   application/x-javascript  text/xml;
</code></pre> 
<h5>
<a id="_678"></a>静态文件缓存</h5> 
<pre><code class="prism language-nginx">    #静态文件缓存
    #最大缓存数量，文件未使用存活期
    #open_file_cache 打开文件，max：缓存文件最大个数，
    #"inactive"：文件存活期,"open_file_cache_min_uses"缓存文件在20s内使用至少2次，那么缓存文件不会被替换，是一个命中率有效的文件
    #"open_file_cache_valid":表示多久验证缓存，回释放使用次数少的文件
    open_file_cache max=655350  inactive=20s;
    
    #验证缓存有效期时间间隔
    open_file_cache_valid  30s;
    
    #有效期内文件最少使用次数
    open_file_cache_min_uses  2;
</code></pre> 
<h2>
<a id="2_Tomcat_697"></a>2. Tomcat安装，配置及优化</h2> 
<h3>
<a id="21_JDK_699"></a>2.1 安装JDK</h3> 
<p>下载 jdk1.8.0_51.tar.gz 解压…在下面添加配置</p> 
<p>/etc/profile.d/ 系统启动的时候，会执行这里面的 .sh文件</p> 
<pre><code class="prism language-bash"><span class="token comment">#/etc/profile.d/java.sh</span>

<span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/jdk1.8.0_51
<span class="token comment">#引用原PATH方式：:$PATH</span>
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
<span class="token comment">#导出路径：</span>
<span class="token builtin class-name">export</span> JAVA_HOME <span class="token environment constant">PATH</span>
</code></pre> 
<p>设置立即生效： source /etc/profile</p> 
<h3>
<a id="22_Tomcat_719"></a>2.2 Tomcat安装</h3> 
<p>日志： /logs/catalina.out</p> 
<p>启动： /bin/start.sh</p> 
<p>关闭： /bin/shutdown.sh</p> 
<p>开机启动：/etc/rc.d/rc.local 文件 ：用来设置开机自动运行</p> 
<pre><code class="prism language-bash"><span class="token function">touch</span> /var/lock/subsys/local
/opt/nginx/sbin/nginx

<span class="token builtin class-name">export</span>  <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/jdk1.8.0_51
<span class="token variable">$JAVA_HOME</span>/bin/startup.sh
</code></pre> 
<p><strong>rc.local 比 profile.d 文件夹里面的控制脚本启动的更早</strong>，所以上面需要重新<strong>导出</strong>一遍JAVA_HOME命令</p> 
<h3>
<a id="23_Tomcat_741"></a>2.3 Tomcat的优化配置</h3> 
<h4>
<a id="_743"></a>内存使用配置</h4> 
<p>/bin/catalina.sh</p> 
<pre><code class="prism language-sh">......

#Windows下配置方法
#set JAVA_OPTS=%JAVA_OPTS% -server -Xms2048m -Xmx2048m -XX:PermSize=256m -XX:MaxPermSize=512m -Djava.awt.headless=true
#通过内存设置充分利用服务器内存
#-server模式启动应用慢，但可以极大程度提高运行性能
#java 8开始，PermSize 被 MetaspaceSize 代替，MetaspaceSize共享heap，不会再有java.lang.outofMemoryError:PermGen space，可以不设置PermSize
#headless=true 适用于linux系统，于图形操作有关，如生成验证码，含义是当前适用的是无显示器的服务器，应用中如果获取系统显示有关参数会抛异常
#可通过 jmap -heap process_id查看设置是否成功
JAVA_OPTS=$JAVA_OPTS -server -Xms2048m -Xmx2048m -XX:PermSize=256m -XX:MaxPermSize=512m -Djava.awt.headless=true

......
</code></pre> 
<h4>
<a id="_766"></a>最大连接数配置</h4> 
<p>server.xml</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 端口连接  protocol ： bio  nio apr 三种网络模型--&gt;</span>
<span class="token comment">&lt;!-- protocol 启用nio模式，（tomcat8默认使用的是nio）（apr模式利用系统异步io） --&gt;</span>
<span class="token comment">&lt;!-- minProcessors 最小空闲连接线程数 --&gt;</span>
<span class="token comment">&lt;!-- maxProcessors 最大连接线程数 --&gt;</span>
<span class="token comment">&lt;!-- acceptCount 允许的最大连接数，应大于等于 maxProcessors --&gt;</span>
<span class="token comment">&lt;!-- enableLookups 如果为true，request.getRemoteHost 会执行DNS 查找，反向解析ip 对应域名或主机名 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8080<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.coyote.http11.Http11NioProtocol<span class="token punctuation">"</span></span>
           <span class="token attr-name">connectionTimetoue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>
           <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span>
           
           <span class="token attr-name">maxThreads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500<span class="token punctuation">"</span></span>      <span class="token attr-name">#最大连接线程数</span>
           <span class="token attr-name">minSpareThreads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">#最小空闲线程</span>
           <span class="token attr-name">maxSpareThreads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token attr-name">#最大空闲线程</span>
           <span class="token attr-name">acceptCount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span>     <span class="token attr-name">#所有线程启动后，还允许接受的连接数量，也就是等待的线程数</span> <span class="token attr-name">,最大可接受的任务：maxThreads+acceptCount</span>
           <span class="token attr-name">enableLookups</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">#是否允许DNS反查</span>
 <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<h2>
<a id="3_NginxTomcat_795"></a>3. Nginx+Tomcat负载均衡详细配置</h2> 
<h3>
<a id="31__799"></a>3.1 负载均衡配置的实现</h3> 
<h4>
<a id="_801"></a>正向代理和反向代理</h4> 
<blockquote> 
 <p>**正向代理：如果把局域网外的 Internet 想象成一个巨大的资源库，则局域网中的客户端要访问 Internet，则需要通过代理服务器来访问，这种代理服务就称为正向代理。**对于<em>反向代理</em>，客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器 IP 地址。</p> 
 <p>代理一般分为正向代理和反向代理。</p> 
 <p>正向代理是一个位于客户端和原始服务器之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。</p> 
 <p>反向代理实际运行方式是代理服务器接受网络上的连接请求。它将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给网络上请求连接的客户端，此时代理服务器对外就表现为一个服务器。</p> 
 <p>可以这么认为，<strong>对于正向代理，代理服务器和客户端处于同一个局域网内；而反向代理，代理服务器和源站则处于同一个局域网内。</strong></p> 
 <p>参考博客：https://blog.csdn.net/u010039418/article/details/80011127</p> 
 <p>https://www.cnblogs.com/xudong-bupt/p/8661523.html</p> 
</blockquote> 
<p>nginx 充当<strong>代理</strong>服务器： 浏览器-&gt;Nginx-&gt;Tomcat，原理如下：</p> 
<p><img src="https://images2.imgbox.com/6c/6b/u5uT7Q7V_o.png" alt="请添加图片描述"></p> 
<p>192.168.1.61服务器请求转到192.168.1.62中的tomcat</p> 
<p>192.168.1.61中nginx配置如下：<br> nginx.conf文件里面<strong>设置代理</strong>：</p> 
<pre><code class="prism language-nginx">worker_processes 1;
events {
    worker_connections 1024;
}
http {
    include    mime.types;
    default_type  application/octet-stream;
    sendfile   on;
    keepalive_timeout  65;
    
    server {
        listen    80;
        server_name   localhost;
        location / {
            #root    html;
            index   index.html  index.htm;
            #代理配置
            proxy_pass  http://192.168.1.62:8080;
        }
        
        error_page  500 502 503 504  /50x.html;
        location = /50x.html {
            root html;
        }
    }
}
</code></pre> 
<p>修改完成后，配置文件生效：sbin/nginx -s reload</p> 
<h4>
<a id="_868"></a>负载均衡</h4> 
<p>示意图如下：<br> <img src="https://images2.imgbox.com/d4/ec/eJYxcNiY_o.png" alt="请添加图片描述"><br> 三个要素：</p> 
<p>1.服务器组</p> 
<p>2.nginx配置</p> 
<p>3.负载均衡策略</p> 
<p>首先要有多个服务器，形成服务器组，nginx通过反向代理，将请求发送到服务器组上，根据负载均衡策略，分配请求到具体的服务器上。</p> 
<p>打开nginx文件，实现负载均衡配置：</p> 
<pre><code class="prism language-nginx">worker_processes 1;
events {
    worker_connections 1024;
}
http {
    include    mime.types;
    default_type  application/octet-stream;
    sendfile   on;
    keepalive_timeout  65;
    
    #定义服务器组，默认轮训方式发送请求
    upstream tomcats {
        server 192.168.1.62:8080;
        server 192.168.1.63:8080;
    }
    
    server {
        listen    80;
        server_name   localhost;
        location / {
            #root    html;
            index   index.html  index.htm;
            #代理配置：  服务器组名，请求发送给服务器组
            proxy_pass  http://tomcats;
        }
        
        error_page  500 502 503 504  /50x.html;
        location = /50x.html {
            root html;
        }
    }
}
</code></pre> 
<h5>
<a id="upstream__923"></a>upstream 参数</h5> 
<pre><code class="prism language-nginx">...
#配置用于负载均衡的服务器集群信息
upstream backends {
    #均衡策略
    #none 轮训（权重由weight决定）
    #ip_hash
    #fair
    #url_hash
    
    server 192.168.1.62:8080;
    server 192.168.1.63;
    
    #weight:权重，值越高负载越大；
    #server 192.168.1.64 weigth=5;
    
    #backup: 备份机，只有非备份机都挂掉，才启用：
    server 192.168.1.64 backup;
    
    #down: 停机标志，不会被访问
    server 192.168.1.64 down;
    
    #max_fails:达到指定次数认为服务器挂掉；
    #fail_timeout:挂掉之后过多久再去测试是否已恢复
    server 192.168.1.66 max_fails=2 fail_timeout=60s;
    
}

...
</code></pre> 
<h5>
<a id="_956"></a>均衡策略</h5> 
<h6>
<a id="__958"></a>平均轮训 默认</h6> 
<p>1:1</p> 
<h6>
<a id="_962"></a>权重</h6> 
<p>根据权重不大， 分配的ip数量不同，默认1:1</p> 
<pre><code class="prism language-nginx">upstream backends {
    server 192.168.1.62:8080 weight=5;
    server 192.168.1.63:8080 weight=3;
}
</code></pre> 
<h6>
<a id="ip_hash_973"></a>ip_hash</h6> 
<p>用户访问的ip第一次访问的时候，会绑定到某一个均衡策略里面，指定的服务器上面，后续该ip的请求的，都会访问这个绑定的服务器ip地址。</p> 
<p>使用方式：</p> 
<pre><code class="prism language-nginx">upstream backends {
    ip_hash; #在这指定使用了ip_hash方式
    server 192.168.1.62:8080 ;
    server 192.168.1.63:8080 ;
}
</code></pre> 
<h6>
<a id="fair_987"></a>fair</h6> 
<p>第三方扩展的</p> 
<p>下载： nginx-upstream-fair-master.zip</p> 
<p>编译第三方文件：</p> 
<p>在编译nginx的时候，</p> 
<p>./configure --prefix=/opt/nginx --add-module=/tmp/nginx-upstream-fair-master</p> 
<p>make &amp; make install #如果第一次编译，</p> 
<p>make #如果nginx之前已经编译过了， make:只是编译</p> 
<p>cd objs #里面是扩展包，用里面的nginx替换掉外部的nginx</p> 
<p>（用nginx文件带着第三方扩展模块，重新编译，然后编译的nginx替换掉之前的nginx文件，即可）</p> 
<p><strong>动态自动的，对服务器负载高的的服务器增加请求数量，自动调节</strong></p> 
<pre><code class="prism language-nginx">upstream backends {
    fair;
    server 192.168.1.62:8080 ;
    server 192.168.1.63:8080 ;
}
</code></pre> 
<h6>
<a id="url_hash_1019"></a>url_hash</h6> 
<p>第三方扩展的</p> 
<p>根据用户的url进行hash运算</p> 
<p>电子商务网站，对于不同商品的，不同路径，在缓存了商品的独一无二的url之后，用户访问的话，都会映射到一个服务器上，如果数据在服务器上面缓存的话， 会极大提供并发。大量不同的商品在不同的服务器上面缓存起来。</p> 
<h3>
<a id="32_Session_1029"></a>3.2 负载均衡是Session的处理策略</h3> 
<h4>
<a id="_1031"></a>问题</h4> 
<p>分布式负载均衡情况下 session存在的问题：</p> 
<blockquote> 
 <p>服务访问集群的时候，负载均衡策略把响应转发到不同的tomcat中，会导致下次访问请求，如果访问的不是之前的保存session的那个tomcat,那么此次就会获取不到session的值。</p> 
</blockquote> 
<h4>
<a id="_1037"></a>解决方式</h4> 
<p>三种策略，</p> 
<h5>
<a id="1_session_1041"></a>1. 粘性session</h5> 
<p>用户锁定到某个tomcat中，</p> 
<p>同一个用户的请求锁定到固定的某一个tomcat中，不存在session丢失的问题。</p> 
<p>方式：ip_hash</p> 
<p>优点：简单，session无需额外处理</p> 
<p>缺点：缺乏容错性，这个tomcat一旦挂了，用户立刻感知到</p> 
<h5>
<a id="2_session_1055"></a>2. session复制</h5> 
<p>session改变，会在集群里面广播，所有服务器同步session数据</p> 
<p>优点：实时性好</p> 
<p>缺点：网络负荷严重，可能造成后端性能低下</p> 
<p>实现方式：</p> 
<p>1.在tomcat的server.xml中开启 session复制开关</p> 
<p>找到模块Engine</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Engine</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Catalina<span class="token punctuation">"</span></span> <span class="token attr-name">defaultHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

 <span class="token comment">&lt;!-- For clustering, please take a look at document at: 
/docs/cluster-howto.html(simple how to)
 /docs/config/cluster.html(reference documentation)
--&gt;</span>
 #打开注释  打开了tomcat的集群功能， tomcat7以后的版本，有默认值,可以无需配置，只需要打开这个即可
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Cuslter</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.tcp.SimpleTcpCluster<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    
    <span class="token comment">&lt;!-- 基于网络广播的策略，一个节点的session变化，其他节点同步复制，节点多或数据量大时性能低下 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Cluster</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.tcp.SimpleTcpCluster<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Channel</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tries.group.GroupChannel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Receiver</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apcache.catalina.tribes.transport.nio.NioReceiver<span class="token punctuation">"</span></span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auto<span class="token punctuation">"</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4000<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Channel</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Cluster</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Engine</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2.在应用中通知tomcat，当前应用处于集群中</p> 
<p>在web.xml中增加选项</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
...
#增加这个，标识当前应用可以处于集群当中
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>distributable</span><span class="token punctuation">/&gt;</span></span>

...
</code></pre> 
<p>在TOMCAT7以后,SERVER.XML取消CLUSTER这行注释之后表示TOMCAT开启了集群功能.TOMCAT的集群功能配备了发送器,接收器,内容转换器,还有各种监听借口,事件显示器等一系列功能.以上是在TOMCAT中的要进行修改的,对应的在开发的应用中要在WEB.XML中添加这么一条配置选项,位置如下图.添加完这两项配置后,这个应用就有了SESSION复制的功能了.</p> 
<blockquote> 
 <p>需要说明的是,因为在一台服务器上可能不止有一个TOMCAT,在配置参数的时候,不要使用默认参数,要自行进行手动配置.首先要考虑的就是端口冲突问题.比如上方的示例,如果一台服务器上有两个TOMCAT,默认指定不同端口.地址也是一样,因为开启该项功能,如果设置的是AUTO,会自动选择,如果选择错了,那么也就不能进行.通常服务器有两个网卡,一个是内网网卡,一个是外网的,我们的接收器是绑定在内网上的.因为我们的服务器集群是在内网的,所以接收器自然绑定的是内网的网卡,如果绑错了就会接收不到消息.</p> 
</blockquote> 
<p>接收器Receiver修改：</p> 
<p>多个tomcat存在冲突，端口修改，另外，需要指定网络</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Cluster</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.tcp.SimpleTcpCluster<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Channel</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tries.group.GroupChannel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Receiver</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apcache.catalina.tribes.transport.nio.NioReceiver<span class="token punctuation">"</span></span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>192.16.1.62<span class="token punctuation">"</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4002<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Channel</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Cluster</span><span class="token punctuation">&gt;</span></span>


#另外一个：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Cluster</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.ha.tcp.SimpleTcpCluster<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Channel</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.catalina.tries.group.GroupChannel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Receiver</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apcache.catalina.tribes.transport.nio.NioReceiver<span class="token punctuation">"</span></span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>192.16.1.63<span class="token punctuation">"</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4003<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Channel</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Cluster</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h5>
<a id="3_session_1129"></a>3. 共享空间保存session</h5> 
<p>对于Session来说，肯定是频繁使用的，虽然你可以把它存放在数据库中，但是真正生产环境中我更推荐存放在性能更快的分布式KV数据中，例如：Memcached和Redis。</p> 
<p>借助分布式缓存: memched，redis等，</p> 
<h6>
<a id="_MSM_sticky_1135"></a>粘性模式 MSM原理 sticky</h6> 
<p><img src="https://images2.imgbox.com/d5/06/EUc5oXb2_o.png" alt="请添加图片描述"></p> 
<blockquote> 
 <p>将用户的每次请求固定到同一台服务器，需要一到多个memcached存储器，主从备份，数据一样，</p> 
 <p>一个tomcat指定一个memcached存储器，不同tomcat指定不同的memcached存储器，</p> 
 <p>用户请求到达tomcat,session会复制一份到memcached存储器，下次来如果是读取session，那么不需要读取memcached存储器，直接读取tomcat上面的session信息。</p> 
 <p>如果是修改session，tomcat修改完，数据保存到memcached存储器。</p> 
 <p><strong>如果tomcat宕机</strong>，用户请求会转移到另外一个tomcat上面，</p> 
 <p>如果用户请求访问了另外一个tomcat,tomcat没有session，会去存储器上访问，数据保存到tomcat中。，相当于数据同步到tomcat中。</p> 
</blockquote> 
<p>以tomcat为主存储，备份session到存储器中，tomcat中没有数据的时候，从存储器中获取。</p> 
<h6>
<a id="_MSMnonsticky_1159"></a>非粘性模式 MSM原理non-sticky</h6> 
<p><img src="https://images2.imgbox.com/5e/98/Klj9hmRP_o.png" alt="请添加图片描述"></p> 
<blockquote> 
 <p>memcached有多个服务，其中一个是主存储，其他是备份，数据是实时同步，</p> 
 <p>session数据写入备份存储器,同步到主存储，tomcat不保存session,读取的时候，从主存储获取。</p> 
</blockquote> 
<h6>
<a id="msm_1171"></a>msm配置：</h6> 
<p>1.复制jar包到tomcat/lib目录，jar分三类</p> 
<blockquote> 
 <ol>
<li> <p>spymemcached.har memcached java客户端</p> </li>
<li> <p>msm相关包</p> </li>
</ol> 
 <p>memcached-session-manager-{version}.jar 核心包</p> 
 <p>memcached-session-manager-tc{tomcat-version}-{version}.jar tomcat版本相关的包</p> 
 <ol start="3"><li>序列化相关包，有多种可选方法，不设置时使用jdk自带序列化，其他可选kryo,javaolution,xstream</li></ol> 
 <p>msm-{tools}-serializer-{version}.jar</p> 
</blockquote> 
<p>2.配置Context,加入处理session的Manager MemcachedBackupSessionManager</p> 
<blockquote> 
 <p>Context查找顺序：</p> 
 <ol>
<li>conf/context.xml 全局配置，作用于所用应用</li>
<li>conf/[enginename]/[hostname]/context.xml.default 全局配置，作用于指定host下全部应用</li>
<li>conf/[enginename]/[hostname]/[contextpath].xml 只作用于contextpath指定的应用</li>
<li>应用META-INF/context.xml 只作用于本应用</li>
<li>conf/server.xml 的模块下， 作用于Context docBase指定的应用</li>
</ol> 
</blockquote> 
<p>所以，只希望session管理作用于特定应用，最好用3,4方式设置，希望作用于全体，可用1,2,5设置</p> 
<p>举个例子，</p> 
<p>context-msm.xml</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Context</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WatchedResource</span><span class="token punctuation">&gt;</span></span>WEB-INF/web.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>WatchedResource</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WatchedResource</span><span class="token punctuation">&gt;</span></span>${catalina.base}/conf/web.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>WatchedResource</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!-- 
       sticky session最小配置
       className 管理器类型
       memcachedNodes memcached服务器节点，以节点名：主机：端口形式表示，其中节点名称随意命名，但不同tomcat之间名称，应该同步
       sticky隐含默认值为true,此时为sticky session模式
       failoverNodes仅适用于sticky模式，n1表示主要将session备份到n2，如果n2不可用，再用n1
       failoverNodes="n1"，说明n2是这个tomcat主要用来备份（粘性模式，session主要存储在tomcat中）的存储器，n1是n2不可用的时候的被迫选择，
       另外一台服务器配置，正好相反，这样保证将session保存到其他机器，避免整个集群崩溃时tomcat与session都不可用
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Manager</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>de.javakaffee.web.msm.MemcachedBackupSessionManager<span class="token punctuation">"</span></span>
             <span class="token attr-name">memcachedNodes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>n1:192.168.1.62:11211,n2:192.168.1.63:11211<span class="token punctuation">"</span></span>
             <span class="token attr-name">failoverNodes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>n1<span class="token punctuation">"</span></span>
             <span class="token punctuation">/&gt;</span></span>
    
    <span class="token comment">&lt;!-- 经常用到的生产环境sticky模式配置 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Manager</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>de.javakaffee.web.msm.MemcachedBackupSessionManager<span class="token punctuation">"</span></span>
             <span class="token attr-name">memcachedNodes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>n1:192.168.1.62:11211,n2:192.168.1.63:11211<span class="token punctuation">"</span></span>
             <span class="token attr-name">failoverNodes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>n1<span class="token punctuation">"</span></span>
             <span class="token attr-name">#忽略的模式</span>
             <span class="token attr-name">requestUriIgnorePattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.*.(jpg|png|css|js)$<span class="token punctuation">"</span></span>
             <span class="token attr-name">#二进制的协议，效率更高</span>
             <span class="token attr-name">memcachedProtocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>binary<span class="token punctuation">"</span></span>
             <span class="token attr-name">#指定第三方的序列化工具，性能比jdk自带的更高</span>
             <span class="token attr-name">transcoderFactoryClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory<span class="token punctuation">"</span></span>
             <span class="token punctuation">/&gt;</span></span>
    
    <span class="token comment">&lt;!-- 经常用到的生产环境non-sticky模式配置 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Manager</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>de.javakaffee.web.msm.MemcachedBackupSessionManager<span class="token punctuation">"</span></span>
             <span class="token attr-name">memcachedNodes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>n1:192.168.1.62:11211,n2:192.168.1.63:11211<span class="token punctuation">"</span></span>
             <span class="token attr-name">sticky</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
             <span class="token attr-name">#粘性模式的时候，</span> <span class="token attr-name">session异步备份模式，非粘性，需要同步</span>
             <span class="token attr-name">sessionBackupAsync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
             <span class="token attr-name">#锁模式，session备份写入的时候，session才可以读取等操作，防止session操作混乱</span>
             <span class="token attr-name">lockingMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auto<span class="token punctuation">"</span></span>
             <span class="token attr-name">#忽略的模式</span>
             <span class="token attr-name">requestUriIgnorePattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.*.(jpg|png|css|js)$<span class="token punctuation">"</span></span>
             <span class="token attr-name">#二进制的协议，效率更高</span>
             <span class="token attr-name">memcachedProtocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>binary<span class="token punctuation">"</span></span>
             <span class="token attr-name">#指定第三方的序列化工具，性能比jdk自带的更高</span>
             <span class="token attr-name">transcoderFactoryClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory<span class="token punctuation">"</span></span>
             <span class="token punctuation">/&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Context</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2>
<a id="4__1257"></a>4. 集群环境中应用代码应注意的问题</h2> 
<h4>
<a id="41__1261"></a>4.1 实体类序列化支持</h4> 
<p>实现 接口 Serializable</p> 
<p>session里面的对象想，需要序列化</p> 
<pre><code class="prism language-java"><span class="token comment">// 可能会放到session中的实体类应实现Serializable接口</span>
<span class="token comment">// 这样才能保证成功使用jdk进行序列化</span>
<span class="token comment">//第三方序列化工具一般不需要实现该接口</span>
<span class="token comment">//但对无参构造，某些类型（如Map）序列化有特殊要求</span>
<span class="token comment">//如果程序运行时出现序列化异常，需要参考工具相关文档进行处理</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//实现了 接口 Serializable 的类建议生成一个serialVersionUID，他相当于一个类版本号，当类成员改变时，修改这个ID,这样，jdk能正确识别已序列化实例与当前类定义是否版本一致</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID<span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4>
<a id="42_IP_1281"></a>4.2 获取客户端IP地址</h4> 
<p>如果是nginx反向代理，tomcat服务器以为nginx是客户端，所以获取了nginx服务器的地址，</p> 
<p>如果要获取真是的客户端的IP地址，需要在nginx代理配置参数</p> 
<pre><code class="prism language-nginx">server {
    listen  80;
    server_name  localhost;
    location / {
        #root html;
        index index.html index.htm;
        proxy_pass http://tomcats;
        # 增加这个配置 ，把真实地客户端Ip地址放到请求头中,nginx 内置的环境变量：$remote_addr
        proxy_set_header X-Real-IP $remote_addr;        
    }
    
    ...

}
</code></pre> 
<p>设置了nginx从客户端中读取的ip,放到了请求头:"X-Real-IP"中，读取如下：</p> 
<pre><code class="prism language-java"><span class="token comment">//获取真实IP</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getIp</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> remoteIp <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">request<span class="token punctuation">.</span></span>GetRemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> headIp <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getheader</span><span class="token punctuation">(</span><span class="token string">"X-Real-IP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> headIp <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> remoteIp <span class="token operator">:</span> headIp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4>
<a id="43_nginx__1315"></a>4.3 nginx 中其他的信息</h4> 
<pre><code class="prism language-nginx">#负载均衡设置，将所有jsp请求发送到upstream backends 指定的服务器群上
location ~ .jsp$ {
    proxy_pass http://backends;
    
    #真实的客户端IP
    proxy_set_header  X-Real_IP    $remote_addr;
    #请求头中Host信息， http://www.test.tt/index.jsp，用户可以取到客户端真实正确的host地址
    proxy_set_header  Host         $host;
    #代理路由信息，此处取IP有安全隐患，整个代理的路由信息，是各个nginx 等的ip信息
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    #真实的用户访问协议
    proxy_set_header  X-Forwarded-Proto  $scheme;
    
    #默认值是default
    #后端response 302时，tomcat header中location的host是http://192.168.1.62:8080
    #因为tomcat收到的请求是nginx发过去的，nginx发起的请求url host是http://192.168.1.62:80
    #设置default后，nginx自动把响应有中的location host部分替换成当前用户请求的host部分
    #网上很多教程，将此值设置为 off 禁止了替换
    #这样用户浏览器收到302后，跳到http://192.168.1.62:8080,直接将后端服务器暴露给浏览器
    #所以除非特殊设置，否则不要做这种画蛇添足的操作
    proxy_redirect  default;
    
}
</code></pre> 
<h4>
<a id="44__1345"></a>4.4 动静分离结果的预规划</h4> 
<p>高并发，资源类的文件，脚本，样式表，文件，</p> 
<p>静态文件放到静态服务器，</p> 
<p>tomcat放到动态服务器中</p> 
<p>开发之前规划好。</p> 
<p>总结：</p> 
<p>负载均衡实现</p> 
<p>session管理</p> 
<h2>
<a id="5__1375"></a>5. 其他</h2> 
<h3>
<a id="Nginx_nginxalias_1377"></a>Nginx 配置中nginx和alias的区别分析</h3> 
<blockquote> 
 <p>root和alias都可以定义在location模块中，都是用来指定请求资源的真实路径;</p> 
 <p>root: <em><strong>*真实的路径是root指定的值加上location指定的值 。*</strong></em></p> 
 <p>alias: 正如其名，alias指定的路径是location的别名，不管location的值怎么写，资源的 <em><strong>*真实路径都是 alias 指定的路径*</strong></em></p> 
 <p>1、 alias 只能作用在location中，而root可以存在server、http和location中。</p> 
 <p>2、 alias 后面必须要用 “/” 结束，否则会找不到文件，而 root 则对 ”/” 可有可无。</p> 
</blockquote> 
<p>本小节参考博客： https://blog.csdn.net/tuoni123/article/details/79712246</p> 
<p>本文参考来源：极客学院<br> <strong>如有侵权，联系速删</strong></p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
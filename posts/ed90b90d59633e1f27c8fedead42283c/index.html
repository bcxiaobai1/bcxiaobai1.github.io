<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>深入浅出vite（一）--vite的优点及原理、性能优化 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深入浅出vite（一）--vite的优点及原理、性能优化</h1>
			
		</header>
		<div class="content post__content clearfix">
			


        
                <div id="content_views" class="markdown_views prism-atom-one-light">
                    
                        
                    
                    <blockquote> 
 <p>Vite 需要 Node.js 版本 14.18+，16+。然而，有些模板需要依赖更高的 Node 版本才能正常运行，当你的包管理器发出警告时，请注意升级你的 Node 版本。</p> 
</blockquote> 
<h2>
<a id="_1"></a>背景</h2> 
<p><code>webpack</code>支持多种模块化，将不同模块的依赖关系构建成依赖图来进行统一处理，当构建的项目越来越大时，需要处理的<code>JS</code>代码也越来越多，通常需要很长时间才可以启动开发服务器，即使使用模块热替换(<code>HMR</code>)，修改文件也需要几秒钟才能在浏览器中反映出来，影响了开发效率和幸福感。</p> 
<p><code>Vite</code>可以解决上述问题，它支持<code>ESM</code>规范，所以并不需要遍历依赖图，而是按需加载各种文件。</p> 
<p><img src="https://images2.imgbox.com/bf/fa/Hy0eaPa1_o.png" alt="vite和webpack开发环境下的差异"></p> 
<h2>
<a id="_7"></a>初体验</h2> 
<pre><code class="prism language-bash">mkidr vite-demo
<span class="token builtin class-name">cd</span> vite-demo
<span class="token function">npm</span> init -y
<span class="token function">npm</span> i lodash
</code></pre> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Vite demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./index.css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./index.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello Vite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<pre><code class="prism language-js"><span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> name <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./test'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-js"><span class="token comment">// test.js</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'Armouy'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-css"><span class="token selector">html, body</span><span class="token punctuation">{<!-- --></span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果借助<code>vscode</code>中的<code>live server</code>插件启动这个项目，会报错：</p> 
<pre><code class="prism language-bash">GET http://127.0.0.1:5500/test net::ERR_ABORTED <span class="token number">404</span> <span class="token punctuation">(</span>Not Found<span class="token punctuation">)</span>
</code></pre> 
<p>借助<code>vite</code>：</p> 
<pre><code class="prism language-bash"><span class="token function">npm</span> i vite --save-dev
</code></pre> 
<p>修改<code>package.json</code>:</p> 
<pre><code class="prism language-json"><span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"dev"</span><span class="token operator">:</span> <span class="token string">"vite"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token string">"vite build"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>执行<code>npm run dev</code>,控制台输出成功~</p> 
<h2>
<a id="Vite_65"></a><code>Vite</code>组成</h2> 
<p><code>vite</code>主要有以下两个功能：</p> 
<ul>
<li>一个开发服务器，基于原生<code>ESM</code>模块，省略了编译耗时，提供高效的模块热更新；</li>
<li>使用<code>Rollup</code>打包，支持配置，可输出用于生成环境的高度优化过的静态资源。</li>
</ul> 
<h2>
<a id="_70"></a>特点</h2> 
<p><code>vite</code>的最大的优点就是快，主要体现在以下两个方面：启动时间快和请求效率高。</p> 
<h3>
<a id="_72"></a>启动时间快的原因</h3> 
<ul>
<li>无需在启动前构建依赖关系图：<code>vite</code>采用<code>ESM</code>规范方式提供源码，只有在浏览器请求时才会进行转换，即按需提供；</li>
<li>预构建：<code>vite</code>在启动服务时会先预构建源码，将遇到的<code>CommonJS</code>或者<code>UMD</code>等模块化代码转为<code>ESM</code>规范，并保存在<code>node_module/.vite/deps</code>文件夹中；遇到多个<code>ESM</code>模块，会转为一个模块，比如<code>lodash-es</code>，不进行预构建，会一次性请求600次，预构建之后只会请求一次。</li>
</ul> 
<p>p.s. 对于<code>node_moduls</code>，浏览器时不支持<code>ESM</code>规范去请求它们的，如果支持的话会带来很大的网络性能问题，对于<code>ESM</code>里面具有其他依赖<code>ESM</code>的话，那么浏览器将会无限制地请求依赖库。<br> p.s. 在<code>vite</code>中也可以借助<code>optimizeDeps.exclude</code>字段来忽视某些内容的预构建。</p> 
<h3>
<a id="_78"></a>请求效率高的原因</h3> 
<ul>
<li>前面提到过，预构建的时候会将构建好结果缓存在<code>node_module/.vite/deps</code>文件夹中，<code>vite</code>中利用了<code>HTTP</code>头来优化加载效率，源码模块的请求会根据<code>304 Not Modified </code>进行协商缓存，而依赖模块请求则会通过 <code>Cache-Control: max-age=31536000,immutable</code> 进行强缓存，因此一旦被缓存它们将不需要再次请求;</li>
<li>
<code>HMR</code>热更新：（跟<code>webpack</code>一样，<code>vite</code>也有热更新机制，做法有些不一样，我们后面再讲）当编辑一个文件时，<code>vite</code>只需要精确地使已编辑模块与最近的<code>HMR</code>边界直接的链失活，就可以保持快速更新。</li>
</ul> 
<h2>
<a id="Vite_82"></a><code>Vite</code>如何识别文件</h2> 
<p><code>webpack</code>中通过借助<code>loader</code>去读取各种文件。而<code>vite</code>对于<code>css</code>的处理有自己的一套方式，在<code>vite</code>搭建<code>vue+ts</code>的项目中，<code>css</code>的引入最后都会转为这种模式：<br> <img src="https://images2.imgbox.com/05/ed/NmjAbKLU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/13/66/6yxWEoOk_o.png" alt="在这里插入图片描述"><br> 首先<code>vite</code>会使用<code>fs</code>模块读取.<code>css</code>文件的内容，然后创建一个<code>style</code>标签，将内容都怼到<code>style</code>标签内，再将这个标签插入到<code>index.html</code>中，最后还会将<code>.css</code>文件的内容转为<code>JS</code>脚本，便于<code>css</code>模块化和热更新，还避免了第三方工具对css的处理，提高了编译性能。</p> 
<p>对于其他静态资源文件，除了<code>svg</code>，<code>vite</code>都是做到了开箱即用，引入即可使用（<code>svg</code>会对路径进行处理，需要区分是按照图片加载，还是按照<code>svg</code>加载）。</p> 
<h2>
<a id="npm_run_dev_89"></a><code>npm run dev</code>的源码分析</h2> 
<p>本来想先写热更新等其他内容，想了想，还是先把源码分析写完，方便后面进行解释。<br> 首先先说一下调试的步骤，这里直接在已有的项目中，配置了调试文件<code>launch.json</code>，<code>program</code>指向了<code>vite</code>所在的路径(是的我用的<code>vscode</code>）：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 使用 IntelliSense 了解相关属性。 </span>
  <span class="token comment">// 悬停以查看现有属性的描述。</span>
  <span class="token comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span>
  <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"启动程序"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"skipFiles"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"&lt;node_internals&gt;/**"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">"program"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}\node_modules\vite\bin\vite.js"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"outFiles"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"${workspaceFolder}/**/*.js"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后打断点开始调试，指向<code>npm run dev</code>的时候会指向<code>vite/bin/vite.js</code>，其中又指向了<code>dist/node/cli.js</code>，根据源码可知，入口文件是哪个了~<br> <img src="https://images2.imgbox.com/41/b4/HvAl1HtX_o.png" alt="npm run dev入口文件"></p> 
<pre><code class="prism language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createServer</span><span class="token punctuation">(</span><span class="token parameter">inlineConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">_createServer</span><span class="token punctuation">(</span>inlineConfig<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">ws</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_createServer</span><span class="token punctuation">(</span><span class="token parameter">inlineConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">resolveConfig</span><span class="token punctuation">(</span>inlineConfig<span class="token punctuation">,</span> <span class="token string">'serve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>故一路分析下来，可以从<code>resolveConfig</code>开始看源码了：</p> 
<pre><code class="prism language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">resolveConfig</span><span class="token punctuation">(</span>inlineConfig<span class="token punctuation">,</span> command<span class="token punctuation">,</span> defaultMode <span class="token operator">=</span> <span class="token string">'development'</span><span class="token punctuation">,</span> defaultNodeEnv <span class="token operator">=</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// ...</span>
  
  <span class="token comment">/**
  * 先加载项目目录的配置文件，
  * 即vite.config.js、vite.config.mjs、vite.config.ts、vite.config.cjs其中一个
  * 如果找不到会报错
  * 如果找到了会对自定义配置和用户配置做合并
  */</span> 
  <span class="token keyword">const</span> loadResult <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadConfigFromFile</span><span class="token punctuation">(</span>configEnv<span class="token punctuation">,</span> configFile<span class="token punctuation">,</span> config<span class="token punctuation">.</span>root<span class="token punctuation">,</span> config<span class="token punctuation">.</span>logLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>loadResult<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      config <span class="token operator">=</span> <span class="token function">mergeConfig</span><span class="token punctuation">(</span>loadResult<span class="token punctuation">.</span>config<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
      configFile <span class="token operator">=</span> loadResult<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
      configFileDependencies <span class="token operator">=</span> loadResult<span class="token punctuation">.</span>dependencies<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  
  <span class="token comment">// ...</span>
  
  <span class="token comment">/**
  * 调整插件顺序，在vite中可以通过enforce: 'pre | post'来指定顺序，一般插件的顺序如下
  * 1. alias
  * 2. 带有enforce: pre的用户插件
  * 3. vite核心插件
  * 4. 没有带enforce值的用户插件
  * 5. vite构建用的插件
  * 6. 带有enforce: post的用户插件
  * 7. vite后置构建插件（最小化、manifest、报告等）
  */</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>prePlugins<span class="token punctuation">,</span> normalPlugins<span class="token punctuation">,</span> postPlugins<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sortUserPlugins</span><span class="token punctuation">(</span>rawUserPlugins<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 这里的config字段，可以在自定义插件的时候改写vite的一些配置</span>
  config <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">runConfigHook</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> userPlugins<span class="token punctuation">,</span> configEnv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// If there are custom commonjsOptions, don't force optimized deps for this test</span>
    <span class="token comment">// even if the env var is set as it would interfere with the playground specs.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>config<span class="token punctuation">.</span>build<span class="token operator">?.</span>commonjsOptions <span class="token operator">&amp;&amp;</span>
        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_TEST_WITHOUT_PLUGIN_COMMONJS</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        config <span class="token operator">=</span> <span class="token function">mergeConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">optimizeDeps</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">disabled</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">ssr</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">optimizeDeps</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">disabled</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span>build <span class="token operator">??</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>build <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>commonjsOptions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    
  <span class="token comment">// ...</span>

  <span class="token comment">/**
  * 处理alias，比如我配置了@指向src的配置，那么最后结果就是
  * find:
  * '@' replacement: 'D:\code\new\vue-admin\src'
  */</span>
  <span class="token keyword">const</span> resolvedAlias <span class="token operator">=</span> <span class="token function">normalizeAlias</span><span class="token punctuation">(</span><span class="token function">mergeAlias</span><span class="token punctuation">(</span>clientAlias<span class="token punctuation">,</span> config<span class="token punctuation">.</span>resolve<span class="token operator">?.</span>alias <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
  
  <span class="token comment">/**
  * 设置环境变量：
  * 读取环境变量，读取的优先级分别是 .env.[mode].local、.env.[mode]
  * 如果不存在对应 mode 的配置文件，则会尝试去寻找 .env.local、.env 配置文件
  * 读取到配置文件后，使用 doteenv 将环境变量写入到项目中；如果这些环境变量配置文件都不存在的话，则会返回一个空对象
  */</span>
  <span class="token keyword">const</span> userEnv <span class="token operator">=</span> inlineConfig<span class="token punctuation">.</span>envFile <span class="token operator">!==</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> envDir<span class="token punctuation">,</span> <span class="token function">resolveEnvPrefix</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...</span>
  
  <span class="token comment">// 整理构建配置</span>
  <span class="token keyword">const</span> resolvedBuildOptions <span class="token operator">=</span> <span class="token function">resolveBuildOptions</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>build<span class="token punctuation">,</span> logger<span class="token punctuation">,</span> resolvedRoot<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...</span>
  
  <span class="token comment">// resolvedConfig 是最后要导出的配置项</span>
  <span class="token keyword">const</span> resolvedConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/** 省略 */</span> <span class="token punctuation">}</span>
  <span class="token keyword">const</span> resolved <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token operator">...</span>config<span class="token punctuation">,</span>
        <span class="token operator">...</span>resolvedConfig<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> resolved<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>分析完<code>resolveConfig</code>可以回到<code>_createServer</code>方法：</p> 
<pre><code class="prism language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_createServer</span><span class="token punctuation">(</span><span class="token parameter">inlineConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 拿到了配置项</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">resolveConfig</span><span class="token punctuation">(</span>inlineConfig<span class="token punctuation">,</span> <span class="token string">'serve'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...以下讲解忽略服务端渲染</span>
  
  <span class="token comment">// 如果不是服务渲染，会创建一个http server用户本地开发调试，同时创建一个webscoket用于热重载</span>
  <span class="token keyword">const</span> httpServer <span class="token operator">=</span> middlewareMode
        <span class="token operator">?</span> <span class="token keyword">null</span>
        <span class="token operator">:</span> <span class="token keyword">await</span> <span class="token function">resolveHttpServer</span><span class="token punctuation">(</span>serverConfig<span class="token punctuation">,</span> middlewares<span class="token punctuation">,</span> httpsOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token function">createWebSocketServer</span><span class="token punctuation">(</span>httpServer<span class="token punctuation">,</span> config<span class="token punctuation">,</span> httpsOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token comment">// ...</span>
  <span class="token comment">// 监听本地项目文件的变动</span>
  <span class="token keyword">const</span> watcher <span class="token operator">=</span> chokidar<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>root<span class="token punctuation">,</span> <span class="token operator">...</span>config<span class="token punctuation">.</span>configFileDependencies<span class="token punctuation">,</span> config<span class="token punctuation">.</span>envDir<span class="token punctuation">]</span><span class="token punctuation">,</span> resolvedWatchOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建了一个server对象</span>
  <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/** 可以启动本地开发服务，也可以负责热重载  */</span> <span class="token punctuation">}</span>
  
  <span class="token comment">/**
  * 当文件发生改变的时候就会被wather监听到，然后调用onHMRUpdate方法
  * 而onHMRUpdate内部调用了handleHMRUpdate
  * handleHMRUpdate会触发插件热更新的钩子，去编译更新文件
  * 如果是需要全量更新则发送full-reload，否则发送update
  * 当客户端接收到full-reload则启动本地刷新，通过http加载全部资源（这里做了协商缓存）
  * 如果客户端接收的是update，则表示启动hmr,浏览器按需加载对饮的模块就行
  */</span>
  watcher<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        file <span class="token operator">=</span> <span class="token function">normalizePath$3</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// invalidate module graph cache on file change</span>
        moduleGraph<span class="token punctuation">.</span><span class="token function">onFileChange</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token function">onHMRUpdate</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token comment">// 在不同的生命周期指调用不同的插件...</span>
  
  <span class="token comment">// 对内部中间件的处理...通过 connect 库提供开发服务器，通过中间件机制实现多项开发服务器配置</span>
  
  <span class="token comment">// 最后就是进行预构建依赖，使用esbuild预构建它们，并将 CommonJS / UMD 转换为 ESM 格式</span>
  <span class="token keyword">const</span> <span class="token function-variable function">initServer</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ..</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDepsOptimizerEnabled</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">await</span> <span class="token function">initDepsOptimizer</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> server<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">// ..</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> initingServer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>关于<code>npm run build</code>，其实流程也差不多，源码就不逐行分析了(有兴趣自行查看~)：</p> 
<ul>
<li>使用<code>resolveConfig</code>收集了命令行配置、读取配置文件并合并配置；</li>
<li>处理插件的的顺序、合并插件并设置环境变量；</li>
<li>生成<code>rollup</code>构建配置；</li>
<li>使用<code>rollup</code>编译产物并输出到指定目录。</li>
</ul> 
<h2>
<a id="_270"></a>预构建原理</h2> 
<p><code>vite</code>借助<code>esbuild</code>进行了预构建，转换<code>ts、jsx、tsx</code>等，预构建有两种操作方式：</p> 
<ol>
<li>可以通过命令行<code>vite optimize</code>手动预解析</li>
<li>在<code>createServer</code>（<code>npm run dev</code>会执行）中也会进行预构建</li>
</ol> 
<p>从源码上可以看出，主要流程简单概括即：</p> 
<ul>
<li>对项目中的依赖进行扫描，并存放在一个<code>deps</code>中；</li>
<li>先把<code>deps</code>拍平成一维数组，调用<code>build.context</code>进行打包，输出打包的映射对象<code>result</code>；</li>
<li>最后得到的依赖结果会被缓存起来，并存放在<code>node_module/.vite/deps</code>目录下。</li>
</ul> 
<p>在<code>node_module/.vite/deps</code>下有一个<code>_metadata.json</code>，这个文件可以根据请求路径，找到对应的预构建之后的文件：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"hash"</span><span class="token operator">:</span> <span class="token string">"2266f73a"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"browserHash"</span><span class="token operator">:</span> <span class="token string">"20efa1a5"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"optimized"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"@element-plus/icons-vue"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"src"</span><span class="token operator">:</span> <span class="token string">"../../@element-plus/icons-vue/dist/index.js"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"file"</span><span class="token operator">:</span> <span class="token string">"@element-plus_icons-vue.js"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"fileHash"</span><span class="token operator">:</span> <span class="token string">"32dcf906"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"needsInterop"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"axios"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"src"</span><span class="token operator">:</span> <span class="token string">"../../axios/index.js"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"file"</span><span class="token operator">:</span> <span class="token string">"axios.js"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"fileHash"</span><span class="token operator">:</span> <span class="token string">"2061b9bb"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"needsInterop"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"element-plus"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"src"</span><span class="token operator">:</span> <span class="token string">"../../element-plus/es/index.mjs"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"file"</span><span class="token operator">:</span> <span class="token string">"element-plus.js"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"fileHash"</span><span class="token operator">:</span> <span class="token string">"123c11eb"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"needsInterop"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"chunks"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"chunk-5OBJFL24"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"file"</span><span class="token operator">:</span> <span class="token string">"chunk-5OBJFL24.js"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="HMR_315"></a>热更新（<code>HMR</code>）原理</h2> 
<p>热更新指的是自动对页面上更改的模块进行替换，以达到刷新页面数据的效果，这个效果甚至是无感的。由上面的源码不难看出：</p> 
<ul>
<li>
<code>vite</code>先执行<code>createWebSocketServer</code>创建一个<code>webscoket</code>服务端，并监听<code>change</code>事件；</li>
<li>
<code>vite</code>在创建<code>client.mjs</code>文件时，会合并合并<code>UserConfig</code>配置，通过<code>transformIndexHtml</code>钩子函数，在转换<code>index.html</code>，这时会将<code>client</code>的代码注入到<code>index.html</code>中，这样浏览器访问<code>index.html</code>就会加载<code>client</code>生成代码，创建<code>client</code>和<code>webscoket</code>的的链接，便于接收<code>webscoket</code>服务端消息；</li>
<li>当服务端监听文件变化的时候，就会给<code>client</code>发送消息，同时调用服务端调用<code>onHMRUpdate</code>函数，该函数会根据此次修改文件的类型，通知客户端是要刷新还是重新加载文件。</li>
</ul> 
<h2>
<a id="Esbuild_322"></a>打包不选择<code>Esbuild</code>的原因</h2> 
<p>由于生产环境中，<code>ESM</code>的机制会导致额外的网络往返导致效率低下，故最好还是将代码进行进行<code> tree-shaking</code>、懒加载和 <code>chunk</code> 分割（以获得更好的缓存)。<code>Vite</code>目前的插件 <code>API</code> 与使用 <code>esbuild</code> 作为打包器并不兼容。尽管 <code>esbuild</code>速度更快，但 <code>Vite</code> 采用了 <code>Rollup</code> 灵活的插件 <code>API</code> 和基础建设， <code>Rollup</code> 提供了更好的性能与灵活性方面的权衡。</p> 
<h2>
<a id="_325"></a>性能优化</h2> 
<h3>
<a id="_326"></a>分包策略</h3> 
<p>正常情况下我们项目打包的时候，业务代码会跟第三方代码糅合咋一起，如果业务代码经常变，就会导致每次打包都会重新打包所有文件，会造成浏览器缓存失效，如果使用分包策略，将第三方代码单独打包，那么就可以解决上述问题：</p> 
<pre><code class="prism language-js"><span class="token comment">// vite.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span> 
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span> 
      <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span> 
        <span class="token literal-property property">assetFileNames</span><span class="token operator">:</span><span class="token string">"[name]-[hash].[ext]"</span><span class="token punctuation">,</span> 
        <span class="token function-variable function">manualChunks</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span> 
          <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token string">'vendor'</span> 
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>



</code></pre> 
<h3>
<a id="gzip_350"></a><code>gzip</code>压缩策略</h3> 
<p>服务端对资源进行压缩，浏览器对资源进行解压。但是要注意，如果如果文件不是很大的话，开启这个插件，反而会由于浏览器解压文件，浪费时间。</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> viteCompression <span class="token keyword">from</span> <span class="token string">'vite-plugin-compression'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> defineConfig （<span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">viteCompression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>）

</code></pre> 
<h3>
<a id="cdn_362"></a><code>cdn</code>加速</h3> 
<p><code>cdn</code>策略简单讲就是多台服务器具有该资源，用户请求的时候会优先请求距离你距离最近的一台资源。跟<code>webpack</code>的优化策略一样，这里的前提是公司比较有钱哈哈哈，不然靠免费的cdn可能会遇到“挂掉”的风险。</p> 
<h2>
<a id="_365"></a>总结</h2> 
<p>本文学习了<code>vite</code>的优点、简单分析了优点背后实现的原理，以及还有性能优化的方案。</p> 
<h2>
<a id="_367"></a>参考</h2> 
<ul>
<li><a href="https://cn.vitejs.dev/">vite官网</a></li>
<li><a href="https://github.com/vitejs/vite">vite源码</a></li>
<li>
<a href="https://github.com/a1029563229/blogs/blob/master/Source-Code/vite/1.md">晒兜斯</a>（他的Vite系列很干货）</li>
<li><a href="https://juejin.cn/column/7144276262406586398">前端构建工具vite进阶系列</a></li>
</ul> 
<hr> 
<p>如有错误，欢迎指出，感谢阅读~</p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
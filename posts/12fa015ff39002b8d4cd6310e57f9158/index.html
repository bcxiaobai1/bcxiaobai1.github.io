<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Docker 大势已去，Podman 即将崛起 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker 大势已去，Podman 即将崛起</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    
                        
                    
                    <p></p>
<div class="toc">
 <h3>Podman</h3>
 <ul>
<li><a href="#Podman_1">Podman</a></li>
<li>
<ul>
<li><a href="#Podman_2">什么是Podman？</a></li>
<li><a href="#PodmanDocker_10">Podman和Docker的主要区别是什么？</a></li>
<li><a href="#Podmandocker_21">Podman的使用与docker有什么区别？</a></li>
</ul>
  </li>
<li><a href="#Podman__27">Podman 常用命令</a></li>
<li>
<ul>
<li><a href="#_28">容器</a></li>
<li><a href="#_43">镜像</a></li>
<li><a href="#_Podman_64">部署 Podman</a></li>
<li><a href="#Podman__69">Podman 加速器</a></li>
<li><a href="#_Podman_90">使用 Podman</a></li>
<li>
<ul>
<li><a href="#_94">运行一个容器</a></li>
<li><a href="#_116">列出运行的容器</a></li>
<li><a href="#_124">检查正在运行的容器</a></li>
<li><a href="#_138">查看一个运行中容器的日志</a></li>
<li><a href="#_153">查看一个运行容器中的进程资源使用情况</a></li>
<li><a href="#_167">停止一个运行中的容器</a></li>
<li><a href="#_176">删除一个容器</a></li>
<li><a href="#_185">上传镜像</a></li>
<li><a href="#_257">配置别名</a></li>
</ul>
   </li>
<li><a href="#_269">用户操作</a></li>
<li>
<ul>
<li><a href="#slirp4netnsfuseoverlayfs_291">安装slirp4netns和fuse-overlayfs</a></li>
<li><a href="#_etc__subuid_etc__subgid_300">/ etc / subuid和/ etc / subgid配置</a></li>
<li><a href="#_334">用户配置文件</a></li>
<li><a href="#root_397">普通用户是无法看见root用户的镜像的</a></li>
</ul>
   </li>
<li><a href="#_409">卷</a></li>
<li>
<ul>
<li><a href="#_414">使用卷</a></li>
<li><a href="#_437">在主机上查看</a></li>
<li><a href="#_449">容器里查看</a></li>
</ul>
  </li>
</ul>
 </li>
</ul>
</div>
<p></p> 
<h1>
<a id="Podman_1"></a>Podman</h1> 
<h2>
<a id="Podman_2"></a>什么是Podman？</h2> 
<p><img src="https://images2.imgbox.com/e5/db/9IRO4eeL_o.png" alt="在这里插入图片描述"></p> 
<p>Podman 是一个开源的容器运行时项目，可在大多数 Linux 平台上使用。Podman 提供与 Docker 非常相似的功能。正如前面提到的那样，它不需要在你的系统上运行任何守护进程，并且它也可以在没有 root 权限的情况下运行。</p> 
<p>Podman 可以管理和运行任何符合 OCI（Open Container Initiative）规范的容器和容器镜像。Podman 提供了一个与 Docker 兼容的命令行前端来管理 Docker 镜像。</p> 
<p><a href="https://podman.io/">Podman 官网地址：https://podman.io/</a></p> 
<h2>
<a id="PodmanDocker_10"></a>Podman和Docker的主要区别是什么？</h2> 
<ul>
<li>dockers在实现CRI的时候，它需要一个守护进程，其次需要以root运行，因此这也带来了安全隐患。</li>
<li>podman不需要守护程序，也不需要root用户运行，从逻辑架构上，比docker更加合理。</li>
<li>在docker的运行体系中，需要多个daemon才能调用到OCI的实现RunC。</li>
<li>在容器管理的链路中，Docker Engine的实现就是dockerd</li>
<li>daemon，它在linux中需要以root运行，dockerd调用containerd，containerd调用containerd-shim，然后才能调用runC。顾名思义shim起的作用也就是“垫片”，避免父进程退出影响容器的运训</li>
<li>podman直接调用OCI,runtime（runC），通过common作为容器进程的管理工具，但不需要dockerd这种以root身份运行的守护进程。</li>
<li>在podman体系中，有个称之为common的守护进程，其运行路径通常是/usr/libexec/podman/conmon，它是各个容器进程的父进程，每个容器各有一个，common的父则通常是1号进程。podman中的common其实相当于docker体系中的containerd-shim。<br> <img src="https://images2.imgbox.com/39/d7/H0xZ8AoM_o.png" alt="在这里插入图片描述"><br> 图中所体现的事情是，podman不需要守护进程，而dorker需要守护进程。在这个图的示意中，dorcker的containerd-shim与podman的common被归在Container一层。</li>
</ul> 
<h2>
<a id="Podmandocker_21"></a>Podman的使用与docker有什么区别？</h2> 
<p>podman的定位也是与docker兼容，因此在使用上面尽量靠近docker。在使用方面，可以分成两个方面来说，一是系统构建者的角度，二是使用者的角度。<br> 在系统构建者方面，用podman的默认软件，与docker的区别不大，只是在进程模型、进程关系方面有所区别。如果习惯了docker几个关联进程的调试方法，在podman中则需要适应。可以通过pstree命令查看进程的树状结构。总体来看，podman比docker要简单。由于podman比docker少了一层daemon，因此重启的机制也就不同了。<br> 在使用者方面，podman与docker的命令基本兼容，都包括容器运行时（run/start/kill/ps/inspect），本地镜像（images/rmi/build）、镜像仓库（login/pull/push）等几个方面。因此podman的命令行工具与docker类似，比如构建镜像、启停容器等。甚至可以通过alias<br> docker=podman可以进行替换。因此，即便使用了podman，仍然可以使用docker.io作为镜像仓库，这也是兼容性最关键的部分。</p> 
<h1>
<a id="Podman__27"></a>Podman 常用命令</h1> 
<h2>
<a id="_28"></a>容器</h2> 
<pre><code class="prism language-python">podman run           创建并启动容器
podman start         启动容器
podman ps            查看容器
podman stop          终止容器
podman restart       重启容器
podman attach        进入容器
podman <span class="token keyword">exec</span>          进入容器
podman export        导出容器
podman <span class="token keyword">import</span>        导入容器快照
podman rm            删除容器
podman logs          查看日志
</code></pre> 
<h2>
<a id="_43"></a>镜像</h2> 
<pre><code class="prism language-python">podman search                检索镜像
podman pull                  获取镜像
podman images                列出镜像
podman image Is              列出镜像
podman rmi                   删除镜像
podman image rm              删除镜像
podman save                  导出镜像
podman load                  导入镜像
podmanfile                   定制镜像（三个）
	podman build             构建镜像
    podman run               运行镜像
    podmanfile               常用指令（四个）
    	COPY                 复制文件
        ADD                  高级复制
        CMD                  容器启动命令
        ENV                  环境变量
        EXPOSE               暴露端口
</code></pre> 
<h2>
<a id="_Podman_64"></a>部署 Podman</h2> 
<pre><code class="prism language-python"><span class="token operator">//</span>安装podman
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install podman</span>
</code></pre> 
<h2>
<a id="Podman__69"></a>Podman 加速器</h2> 
<p><strong>版本7配置加速器</strong></p> 
<pre><code class="prism language-python"><span class="token operator">//</span>仓库配置
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># vim /etc/containers/registries.conf</span>
<span class="token punctuation">[</span>registries<span class="token punctuation">.</span>search<span class="token punctuation">]</span>
<span class="token comment">#registries = ["registry.access.redhat.com", "registry.redhat.io", "docker.io"]	 #这个是查找，从这三个地方查找</span>

registries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"docker.io"</span><span class="token punctuation">]</span>		<span class="token comment">#如果只留一个，则只在一个源里查找</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>docker<span class="token punctuation">.</span>io<span class="token punctuation">]</span><span class="token punctuation">]</span>
location<span class="token operator">=</span><span class="token string">"j3m2itm3.mirror.aliyuncs.com"</span>
</code></pre> 
<p><strong>版本8配置加速器</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#unqualified-search-registries = ["registry.fedoraproject.org", "registry.access.redhat.com", "registry.centos.org", "docker.io"] 		#直接注释掉</span>
unqualified<span class="token operator">-</span>search<span class="token operator">-</span>registries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"docker.io"</span><span class="token punctuation">]</span>		<span class="token comment">#添加一个docker.io</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>registry<span class="token punctuation">]</span><span class="token punctuation">]</span>
prefix <span class="token operator">=</span> <span class="token string">"docker.io"</span>
location <span class="token operator">=</span> <span class="token string">"j3m2itm3.mirror.aliyuncs.com"</span> （不用加https<span class="token punctuation">:</span><span class="token operator">//</span>  直接加地址）
</code></pre> 
<h2>
<a id="_Podman_90"></a>使用 Podman</h2> 
<p>使用 Podman 非常的简单，Podman 的指令跟 Docker 大多数都是相同的。下面我们来看几个常用的例子：</p> 
<h3>
<a id="_94"></a>运行一个容器</h3> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman run -d --name httpd docker.io/library/httpd</span>
Trying to pull docker<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>httpd<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Getting image source signatures
Copying blob e5ae68f74026 done  
Copying blob d3576f2b6317 done  
Copying blob bc36ee1127ec done  
Copying blob f1aa5f54b226 done  
Copying blob aa379c0cedc2 done  
Copying config ea28e1b82f done  
Writing manifest to image destination
Storing signatures
<span class="token number">0492e405b9ecb05e6e6be1fec0ac1a8b6ba3ff949df259b45146037b5f355035</span>

<span class="token operator">//</span>查看镜像
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman images</span>
REPOSITORY                  TAG      IMAGE ID       CREATED       SIZE
docker<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>httpd     latest   ea28e1b82f31   <span class="token number">11</span> days ago   <span class="token number">148</span> MB
</code></pre> 
<h3>
<a id="_116"></a>列出运行的容器</h3> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman ps</span>
CONTAINER ID  IMAGE                             COMMAND           CREATED             STATUS                 PORTS  NAMES
<span class="token number">0492e405b9ec</span>  docker<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>httpd<span class="token punctuation">:</span>latest    httpd<span class="token operator">-</span>foreground  About a minute ago  Up About a minute ago         httpd
</code></pre> 
<p>注意：如果在ps命令中添加-a，Podman 将显示所有容器。</p> 
<h3>
<a id="_124"></a>检查正在运行的容器</h3> 
<p>您可以“检查”正在运行的容器的元数据和有关其自身的详细信息。我们甚至可以使用 inspect 子命令查看分配给容器的 IP 地址。由于容器以无根模式运行，因此未分配 IP 地址，并且该值将在检查的输出中列为“无”。</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman inspect -l | grep IPAddress": </span>
            <span class="token string">"SecondaryIPAddresses"</span><span class="token punctuation">:</span> null<span class="token punctuation">,</span> 
            <span class="token string">"IPAddress"</span><span class="token punctuation">:</span> <span class="token string">"10.88.0.5"</span><span class="token punctuation">,</span>

<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># curl 10.88.0.5</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>It works!<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<p>注意： -l 是最新容器的便利参数。您还可以使用容器的 ID 代替 -l。</p> 
<h3>
<a id="_138"></a>查看一个运行中容器的日志</h3> 
<pre><code class="prism language-python">选项
	<span class="token operator">-</span><span class="token operator">-</span>latest		<span class="token comment">#最近的</span>
	
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman logs --latest</span>
AH00558<span class="token punctuation">:</span> httpd<span class="token punctuation">:</span> Could <span class="token keyword">not</span> reliably determine the serve<span class="token string">r's fully qualified domain name, using 10.88.0.5. Set the '</span>ServerName' directive globally to suppress this message
AH00558<span class="token punctuation">:</span> httpd<span class="token punctuation">:</span> Could <span class="token keyword">not</span> reliably determine the serve<span class="token string">r's fully qualified domain name, using 10.88.0.5. Set the '</span>ServerName' directive globally to suppress this message
<span class="token punctuation">[</span>Mon Dec <span class="token number">13</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token number">53.690844</span> <span class="token number">2021</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>mpm_event<span class="token punctuation">:</span>notice<span class="token punctuation">]</span> <span class="token punctuation">[</span>pid <span class="token number">1</span><span class="token punctuation">:</span>tid <span class="token number">140665160166720</span><span class="token punctuation">]</span> AH00489<span class="token punctuation">:</span> Apache<span class="token operator">/</span><span class="token number">2.4</span><span class="token number">.51</span> <span class="token punctuation">(</span>Unix<span class="token punctuation">)</span> configured <span class="token operator">-</span><span class="token operator">-</span> resuming normal operations
<span class="token punctuation">[</span>Mon Dec <span class="token number">13</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token number">53.690946</span> <span class="token number">2021</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>core<span class="token punctuation">:</span>notice<span class="token punctuation">]</span> <span class="token punctuation">[</span>pid <span class="token number">1</span><span class="token punctuation">:</span>tid <span class="token number">140665160166720</span><span class="token punctuation">]</span> AH00094<span class="token punctuation">:</span> Command line<span class="token punctuation">:</span> <span class="token string">'httpd -D FOREGROUND'</span>
<span class="token number">10.88</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token operator">/</span>Dec<span class="token operator">/</span><span class="token number">2021</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">48</span> <span class="token operator">+</span><span class="token number">0000</span><span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">45</span>
<span class="token number">10.88</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token operator">/</span>Dec<span class="token operator">/</span><span class="token number">2021</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">47</span> <span class="token operator">+</span><span class="token number">0000</span><span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">45</span>
</code></pre> 
<h3>
<a id="_153"></a>查看一个运行容器中的进程资源使用情况</h3> 
<p>可以使用top观察容器中的 nginx pid</p> 
<pre><code class="prism language-python">语法：
	podman top <span class="token operator">&lt;</span>container_id<span class="token operator">&gt;</span>  
	
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman top httpd</span>
USER       PID   PPID   <span class="token operator">%</span>CPU    ELAPSED            TTY   TIME   COMMAND
root       <span class="token number">1</span>     <span class="token number">0</span>      <span class="token number">0.000</span>   15m38<span class="token punctuation">.</span>599711321s   ?     0s     httpd <span class="token operator">-</span>DFOREGROUND 
www<span class="token operator">-</span>data   <span class="token number">7</span>     <span class="token number">1</span>      <span class="token number">0.000</span>   15m38<span class="token punctuation">.</span>599783256s   ?     0s     httpd <span class="token operator">-</span>DFOREGROUND 
www<span class="token operator">-</span>data   <span class="token number">8</span>     <span class="token number">1</span>      <span class="token number">0.000</span>   15m38<span class="token punctuation">.</span>599845342s   ?     0s     httpd <span class="token operator">-</span>DFOREGROUND 
www<span class="token operator">-</span>data   <span class="token number">9</span>     <span class="token number">1</span>      <span class="token number">0.000</span>   15m38<span class="token punctuation">.</span>599880444s   ?     0s     httpd <span class="token operator">-</span>DFOREGROUND 
</code></pre> 
<h3>
<a id="_167"></a>停止一个运行中的容器</h3> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman stop --latest</span>
<span class="token number">2f3edf712621d3a41e03fa8c7f6a5cdba56fbbad43a7a59ede26cc88f31006c4</span>
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman ps</span>
CONTAINER ID  IMAGE  COMMAND  CREATED  STATUS  PORTS  NAMES
</code></pre> 
<h3>
<a id="_176"></a>删除一个容器</h3> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman rm --latest</span>
<span class="token number">2f3edf712621d3a41e03fa8c7f6a5cdba56fbbad43a7a59ede26cc88f31006c4</span>
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman ps -a</span>
CONTAINER ID  IMAGE  COMMAND  CREATED  STATUS  PORTS  NAMES
</code></pre> 
<p><code>以上这些特性基本上都和 Docker 一样，Podman 除了兼容这些特性外，还支持了一些新的特性。</code></p> 
<h3>
<a id="_185"></a>上传镜像</h3> 
<p><strong>例如，如果我们想在 docker.io 上分享我们新建的 Nginx 容器镜像，这很容易。首先登录码头：</strong></p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># tree </span>
<span class="token punctuation">.</span>
├── Dockerfile
└── files
    └── nginx<span class="token operator">-</span><span class="token number">1.20</span><span class="token number">.1</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz

<span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span>
FROM docker<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>centos

ENV PATH <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>sbin<span class="token punctuation">:</span>$PATH
ADD files<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.20</span><span class="token number">.1</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">/</span>usr<span class="token operator">/</span>src
RUN useradd <span class="token operator">-</span>r <span class="token operator">-</span>M <span class="token operator">-</span>s <span class="token operator">/</span>sbin<span class="token operator">/</span>nologin nginx <span class="token operator">&amp;</span><span class="token operator">&amp;</span> 
    yum <span class="token operator">-</span>y install pcre<span class="token operator">-</span>devel openssl openssl<span class="token operator">-</span>devel gd<span class="token operator">-</span>devel gcc gcc<span class="token operator">-</span>c<span class="token operator">+</span><span class="token operator">+</span> make <span class="token operator">&amp;</span><span class="token operator">&amp;</span> 
    mkdir <span class="token operator">-</span>p <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx <span class="token operator">&amp;</span><span class="token operator">&amp;</span> 
    cd <span class="token operator">/</span>usr<span class="token operator">/</span>src<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.20</span><span class="token number">.1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> 
    <span class="token punctuation">.</span><span class="token operator">/</span>configure 
    <span class="token operator">-</span><span class="token operator">-</span>prefix<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx 
    <span class="token operator">-</span><span class="token operator">-</span>user<span class="token operator">=</span>nginx 
    <span class="token operator">-</span><span class="token operator">-</span>group<span class="token operator">=</span>nginx 
    <span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>debug 
    <span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>http_ssl_module 
    <span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>http_realip_module 
    <span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>http_image_filter_module 
    <span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>http_gunzip_module 
    <span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>http_gzip_static_module 
    <span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>http_stub_status_module 
    <span class="token operator">-</span><span class="token operator">-</span>http<span class="token operator">-</span>log<span class="token operator">-</span>path<span class="token operator">=</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>access<span class="token punctuation">.</span>log 
    <span class="token operator">-</span><span class="token operator">-</span>error<span class="token operator">-</span>log<span class="token operator">-</span>path<span class="token operator">=</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>error<span class="token punctuation">.</span>log <span class="token operator">&amp;</span><span class="token operator">&amp;</span> 
  make <span class="token operator">&amp;</span><span class="token operator">&amp;</span> make install

CMD <span class="token punctuation">[</span><span class="token string">"nginx"</span><span class="token punctuation">,</span><span class="token string">"-g"</span><span class="token punctuation">,</span><span class="token string">"daemon off"</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># podman build -t nginx .</span>

<span class="token operator">//</span> 修改镜像名
 <span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman tag docker.io/library/nginx:latest docker.io/1314444/test:latest</span>

<span class="token operator">//</span> 登录并上传镜像
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman login docker.io // 需要告诉其要登录到docker仓库</span>
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman login docker.io</span>
Username<span class="token punctuation">:</span> <span class="token number">1314444</span>		<span class="token comment">#账户</span>
Password<span class="token punctuation">:</span> <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>		<span class="token comment">#密码</span>
Login Succeeded!

<span class="token punctuation">[</span>root@localhost nginx<span class="token punctuation">]</span><span class="token comment"># podman push docker.io/1314444/test:latest  //上传镜像</span>
Getting image source signatures
Copying blob <span class="token number">38c40d6c2c85</span> done
Copying blob fee76a531659 done
Copying blob c2adabaecedb done
Copying config <span class="token number">7f3589c0b8</span> done
Writing manifest to image destination
Copying config <span class="token number">7f3589c0b8</span> done
Writing manifest to image destination
Storing signatures


<span class="token operator">//</span>请注意，我们将四层推送到我们的注册表，现在可供其他人共享。快速浏览一下：
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman inspect 1314444/test:nginx</span>
<span class="token operator">//</span>输出：
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Id"</span><span class="token punctuation">:</span> <span class="token string">"7f3589c0b8849a9e1ff52ceb0fcea2390e2731db9d1a7358c2f5fad216a48263"</span><span class="token punctuation">,</span>
        <span class="token string">"Digest"</span><span class="token punctuation">:</span> <span class="token string">"sha256:7822b5ba4c2eaabdd0ff3812277cfafa8a25527d1e234be028ed381a43ad5498"</span><span class="token punctuation">,</span>
        <span class="token string">"RepoTags"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">"docker.io/1314444/test:nginx"</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>总而言之，Podman 使查找、运行、构建和共享容器变得容易。</p> 
<h3>
<a id="_257"></a>配置别名</h3> 
<p>如果习惯了使用 Docker 命令，可以直接给 Podman 配置一个别名来实现无缝转移。你只需要在 .bashrc 下加入以下行内容即可：</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># echo "alias docker=podman" &gt;&gt; .bashrc</span>
source <span class="token punctuation">.</span>bashrc
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># alias</span>
alias cp<span class="token operator">=</span><span class="token string">'cp -i'</span>
alias docker<span class="token operator">=</span><span class="token string">'podman'</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<h2>
<a id="_269"></a>用户操作</h2> 
<p>在允许没有root特权的用户运行Podman之前，管理员必须安装或构建Podman并完成以下配置<br> cgroup V2Linux内核功能允许用户限制普通用户容器可以使用的资源，如果使用cgroupV2启用了运行Podman的Linux发行版，则可能需要更改默认的OCI运行时。某些较旧的版本runc不适用于cgroupV2，必须切换到备用OCI运行时crun。</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install crun     //centos8系统自带</span>

<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># vi /usr/share/containers/containers.conf </span>
    <span class="token number">446</span> <span class="token comment"># Default OCI runtime</span>
    <span class="token number">447</span> <span class="token comment"># </span>
    <span class="token number">448</span> runtime <span class="token operator">=</span> <span class="token string">"crun"</span>      <span class="token operator">//</span>取消注释并将runc改为crun

<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman run -d --name web -p 80:80 docker.io/library/nginx</span>
c8664d2e43c872e1e5219f82d41f63048ed3a5ed4fb6259c225a14d6c243677f

<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman inspect web | grep crun</span>
        <span class="token string">"OCIRuntime"</span><span class="token punctuation">:</span> <span class="token string">"crun"</span><span class="token punctuation">,</span>
            <span class="token string">"crun"</span><span class="token punctuation">,</span>
</code></pre> 
<h3>
<a id="slirp4netnsfuseoverlayfs_291"></a>安装slirp4netns和fuse-overlayfs</h3> 
<p>在普通用户环境中使用Podman时，建议使用fuse-overlayfs而不是VFS文件系统，至少需要版本0.7.6。现在新版本默认就是了。</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install slirp4netns</span>

<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install fuse-overlayfs</span>
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># vi /etc/containers/storage.conf</span>
<span class="token number">77</span> mount_program <span class="token operator">=</span> <span class="token string">"/usr/bin/fuse-overlayfs"</span>     <span class="token operator">//</span>取消注释
</code></pre> 
<h3>
<a id="_etc__subuid_etc__subgid_300"></a>/ etc / subuid和/ etc / subgid配置</h3> 
<p>Podman要求运行它的用户在/ etc / subuid和/ etc / subgid文件中列出一系列UID,shadow-utils或newuid包提供这些文件</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># yum -y install shadow-utils</span>

可以在<span class="token operator">/</span> etc <span class="token operator">/</span> subuid和<span class="token operator">/</span> etc <span class="token operator">/</span> subgid查看，每个用户的值必须唯一且没有任何重叠。

<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># useradd zz</span>
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat /etc/subuid</span>
zz<span class="token punctuation">:</span><span class="token number">100000</span><span class="token punctuation">:</span><span class="token number">65536</span>
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat /etc/subgid</span>
zz<span class="token punctuation">:</span><span class="token number">100000</span><span class="token punctuation">:</span><span class="token number">65536</span>

<span class="token operator">//</span> 启动非特权ping 
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># sysctl -w "net.ipv4.ping_group_range=0 200000" //大于100000这个就表示tom可以操作podman</span>
net<span class="token punctuation">.</span>ipv4<span class="token punctuation">.</span>ping_group_range <span class="token operator">=</span> <span class="token number">0</span> <span class="token number">200000</span>
</code></pre> 
<ul><li> <p>这个文件的格式是 USERNAME:UID:RANGE</p> 
  <ul>
<li>中/etc/passwd或输出中列出的用户名getpwent。</li>
<li>为用户分配的初始 UID。</li>
<li>为用户分配的 UID 范围的大小。</li>
</ul> </li></ul> 
<p>该usermod程序可用于为用户分配 UID 和 GID，而不是直接更新文件。</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># usermod --add-subuids 200000-201000 --add-subgids 200000-201000 hh</span>
grep hh <span class="token operator">/</span>etc<span class="token operator">/</span>subuid <span class="token operator">/</span>etc<span class="token operator">/</span>subgid
<span class="token operator">/</span>etc<span class="token operator">/</span>subuid<span class="token punctuation">:</span>hh<span class="token punctuation">:</span><span class="token number">200000</span><span class="token punctuation">:</span><span class="token number">1001</span>
<span class="token operator">/</span>etc<span class="token operator">/</span>subgid<span class="token punctuation">:</span>hh<span class="token punctuation">:</span><span class="token number">200000</span><span class="token punctuation">:</span><span class="token number">1001</span>
</code></pre> 
<h3>
<a id="_334"></a>用户配置文件</h3> 
<p>三个主要的配置文件是<code>container.conf</code>、<code>storage.conf</code>和<code>registries.conf</code>。用户可以根据需要修改这些文件。<br> <strong>container.conf</strong></p> 
<pre><code class="prism language-python"><span class="token operator">//</span> 用户配置文件
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat /usr/share/containers/containers.conf</span>
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat /etc/containers/containers.conf</span>
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat ~/.config/containers/containers.conf  //优先级最高</span>
</code></pre> 
<p>如果它们以该顺序存在。每个文件都可以覆盖特定字段的前一个文件。</p> 
<p><strong>配置storage.conf文件</strong></p> 
<pre><code class="prism language-python"><span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span>etc<span class="token operator">/</span>containers<span class="token operator">/</span>storage<span class="token punctuation">.</span>conf
<span class="token number">2</span><span class="token punctuation">.</span>$HOME<span class="token operator">/</span><span class="token punctuation">.</span>config<span class="token operator">/</span>containers<span class="token operator">/</span>storage<span class="token punctuation">.</span>conf
</code></pre> 
<p>在普通用户中<code>/etc/containers/storage.conf</code>的一些字段将被忽略</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment">#  vi /etc/containers/storage.conf</span>
<span class="token punctuation">[</span>storage<span class="token punctuation">]</span>

<span class="token comment"># Default Storage Driver, Must be set for proper operation.</span>
driver <span class="token operator">=</span> <span class="token string">"overlay"</span>		<span class="token comment">#此处改为overlay</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
mount_program <span class="token operator">=</span> <span class="token string">"/usr/bin/fuse-overlayfs"</span>		<span class="token comment">#取消注释</span>

<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># sysctl user.max_user_namespaces=15000  #如果版本为8以下，则需要做以下操作：</span>
</code></pre> 
<p>在普通用户中这些字段默认</p> 
<pre><code class="prism language-python">graphroot<span class="token operator">=</span><span class="token string">"$HOME/.local/share/containers/storage"</span>
runroot<span class="token operator">=</span><span class="token string">"$XDG_RUNTIME_DIR/containers"</span>
</code></pre> 
<p><strong>registries.conf</strong><br> 配置按此顺序读入,这些文件不是默认创建的,可以从<code>/usr/share/containers</code>或复制文件<code>/etc/containers</code>并进行修改。</p> 
<pre><code class="prism language-python"><span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span>etc<span class="token operator">/</span>containers<span class="token operator">/</span>registries<span class="token punctuation">.</span>conf
<span class="token number">2</span><span class="token punctuation">.</span><span class="token operator">/</span>etc<span class="token operator">/</span>containers<span class="token operator">/</span>registries<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token operator">*</span>
<span class="token number">3.</span>HOME<span class="token operator">/</span><span class="token punctuation">.</span>config<span class="token operator">/</span>containers<span class="token operator">/</span>registries<span class="token punctuation">.</span>conf
</code></pre> 
<p><strong>授权文件</strong><br> 此文件里面写了docker账号的密码，以加密方式显示</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman login</span>
Username<span class="token punctuation">:</span> <span class="token number">1314444</span>
Password<span class="token punctuation">:</span> 
Login Succeeded!
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># cat /run/user/0/containers/auth.json </span>
<span class="token punctuation">{<!-- --></span>
        <span class="token string">"auths"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"registry.fedoraproject.org"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"auth"</span><span class="token punctuation">:</span> <span class="token string">"MTMxNDQ0NDpIMjAxNy0xOA=="</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3>
<a id="root_397"></a>普通用户是无法看见root用户的镜像的</h3> 
<pre><code class="prism language-python"><span class="token operator">//</span>root用户
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># podman images</span>
REPOSITORY                  TAG      IMAGE ID       CREATED       SIZE
docker<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>httpd     latest   ea28e1b82f31   <span class="token number">11</span> days ago   <span class="token number">146</span> MB

<span class="token operator">//</span>普通用户
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># su - zz</span>
<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ podman images
REPOSITORY  TAG         IMAGE ID    CREATED     SIZE
</code></pre> 
<h2>
<a id="_409"></a>卷</h2> 
<ul>
<li>容器与root用户一起运行，则root容器中的用户实际上就是主机上的用户。</li>
<li>UID GID是在/etc/subuid和/etc/subgid等中用户映射中指定的第一个UID GID。</li>
<li>如果普通用户的身份从主机目录挂载到容器中，并在该目录中以根用户身份创建文件，则会看到它实际上是你的用户在主机上拥有的。</li>
</ul> 
<h3>
<a id="_414"></a>使用卷</h3> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># su - zz</span>
<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ pwd
<span class="token operator">/</span>home<span class="token operator">/</span>zz
<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ mkdir <span class="token operator">/</span>home<span class="token operator">/</span>zz<span class="token operator">/</span>data

<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ podman run <span class="token operator">-</span>it <span class="token operator">-</span>v <span class="token string">"$(pwd)"</span><span class="token operator">/</span>data<span class="token punctuation">:</span><span class="token operator">/</span>data docker<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>busybox <span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>sh
Trying to pull docker<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>busybox<span class="token punctuation">:</span>latest<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Getting image source signatures
Copying blob <span class="token number">3cb635b06aa2</span> done  
Copying config ffe9d497c3 done  
Writing manifest to image destination
Storing signatures
<span class="token operator">/</span> <span class="token comment"># ls</span>
<span class="token builtin">bin</span>   data  dev   etc   home  proc  root  run   sys   tmp   usr   var
<span class="token operator">/</span> <span class="token comment"># cd data/</span>
<span class="token operator">/</span>data <span class="token comment"># ls</span>
<span class="token operator">/</span>data <span class="token comment"># touch 123</span>
<span class="token operator">/</span>data <span class="token comment"># ls -l</span>
total <span class="token number">0</span>
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>    <span class="token number">1</span> root     root             <span class="token number">0</span> Dec <span class="token number">13</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">17</span> <span class="token number">123</span>
</code></pre> 
<h3>
<a id="_437"></a>在主机上查看</h3> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ ll data<span class="token operator">/</span>
总用量 <span class="token number">0</span>
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span> <span class="token number">1</span> zz zz <span class="token number">0</span> <span class="token number">12</span>月 <span class="token number">13</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">17</span> <span class="token number">123</span>

<span class="token operator">//</span>写入文件
<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ echo <span class="token string">"hell world"</span> <span class="token operator">&gt;&gt;</span> <span class="token number">123</span>
<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ cat <span class="token number">123</span>
hell world
</code></pre> 
<h3>
<a id="_449"></a>容器里查看</h3> 
<pre><code class="prism language-python"><span class="token operator">/</span>data <span class="token comment"># cat 123</span>
hell world

<span class="token operator">//</span>我们可以发现在容器里面的文件的属主和属组都属于root，那么如何才能让其属于tom用户呢？下面告诉你答案
<span class="token operator">/</span>data <span class="token comment"># ls -l</span>
total <span class="token number">4</span>
<span class="token operator">-</span>rw<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>    <span class="token number">1</span> root     root            <span class="token number">12</span> Dec <span class="token number">13</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">20</span> <span class="token number">123</span>

<span class="token operator">//</span>只要在运行容器的时候加上一个<span class="token operator">-</span><span class="token operator">-</span>userns<span class="token operator">=</span>keep<span class="token operator">-</span><span class="token builtin">id</span>即可。
<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ podman run <span class="token operator">-</span>it <span class="token operator">-</span><span class="token operator">-</span>name test <span class="token operator">-</span>v <span class="token string">"$(pwd)"</span><span class="token operator">/</span>data<span class="token punctuation">:</span><span class="token operator">/</span>data <span class="token operator">-</span><span class="token operator">-</span>userns<span class="token operator">=</span>keep<span class="token operator">-</span><span class="token builtin">id</span> docker<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>busybox <span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>sh
<span class="token operator">~</span> $ cd data<span class="token operator">/</span>
<span class="token operator">/</span>data $ ls <span class="token operator">-</span>l
total <span class="token number">4</span>
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>    <span class="token number">1</span> zz       zz              <span class="token number">11</span> Dec <span class="token number">13</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">21</span> <span class="token number">123</span>
</code></pre> 
<p>使用普通用户映射容器端口时会报“ permission denied”的错误</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ podman run  <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">80</span> httpd
Error<span class="token punctuation">:</span> rootlessport cannot expose privileged port <span class="token number">80</span><span class="token punctuation">,</span> you can add <span class="token string">'net.ipv4.ip_unprivileged_port_start=80'</span> to <span class="token operator">/</span>etc<span class="token operator">/</span>sysctl<span class="token punctuation">.</span>conf <span class="token punctuation">(</span>currently <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">or</span> choose a larger port number <span class="token punctuation">(</span><span class="token operator">&gt;=</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span> listen tcp <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">80</span><span class="token punctuation">:</span> bind<span class="token punctuation">:</span> permission denied
</code></pre> 
<p>普通用户可以映射&gt;= 1024的端口</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ podman run  <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">1024</span><span class="token punctuation">:</span><span class="token number">80</span> httpd
<span class="token number">58613a6bdc70d4d4f9f624583f795a62a610596d166f0873bdff8fb26aa15092</span>
<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ ss <span class="token operator">-</span>anlt
State       Recv<span class="token operator">-</span>Q      Send<span class="token operator">-</span>Q           Local Address<span class="token punctuation">:</span>Port           Peer Address<span class="token punctuation">:</span>Port      Process      
LISTEN      <span class="token number">0</span>           <span class="token number">128</span>                    <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">22</span>                  <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token operator">*</span>                      
LISTEN      <span class="token number">0</span>           <span class="token number">128</span>                          <span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">1024</span>                      <span class="token operator">*</span><span class="token punctuation">:</span><span class="token operator">*</span>                      
LISTEN      <span class="token number">0</span>           <span class="token number">128</span>                       <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token number">22</span>                     <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token operator">*</span> 
</code></pre> 
<p>配置echo ‘net.ipv4.ip_unprivileged_port_start=80’ &gt;&gt; /etc/sysctl.conf后可以映射大于等于80的端口</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># echo  'net.ipv4.ip_unprivileged_port_start=80'  &gt;&gt; /etc/sysctl.conf</span>
<span class="token punctuation">[</span>root@localhost <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># sysctl -p</span>
net<span class="token punctuation">.</span>ipv4<span class="token punctuation">.</span>ip_unprivileged_port_start <span class="token operator">=</span> <span class="token number">80</span>

<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ podman run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">80</span> httpd
<span class="token number">1215455a0c300d78e7bf6afaefc9873f818c6b0f26affeee4e2bc17954e72d8e</span>
<span class="token punctuation">[</span>zz@localhost <span class="token operator">~</span><span class="token punctuation">]</span>$ ss <span class="token operator">-</span>anlt
State       Recv<span class="token operator">-</span>Q      Send<span class="token operator">-</span>Q           Local Address<span class="token punctuation">:</span>Port           Peer Address<span class="token punctuation">:</span>Port      Process      
LISTEN      <span class="token number">0</span>           <span class="token number">128</span>                    <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">22</span>                  <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token operator">*</span>                      
LISTEN      <span class="token number">0</span>           <span class="token number">128</span>                          <span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">1024</span>                      <span class="token operator">*</span><span class="token punctuation">:</span><span class="token operator">*</span>                      
LISTEN      <span class="token number">0</span>           <span class="token number">128</span>                          <span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">80</span>                        <span class="token operator">*</span><span class="token punctuation">:</span><span class="token operator">*</span>                      
LISTEN      <span class="token number">0</span>           <span class="token number">128</span>                       <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token number">22</span>                     <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token operator">*</span>  
</code></pre>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
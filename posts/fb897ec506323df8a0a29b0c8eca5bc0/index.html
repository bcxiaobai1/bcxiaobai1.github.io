<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>基于树莓派的人脸识别门禁系统 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于树莓派的人脸识别门禁系统</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <h2>
<a id="Opencv_0"></a>一、树莓派Opencv以及扩展模块的安装</h2> 
<p>1、概述：本次在树莓派上安装Opencv及其扩展模块，考虑到树莓派的SD卡容量和内存的限制，不采用直接pip安装方法，而采用编译Opencv源码的方式进行安装。<br> 2、遇到的问题及解决方法</p> 
<table>
<thead><tr>
<th>遇到的问题</th>
<th>解决方法</th>
</tr></thead>
<tbody>
<tr>
<td>缺少”cuda.hpp”</td>
<td>将/home/pi/opencv_contrib3.4.1/modules/xfeatures2d/include/opencv2下的xfeatures2d文件夹复制到home/pi/opencv-3.4.1/modules/stitching/include/opencv2下</td>
</tr>
<tr>
<td>缺少”bosstdesc_bgm.i”</td>
<td>下载对应的文件到opencv_contrib/modules/xfeatures2d/src下</td>
</tr>
<tr>
<td>运行至99%时树莓派卡死</td>
<td>原本采用make -j4进行源码编译加速，但是多次尝试仍然卡死，之后采用make解决了问题，可能原因是make -j4所需的交换空间太大导致卡死。</td>
</tr>
</tbody>
</table>
<p>3、运行结果<br> <img src="https://images2.imgbox.com/27/19/zPkIdVRi_o.png" alt="在这里插入图片描述"><br> 导入opencv库没有问题，说明安装成功。</p> 
<h2>
<a id="_12"></a>二、树莓派人脸检测</h2> 
<p>1、概述：本次在树莓派上检测人脸用Opencv自带的Haar特征分类器。<br> 2、代码编写：<br> 将.xml文件拷贝到mu_code文件夹下，在mu_code下编写代码，则工程的根目录默认在mu_code。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
cap<span class="token operator">=</span>cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cascadePath <span class="token operator">=</span> <span class="token string">"/home/pi/opencv-3.4.3/data/haarcascades/haarcascade_frontalface_default.xml"</span>
faceCascade <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascadePath<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret<span class="token punctuation">,</span> img <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 灰度化处理</span>
    gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    faces <span class="token operator">=</span> faceCascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        w <span class="token operator">=</span> faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        h <span class="token operator">=</span> faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"fle"</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre> 
<p>3、运行结果：<br> <img src="https://images2.imgbox.com/09/a4/goF5bDyt_o.png" alt="在这里插入图片描述"><br> 由图中可以看出可以正确检测出人脸。</p> 
<h2>
<a id="_38"></a>三、树莓派人脸识别</h2> 
<p>1、概述：<br> 本次在树莓派上进行人脸识别采用OpenCV人脸识别类LBPHFaceRecognizer。<br> 2、代码编写：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
imagePath<span class="token operator">=</span><span class="token string">"face.png"</span>
img_face<span class="token operator">=</span>cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>imagePath<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"fle"</span><span class="token punctuation">,</span>img_face<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
recognizer <span class="token operator">=</span> cv2<span class="token punctuation">.</span>face<span class="token punctuation">.</span>LBPHFaceRecognizer_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
PIL_img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span>
img_numpy <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>PIL_img<span class="token punctuation">,</span> <span class="token string">'uint8'</span><span class="token punctuation">)</span>
faces<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
faces<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img_numpy<span class="token punctuation">)</span>
ids<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
recognizer<span class="token punctuation">.</span>train<span class="token punctuation">(</span>faces<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">id</span><span class="token punctuation">,</span> confidence <span class="token operator">=</span> recognizer<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>img_face<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"id="</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"confidence="</span><span class="token punctuation">,</span>confidence<span class="token punctuation">)</span>
</code></pre> 
<p>3、运行结果：<br> <img src="https://images2.imgbox.com/65/85/ad0LGTxo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ed/d9/MmavgW0q_o.png" alt="在这里插入图片描述"><br> 人脸图片用于训练，用于训练的id是2，这里只是为了检测代码的正确性，所以依然用这张图片是做识别，识别的结果是id=2,confidence≈9.8。Id号识别正确，confidence接近于0，说明识别率很高。</p> 
<h2>
<a id="LED_66"></a>四、树莓派利用双色LED模拟开关门动作</h2> 
<p>1、概述：<br> 设计一个双色LED类，该类应该能够向外提供两个方法，分别设置红灯和绿灯的PWM。<br> 这里在主函数调用是都是设置为满PWM。<br> ２、接线</p> 
<table>
<thead><tr>
<th>树莓派</th>
<th>3mm双色LED模块</th>
</tr></thead>
<tbody>
<tr>
<td>GND</td>
<td>负极（-）</td>
</tr>
<tr>
<td>P17</td>
<td>红色灯正极（中间引脚）</td>
</tr>
<tr>
<td>P18</td>
<td>绿色灯正极</td>
</tr>
</tbody>
</table>
<p>３、代码编写</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> RPi<span class="token punctuation">.</span>GPIO <span class="token keyword">as</span> GPIO
<span class="token keyword">import</span> time
<span class="token keyword">class</span> <span class="token class-name">Double_LED_Class</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># double_led 初始化工作</span>
        makerobo_pins <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>  <span class="token comment"># PIN管脚字典</span>
        GPIO<span class="token punctuation">.</span>setmode<span class="token punctuation">(</span>GPIO<span class="token punctuation">.</span>BOARD<span class="token punctuation">)</span>  <span class="token comment"># 采用实际的物理管脚给GPIO口</span>
        GPIO<span class="token punctuation">.</span>setwarnings<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># 去除GPIO口警告</span>
        GPIO<span class="token punctuation">.</span>setup<span class="token punctuation">(</span>makerobo_pins<span class="token punctuation">,</span> GPIO<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>  <span class="token comment"># 设置Pin模式为输出模式</span>
        GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>makerobo_pins<span class="token punctuation">,</span> GPIO<span class="token punctuation">.</span>LOW<span class="token punctuation">)</span>  <span class="token comment"># 设置Pin管脚为低电平(0V)关闭LED</span>
        self<span class="token punctuation">.</span>p_R <span class="token operator">=</span> GPIO<span class="token punctuation">.</span>PWM<span class="token punctuation">(</span>makerobo_pins<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>  <span class="token comment"># 设置频率为2KHz</span>
        self<span class="token punctuation">.</span>p_G <span class="token operator">=</span> GPIO<span class="token punctuation">.</span>PWM<span class="token punctuation">(</span>makerobo_pins<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>  <span class="token comment"># 设置频率为2KHz</span>
        <span class="token comment"># 初始化占空比为0(led关闭)</span>
        self<span class="token punctuation">.</span>p_R<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>p_G<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">makerobo_pwm_map</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">,</span> in_min<span class="token punctuation">,</span> in_max<span class="token punctuation">,</span> out_min<span class="token punctuation">,</span> out_max<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> in_min<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>out_max <span class="token operator">-</span> out_min<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>in_max <span class="token operator">-</span> in_min<span class="token punctuation">)</span> <span class="token operator">+</span> out_min
    <span class="token keyword">def</span> <span class="token function">makerobo_set_red_Color</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>col<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 例如:col = 0x1122</span>
        <span class="token comment"># 把0-255的范围同比例缩小到0-100之间</span>
        R_val <span class="token operator">=</span> self<span class="token punctuation">.</span>makerobo_pwm_map<span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>p_R<span class="token punctuation">.</span>ChangeDutyCycle<span class="token punctuation">(</span>R_val<span class="token punctuation">)</span>  <span class="token comment"># 改变占空比</span>
    <span class="token keyword">def</span> <span class="token function">makerobo_set_green_Color</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>col<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 例如:col = 0x1122</span>
        <span class="token comment"># 把0-255的范围同比例缩小到0-100之间</span>
        G_val <span class="token operator">=</span> self<span class="token punctuation">.</span>makerobo_pwm_map<span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>p_G<span class="token punctuation">.</span>ChangeDutyCycle<span class="token punctuation">(</span>G_val<span class="token punctuation">)</span>  <span class="token comment"># 改变占空比</span>
    <span class="token comment"># 释放资源</span>
    <span class="token keyword">def</span> <span class="token function">makerobo_destroy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>p_G<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>p_R<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        GPIO<span class="token punctuation">.</span>output<span class="token punctuation">(</span>self<span class="token punctuation">.</span>makerobo_pins<span class="token punctuation">,</span> GPIO<span class="token punctuation">.</span>LOW<span class="token punctuation">)</span>  <span class="token comment"># 关闭所有LED</span>
        GPIO<span class="token punctuation">.</span>cleanup<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 释放资源</span>

<span class="token comment"># 测试用例</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    Hardware_double_led<span class="token operator">=</span>Double_LED_Class<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Hardware_double_led<span class="token punctuation">.</span>makerobo_set_red_Color<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">#显示红灯3s后显示绿灯</span>
    Hardware_double_led<span class="token punctuation">.</span>makerobo_set_red_Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    Hardware_double_led<span class="token punctuation">.</span>makerobo_set_green_Color<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
</code></pre> 
<p>４、运行结果<br> <img src="https://images2.imgbox.com/ca/56/tGnXgRci_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/be/1a/WAPVCBBb_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="_121"></a>五、树莓派门禁系统界面设计与整体逻辑代码整合</h2> 
<p>1、概述：<br> 树莓派门禁系统总共包括4个界面设计，分别是人脸识别开门界面、管理员登录界面、人脸录入界面、人脸数据库展示界面。这四个界面都用PyQt5进行设计，先在Window上用Qt Designer搭建界面，用Python编写逻辑关系，最后移植到树莓派上，树莓派上只需要安装PyQt库即可运行程序。<br> 下面为四个界面的展示图：<br> <img src="https://images2.imgbox.com/6f/d0/TgYQGPq0_o.png" alt="人脸识别开门界面"><br> <img src="https://images2.imgbox.com/ca/81/RRw5LRpL_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b3/fc/3cQqjS0p_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/61/aa/c2FZZiYS_o.png" alt="在这里插入图片描述"><br> 界面控件的逻辑关系如下图：<br> <img src="https://images2.imgbox.com/ab/3d/fajAlhrG_o.png" alt="在这里插入图片描述"><br> 2、代码编写：<br> 代码思路：<br> <img src="https://images2.imgbox.com/1f/45/MM7ACMFW_o.png" alt="在这里插入图片描述"><br> 创建了四个界面类，分别继承于用Qt Designer创建 的四个界面类，这样做是为了能够在更改界面的时候不会改变逻辑部分代码。另外创建了一个数据库操作类，主要是为了能够查询，读写数据库，这里采用的是SQlite数据库。<br> Main文件：</p> 
<pre><code class="prism language-python"><span class="token comment">#########################################</span>
<span class="token comment">#Author:郭先达</span>
<span class="token comment">#date:2021.12.22</span>
<span class="token comment">#######################################33</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> threading
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> QBasicTimer
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication<span class="token punctuation">,</span> QWidget<span class="token punctuation">,</span> QPushButton<span class="token punctuation">,</span> QLabel<span class="token punctuation">,</span> QLineEdit<span class="token punctuation">,</span> QGridLayout<span class="token punctuation">,</span> QMessageBox<span class="token punctuation">,</span> QGroupBox
<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtWidgets
<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore<span class="token punctuation">,</span> QtGui<span class="token punctuation">,</span> QtWidgets
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QWidget<span class="token punctuation">,</span> QLabel<span class="token punctuation">,</span> QApplication
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QPalette<span class="token punctuation">,</span> QBrush<span class="token punctuation">,</span> QPixmap
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtSql <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> time
<span class="token keyword">from</span> double_led <span class="token keyword">import</span> Double_LED_Class
<span class="token keyword">import</span> os

<span class="token keyword">from</span> MainWindow <span class="token keyword">import</span> Ui_Dialog <span class="token keyword">as</span> Ui_Dialog_MainWindow
<span class="token keyword">from</span> Admin_enter <span class="token keyword">import</span> Ui_Dialog <span class="token keyword">as</span> Ui_Dialog_Admin_enter
<span class="token keyword">from</span> Face_rec <span class="token keyword">import</span> Ui_Dialog <span class="token keyword">as</span> Ui_Dialog_Face_rec
<span class="token keyword">from</span> SQliteWindow <span class="token keyword">import</span> Ui_Dialog <span class="token keyword">as</span> Ui_Dialog_SQliteWindow

<span class="token comment"># 导入OpenCV自带的数据集，定义多个是因为在后面有多次调用，用一个的话会报错</span>
cascadePath <span class="token operator">=</span> <span class="token string">"haarcascade_frontalface_default.xml"</span>
faceCascade1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascadePath<span class="token punctuation">)</span>
faceCascade2<span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascadePath<span class="token punctuation">)</span>
faceCascade3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascadePath<span class="token punctuation">)</span>
faceCascade4<span class="token operator">=</span>cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascadePath<span class="token punctuation">)</span>

<span class="token comment">#人脸识别开门界面</span>
<span class="token keyword">class</span> <span class="token class-name">Fle_MainWindow</span><span class="token punctuation">(</span>QDialog<span class="token punctuation">,</span>Ui_Dialog_MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Fle_MainWindow<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token comment"># 创建定时器,定时器用来定时拍照</span>
        self<span class="token punctuation">.</span>timer_camera <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QTimer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment">#进入人脸识别开门界面之前先把所有数据训练一遍，以满足新数据的录入</span>
        self<span class="token punctuation">.</span>recognizer <span class="token operator">=</span> cv2<span class="token punctuation">.</span>face<span class="token punctuation">.</span>LBPHFaceRecognizer_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
        faces<span class="token punctuation">,</span> ids <span class="token operator">=</span> self<span class="token punctuation">.</span>getImagesAndLabels<span class="token punctuation">(</span><span class="token string">"./Face_data"</span><span class="token punctuation">)</span><span class="token comment">#拍摄的照片放在这个文件夹下</span>
        self<span class="token punctuation">.</span>recognizer<span class="token punctuation">.</span>train<span class="token punctuation">(</span>faces<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#开始训练</span>

        self<span class="token punctuation">.</span>font <span class="token operator">=</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX
        <span class="token comment">#摄像头初始化</span>
        self<span class="token punctuation">.</span>camera_init<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#绑定函数show_camera</span>
        self<span class="token punctuation">.</span>timer_camera<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>show_camera<span class="token punctuation">)</span>
        <span class="token comment">#30ms拍一次照片</span>
        self<span class="token punctuation">.</span>timer_camera<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>

        <span class="token comment"># 点击管理员按钮事件</span>
        self<span class="token punctuation">.</span>pushButton_administrators<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>slot_btn_admin<span class="token punctuation">)</span>
        <span class="token comment">#新建一个双色LED类</span>
        self<span class="token punctuation">.</span>Hardware_double_led<span class="token operator">=</span>Double_LED_Class<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 函数获取图像和标签数据</span>
    <span class="token keyword">def</span> <span class="token function">getImagesAndLabels</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        imagePaths <span class="token operator">=</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token keyword">for</span> f <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">]</span>
        faceSamples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">#人脸数据</span>
        ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">#人脸对应的id标签</span>
        <span class="token keyword">for</span> imagePath <span class="token keyword">in</span> imagePaths<span class="token punctuation">:</span>
            <span class="token comment"># 转换为灰度</span>
            PIL_img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span>
            img_numpy <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>PIL_img<span class="token punctuation">,</span> <span class="token string">'uint8'</span><span class="token punctuation">)</span>
            <span class="token comment">#print(imagePath),打印出具体信息，怎么分割就怎么设置序号</span>
            <span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            faces <span class="token operator">=</span> faceCascade3<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>img_numpy<span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
                faceSamples<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img_numpy<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span><span class="token punctuation">)</span>
                ids<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span>
        <span class="token keyword">return</span> faceSamples<span class="token punctuation">,</span> ids

    <span class="token keyword">def</span> <span class="token function">camera_init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 打开设置摄像头对象</span>
        self<span class="token punctuation">.</span>cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>__flag_work <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment">#这里的minW和minH用于限制人脸的最小宽高，防止误测</span>
        self<span class="token punctuation">.</span>minW <span class="token operator">=</span> <span class="token number">0.2</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">#视频流的帧宽度</span>
        self<span class="token punctuation">.</span>minH <span class="token operator">=</span> <span class="token number">0.2</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">#视频流的帧高度</span>

    <span class="token keyword">def</span> <span class="token function">show_camera</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        flag<span class="token punctuation">,</span> self<span class="token punctuation">.</span>image <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 将图片变化成灰度图</span>
        gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
        <span class="token comment"># 探测图片中的人脸</span>
        faces <span class="token operator">=</span> faceCascade1<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>
            gray<span class="token punctuation">,</span>
            scaleFactor<span class="token operator">=</span><span class="token number">1.2</span><span class="token punctuation">,</span>
            minNeighbors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
            minSize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>minW<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>minH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token comment"># 判断是否检测到人脸，检测到设置为绿灯，没检测到设置为红灯</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment">#下面这个操作是为了能够只检测到一张脸，检测面积最大的那个脸</span>
            WxH_max<span class="token operator">=</span><span class="token number">0</span> <span class="token comment">#人脸矩形的面积</span>
            WxH_max_face<span class="token operator">=</span>faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>WxH_max<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    WxH_max<span class="token operator">=</span>i<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
                    WxH_max_face<span class="token operator">=</span>i
            <span class="token comment"># 围绕脸的框</span>
            x<span class="token operator">=</span>WxH_max_face<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            y <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            w <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            h <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
            cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token comment">#用recognizer进行识别判断</span>
            <span class="token builtin">id</span><span class="token punctuation">,</span> confidence <span class="token operator">=</span> self<span class="token punctuation">.</span>recognizer<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>gray<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># 对置信度进行判断，这里设定为70</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>confidence <span class="token operator">&lt;</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                confidence <span class="token operator">=</span> <span class="token string">"  {0}%"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">-</span> confidence<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>mysqlite<span class="token punctuation">.</span>get_rows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> mysqlite<span class="token punctuation">.</span>find_data<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">id</span><span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>label_ID<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>mysqlite<span class="token punctuation">.</span>find_data<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>label_name<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>mysqlite<span class="token punctuation">.</span>find_data<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>Hardware_double_led<span class="token punctuation">.</span>makerobo_set_red_Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>Hardware_double_led<span class="token punctuation">.</span>makerobo_set_green_Color<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                confidence <span class="token operator">=</span> <span class="token string">"  {0}%"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">-</span> confidence<span class="token punctuation">)</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>label_ID<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"不认识"</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>label_name<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"不认识"</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>Hardware_double_led<span class="token punctuation">.</span>makerobo_set_red_Color<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>Hardware_double_led<span class="token punctuation">.</span>makerobo_set_green_Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment"># 给图片添加文本 图片矩阵, 添加文本名称, 设置文本显示位置,</span>
            <span class="token comment"># 字体样式, 字体大小, 字体颜色, 字体粗细</span>
            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>font<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>confidence<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token operator">+</span> h <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>font<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>Hardware_double_led<span class="token punctuation">.</span>makerobo_set_red_Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>Hardware_double_led<span class="token punctuation">.</span>makerobo_set_green_Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment"># 将视频显示在了label上</span>
        show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>show<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
        showImage <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>show<span class="token punctuation">.</span>data<span class="token punctuation">,</span> show<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> show<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB888<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lab_face<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>showImage<span class="token punctuation">)</span><span class="token punctuation">)</span>


    <span class="token comment"># 点点击管理员按钮事件</span>
    <span class="token keyword">def</span> <span class="token function">slot_btn_admin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#应该在释放摄像头之前先关闭定时器</span>
        self<span class="token punctuation">.</span>timer_camera<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>logon <span class="token operator">=</span> Fle_Admin_enter<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>logon<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>hide<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#其他界面不用双色LED模拟开关门，把灯灭掉</span>
        self<span class="token punctuation">.</span>Hardware_double_led<span class="token punctuation">.</span>makerobo_set_red_Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>Hardware_double_led<span class="token punctuation">.</span>makerobo_set_green_Color<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 管理员登录界面</span>
<span class="token keyword">class</span> <span class="token class-name">Fle_Admin_enter</span><span class="token punctuation">(</span>QDialog<span class="token punctuation">,</span>Ui_Dialog_Admin_enter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Fle_Admin_enter<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

        <span class="token comment">#将输入信息初始化为空</span>
        self<span class="token punctuation">.</span>lineEdit_admin_ID<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit_admin_key<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
        <span class="token comment">#设置密码为隐藏方式显示</span>
        self<span class="token punctuation">.</span>lineEdit_admin_key<span class="token punctuation">.</span>setEchoMode<span class="token punctuation">(</span>QLineEdit<span class="token punctuation">.</span>Password<span class="token punctuation">)</span>

        <span class="token comment"># lineEdit改变事件</span>
        self<span class="token punctuation">.</span>lineEdit_admin_ID<span class="token punctuation">.</span>textEdited<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>changeEdit_ID<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit_admin_key<span class="token punctuation">.</span>textEdited<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>changeEdit_key<span class="token punctuation">)</span>

        <span class="token comment"># 点击返回按钮事件</span>
        self<span class="token punctuation">.</span>pushButton_admin_back<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>slot_btn_back<span class="token punctuation">)</span>
        <span class="token comment"># 点击登录按钮事件</span>
        self<span class="token punctuation">.</span>pushButton_admin_enter<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>slot_btn_logon<span class="token punctuation">)</span>


    <span class="token comment"># 点击Edit_ID事件</span>
    <span class="token keyword">def</span> <span class="token function">changeEdit_ID</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        Edit_ID <span class="token operator">=</span> self<span class="token punctuation">.</span>lineEdit_admin_ID<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Edit_ID="</span><span class="token punctuation">,</span>Edit_ID<span class="token punctuation">)</span>

    <span class="token comment"># 点击Edit_key事件</span>
    <span class="token keyword">def</span> <span class="token function">changeEdit_key</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        Edit_key <span class="token operator">=</span> self<span class="token punctuation">.</span>lineEdit_admin_key<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Edit_ID="</span><span class="token punctuation">,</span>Edit_key<span class="token punctuation">)</span>

    <span class="token comment"># 点击返回按钮事件</span>
    <span class="token keyword">def</span> <span class="token function">slot_btn_back</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>menu <span class="token operator">=</span> Fle_MainWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menu<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>hide<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 点击登录按钮事件</span>
    <span class="token keyword">def</span> <span class="token function">slot_btn_logon</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 判断账号和密码是否输入正确</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lineEdit_admin_ID<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lineEdit_admin_key<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token comment">#这里设置管理员的账号和密码，这里都设置为1</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>lineEdit_admin_ID<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"1"</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>lineEdit_admin_key<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>manager_face <span class="token operator">=</span> Fle_Face_rec<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>manager_face<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>hide<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">#print("enter Ui_manager_face")</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token string">"账号或密码错误！"</span><span class="token punctuation">,</span> QMessageBox<span class="token punctuation">.</span>Close<span class="token punctuation">)</span>

<span class="token comment">#人脸录入界面</span>
<span class="token keyword">class</span> <span class="token class-name">Fle_Face_rec</span><span class="token punctuation">(</span>QDialog<span class="token punctuation">,</span>Ui_Dialog_Face_rec<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Fle_Face_rec<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token comment"># 初始化为空</span>
        self<span class="token punctuation">.</span>lineEdit_ID<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lineEdit_name<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>

        <span class="token comment"># 初始化进度条定时器</span>
        self<span class="token punctuation">.</span>timer <span class="token operator">=</span> QBasicTimer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>step <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># 创建定时器</span>
        self<span class="token punctuation">.</span>timer_camera <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QTimer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 初始化摄像头数据</span>
        self<span class="token punctuation">.</span>camera_init<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 定时器函数，用来显示人脸检测结果，并不录入数据</span>
        self<span class="token punctuation">.</span>timer_camera<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>show_camera<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timer_camera<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>pushButton_begin_rec<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>slot_btn_enter<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_back<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>slot_btn_back<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_show_sqlite<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>show_sqlitedata<span class="token punctuation">)</span>
    <span class="token comment"># 初始化摄像头数据</span>
    <span class="token keyword">def</span> <span class="token function">camera_init</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>__flag_work <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span><span class="token number">0</span>
        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment">#设置分辨率为640*480</span>
        self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">640</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">480</span><span class="token punctuation">)</span>

    <span class="token comment"># 点击返回按键返回上一界面</span>
    <span class="token keyword">def</span> <span class="token function">slot_btn_back</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>timer_camera<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>logon <span class="token operator">=</span> Fle_MainWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>logon<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>hide<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show_camera</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        flag<span class="token punctuation">,</span> self<span class="token punctuation">.</span>image <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
        faceCascade2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascadePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        faces <span class="token operator">=</span> faceCascade2<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>
            gray<span class="token punctuation">,</span>
            scaleFactor<span class="token operator">=</span><span class="token number">1.2</span><span class="token punctuation">,</span>
            minNeighbors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
            minSize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>
            WxH_max <span class="token operator">=</span> <span class="token number">0</span>
            WxH_max_face <span class="token operator">=</span> faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> WxH_max<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    WxH_max <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
                    WxH_max_face <span class="token operator">=</span> i
            <span class="token comment"># 围绕脸的框</span>
            x <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            y <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            w <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            h <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>

            cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            roi_gray <span class="token operator">=</span> gray<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span>
            roi_color <span class="token operator">=</span> self<span class="token punctuation">.</span>image<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span>

        <span class="token comment"># 将视频显示在了label上</span>
        show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>show<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
        showImage <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">(</span>show<span class="token punctuation">.</span>data<span class="token punctuation">,</span> show<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> show<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> QtGui<span class="token punctuation">.</span>QImage<span class="token punctuation">.</span>Format_RGB888<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label_face<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QtGui<span class="token punctuation">.</span>QPixmap<span class="token punctuation">.</span>fromImage<span class="token punctuation">(</span>showImage<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 点击按钮开启人脸录入线程</span>
    <span class="token keyword">def</span> <span class="token function">slot_btn_enter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># 创建线程并开启</span>
        self<span class="token punctuation">.</span>thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>thread_pic<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 开启进度条定时器</span>
        self<span class="token punctuation">.</span>timer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>

    <span class="token comment"># 加载进度条</span>
    <span class="token keyword">def</span> <span class="token function">timerEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>progressBar<span class="token punctuation">.</span>setValue<span class="token punctuation">(</span>self<span class="token punctuation">.</span>count<span class="token punctuation">)</span>


    <span class="token comment"># 录入人脸线程</span>
    <span class="token keyword">def</span> <span class="token function">thread_pic</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tip<span class="token operator">=</span><span class="token string">"正在录入"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lineEdit_ID<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lineEdit_name<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"的人脸！！"</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>tip<span class="token punctuation">)</span>
        <span class="token comment"># 创建目录，将获取的人脸照片放入指定的文件夹</span>
        self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token string">"./Face_data"</span>
        file_ID<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lineEdit_ID<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 灰度化处理</span>
            gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
            faces <span class="token operator">=</span> faceCascade4<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>
                WxH_max <span class="token operator">=</span> <span class="token number">0</span>
                WxH_max_face <span class="token operator">=</span> faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> WxH_max<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        WxH_max <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
                        WxH_max_face <span class="token operator">=</span> i
                <span class="token comment"># 围绕脸的框</span>
                x <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                y <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                w <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
                h <span class="token operator">=</span> WxH_max_face<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>

                self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token comment"># 将捕获的图像命名为User.0.1.png,其中0是id号</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">+</span> <span class="token string">"/User."</span> <span class="token operator">+</span> file_ID <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">)</span>
                <span class="token builtin">bool</span> <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">+</span> <span class="token string">"/User."</span> <span class="token operator">+</span> file_ID <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">,</span>
                                   gray<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span><span class="token punctuation">)</span>

                <span class="token comment"># 取100张人脸样本，停止录像</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>count <span class="token operator">&gt;=</span> <span class="token number">100</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"人脸数据采集已完成!"</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
        <span class="token comment">#将数据存入数据库</span>
        mysqlite<span class="token punctuation">.</span>add_row<span class="token punctuation">(</span>self<span class="token punctuation">.</span>lineEdit_ID<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>lineEdit_xuehao<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lineEdit_name<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">show_sqlitedata</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>logon <span class="token operator">=</span> Fle_SQliteWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>logon<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#self.hide()</span>

<span class="token comment">#人脸数据库展示界面</span>
<span class="token keyword">class</span> <span class="token class-name">Fle_SQliteWindow</span><span class="token punctuation">(</span>QDialog<span class="token punctuation">,</span>Ui_Dialog_SQliteWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Fle_SQliteWindow<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>setModel<span class="token punctuation">(</span>mysqlite<span class="token punctuation">.</span>model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_add<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>addrow<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton_delete<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> mysqlite<span class="token punctuation">.</span>model<span class="token punctuation">.</span>removeRow<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>currentIndex<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>row<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">addrow</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 不是在QTableView上添加，而是在模型上添加,会自动将数据保存到数据库中！</span>
        <span class="token comment"># 参数一：数据库共有几行数据  参数二：添加几行</span>
        ret <span class="token operator">=</span> mysqlite<span class="token punctuation">.</span>model<span class="token punctuation">.</span>insertRows<span class="token punctuation">(</span>mysqlite<span class="token punctuation">.</span>model<span class="token punctuation">.</span>rowCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 返回是否插入</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据库共有%d行数据'</span> <span class="token operator">%</span> mysqlite<span class="token punctuation">.</span>model<span class="token punctuation">.</span>rowCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'insertRow=%s'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">#数据库操作类</span>
<span class="token keyword">class</span> <span class="token class-name">Fle_Sqlite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>db <span class="token operator">=</span> QSqlDatabase<span class="token punctuation">.</span>addDatabase<span class="token punctuation">(</span><span class="token string">'QSQLITE'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>setDatabaseName<span class="token punctuation">(</span><span class="token string">'./people_data.db'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'无法建立与数据库的连接'</span><span class="token punctuation">)</span>
        query <span class="token operator">=</span> QSqlQuery<span class="token punctuation">(</span><span class="token punctuation">)</span>
        query<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token string">'create table people(id varcahr(10),xuehao varcahr(15),name varcahr(50))'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> QSqlTableModel<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># MVC模式中的模型</span>
        <span class="token comment"># 初始化将数据装载到模型当中</span>
        self<span class="token punctuation">.</span>initializeModel<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 初始化</span>
    <span class="token keyword">def</span> <span class="token function">initializeModel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>setTable<span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">)</span>
        <span class="token comment"># 当字段变化时会触发一些事件</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>setEditStrategy<span class="token punctuation">(</span>QSqlTableModel<span class="token punctuation">.</span>OnFieldChange<span class="token punctuation">)</span>
        <span class="token comment"># 将整个数据装载到model中</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置字段头</span>
        <span class="token comment">#只是设置字段头，不是显示</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>setHeaderData<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Qt<span class="token punctuation">.</span>Horizontal<span class="token punctuation">,</span> <span class="token string">'ID'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>setHeaderData<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Qt<span class="token punctuation">.</span>Horizontal<span class="token punctuation">,</span> <span class="token string">'xuehao'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>setHeaderData<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Qt<span class="token punctuation">.</span>Horizontal<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span>

    <span class="token comment">#找指定位置的数据</span>
    <span class="token keyword">def</span> <span class="token function">find_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> row<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 序号从0开始</span>
        index <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>index<span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>data<span class="token punctuation">(</span>index<span class="token punctuation">)</span>

    <span class="token comment">#新加一行</span>
    <span class="token keyword">def</span> <span class="token function">add_row</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>ID<span class="token punctuation">,</span>xuehao<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        row <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>rowCount<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>insertRow<span class="token punctuation">(</span>row<span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>setData<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>index<span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ID<span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>setData<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>index<span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xuehao<span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>setData<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>index<span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>  
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>submitAll<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ID<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>xuehao<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>

    <span class="token comment">#删除最后一行</span>
    <span class="token keyword">def</span> <span class="token function">del_row</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        row <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>rowCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>removeRow<span class="token punctuation">(</span>row<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>submitAll<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_rows</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#print(self.model.rowCount())</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>rowCount<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    mysqlite<span class="token operator">=</span>Fle_Sqlite<span class="token punctuation">(</span><span class="token punctuation">)</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    w <span class="token operator">=</span> Fle_MainWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>
    w<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<p>3、运行结果：<br> <img src="https://images2.imgbox.com/8c/b3/KINpC8st_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/93/ad/HtFruEvb_o.png" alt="在这里插入图片描述"><br> 由上面两图可以看出识别效果正确。<br> <img src="https://images2.imgbox.com/d5/91/fm5pF3Bp_o.png" alt="在这里插入图片描述"><br> 识别出人脸时亮绿灯。<br> <img src="https://images2.imgbox.com/43/b7/kKUUAW9i_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/26/7e/HMz1yFta_o.png" alt="在这里插入图片描述"><br> 由上图可知，显示“不认识”时亮红灯。</p> 
<h2>
<a id="_566"></a>六、总结与体会</h2> 
<p>①本次实验采用的LBPH人脸识别模型精度欠缺，受光线影响非常严重，或许可以通过摄像头加红外滤光片外加红外补光灯解决。<br> ②本次实验中多次遇到摄像头调用打开不了导致imread出错的情况，具体原因没有找到，猜测是摄像头的序列号改变了。<br> ③本次实验中创建了多个界面类，而人脸识别界面类和人脸录入界面类都需要调用摄像头，导致了摄像头经常报错，所以在界面切换的时候关掉了摄像头，在界面初始化的时候又打开了摄像头，但是这样做有时也会造成摄像头来不及释放而报错。<br> ④对于数据库的操作，卡了很长的时间才分清楚数据库和数据表的区别，最后才搞清楚读写操作都是对链接到数据库的数据表操作。</p> 
<h2>
<a id="_571"></a>附录</h2> 
<p>代码：<br> 链接：https://pan.baidu.com/s/12RZ_K74Rp8rOkJ6TxA5TMg<br> 提取码：b00q</p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
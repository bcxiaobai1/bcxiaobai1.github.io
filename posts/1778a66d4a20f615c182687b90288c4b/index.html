<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>java认证与证书 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java认证与证书</h1>
			
		</header>
		<div class="content post__content clearfix">
			


        
                <div id="content_views" class="markdown_views prism-atom-one-light">
                    
                        
                    
                    <blockquote> 
 <p>本文内容主要来自《Java加密与解密的艺术》</p> 
</blockquote> 
<p>目前主要有JKS和PEM两种编码格式文件。</p> 
<ul>
<li>
<strong>JKS（Java Key Store）</strong>，Java原生的密钥库/信任库文件。</li>
<li>**PEM（Privacy Enbanced Mail，隐私增强邮件）**是使用多种加密方法提供机密性、认证和信息完整性的因特网电子邮件，在因特网中却没有被广泛配置，但在<code>OpenSSL</code>中，却是最为常见的密钥库文件。</li>
</ul> 
<p>如何在这两种密钥库文件中进行库文件交换呢？</p> 
<p>可以通过<code>PKCS#12</code>格式的证书文件在两种格式的密钥库中进行库文件导出/导入等。</p> 
<p>通常使用<code>Base64</code>编码格式作为数字证书文件存储格式。</p> 
<h3>
<a id="_13"></a>自签名证书</h3> 
<p>自签名证书，即证书申请者为自己的证书签名。</p> 
<blockquote> 
 <p>这类证书通常应用于软件厂商内部发放的产品中，或约定使用该证书的数据交互双方。数字证书完全充当加密算法的载体，为必要数据做加密/解密和签名/验证等操作。</p> 
</blockquote> 
<h3>
<a id="_21"></a>证书签发</h3> 
<p>数字证书的颁发流程简述过程如下：</p> 
<ol>
<li>由<strong>数字证书需求</strong>方产生自己的密钥对。</li>
<li>由<strong>数字证书需求</strong>方将算法、公钥和证书申请者身份信息传送给<strong>认证机构</strong>。</li>
<li>由<strong>认证机构</strong>核实用户的身份，执行相应必要的步骤，确保请求确实由用户发送而来。</li>
<li>由<strong>认证机构</strong>将数字证书颁发给用户。</li>
</ol> 
<h3>
<a id="_38"></a>加密交互</h3> 
<p>1、客户端请求服务器的流程如下：</p> 
<p>客户端请求服务器将按如下步骤进行：</p> 
<ol>
<li>由<strong>客户端</strong>使用公钥对数据加密。</li>
<li>由<strong>客户端</strong>向服务器端发送加密数据。</li>
<li>由<strong>服务器端</strong>使用私钥对数据解密。</li>
</ol> 
<p>2、服务器端完成客户端请求处理后，需经过以下几个步骤完成响应：</p> 
<ol>
<li>由<strong>服务器端</strong>使用私钥对待加密数据签名。</li>
<li>由<strong>服务器端</strong>使用私钥对数据加密。</li>
<li>由服<strong>务器</strong>向<strong>客户端</strong>回应加密数据和数字签名。</li>
<li>由<strong>客户端</strong>使用公钥对数据解密。</li>
<li>由<strong>客户端</strong>使用公钥和解密数据验证签名。</li>
</ol> 
<h3>
<a id="KeyTool_60"></a>KeyTool证书管理</h3> 
<p>KeyTool是Java中的数字证书管理工具，用于数字证书的申请、导入、导出和撤销等证书管理操作。</p> 
<p>官方文档https://docs.oracle.com/javase/8/docs/technotes/tools/windows/keytool.html</p> 
<p>KeyTool与本地密钥库相关联，将私钥存于密钥库，公钥则以数字证书输出。<code>KeyTool</code>位于<code>%JAVA_HOME%bin</code>目录中，需要通过命令行进行相应的操作。</p> 
<h5>
<a id="1_68"></a>1、构建自签名证书</h5> 
<blockquote> 
 <p>前面说了证书签发的流程，一般都是需要把公钥等相关信息发送给<strong>认证机构</strong>，认证机构颁发证书给我们。</p> 
 <p>如果我们自己给自己颁发证书这种，就被成为自签名证书。</p> 
</blockquote> 
<p>配置了<code>jdk</code>环境变量后就能直接在命令行输入<code>keytool</code>查看具体的命令，如果我们想看具体命令，输入相关命令后面加<code>--help</code>就可以了，如<code>keytool -genkeypair --help</code>。</p> 
<pre><code class="prism language-shell">密钥和证书管理工具

命令:

 <span class="token parameter variable">-certreq</span>            生成证书请求
 <span class="token parameter variable">-changealias</span>        更改条目的别名
 <span class="token parameter variable">-delete</span>             删除条目
 <span class="token parameter variable">-exportcert</span>         导出证书
 <span class="token parameter variable">-genkeypair</span>         生成密钥对
 <span class="token parameter variable">-genseckey</span>          生成密钥
 <span class="token parameter variable">-gencert</span>            根据证书请求生成证书
 <span class="token parameter variable">-importcert</span>         导入证书或证书链
 <span class="token parameter variable">-importpass</span>         导入口令
 <span class="token parameter variable">-importkeystore</span>     从其他密钥库导入一个或所有条目
 <span class="token parameter variable">-keypasswd</span>          更改条目的密钥口令
 <span class="token parameter variable">-list</span>               列出密钥库中的条目
 <span class="token parameter variable">-printcert</span>          打印证书内容
 <span class="token parameter variable">-printcertreq</span>       打印证书请求的内容
 <span class="token parameter variable">-printcrl</span>           打印 CRL 文件的内容
 <span class="token parameter variable">-storepasswd</span>        更改密钥库的存储口令

使用 <span class="token string">"keytool -?, -h, or --help"</span> 可输出此帮助消息
使用 <span class="token string">"keytool -command_name --help"</span> 可获取 command_name 的用法。
使用 <span class="token parameter variable">-conf</span> <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span> 选项可指定预配置的选项文件。
</code></pre> 
<p>在构建证书前，需要生成密钥对，也就是基于某一种非对称加密算法的公私钥。</p> 
<p>输入<code>keytool -genkeypair --help</code>就能看到<code>genkeypair</code>命令的相关参数。</p> 
<pre><code class="prism language-shell">keytool <span class="token parameter variable">-genkeypair</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>.

生成密钥对

选项:

 <span class="token parameter variable">-alias</span> <span class="token operator">&lt;</span>alias<span class="token operator">&gt;</span>          要处理的条目的别名
 <span class="token parameter variable">-keyalg</span> <span class="token operator">&lt;</span>alg<span class="token operator">&gt;</span>           密钥算法名称
 <span class="token parameter variable">-keysize</span> <span class="token operator">&lt;</span>size<span class="token operator">&gt;</span>         密钥位大小
 <span class="token parameter variable">-groupname</span> <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>       Group name. For example, an Elliptic Curve name.
 <span class="token parameter variable">-sigalg</span> <span class="token operator">&lt;</span>alg<span class="token operator">&gt;</span>           签名算法名称
 <span class="token parameter variable">-destalias</span> <span class="token operator">&lt;</span>alias<span class="token operator">&gt;</span>      目标别名
 <span class="token parameter variable">-dname</span> <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>           唯一判别名
 <span class="token parameter variable">-startdate</span> <span class="token operator">&lt;</span>date<span class="token operator">&gt;</span>       证书有效期开始日期/时间
 <span class="token parameter variable">-ext</span> <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>            X.509 扩展
 <span class="token parameter variable">-validity</span> <span class="token operator">&lt;</span>days<span class="token operator">&gt;</span>        有效天数
 <span class="token parameter variable">-keypass</span> <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>          密钥口令
 <span class="token parameter variable">-keystore</span> <span class="token operator">&lt;</span>keystore<span class="token operator">&gt;</span>    密钥库名称
 <span class="token parameter variable">-storepass</span> <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>        密钥库口令
 <span class="token parameter variable">-storetype</span> <span class="token operator">&lt;</span>type<span class="token operator">&gt;</span>       密钥库类型
 <span class="token parameter variable">-providername</span> <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>    提供方名称
 <span class="token parameter variable">-addprovider</span> <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>     按名称 <span class="token punctuation">(</span>例如 SunPKCS11<span class="token punctuation">)</span> 添加安全提供方
   <span class="token punctuation">[</span>-providerarg <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token punctuation">]</span>    配置 <span class="token parameter variable">-addprovider</span> 的参数
 <span class="token parameter variable">-providerclass</span> <span class="token operator">&lt;</span>class<span class="token operator">&gt;</span>  按全限定类名添加安全提供方
   <span class="token punctuation">[</span>-providerarg <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token punctuation">]</span>    配置 <span class="token parameter variable">-providerclass</span> 的参数
 <span class="token parameter variable">-providerpath</span> <span class="token operator">&lt;</span>list<span class="token operator">&gt;</span>    提供方类路径
 <span class="token parameter variable">-v</span>                      详细输出
 <span class="token parameter variable">-protected</span>              通过受保护的机制的口令

使用 <span class="token string">"keytool -?, -h, or --help"</span> 可输出此帮助消息
</code></pre> 
<p>这里我们使用<code>www.abc.org</code>作为别名，使用RSA作为加密算法，并规定密钥长度为2048位，使用<code>SHA256withRSA</code>作为数字签名算法，欲签发有效期为36000天的数字证书。</p> 
<p>完整命令如下:</p> 
<pre><code class="prism language-shell">keytool <span class="token parameter variable">-genkeypair</span> <span class="token parameter variable">-keyalg</span> RSA <span class="token parameter variable">-keysize</span> <span class="token number">2048</span> <span class="token parameter variable">-sigalg</span> SHA256withRSA <span class="token parameter variable">-validity</span> <span class="token number">36000</span> <span class="token parameter variable">-alias</span> www.abc.org <span class="token parameter variable">-keystore</span> abc.p12 <span class="token parameter variable">-storepass</span> <span class="token number">123456</span> <span class="token parameter variable">-dname</span> <span class="token string">"CN=www.abc.org,OU=a,O=a,L=BJ,ST=BJ,C=CN"</span>
</code></pre> 
<blockquote> 
 <p><code>-genkeypair</code> 生成密钥对。</p> 
 <p><code>-keyalg</code> 指定密钥算法，这里指定为RSA算法。</p> 
 <p><code>-keysize</code> 指定密钥长度，默认1024位，这里指定为2048位.</p> 
 <p><code>-sigalg</code> 指定数字签名算法，这里指定为SHA256withRSA算法。</p> 
 <p><code>-validity</code> 指定证书有效期，这里指定为36000天。</p> 
 <p><code>-alias</code> 指定别名，这里是www.abc.org。</p> 
 <p><code>-keystore</code> 指定密钥库存储位置，这里是abc.keystore.</p> 
 <hr> 
 <p>KeyTool工具支持RSA和DSA共2种算法，且DSA算法为默认算法。</p> 
 <p><code>-storepass</code> 参数可以不在命令行输入，回车后就会提示要求输入</p> 
 <p><code>-dname</code>参数也可以不在命令行输入，回车后就会提示要求输入</p> 
</blockquote> 
<p>这时就会在当前目录下生成一个<code>abc.p12</code>，这就是创建的数字证书。虽然这时的数字证书并没有经过CA认证，但并不影响我们使用。</p> 
<p>下来可以将数字证书导出，发送给需要通信的对方进行加密交互。<code>KeyTool</code>通过<code>-exportcert</code>命令导出证书。</p> 
<pre><code class="prism language-shell">keytool <span class="token parameter variable">-exportcert</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>.

导出证书

选项:

 <span class="token parameter variable">-rfc</span>                    以 RFC 样式输出
 <span class="token parameter variable">-alias</span> <span class="token operator">&lt;</span>alias<span class="token operator">&gt;</span>          要处理的条目的别名
 <span class="token parameter variable">-file</span> <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span>            输出文件名
 <span class="token parameter variable">-keystore</span> <span class="token operator">&lt;</span>keystore<span class="token operator">&gt;</span>    密钥库名称
 <span class="token parameter variable">-cacerts</span>                访问 cacerts 密钥库
 <span class="token parameter variable">-storepass</span> <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span>        密钥库口令
 <span class="token parameter variable">-storetype</span> <span class="token operator">&lt;</span>type<span class="token operator">&gt;</span>       密钥库类型
 <span class="token parameter variable">-providername</span> <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>    提供方名称
 <span class="token parameter variable">-addprovider</span> <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>     按名称 <span class="token punctuation">(</span>例如 SunPKCS11<span class="token punctuation">)</span> 添加安全提供方
   <span class="token punctuation">[</span>-providerarg <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token punctuation">]</span>    配置 <span class="token parameter variable">-addprovider</span> 的参数
 <span class="token parameter variable">-providerclass</span> <span class="token operator">&lt;</span>class<span class="token operator">&gt;</span>  按全限定类名添加安全提供方
   <span class="token punctuation">[</span>-providerarg <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token punctuation">]</span>    配置 <span class="token parameter variable">-providerclass</span> 的参数
 <span class="token parameter variable">-providerpath</span> <span class="token operator">&lt;</span>list<span class="token operator">&gt;</span>    提供方类路径
 <span class="token parameter variable">-v</span>                      详细输出
 <span class="token parameter variable">-protected</span>              通过受保护的机制的口令

使用 <span class="token string">"keytool -?, -h, or --help"</span> 可输出此帮助消息
</code></pre> 
<p>完整的导出命令如下：</p> 
<pre><code class="prism language-shell">keytool <span class="token parameter variable">-exportcert</span> <span class="token parameter variable">-alias</span> www.abc.org <span class="token parameter variable">-keystore</span> abc.p12 <span class="token parameter variable">-file</span> abc.cer <span class="token parameter variable">-rfc</span>  <span class="token parameter variable">-storepass</span> <span class="token number">123456</span>
</code></pre> 
<blockquote> 
 <p><code>-exportcert</code> 证书导出操作。</p> 
 <p><code>-alias</code> 指定导别名，这里为www.abc.org。</p> 
 <p><code>-keystore</code> 指定密钥库文件，这里为abc.keystore</p> 
 <p><code>-file</code> 指定导出文件路径，这里为abc.cer</p> 
 <p><code>-rfc</code> 指定以Base64编码格式输出</p> 
 <p><code>-storepass</code> 密钥库口令</p> 
</blockquote> 
<p>这时就会在当前目录下生成<code>abc.cer</code>。</p> 
<p>我们可以使用<code>keytool -printcert -file abc.cer</code>命令查看<code>abc.cer</code>文件的内容。</p> 
<blockquote> 
 <p>我们可以使用<code>keytool -printcert -file abc.cer -rfc</code> 已文本形式查看<code>abc.cer</code>文件的内容。</p> 
 <p>我们是用<code>notepad++</code>之类的文本工具也可以打开<code>abc.cer</code>。会发现它和上面<code>rfc</code>参数显示的内容是一样的。</p> 
</blockquote> 
<p>我们可以使用<code>keytool -list -alias www.abc.org -keystore abc.p12 -v</code>命令查看<code>abc.p12</code>文件的内容。</p> 
<blockquote> 
 <p><code>-alias www.abc.org</code>指定了要看<code>www.abc.org</code>证书的信息。去掉这个参数，会显示证书中所有的条目。</p> 
 <p><code>abc.p12</code>这种数字证书中是可以存储多个证书条目</p> 
</blockquote> 
<p>通过KeyTool工具直接导出的证书，是一个自签名的<code>X.509</code>第三版类型的根证书，并以<code>Base64</code>编码保存。</p> 
<blockquote> 
 <p>自签名证书虽然可以使用，但未经过CA机构认证，几乎没有任何法律效力，也毫无安全可言。</p> 
 <p><code>abc.p12</code>这个包含私钥和公钥。<code>abc.cer</code>只包含公钥。</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token builtin class-name">echo</span> PFX证书导入JKS密钥库
keytool <span class="token parameter variable">-importkeystore</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-srckeystore</span>   client.p12 <span class="token parameter variable">-srcstoretype</span> pkcs12 - srcstorepass <span class="token number">123456</span> <span class="token parameter variable">-destkeystore</span> client.keystore <span class="token parameter variable">-deststoretype</span> jks - deststorepass <span class="token number">123456</span>
<span class="token comment">#-importkeystore     导入密钥库，通过格式设定可以将PKCS#12文件转换为JKS格式。</span>
<span class="token comment">#-v                  显示详情。</span>
<span class="token comment">#-srckeystore        源密钥库，这里是d:zlex.pfx。</span>
<span class="token comment">#-srcstoretype       源密钥库格式，这里为pkcs12。</span>
<span class="token comment">#-srcstorepass       源密钥库密码，这里为123456。</span>
<span class="token comment">#-destkeystore       目标密钥库，这里为d:zlex.keystore。</span>
<span class="token comment">#-deststoretype      目标密钥库格式，这里为JKS，默认值也如此。</span>
<span class="token comment">#-deststorepass      目标密钥库密码，这里为123456。</span>
</code></pre> 
<h5>
<a id="2springboot_257"></a>2、springboot中使用证书</h5> 
<p>2.1 在<code>springboot的配置文件中添加如下内容</code>:</p> 
<pre><code class="prism language-properties">server.ssl.enabled=true
#NONE?WANT?NEED
server.ssl.client-auth=NONE
#server.ssl.protocol=TLS
server.ssl.key-store=classpath:certs/abc.p12
#server.ssl.key-password=123456
server.ssl.key-store-password=123456
server.ssl.key-store-type=PKCS12
server.ssl.keyAlias=www.abc.org
</code></pre> 
<p>2.2 将上面生成的abc.p12放置到<code>resources/certs/abc.p12</code>这个位置。</p> 
<p>启动工程，再通过<code>https</code>浏览器访问<code>url</code>就可以了。同时我们也可以通过浏览器导出证书。我们对比浏览器导出的证书和我们之前通过命令行导出的<code>abc.cer</code>,会发现两者的内容是一摸一样的。</p> 
<h5>
<a id="3java_281"></a>3、在<code>java</code>代码是如何使用这些证书的：</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">KeyStore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PrivateKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PublicKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">Signature</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span></span><span class="token class-name">Certificate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span></span><span class="token class-name">CertificateFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span></span><span class="token class-name">X509Certificate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Cipher</span></span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 证书组件
 * @author 梁栋
 * @version 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CertificateCoder</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 类型证书X.509</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CERT_TYPE</span> <span class="token operator">=</span> <span class="token string">"X.509"</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 由KeyStore获得私钥
     * @param keyStorePath 密钥库路径
     * @param alias 别名
     * @param password 密码
     * @return PrivateKey 私钥
     * @throws Exception
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">PrivateKey</span> <span class="token function">getPrivateKeyByKeyStore</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyStorePath<span class="token punctuation">,</span>
    <span class="token class-name">String</span> alias<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 获得密钥库</span>
           <span class="token class-name">KeyStore</span> ks <span class="token operator">=</span> <span class="token function">getKeyStore</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 获得私钥</span>
           <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">PrivateKey</span><span class="token punctuation">)</span> ks<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span> password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 由Certificate获得公钥
     * @param certificatePath 证书路径
     * @return PublicKey 公钥
     * @throws Exception
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">PublicKey</span> <span class="token function">getPublicKeyByCertificate</span><span class="token punctuation">(</span><span class="token class-name">String</span> certificatePath<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 获得证书</span>
           <span class="token class-name">Certificate</span> certificate <span class="token operator">=</span> <span class="token function">getCertificate</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 获得公钥</span>
           <span class="token keyword">return</span> certificate<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 获得Certificate
     * @param certificatePath 证书路径
     * @return Certificate 证书
     * @throws Exception
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Certificate</span> <span class="token function">getCertificate</span><span class="token punctuation">(</span><span class="token class-name">String</span> certificatePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 实例化证书工厂</span>
           <span class="token class-name">CertificateFactory</span> certificateFactory <span class="token operator">=</span> <span class="token class-name">CertificateFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token constant">CERT_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 取得证书文件流</span>
           <span class="token class-name">FileInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 生成证书</span>
           <span class="token class-name">Certificate</span> certificate <span class="token operator">=</span> certificateFactory<span class="token punctuation">.</span><span class="token function">generateCertificate</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 关闭证书文件流</span>
           in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> certificate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 获得Certificate
     * @param keyStorePath 密钥库路径
     * @param alias 别名
     * @param password 密码
     * @return Certificate 证书
     * @throws Exception
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Certificate</span> <span class="token function">getCertificate</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyStorePath<span class="token punctuation">,</span> <span class="token class-name">String</span> alias<span class="token punctuation">,</span>
    <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 获得密钥库</span>
           <span class="token class-name">KeyStore</span> ks <span class="token operator">=</span> <span class="token function">getKeyStore</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 获得证书</span>
           <span class="token keyword">return</span> ks<span class="token punctuation">.</span><span class="token function">getCertificate</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 获得KeyStore
     * @param keyStorePath 密钥库路径
     * @param password 密码
     * @return KeyStore 密钥库
     * @throws Exception
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">KeyStore</span> <span class="token function">getKeyStore</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyStorePath<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 实例化密钥库</span>
           <span class="token class-name">KeyStore</span> ks <span class="token operator">=</span> <span class="token class-name">KeyStore</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">KeyStore</span><span class="token punctuation">.</span><span class="token function">getDefaultType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 获得密钥库文件流</span>
           <span class="token class-name">FileInputStream</span> is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 加载密钥库</span>
           ks<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 关闭密钥库文件流</span>
           is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> ks<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 私钥加密
     * @param data 待加密数据
     * @param keyStorePath 密钥库路径
     * @param alias 别名
     * @param password 密码
     * @return byte[] 加密数据
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> keyStorePath<span class="token punctuation">,</span>
    <span class="token class-name">String</span> alias<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 取得私钥</span>
           <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> <span class="token function">getPrivateKeyByKeyStore</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 对数据加密</span>
           <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token constant">ENCRYPT_MODE</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 私钥解密
     * @param data 待解密数据
     * @param keyStorePath 密钥库路径
     * @param alias 别名
     * @param password 密码
     * @return byte[] 解密数据
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> keyStorePath<span class="token punctuation">,</span>
    <span class="token class-name">String</span> alias<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 取得私钥</span>
           <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> <span class="token function">getPrivateKeyByKeyStore</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 对数据加密</span>
           <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token constant">DECRYPT_MODE</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 公钥加密
     * @param data 待加密数据
     * @param certificatePath 证书路径
     * @return byte[] 加密数据
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> certificatePath<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 取得公钥</span>
           <span class="token class-name">PublicKey</span> publicKey <span class="token operator">=</span> <span class="token function">getPublicKeyByCertificate</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 对数据加密</span>
           <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token constant">ENCRYPT_MODE</span><span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 公钥解密
     * @param data 待解密数据
     * @param certificatePath 证书路径
     * @return byte[] 解密数据
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> certificatePath<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 取得公钥</span>
           <span class="token class-name">PublicKey</span> publicKey <span class="token operator">=</span> <span class="token function">getPublicKeyByCertificate</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 对数据加密</span>
           <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token constant">DECRYPT_MODE</span><span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 签名
     * @param keyStorePath 密钥库路径
     * @param alias 别名
     * @param password 密码
     * @return byte[] 签名
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign<span class="token punctuation">,</span> <span class="token class-name">String</span> keyStorePath<span class="token punctuation">,</span> <span class="token class-name">String</span> alias<span class="token punctuation">,</span>
    <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 获得证书</span>
           <span class="token class-name">X509Certificate</span> x509Certificate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">X509Certificate</span><span class="token punctuation">)</span> getCertificate
           <span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 构建签名，由证书指定签名算法</span>
           <span class="token class-name">Signature</span> signature <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">.</span>getInstance <span class="token punctuation">(</span>x509Certificate<span class="token punctuation">.</span><span class="token function">getSigAlgName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 获取私钥</span>
           <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> <span class="token function">getPrivateKeyByKeyStore</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 初始化签名，由私钥构建</span>
           signature<span class="token punctuation">.</span><span class="token function">initSign</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
           signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 验证签名
     * @param data 数据
     * @param sign 签名
     * @param certificatePath 证书路径
     * @return boolean 验证通过为真
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign<span class="token punctuation">,</span> <span class="token class-name">String</span> certificatePath<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 获得证书</span>
           <span class="token class-name">X509Certificate</span> x509Certificate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">X509Certificate</span><span class="token punctuation">)</span><span class="token function">getCertificate</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 由证书构建签名</span>
           <span class="token class-name">Signature</span> signature <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>x509Certificate<span class="token punctuation">.</span><span class="token function">getSigAlgName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 由证书初始化签名，实际上是使用了证书中的公钥</span>
           signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>x509Certificate<span class="token punctuation">)</span><span class="token punctuation">;</span>
           signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>binary<span class="token punctuation">.</span></span><span class="token class-name">Hex</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span></span><span class="token class-name">CertificateCoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>testng<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 证书校验
 * @author 梁栋
 * @version 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CertificateCoderTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"123456"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> alias <span class="token operator">=</span> <span class="token string">"www.abc.org"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> certificatePath <span class="token operator">=</span> <span class="token string">"D:\tmp\a\abc.cer"</span><span class="token punctuation">;</span>  <span class="token comment">//证书位置</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> keyStorePath <span class="token operator">=</span> <span class="token string">"D:\tmp\a\abc.p12"</span><span class="token punctuation">;</span>     <span class="token comment">//证书位置</span>
    <span class="token comment">/**
     * 公钥加密—私钥解密
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"公钥加密—私钥解密"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">String</span> inputStr <span class="token operator">=</span> <span class="token string">"数字证书"</span><span class="token punctuation">;</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> inputStr<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 公钥加密</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encrypt <span class="token operator">=</span> <span class="token class-name">CertificateCoder</span><span class="token punctuation">.</span><span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 私钥解密</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decrypt <span class="token operator">=</span> <span class="token class-name">CertificateCoder</span><span class="token punctuation">.</span><span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span>encrypt<span class="token punctuation">,</span> keyStorePath<span class="token punctuation">,</span>
           alias<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">String</span> outputStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decrypt<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"加密前:n"</span> <span class="token operator">+</span> inputStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后:n"</span> <span class="token operator">+</span> outputStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 验证数据一致</span>
           <span class="token function">assertArrayEquals</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> decrypt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 私钥加密—公钥解密
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"私钥加密—公钥解密"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">String</span> inputStr <span class="token operator">=</span> <span class="token string">"数字签名"</span><span class="token punctuation">;</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> inputStr<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 私钥加密</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encodedData <span class="token operator">=</span> <span class="token class-name">CertificateCoder</span><span class="token punctuation">.</span><span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>
           keyStorePath<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 公钥加密</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decodedData <span class="token operator">=</span> <span class="token class-name">CertificateCoder</span><span class="token punctuation">.</span><span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span>encodedData<span class="token punctuation">,</span>
           certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">String</span> outputStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decodedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"加密前:n"</span> <span class="token operator">+</span> inputStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后:n"</span> <span class="token operator">+</span> outputStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token function">assertEquals</span><span class="token punctuation">(</span>inputStr<span class="token punctuation">,</span> outputStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 签名验证
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSign</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
           <span class="token class-name">String</span> inputStr <span class="token operator">=</span> <span class="token string">"签名"</span><span class="token punctuation">;</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> inputStr<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"私钥签名—公钥验证"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 产生签名</span>
           <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign <span class="token operator">=</span> <span class="token class-name">CertificateCoder</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> keyStorePath<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"签名:n"</span> <span class="token operator">+</span> <span class="token class-name">Hex</span><span class="token punctuation">.</span><span class="token function">encodeHexString</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 验证签名</span>
           <span class="token keyword">boolean</span> status <span class="token operator">=</span> <span class="token class-name">CertificateCoder</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> sign<span class="token punctuation">,</span> certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"状态:n"</span> <span class="token operator">+</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 校验</span>
           <span class="token function">assertTrue</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>2、双向验证</p> 
<p>一般来说只有客户端会验证服务端的证书，服务端不会验证客户端。但是一些特殊场景，安全级别要求高的地方，也会验证客户端。比如我们早些年网银用的<code>U盾</code>,就是将客户端证书置于<code>U</code>中，登录网银的时候，服务端也会验证我们客户端的证书。</p> 
<p>单向验证和双向验证的机制都是一样的。我们简单就客户端侧验证描述下：</p> 
<p><img src="https://images2.imgbox.com/dd/b4/UVXTEIjg_o.png" alt="在这里插入图片描述"></p> 
<p>1 首先服务端的证书一般都是经过<code>CA机构</code>使用私钥加密过的。</p> 
<p>2.浏览器接收服务端的证书后，会查找对应的签发机构的公钥：</p> 
<p>2.1 如果对应签发机构的证书在可信列表中，就会直接拿来验证服务器的证书。</p> 
<p>2.2 如果对应签发机构的证书不在可信列表中。如果签发机构的证书是自签名证书，这时就可以直接判断服务器证书是不可信证书，直接结束；如果不是自签名证书，继续向上虚招签发机构证书的签发机构证书，继续验证。</p> 
<p>如果我们使用<code>springboot</code>来验证客户端证书，就需要先在客户端也生成一套自签名证书，把它进行安装，同时将它的公钥证书作为可信证书添加 到<code>springboot</code>的可信证书列表中。</p> 
<pre><code class="prism language-shell">keytool <span class="token parameter variable">-genkeypair</span> <span class="token parameter variable">-keyalg</span> RSA <span class="token parameter variable">-keysize</span> <span class="token number">2048</span> <span class="token parameter variable">-sigalg</span> SHA256withRSA <span class="token parameter variable">-validity</span> <span class="token number">36000</span> <span class="token parameter variable">-alias</span> www.client.org <span class="token parameter variable">-keystore</span> client.p12 <span class="token parameter variable">-storepass</span> <span class="token number">123456</span> <span class="token parameter variable">-dname</span> <span class="token string">"CN=www.client.org,OU=a,O=a,L=BJ,ST=BJ,C=CN"</span>
keytool <span class="token parameter variable">-exportcert</span> <span class="token parameter variable">-keystore</span> client.p12 <span class="token parameter variable">-alias</span>  www.client.org   <span class="token parameter variable">-file</span> client.crt  <span class="token parameter variable">-storepass</span> <span class="token number">123456</span>
</code></pre> 
<p>我们使用上面两行命令生成客户端的证书，然后进行安装。</p> 
<p>如果没有安装证书，打开<code>client.crt</code>就会看到证书是不可信的。</p> 
<p><img src="https://images2.imgbox.com/e5/cc/uEjq7ftP_o.png" alt="在这里插入图片描述"></p> 
<p>安装<code>client.p12</code>、<code>client.crt</code>后，再打开就会看到的，表明当前证书已经在可信列表。</p> 
<p><img src="https://images2.imgbox.com/b2/3c/i0XLSuRJ_o.png" alt="在这里插入图片描述"></p> 
<p>现在我们把客户端证书导入一个可信列表。</p> 
<pre><code class="prism language-shell">keytool <span class="token parameter variable">-importcert</span> <span class="token parameter variable">-trustcacerts</span> <span class="token parameter variable">-alias</span>  www.client.org <span class="token parameter variable">-file</span> client.crt <span class="token parameter variable">-keystore</span> abc.p12  <span class="token parameter variable">-storepass</span> <span class="token number">123456</span>
</code></pre> 
<blockquote> 
 <p><code>-importcert</code> 导入数字证书。</p> 
 <p><code>-trustcacerts</code> 将数字证书导入信任库。</p> 
 <p><code>-alias</code> 指定导别名，这里为www.abc.org。</p> 
 <p><code>-file</code> 指定导入数字证书文件路径，这里为<code>abc.cer</code>。</p> 
 <p><code>-keystore</code> 指定密钥库文件，这里为<code>abc.p12</code>。</p> 
</blockquote> 
<p>我这里是导入了之前的<code>abc.p12</code>，可以选择不同的文件导入，如果文件不存在，就会新创建一个文件。</p> 
<p>使用<code>keytool -list -alias www.client.org -keystore abc.p12</code>命令就会看到它是一个<code>trustedCertEntry</code>条目。</p> 
<p><img src="https://images2.imgbox.com/63/a8/PsAhRhUz_o.png" alt="在这里插入图片描述"></p> 
<p>修改我们<code>springboot</code>配置文件如下：</p> 
<pre><code class="prism language-properties"># ??ssl
server.ssl.enabled=true
#NONE?WANT?NEED
server.ssl.client-auth=NEED
#server.ssl.protocol=TLS
server.ssl.key-store=classpath:certs/abc.p12
#server.ssl.key-password=123456
server.ssl.key-store-password=123456
server.ssl.key-store-type=PKCS12
server.ssl.keyAlias=www.abc.org

server.ssl.trust-store=classpath:certs/abc.p12
server.ssl.trust-store-password=123456
server.ssl.trust-store-type=JKS
server.ssl.trust-store-provider=SUN

</code></pre> 
<p>重新拷贝<code>abc.p12</code>到<code>resources/certs/abc.p12</code>,启动服务端。</p> 
<p>再次通过浏览器访问就会看到浏览器提示服务端要验证客户端证书。</p> 
<blockquote> 
 <p>注意，需要先安装客户端证书<code>client.p12</code>、<code>client.crt</code>。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/e4/45/1fD2Ursv_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>keytool -importcert -trustcacerts -alias www.abc.org -file abc.crt -keystore client.p12 -storepass 123456<br> 如果是工具去操作，还需要将服务端证书添加到客户端的可信列表中去。</p> 
</blockquote> 
<h3>
<a id="OPENSSL_680"></a>OPENSSL</h3> 
<h5>
<a id="1_682"></a>1、构建证书链</h5> 
<pre><code class="prism language-SHELL"> 
echo 构建已发行证书存放目录 certs
mkdir certs

echo 构建新证书存放目录 newcerts
mkdir newcerts

echo 构建私钥存放目录 private
mkdir private

echo 构建证书吊销列表存放目录 crl
mkdir crl

echo 构建索引文件 index.txt
echo 0&gt;index.txt

echo 构建序列号文件 serial
echo 01&gt;serial

echo 构建随机数 private/.rand
openssl rand -out private/.rand 1000
#rand         随机数命令。
#-out         输出文件路径，这里将随机数文件输出到private目录下。


echo 构建根证书私钥 private/ca.key.pem
openssl genrsa  -out private/ca.key.pem 2048
# -aes256  参数会对生成的私钥进行加密，如果需要密码，就可以使用这个参数 
#openssl genrsa   -aes256 -out private/ca.key.pem 2048
#genrsa         产生RSA密钥命令。
#-aes256        使用AES算法（256位密钥）对产生的私钥加密。可选算法包括DES、DESede、IDEA和AES。
#-out           输出路径，这里指private/ca.key.pem。


echo 生成根证书签发申请 private/ca.csr
openssl req -new -key private/ca.key.pem -out private/ca.csr -subj   "/C=CN/ST=BJ/L=BJ/O=abc/OU=abc/CN=*.abc.org"
#req     产生证书签发申请命令。
#-new    表示新请求。
#-key    密钥，这里为private/ca.key.pem文件。
#-out    输出路径，这里为private/ca.csr文件。
#-subj   指定用户信息，这里使用泛域名“*.abc.org”作为用户名。


echo 签发根证书 private/ca.cer
openssl   x509   -req   -days   10000   -sha1   -extensions   v3_ca   -signkey  private/ca.key.pem -in private/ca.csr -out certs/ca.cer
#x509         签发X.509格式证书命令。
#-req         证书输入请求。
#-days        有效天数，这里为10000天。
#-sha1        证书摘要算法，这里为SHA1算法。
#-extensions  按OpenSSL配置文件v3_ca项添加扩展。
#-signkey     自签名密钥，这里为private/ca.key.pem。
#-in          输入文件，这里为private/ca.csr。
#-out         输出文件，这里为certs/ca.cer。




echo 构建服务器私钥 private/server.key.pem
openssl genrsa -out private/server.key.pem 2048
#参数上面已经有过介绍

echo 生成服务器证书签发申请 private/server.csr
openssl req -new -key private/server.key.pem -out private/server.csr -subj "/C=CN/ST=BJ/L=BJ/O=abc/OU=abc/CN=www.abc.org"
#参数上面已经有过介绍

echo 签发服务器证书 private/server.cer
openssl x509 -req -days 3650 -sha1 -extensions v3_req -CA certs/ca.cer -CAkey   private/ca.key.pem -CAserial ca.srl -CAcreateserial -in private/server.csr -out   certs/server.cer
#x509             签发X.509格式证书命令。
#-req             证书输入请求。
#-days            有效天数，这里为3650天。
#-sha1            证书摘要算法，这里为SHA1算法。
#-extensions      按OpenSSL配置文件v3_req项添加扩展。
#-CA              CA证书，这里为certs/ca.cer。
#-CAkey           CA证书密钥，这里为private/ca.key.pem。
#-CAserial        CA证书序列号文件，这里为ca.srl。
#-CAcreateserial  创建CA证书序列号。
#-in              输入文件，这里为private/server.csr。
#-out             输出文件，这里为certs/server.cer。


echo 产生客户私钥 private/client.key.pem
openssl genrsa  -out private/client.key.pem 2048
#参数上面已经有过介绍


echo 生成客户证书签发申请 client.csr
openssl req -new -key private/client.key.pem -out private/client.csr -subj  "/C=CN/ST=BJ/L=BJ/O=abc/OU=abc/CN=client"
#参数上面已经有过介绍


echo 签发客户证书 certs/client.cer
openssl ca -days 3650 -in private/client.csr -out certs/client.cer -cert  certs/ca.cer -keyfile private/ca.key.pem
#ca          签发证书命令。
#-days       证书有效期，这里为3650天。
#-in         输入文件，这里为private/client.csr。
#-out        输出文件，这里为certs/server.cer。
#-cert       证书文件，这里为certs/ca.cer。
#-keyfile    根证书密钥文件，这里为private/ca.key.pem。

</code></pre> 
<p>执行完上面的命令会在当前目录下生成如下文件</p> 
<p><img src="https://images2.imgbox.com/20/fb/hptmk1xM_o.png" alt="在这里插入图片描述"></p> 
<p>下面我们分别转化成<code>PKCS#12编码格式</code></p> 
<pre><code class="prism language-SHELL">echo 根证书转换 private/ca.p12
openssl pkcs12 -export -cacerts -inkey private/ca.key.pem -in certs/ca.cer -out certs/ca.p12
#pkcs12     PKCS#12编码格式证书命令。
#-export    导出证书。
#-cacerts   仅导出CA证书。
#-inkey     输入密钥，这里为private/ca.key.pem。
#-in        输入文件，这里为certs/ca.cer。
#-out       输出文件，这里为certs/ca.p12。

#keytool -list -keystore certs/ca.p12 -storetype pkcs12 -v -storepass 123456 如果你的密码设置的是123456，使用这个命令就能查看内容  



echo 服务器证书转换 private/server.p12
openssl   pkcs12   -export   -clcerts   -inkey   private/server.key.pem   -in  certs/server.cer -out certs/server.p12
#pkcs12       PKCS#12编码格式证书命令。
#-export      导出证书。
#-clcerts     仅导出客户证书。
#-inkey       输入密钥文件路径，这里为private/server.key.pem。
#-in          输入文件路径，这里为certs/ca.cer。
#-out         输出文件路径，这里为certs/server.p12。



echo 客户证书转换 certs/client.p12
openssl pkcs12 -export -inkey  private/client.key.pem -in certs/client.cer -out  certs/client.p12

</code></pre> 
<h5>
<a id="2nginx_827"></a>2、下面我们使用nginx双向验证演示下。</h5> 
<p>放开<code>nginx</code>配置文件<code>nginx.conf</code>中关于<code>https</code>的部分，并添加如下图证书相关配置。</p> 
<p><img src="https://images2.imgbox.com/b9/35/rJGzW4Ku_o.png" alt="在这里插入图片描述"></p> 
<p>重启<code>nginx</code>。这时，由于我们客户端没有对应证书，浏览器访问会报如下错误。</p> 
<p><img src="https://images2.imgbox.com/05/8e/zUIa9kzH_o.png" alt="在这里插入图片描述"></p> 
<p>这时，在客户端安装<code>ca.cer</code>,<code>client.p12</code>两个证书，这时客户端就可以正常访问。</p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
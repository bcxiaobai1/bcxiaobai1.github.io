<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>全文检索-Elasticsearch-进阶检索 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">全文检索-Elasticsearch-进阶检索</h1>
			
		</header>
		<div class="content post__content clearfix">
			


        
                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <p></p> 
<div class="toc"> 
 <h3>文章目录</h3> 
 <ul>
<li><a href="#_1">前言</a></li>
<li><a href="#SearchAPI_3">一、SearchAPI</a></li>
<li>
<ul>
<li><a href="#11_URL__8">1.1 URL 后接参数检索</a></li>
<li><a href="#12_URL__32">1.2 URL 加请求体检索</a></li>
</ul> 
  </li>
<li><a href="#Query_DSL_56">二、Query DSL</a></li>
<li>
<ul>
<li><a href="#21__57">2.1 基本语法格式</a></li>
<li><a href="#22__match_91">2.2 匹配查询 match</a></li>
<li><a href="#23__match_phase_120">2.3 短语匹配 match_phase</a></li>
<li><a href="#24__multi_match_135">2.4 多字段匹配 multi_match</a></li>
<li><a href="#25__bool_155">2.5 复合查询 bool</a></li>
<li><a href="#26__filter_207">2.6 过滤 filter</a></li>
<li><a href="#27__term_229">2.7 查询 term</a></li>
<li><a href="#28__aggregations_249">2.8 聚合 aggregations</a></li>
</ul> 
  </li>
<li><a href="#Mapping_389">三、Mapping</a></li>
<li>
<ul>
<li><a href="#31__390">3.1 介绍</a></li>
<li><a href="#32__398">3.2 新版本改变</a></li>
<li><a href="#33__417">3.3 查询索引的映射</a></li>
<li><a href="#34__440">3.4 创建映射</a></li>
<li><a href="#35__469">3.5 添加新的字段映射</a></li>
<li><a href="#36__508">3.6 更新映射</a></li>
<li><a href="#37__511">3.7 数据迁移</a></li>
</ul> 
  </li>
<li><a href="#_609">四、分词</a></li>
<li>
<ul>
<li><a href="#41__ik__620">4.1 安装 ik 分词器</a></li>
<li><a href="#42__689">4.2 测试分词器</a></li>
<li><a href="#43__694">4.3 自定义词库</a></li>
</ul> 
  </li>
<li><a href="#_nginx_749">五、附录-安装 nginx</a></li>
<li>
<ul>
<li><a href="#51__750">5.1 安装步骤</a></li>
<li><a href="#52__819">5.2 创建分析文本</a></li>
</ul> 
 </li>
</ul> 
</div> 
<p></p> 
<h1>
<a id="_1"></a>前言</h1> 
<p>本文记录谷粒商城高级篇的 Elasticsearch 进阶检索部分，续上之前记录的 Elasticsearch入门篇。</p> 
<h1>
<a id="SearchAPI_3"></a>一、SearchAPI</h1> 
<p>ES 支持两种基本方式检索 :</p> 
<ul>
<li>一个是通过使用 REST request URI 发送搜索参数（uri + 检索参数）</li>
<li>另一个是通过使用 REST request body 来发送它们（uri + 请求体）</li>
</ul> 
<h2>
<a id="11_URL__8"></a>1.1 URL 后接参数检索</h2> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search  检索 bank 下所有信息，包括 type 和 docs  

GET bank<span class="token operator">/</span>_search<span class="token operator">?</span>q<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">&amp;</span>sort<span class="token operator">=</span>account_number<span class="token operator">:</span>asc 请求参数方式检索
</code></pre> 
<p><img src="https://images2.imgbox.com/de/fc/hHJzLtLD_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">响应结果解释：
took <span class="token operator">-</span> <span class="token class-name">Elasticsearch</span> 执行搜索的时间（毫秒）
time_out <span class="token operator">-</span> 告诉我们搜索是否超时
_shards <span class="token operator">-</span> 告诉我们多少个分片被搜索了，以及统计了成功<span class="token operator">/</span>失败的搜索分片
hits <span class="token operator">-</span> 搜索结果
hits<span class="token punctuation">.</span>total <span class="token operator">-</span> 搜索结果
hits<span class="token punctuation">.</span>hits <span class="token operator">-</span> 实际的搜索结果数组（默认为前 <span class="token number">10</span> 的文档）
sort <span class="token operator">-</span> 结果的排序 key（键）（没有则按 score 排序）
score 和 max_score <span class="token operator">-</span> 相关性得分和最高得分（全文检索用）
</code></pre> 
<h2>
<a id="12_URL__32"></a>1.2 URL 加请求体检索</h2> 
<p>请求体中写查询条件，语法：</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"account_number"</span><span class="token operator">:</span> <span class="token string">"asc"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"balance"</span><span class="token operator">:</span> <span class="token string">"desc"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>示例：查询出所有，先按照 accout_number 升序排序，再按照 balance 降序排序</p> 
<p><img src="https://images2.imgbox.com/58/7f/KLYi4MAJ_o.png" alt="在这里插入图片描述"></p> 
<h1>
<a id="Query_DSL_56"></a>二、Query DSL</h1> 
<h2>
<a id="21__57"></a>2.1 基本语法格式</h2> 
<p>Elasticsearch 提供了一个可以执行查询的 Json 风格的 DSL（domain-specific language 领域特定语言）。这个被称为 Query DSL。该查询语言非常全面，并且刚开始的时候感觉有点复杂，真正学好它的方法是从一些基础的示例开始的。</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"sort"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
 <span class="token punctuation">{<!-- --></span>
      <span class="token string">"balance"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"order"</span><span class="token operator">:</span> <span class="token string">"desc"</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"from"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token string">"_source"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"balance"</span><span class="token punctuation">,</span> <span class="token string">"firstname"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>示例：查询所有记录，按照 balance 降序排序，只返回第 11 条记录到第 20 条记录，只显示 balance 和 firstname 字段。</p> 
<p><img src="https://images2.imgbox.com/db/30/ImBwipkz_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">query 定义如何查询，
match_all 查询类型【代表查询所有的所有】，es 中可以在 query 中组合非常多的查
询类型完成复杂查询
除了 query 参数之外，我们也可以传递其它的参数以改变查询结果。如 sort，size
from <span class="token operator">+</span> size 限定，完成分页功能
sort 排序，多字段排序，会在前序字段相等时后续字段内部排序，否则以前序为准
_source 返回部分字段
</code></pre> 
<h2>
<a id="22__match_91"></a>2.2 匹配查询 match</h2> 
<p>1.基本类型 ( 非字符串 ) ，精确匹配</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"account_number"</span><span class="token operator">:</span> <span class="token string">"30"</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f4/fb/ruWqPNHl_o.png" alt="在这里插入图片描述"></p> 
<p>2.字符串，全文检索</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token operator">:</span> <span class="token string">"mill road"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>全文检索按照评分进行排序，会对检索条件进行分词匹配。<br> 查询 address 中包含 mill 或者 road 或者 mill road 的所有记录，并给出相关性得分。</p> 
</blockquote> 
<h2>
<a id="23__match_phase_120"></a>2.3 短语匹配 match_phase</h2> 
<p>将需要匹配的值当成一个整体单词 ( 不分词 ) 进行检索</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_phrase"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token operator">:</span> <span class="token string">"mill road"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="24__multi_match_135"></a>2.4 多字段匹配 multi_match</h2> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"multi_match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"query"</span><span class="token operator">:</span> <span class="token string">"mill land"</span><span class="token punctuation">,</span>
      <span class="token string">"fields"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"state"</span><span class="token punctuation">,</span>
        <span class="token string">"address"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<blockquote> 
 <p>multi_match 中的 query 也会进行分词。<br> 查询 state 包含 mill 或 land 或者 address 包含 mill 或 land 的记录。</p> 
</blockquote> 
<h2>
<a id="25__bool_155"></a>2.5 复合查询 bool</h2> 
<blockquote> 
 <p>复合语句可以合并任何其他查询语句，包括复合语句。复合语句之间可以相互嵌套，可以表达复杂的逻辑。</p> 
</blockquote> 
<p>搭配使用 must,must_not，should</p> 
<p>must: 必须达到 must 指定的条件。 ( 影响相关性得分 )</p> 
<p>must_not: 必须不满足 must_not 的条件。 ( 不影响相关性得分 )</p> 
<p>should: 如果满足 should 条件，则可以提高得分。如果不满足，也可以查询出记录。 ( 影响相关性得分 )</p> 
<p>示例：查询出地址包含 mill，且性别为 M，年龄不等于 28 的记录，且优先展示 firstname 包含 Winnie 的记录。</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"bool"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token string">"M"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"age"</span><span class="token operator">:</span> <span class="token string">"28"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"should"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"firstname"</span><span class="token operator">:</span> <span class="token string">"Winnie"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> 
<h2>
<a id="26__filter_207"></a>2.6 过滤 filter</h2> 
<blockquote> 
 <p>不影响相关性得分，查询出满足 filter 条件的记录。<br> 在 bool 中使用。</p> 
</blockquote> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"bool"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"filter"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"range"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"age"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"gte"</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
            <span class="token string">"lte"</span><span class="token operator">:</span> <span class="token number">30</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="27__term_229"></a>2.7 查询 term</h2> 
<blockquote> 
 <p>匹配某个属性的值。<br> 全文检索字段用 match，其他非 text 字段匹配用 term<br> keyword：文本精确匹配 ( 全部匹配 )<br> match_phase：文本短语匹配</p> 
</blockquote> 
<p>规范：非 text 字段精确匹配使用 term</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"age"</span><span class="token operator">:</span> <span class="token string">"20"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="28__aggregations_249"></a>2.8 聚合 aggregations</h2> 
<p>聚合提供了从数据中分组和提取数据的能力。最简单的聚合方法大致等于 SQL GROUP<br> BY 和 SQL 聚合函数。在 Elasticsearch 中，您有执行搜索返回 hits（命中结果），并且同时返回聚合结果，把一个响应中的所有 hits（命中结果）分隔开的能力。这是非常强大且有效的，您可以执行查询和多个聚合，并且在一次使用中得到各自的（任何一个的）返回结果，使用一次简洁和简化的 API 来避免网络往返。</p> 
<pre><code class="prism language-java"># 聚合语法
<span class="token string">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"&lt;聚合名称 1&gt;"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"&lt;聚合类型&gt;"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token operator">&lt;</span>聚合体内容<span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">"元数据"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token punctuation">[</span><span class="token generics"><span class="token punctuation">&lt;</span>meta_data_body<span class="token punctuation">&gt;</span></span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token operator">?</span>
        <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">"aggregations"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">[</span><span class="token generics"><span class="token punctuation">&lt;</span>sub_aggregation<span class="token punctuation">&gt;</span></span><span class="token punctuation">]</span><span class="token operator">+</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token operator">?</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">"聚合名称 2&gt;"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token operator">*</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>示例 1：搜索 address 中包含 mill 的所有人的年龄分布 ( 前 10 条 ) 以及平均年龄，以及平均薪资</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"aggAge"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span><span class="token punctuation">,</span>
        <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"ageAvg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"balanceAvg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>如果不想返回 hits 结果，可以在最后面设置 size:0</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token operator">:</span> <span class="token string">"mill"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"ageAggr"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span><span class="token punctuation">,</span>
        <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>示例 2：按照年龄聚合，并且请求这些年龄段的这些人的平均薪资</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"age_avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span><span class="token punctuation">,</span>
        <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">1000</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"banlances_avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>示例 3：查出所有年龄分布，并且这些年龄段中 M 的平均薪资和 F 的平均薪资以及这个年龄段的总体平均薪资</p> 
<pre><code class="prism language-java">GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"age_agg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"age"</span><span class="token punctuation">,</span>
        <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">100</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"gender_agg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"terms"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"gender.keyword"</span><span class="token punctuation">,</span>
            <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">100</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">"aggs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"balance_avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"balance_avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"avg"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"field"</span><span class="token operator">:</span> <span class="token string">"balance"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"size"</span><span class="token operator">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span>
</code></pre> 
<h1>
<a id="Mapping_389"></a>三、Mapping</h1> 
<h2>
<a id="31__390"></a>3.1 介绍</h2> 
<p>Mapping 是用来定义一个文档 (document) ，以及它所包含的属性 (field) 是如何存储和索引的。</p> 
<ul>
<li>定义哪些字符串属性应该被看做全文本属性 (full text fields)</li>
<li>定义哪些属性包含数字，日期或地理位置</li>
<li>定义文档中的所有属性是否都能被索引 (_all 配置)</li>
<li>日期的格式</li>
<li>自定义映射规则来执行动态添加属性</li>
</ul> 
<h2>
<a id="32__398"></a>3.2 新版本改变</h2> 
<p><strong>ES7 去 tpye 概念</strong></p> 
<p>关系型数据库中两个数据库表示是独立的，即使他们里面有相同名称的列也不影响使用，但 ES 中不是这样的。elasticsearch 是基于 Lucence 开发的搜索引擎，而 ES 中不同 type 下名称相同的 field 最终在 Lucence 中的处理方式是一样的。</p> 
<ul>
<li>为了区分不同 type 下的同一名称的字段，Lucence 需要处理冲突，导致检索效率下降</li>
<li>去掉type就是为了提高ES处理数据的效率。</li>
</ul> 
<p>ES7.x 版本：URL 中的 type 参数为可选。</p> 
<ul><li>URL中的type参数为可选。比如，索引一个文档不再要求提供文档类型。</li></ul> 
<p>ES8.x 版本：不支持 URL 中的 type 参数</p> 
<ul><li>不再支持URL中的type参数。</li></ul> 
<p>解决：将索引从多类型迁移到单类型，每种类型文档一个独立索引</p> 
<p>所有类型可以参考文档:<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/mapping-types.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/mapping-types.html</a></p> 
<h2>
<a id="33__417"></a>3.3 查询索引的映射</h2> 
<pre><code class="prism language-java">GET my<span class="token operator">-</span>index<span class="token operator">/</span>_mapping
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"my-index"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"mappings"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"age"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"integer"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"email"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"name"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="34__440"></a>3.4 创建映射</h2> 
<pre><code class="prism language-java">PUT <span class="token operator">/</span>my<span class="token operator">-</span>index
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"age"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"email"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"name"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java">#返回结果
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"acknowledged"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">"shards_acknowledged"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">"index"</span> <span class="token operator">:</span> <span class="token string">"my-index"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="35__469"></a>3.5 添加新的字段映射</h2> 
<pre><code class="prism language-java">PUT <span class="token operator">/</span>my<span class="token operator">-</span>index<span class="token operator">/</span>_mapping
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"employee-id"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
      <span class="token string">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# index控制属性值是否被索引<span class="token punctuation">,</span>默认是<span class="token boolean">true</span>。<span class="token boolean">false</span>的话就是不被索引<span class="token punctuation">,</span>作为冗余存储
</code></pre> 
<p>查看添加新字段的变化</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"my-index"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"mappings"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"age"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"integer"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"email"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"employee-id"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
          <span class="token string">"index"</span> <span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"name"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2>
<a id="36__508"></a>3.6 更新映射</h2> 
<p>对于已经存在的映射字段，我们不能更新。更新必须创建新的索引进行数据迁移。</p> 
<h2>
<a id="37__511"></a>3.7 数据迁移</h2> 
<p>先创建出 newbank 的正确映射，然后使用如下方式进行数据迁移</p> 
<pre><code class="prism language-java">#创建新的索引
PUT <span class="token operator">/</span>newbank
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"account_number"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"long"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"address"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"age"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"balance"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"long"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"city"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"email"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"employer"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"firstname"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"gender"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"lastname"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token string">"fields"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"keyword"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
            <span class="token string">"ignore_above"</span><span class="token operator">:</span> <span class="token number">256</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"state"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java">#返回结果
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"acknowledged"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">"shards_acknowledged"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">"index"</span> <span class="token operator">:</span> <span class="token string">"newbank"</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java">POST _reindex
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"source"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"index"</span><span class="token operator">:</span> <span class="token string">"bank"</span><span class="token punctuation">,</span>
    <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"account"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"dest"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"index"</span><span class="token operator">:</span> <span class="token string">"newbank"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>返回结果</p> 
<pre><code class="prism language-java">#<span class="token operator">!</span> <span class="token class-name">Deprecation</span><span class="token operator">:</span> <span class="token punctuation">[</span>types removal<span class="token punctuation">]</span> <span class="token class-name">Specifying</span> types in reindex requests is deprecated<span class="token punctuation">.</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"took"</span> <span class="token operator">:</span> <span class="token number">7617</span><span class="token punctuation">,</span>
  <span class="token string">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token string">"total"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token string">"updated"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"created"</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token string">"deleted"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"batches"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string">"version_conflicts"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"noops"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"retries"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"bulk"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">"search"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"throttled_millis"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"requests_per_second"</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>
  <span class="token string">"throttled_until_millis"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"failures"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/dd/4f/hANbPOJs_o.png" alt="在这里插入图片描述"></p> 
<h1>
<a id="_609"></a>四、分词</h1> 
<p>一个 tokenizer（分词器）接收一个字符流，将之分割为独立的 tokens（词元，通常是独立的单词），然后输出 tokens 流。</p> 
<p>例如 whitespace tokenizer 遇到空白字符时分割文本，它会将文本 “Quick brown fox!” 分割为 Quick，brown，fox!。</p> 
<p><img src="https://images2.imgbox.com/2a/1e/O8xEtX8g_o.png" alt="在这里插入图片描述"></p> 
<p>该 tokenizer（分词器）还负责记录各个 term（词条）的顺序或 position 位置（用于 phrase 短语和 word proximity 词近邻查询），以及 term（词条）所代表的原始 word（单词）的 start（起始）和 end（结束）的 character offsets（字符偏移量）（用于高亮显示搜索的内容）。</p> 
<p>Elasticsearch 提供了很多内置的分词器，可以用来构建 custom analyzers（自定义分词器）。</p> 
<h2>
<a id="41__ik__620"></a>4.1 安装 ik 分词器</h2> 
<p><code>注意：不能用默认 elasticsearch-plugin install xxx.zip 进行自动安装</code></p> 
<p>1.进入elasticsearch 插件挂载</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /mydata/elasticsearch/plugins
</code></pre> 
<p>2.创建 ik 目录</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> ik
</code></pre> 
<p>3.进入 ik 目录</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> ik
</code></pre> 
<p>4.下载 ik 分词器</p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.4.2/elasticsearch-analysis-ik-7.4.2.zip
</code></pre> 
<p>5.下载成功</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ik<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.4.2/elasticsearch-analysis-ik-7.4.2.zip</span>
--2023-05-09 <span class="token number">16</span>:49:36--  https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.4.2/elasticsearch-analysis-ik-7.4.2.zip
正在解析主机 github.com <span class="token punctuation">(</span>github.com<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">20.205</span>.243.166
正在连接 github.com <span class="token punctuation">(</span>github.com<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">20.205</span>.243.166<span class="token operator">|</span>:443<span class="token punctuation">..</span>. 已连接。
已发出 HTTP 请求，正在等待回应<span class="token punctuation">..</span>. <span class="token number">302</span> Found
位置：https://objects.githubusercontent.com/github-production-release-asset-2e65be/2993595/19827980-fef3-11e9-8cda-384bc0d9396c?X-Amz-Algorithm<span class="token operator">=</span>AWS4-HMAC-SHA256<span class="token operator">&amp;</span>X-Amz-Credential<span class="token operator">=</span>AKIAIWNJYAX4CSVEH53A%2F20230509%2Fus-east-1%2Fs3%2Faws4_request<span class="token operator">&amp;</span>X-Amz-Date<span class="token operator">=</span>20230509T084937Z<span class="token operator">&amp;</span>X-Amz-Expires<span class="token operator">=</span><span class="token number">300</span><span class="token operator">&amp;</span>X-Amz-Signature<span class="token operator">=</span>dede12056de2e09b1386e24e2db04835a7283f829d4e35f4ce0d268b9fa36780<span class="token operator">&amp;</span>X-Amz-SignedHeaders<span class="token operator">=</span>host<span class="token operator">&amp;</span><span class="token assign-left variable">actor_id</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span><span class="token assign-left variable">key_id</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span><span class="token assign-left variable">repo_id</span><span class="token operator">=</span><span class="token number">2993595</span><span class="token operator">&amp;</span>response-content-disposition<span class="token operator">=</span>attachment%3B%20filename%3Delasticsearch-analysis-ik-7.4.2.zip<span class="token operator">&amp;</span>response-content-type<span class="token operator">=</span>application%2Foctet-stream <span class="token punctuation">[</span>跟随至新的 URL<span class="token punctuation">]</span>
--2023-05-09 <span class="token number">16</span>:49:37--  https://objects.githubusercontent.com/github-production-release-asset-2e65be/2993595/19827980-fef3-11e9-8cda-384bc0d9396c?X-Amz-Algorithm<span class="token operator">=</span>AWS4-HMAC-SHA256<span class="token operator">&amp;</span>X-Amz-Credential<span class="token operator">=</span>AKIAIWNJYAX4CSVEH53A%2F20230509%2Fus-east-1%2Fs3%2Faws4_request<span class="token operator">&amp;</span>X-Amz-Date<span class="token operator">=</span>20230509T084937Z<span class="token operator">&amp;</span>X-Amz-Expires<span class="token operator">=</span><span class="token number">300</span><span class="token operator">&amp;</span>X-Amz-Signature<span class="token operator">=</span>dede12056de2e09b1386e24e2db04835a7283f829d4e35f4ce0d268b9fa36780<span class="token operator">&amp;</span>X-Amz-SignedHeaders<span class="token operator">=</span>host<span class="token operator">&amp;</span><span class="token assign-left variable">actor_id</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span><span class="token assign-left variable">key_id</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span><span class="token assign-left variable">repo_id</span><span class="token operator">=</span><span class="token number">2993595</span><span class="token operator">&amp;</span>response-content-disposition<span class="token operator">=</span>attachment%3B%20filename%3Delasticsearch-analysis-ik-7.4.2.zip<span class="token operator">&amp;</span>response-content-type<span class="token operator">=</span>application%2Foctet-stream
正在解析主机 objects.githubusercontent.com <span class="token punctuation">(</span>objects.githubusercontent.com<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">185.199</span>.109.133, <span class="token number">185.199</span>.108.133, <span class="token number">185.199</span>.110.133, <span class="token punctuation">..</span>.
正在连接 objects.githubusercontent.com <span class="token punctuation">(</span>objects.githubusercontent.com<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">185.199</span>.109.133<span class="token operator">|</span>:443<span class="token punctuation">..</span>. 已连接。
已发出 HTTP 请求，正在等待回应<span class="token punctuation">..</span>. <span class="token number">200</span> OK
长度：4504487 <span class="token punctuation">(</span><span class="token number">4</span>.3M<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
正在保存至: “elasticsearch-analysis-ik-7.4.2.zip”

<span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token number">4,504</span>,487   <span class="token number">1</span>.44MB/s 用时 <span class="token number">3</span>.0s   

<span class="token number">2023</span>-05-09 <span class="token number">16</span>:49:41 <span class="token punctuation">(</span><span class="token number">1.44</span> MB/s<span class="token punctuation">)</span> - 已保存 “elasticsearch-analysis-ik-7.4.2.zip” <span class="token punctuation">[</span><span class="token number">4504487</span>/4504487<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>6.下载成功后解压到 ik 目录</p> 
<pre><code class="prism language-bash"><span class="token function">unzip</span> elasticsearch-analysis-ik-7.4.2.zip
</code></pre> 
<p>7.修改 ik 目录读写权限</p> 
<pre><code class="prism language-bash"><span class="token function">chmod</span> -R <span class="token number">777</span> ik/
</code></pre> 
<p>8.进入 docker 的 bash 控制台</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it elasticsearch /bin/bash
</code></pre> 
<p>9.进入 elasticsearch 的 bin 执行如下命令</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@21fddd211b43 bin<span class="token punctuation">]</span><span class="token comment"># elasticsearch-plugin list</span>
ik
</code></pre> 
<p>出现 ik 表明安装完成</p> 
<h2>
<a id="42__689"></a>4.2 测试分词器</h2> 
<p>1.Kibana 使用 ik_smart 检索</p> 
<p><img src="https://images2.imgbox.com/b1/bf/qwRo2iWi_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="43__694"></a>4.3 自定义词库</h2> 
<p>ik 分词器没办法识别新的词汇和网络用语，所以需要我们自己自定义词库来达到扩展词库的目的。<br> 1.修改配置文件</p> 
<p>ik 分词器的配置文件在容器中的路径：</p> 
<pre><code class="prism language-bash">/usr/share/elasticsearch/plugins/ik/config/IKAnalyzer.cfg.xml。
</code></pre> 
<p>修改这个文件可以通过修改映射文件，文件路径：</p> 
<pre><code class="prism language-bash">/mydata/elasticsearch/plugins/ik/config/IKAnalyzer.cfg.xml
</code></pre> 
<p>编辑配置文件：</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /mydata/elasticsearch/plugins/ik/config/IKAnalyzer.cfg.xml
</code></pre> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">properties</span> <span class="token name">SYSTEM</span> <span class="token string">"http://java.sun.com/dtd/properties.dtd"</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment</span><span class="token punctuation">&gt;</span></span>IK Analyzer 扩展配置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comment</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ext_dict<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ext_stopwords<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>remote_ext_dict<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>http://192.168.57.129/es/fenci.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span>
<span class="token comment">&lt;!-- &lt;entry key="remote_ext_stopwords"&gt;words_location&lt;/entry&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>修改配置 remote_ext_dict 的属性值，指定一个 远程网站文件的路径，比如 http://www.xxx.com/ikwords.text。</p> 
<p>这里我们可以自己搭建一套 nginx 环境，然后把 ikwords.text 放到 nginx 根目录。</p> 
<p>修改 IKAnalyzer.cfg.xml 后重启 elasticsearch</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> restart elasticsearch
</code></pre> 
<p>访问 Kibana 如下图</p> 
<p><img src="https://images2.imgbox.com/c6/14/plztOK1s_o.png" alt="在这里插入图片描述"></p> 
<h1>
<a id="_nginx_749"></a>五、附录-安装 nginx</h1> 
<h2>
<a id="51__750"></a>5.1 安装步骤</h2> 
<p>1.在 /mydata 目录下创建 nginx 目录</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> nginx
</code></pre> 
<p>2.进入 nginx 目录安装 nginx</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost mydata<span class="token punctuation">]</span><span class="token comment"># docker run -p 80:80 --name nginx -d nginx:1.10</span>
Unable to <span class="token function">find</span> image <span class="token string">'nginx:1.10'</span> locally
<span class="token number">1.10</span>: Pulling from library/nginx
6d827a3ef358: Pull complete 
1e3e18a64ea9: Pull complete 
556c62bb43ac: Pull complete 
Digest: sha256:6202beb06ea61f44179e02ca965e8e13b961d12640101fca213efbfd145d7575
Status: Downloaded newer image <span class="token keyword">for</span> nginx:1.10
4026fb105bd2a0905512b553bcea6452eacb55b2c4499ceef4a148c6023f60c9
</code></pre> 
<p>3.将容器内的配置文件拷贝到 nginx 目录<code>别忘了后面的点</code></p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> container <span class="token function">cp</span> nginx:/etc/nginx <span class="token builtin class-name">.</span>
</code></pre> 
<p>4.修改文件名称</p> 
<pre><code class="prism language-bash"><span class="token function">mv</span> nginx conf
</code></pre> 
<p>5.把这个 conf 移动到 /mydata/nginx 下</p> 
<pre><code class="prism language-bash"><span class="token function">mv</span> conf/ nginx
</code></pre> 
<p>6.终止原容器</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> stop nginx
</code></pre> 
<p>7.执行命令删除原容器</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">rm</span> nginx
</code></pre> 
<p>8.创建新的 nginx</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run -p <span class="token number">80</span>:80 --name nginx <span class="token punctuation"></span>
-v /mydata/nginx/html:/usr/share/nginx/html <span class="token punctuation"></span>
-v /mydata/nginx/logs:/var/log/nginx <span class="token punctuation"></span>
-v /mydata/nginx/conf:/etc/nginx <span class="token punctuation"></span>
-d nginx:1.10
</code></pre> 
<p>9.给 nginx 的 html 下面放的所有资源可以直接访问</p> 
<pre><code class="prism language-bash"><span class="token function">vi</span> index.html
</code></pre> 
<p>10.编写 html</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Gulimall<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>11.安装成功，访问效果如下图</p> 
<p><img src="https://images2.imgbox.com/4d/86/HjDvdqNt_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="52__819"></a>5.2 创建分析文本</h2> 
<p>1.html 目录下创建 es 目录，在 es 目录下创建文本</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> es
</code></pre> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> es
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">vi</span> fenci.txt
</code></pre> 
<pre><code class="prism language-java">尚硅谷
乔碧萝
</code></pre> 
<p>编写文本，esc 后 shift + ： wq 保存退出。访问如下图</p> 
<p><img src="https://images2.imgbox.com/5d/c4/cDRKz8P6_o.png" alt="在这里插入图片描述"></p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
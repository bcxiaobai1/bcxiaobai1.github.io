<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>计算机视觉项目实战-驾驶员疲劳检测 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">计算机视觉项目实战-驾驶员疲劳检测</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-tomorrow-night">
                    
                        
                    
                    <blockquote> 
 <p>???<font face="楷体" size="3" color="GoldenRod"><strong>欢迎来到本博客</strong>???</font><br> <strong>本次博客内容将继续讲解关于OpenCV的相关知识</strong><br> ?<strong>作者简介</strong>：<font face="楷体" size="3" color="Orange">⭐️⭐️⭐️<strong>目前计算机研究生在读。主要研究方向是人工智能和群智能算法方向。目前熟悉深度学习（keras、pytorch、yolo），python网页爬虫、机器学习、计算机视觉（OpenCV）、群智能算法。然后正在学习深度学习的相关内容。以后可能会涉及到网络安全相关领域，毕竟这是每一个学习计算机的梦想嘛！</strong></font><br> ?<strong>目前更新</strong>：<font face="楷体" size="3" color="PaleVioletRed">???目前已经更新了关于网络爬虫的相关知识、机器学习的相关知识、目前正在更新计算机视觉-OpenCV的相关内容。</font><br> ???<em><strong>本文摘要</strong></em>???</p>
 <table><tbody><tr><td bgcolor="LightBlue">
<strong>本文我们将继续讲解计算机视觉领域项目-驾驶员疲劳检测。</strong><br> 
     <div class="toc">
      <h3>文章目录</h3>
      <ul><li>
<ul>
<li><a href="#_11">?项目前言</a></li>
<li><a href="#_13">?项目关键点讲解</a></li>
<li><a href="#_25">?项目代码详解</a></li>
<li><a href="#_192">?项目结果展示</a></li>
<li><a href="#_195">?项目改进方向（打哈欠检测疲劳方法）</a></li>
<li><a href="#_258">?项目改进方向（点头检测疲劳）</a></li>
<li><a href="#GUI_393">?GUI界面设计展示</a></li>
</ul>
      </li></ul>
     </div>
<br> <img src="https://images2.imgbox.com/0b/c7/6qyWR4En_o.png" alt="在这里插入图片描述">
</td></tr></tbody></table>
 <p></p> 
</blockquote> 
<h2>
<a id="_11"></a>?项目前言</h2> 
<p>上次博客我们讲到了如何定位人脸，并且在人脸上进行关键点定位。其中包括5点定位和68点定位等，在定位之后呢，我们就可以使用定位信息来做一些相关操作，例如闭眼检测，这里就可以应用到驾驶员的疲劳检测上，或者是经常使用电脑的人，不闭眼可能会导致眼睛干涩等。</p> 
<h2>
<a id="_13"></a>?项目关键点讲解</h2> 
<p>我们本次博客主要讲解通过闭眼来检测疲劳驾驶，那么我们首先就要了解怎么让计算机来判断人是否闭了眼睛。我们通过上次的博客可以知道，我们首先要让计算机识别出来人脸，然后在识别出来的人脸上继续做关键点查找。我们这里用的是68关键点检测。<br> <img src="https://images2.imgbox.com/d5/60/yHOpcl2Y_o.png" alt="在这里插入图片描述"><br> 对于眼睛来讲，他每一个眼睛都有6个关键点。这里我们可以通过一种方式来判断是否进行了眨眼。<br> <img src="https://images2.imgbox.com/b9/03/YHp5Ulw5_o.png" alt="在这里插入图片描述"><br> 在眼睛的6个关键点中，我们可以发现当睁眼的时候，2和6点以及3和5点的欧氏距离较大。1和4点稍稍距离会增加一点，那么我们可以设定一个公式。<br> <img src="https://images2.imgbox.com/bc/61/b2qHTOYp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4a/32/YKd3xKnc_o.png" alt="在这里插入图片描述"></p> 
<p>对应在图上就是2点和6点相减，3和5点相减。然后比上2倍的1和4点的差。其中都是绝对值。这样睁眼的时候EAR的数值就会较大，闭眼的时候EAR的数值就会较小。然后我们自己设定一个阈值，如果EAR的数值低于这个阈值超过了视频帧中的几帧。那么我们就认为该驾驶员正在闭眼。<br> <img src="https://images2.imgbox.com/72/32/4cZijiSE_o.png" alt="在这里插入图片描述"><br> 经过了论文验证，说明该方法的准确度是非常可观的，且具有较强的鲁棒性。</p> 
<h2>
<a id="_25"></a>?项目代码详解</h2> 
<p>首先我们导入工具包，这里面也包括了计算欧氏距离的工具包。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>spatial <span class="token keyword">import</span> distance <span class="token keyword">as</span> dist
<span class="token keyword">from</span> collections <span class="token keyword">import</span> OrderedDict
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> time
<span class="token keyword">import</span> dlib
<span class="token keyword">import</span> cv2
</code></pre> 
<p>然后我们把68点关键点定位信息定位好。</p> 
<pre><code class="prism language-python">FACIAL_LANDMARKS_68_IDXS <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token punctuation">[</span>
	<span class="token punctuation">(</span><span class="token string">"mouth"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token string">"right_eyebrow"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token string">"left_eyebrow"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token string">"right_eye"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token string">"left_eye"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token string">"nose"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token string">"jaw"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里<code>"jaw", (0, 17)</code>表示的是下巴的位置的关键点标识分别是0-17点。<br> 然后我们将需要的模型和视频导入到程序当中。关键点检测模型。</p> 
<pre><code class="prism language-python">ap <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
ap<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"-p"</span><span class="token punctuation">,</span> <span class="token string">"--shape-predictor"</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
	<span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"path to facial landmark predictor"</span><span class="token punctuation">)</span>
ap<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"-v"</span><span class="token punctuation">,</span> <span class="token string">"--video"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"path to input video file"</span><span class="token punctuation">)</span>
args <span class="token operator">=</span> <span class="token builtin">vars</span><span class="token punctuation">(</span>ap<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">EYE_AR_THRESH <span class="token operator">=</span> <span class="token number">0.3</span>
EYE_AR_CONSEC_FRAMES <span class="token operator">=</span> <span class="token number">3</span>
</code></pre> 
<p>这里这两个参数很重要，其中<code>EYE_AR_THRESH</code>这个表示EAR的阈值。如果高于这个阈值说明人这个时候是睁眼的，如果低于这个阈值的话，那么这个时候就要注意了，驾驶员可能在闭眼。而<code>EYE_AR_CONSEC_FRAMES</code>这个表示如果EAR数值超过了三帧及以上我们就可以把他认定为一次闭眼。为什么是三帧呢？因为如果一帧两帧的话可能是其他因素影响的。</p> 
<pre><code class="prism language-python">COUNTER <span class="token operator">=</span> <span class="token number">0</span>
TOTAL <span class="token operator">=</span> <span class="token number">0</span>
</code></pre> 
<p>然后我们又设定了两个计数器，如果小于阈值那么<code>COUNTER</code>的数值就加一，知道COUNTER的数值大于等于3的时候，这个TOTAL就加一，就说明记录的闭眼了一次。</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[INFO] loading facial landmark predictor..."</span><span class="token punctuation">)</span>
detector <span class="token operator">=</span> dlib<span class="token punctuation">.</span>get_frontal_face_detector<span class="token punctuation">(</span><span class="token punctuation">)</span>
predictor <span class="token operator">=</span> dlib<span class="token punctuation">.</span>shape_predictor<span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token string">"shape_predictor"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里我们就很熟悉了，一个是人脸定位器，一个是关键点检测器。这里分别调出来。</p> 
<pre><code class="prism language-python"><span class="token punctuation">(</span>lStart<span class="token punctuation">,</span> lEnd<span class="token punctuation">)</span> <span class="token operator">=</span> FACIAL_LANDMARKS_68_IDXS<span class="token punctuation">[</span><span class="token string">"left_eye"</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span>rStart<span class="token punctuation">,</span> rEnd<span class="token punctuation">)</span> <span class="token operator">=</span> FACIAL_LANDMARKS_68_IDXS<span class="token punctuation">[</span><span class="token string">"right_eye"</span><span class="token punctuation">]</span>
</code></pre> 
<p>然后我们通过关键点只取两个ROI区域，就是左眼区域和右眼区域。</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[INFO] starting video stream thread..."</span><span class="token punctuation">)</span>
vs <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token string">"video"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>随后我们将视频读进来。</p> 
<pre><code class="prism language-python"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
	<span class="token comment"># 预处理</span>
	frame <span class="token operator">=</span> vs<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> frame <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
		<span class="token keyword">break</span>
	<span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span> <span class="token operator">=</span> frame<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
	width<span class="token operator">=</span><span class="token number">1200</span>
	r <span class="token operator">=</span> width <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span>
	dim <span class="token operator">=</span> <span class="token punctuation">(</span>width<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h <span class="token operator">*</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span>
	frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> dim<span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
	gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
</code></pre> 
<p>将视频的展示框放大一点，这里很关键就是如果视频的框框设置的太小的话，可能无法检测到人脸。然后我们就把宽设置成了1200，然后对长度也同比例就行resize操作。最后转换成灰度图。</p> 
<pre><code class="prism language-python">rects <span class="token operator">=</span> detector<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里面检测到人脸，将人脸框的四个坐标拿到手。注意就是必须要是对灰度图进行处理。</p> 
<pre><code class="prism language-python">	<span class="token keyword">for</span> rect <span class="token keyword">in</span> rects<span class="token punctuation">:</span>
		<span class="token comment"># 获取坐标</span>
		shape <span class="token operator">=</span> predictor<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
		shape <span class="token operator">=</span> shape_to_np<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>
</code></pre> 
<p>在这里进行人脸框遍历，然后检测68关键点。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">shape_to_np</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"int"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 创建68*2</span>
	coords <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>shape<span class="token punctuation">.</span>num_parts<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>dtype<span class="token punctuation">)</span>
	<span class="token comment"># 遍历每一个关键点</span>
	<span class="token comment"># 得到坐标</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> shape<span class="token punctuation">.</span>num_parts<span class="token punctuation">)</span><span class="token punctuation">:</span>
		coords<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>shape<span class="token punctuation">.</span>part<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> shape<span class="token punctuation">.</span>part<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
	<span class="token keyword">return</span> coords
</code></pre> 
<p>这里就是提取关键点的坐标。</p> 
<pre><code class="prism language-python">		leftEye <span class="token operator">=</span> shape<span class="token punctuation">[</span>lStart<span class="token punctuation">:</span>lEnd<span class="token punctuation">]</span>
		rightEye <span class="token operator">=</span> shape<span class="token punctuation">[</span>rStart<span class="token punctuation">:</span>rEnd<span class="token punctuation">]</span>
		leftEAR <span class="token operator">=</span> eye_aspect_ratio<span class="token punctuation">(</span>leftEye<span class="token punctuation">)</span>
		rightEAR <span class="token operator">=</span> eye_aspect_ratio<span class="token punctuation">(</span>rightEye<span class="token punctuation">)</span>
</code></pre> 
<p>然后我们把左眼和右眼分别求了一下EAR数值。这里的<code>eye_aspect_ratio</code>函数就是计算EAR数值的。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">eye_aspect_ratio</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 计算距离，竖直的</span>
	A <span class="token operator">=</span> dist<span class="token punctuation">.</span>euclidean<span class="token punctuation">(</span>eye<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> eye<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	B <span class="token operator">=</span> dist<span class="token punctuation">.</span>euclidean<span class="token punctuation">(</span>eye<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> eye<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token comment"># 计算距离，水平的</span>
	C <span class="token operator">=</span> dist<span class="token punctuation">.</span>euclidean<span class="token punctuation">(</span>eye<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> eye<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token comment"># ear值</span>
	ear <span class="token operator">=</span> <span class="token punctuation">(</span>A <span class="token operator">+</span> B<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> C<span class="token punctuation">)</span>
	<span class="token keyword">return</span> ear
</code></pre> 
<p>其中<code>dist.euclidean</code>表示计算欧式距离，和公式中计算EAR数值一摸一样。</p> 
<pre><code class="prism language-python">		ear <span class="token operator">=</span> <span class="token punctuation">(</span>leftEAR <span class="token operator">+</span> rightEAR<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span>

		<span class="token comment"># 绘制眼睛区域</span>
		leftEyeHull <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convexHull<span class="token punctuation">(</span>leftEye<span class="token punctuation">)</span>
		rightEyeHull <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convexHull<span class="token punctuation">(</span>rightEye<span class="token punctuation">)</span>
		cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">[</span>leftEyeHull<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
		cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">[</span>rightEyeHull<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后对于左眼和右眼都进行了EAR求解然后求了一个平均值，然后根据凸包的概念，对眼睛区域进行了绘图。将左眼区域和右眼区域绘图出来。</p> 
<pre><code class="prism language-python">		<span class="token keyword">if</span> ear <span class="token operator">&lt;</span> EYE_AR_THRESH<span class="token punctuation">:</span>
			COUNTER <span class="token operator">+=</span> <span class="token number">1</span>

		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token comment"># 如果连续几帧都是闭眼的，总数算一次</span>
			<span class="token keyword">if</span> COUNTER <span class="token operator">&gt;=</span> EYE_AR_CONSEC_FRAMES<span class="token punctuation">:</span>
				TOTAL <span class="token operator">+=</span> <span class="token number">1</span>

			<span class="token comment"># 重置</span>
			COUNTER <span class="token operator">=</span> <span class="token number">0</span>

		<span class="token comment"># 显示</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"Blinks: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>TOTAL<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"EAR: {:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ear<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

	cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Frame"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
	key <span class="token operator">=</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span>
 
	<span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span>
		<span class="token keyword">break</span>

vs<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>最后进行了一次阈值判断，如果EAR连续三帧都小于0.3，那么我们就把TOTAL加一，这样记录一次闭眼的过程。然后最后将EAR数值和TOTAL的数值展示在视频当中。最后完成整体的训练。</p> 
<h2>
<a id="_192"></a>?项目结果展示</h2> 
<p><img src="https://images2.imgbox.com/87/33/JqEE0hmJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f3/95/vlDM51Cz_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="_195"></a>?项目改进方向（打哈欠检测疲劳方法）</h2> 
<p>我们知道在疲劳检测当中，光光检测眨眼可能不是特别准确，因此我们还要在其他可以展示驾驶员疲劳的点来结合展示驾驶员是否处于疲劳驾驶阶段。我们了解到还可以通过嘴巴打哈欠，和点头来展示驾驶员是否疲劳。我们首先来考虑嘴巴打哈欠。<br> 首先我们来看一下嘴巴的关键点。<br> <img src="https://images2.imgbox.com/ec/26/smDzrIT5_o.png" alt="在这里插入图片描述"><br> 我们使用对眨眼检测的方法继续对嘴巴使用同样的方法检测是否张嘴！对应公式是：<br> <img src="https://images2.imgbox.com/17/6c/HbSnNmTR_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">mouth_aspect_ratio</span><span class="token punctuation">(</span>mouth<span class="token punctuation">)</span><span class="token punctuation">:</span>
	A <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>mouth<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> mouth<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 51, 59</span>
	B <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>mouth<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">-</span> mouth<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 53, 57</span>
	C <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>mouth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> mouth<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 49, 55</span>
	mar <span class="token operator">=</span> <span class="token punctuation">(</span>A <span class="token operator">+</span> B<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> C<span class="token punctuation">)</span>
	<span class="token keyword">return</span> mar
</code></pre> 
<p>这里面我们选择的是嘴部区域内的六个点，来判断驾驶员是否进行了张嘴！</p> 
<pre><code class="prism language-python">MAR_THRESH <span class="token operator">=</span> <span class="token number">0.5</span>
MOUTH_AR_CONSEC_FRAMES <span class="token operator">=</span> <span class="token number">3</span>
</code></pre> 
<p>同样我们也要设置一个阈值，解释同对眨眼检测的时候一样。</p> 
<pre><code class="prism language-python"><span class="token punctuation">(</span>mStart<span class="token punctuation">,</span> mEnd<span class="token punctuation">)</span> <span class="token operator">=</span> FACIAL_LANDMARKS_68_IDXS<span class="token punctuation">[</span><span class="token string">"mouth"</span><span class="token punctuation">]</span>
</code></pre> 
<p>首先我们取到68关键点中对应的嘴部区域。</p> 
<pre><code class="prism language-python">mouth <span class="token operator">=</span> shape<span class="token punctuation">[</span>mStart<span class="token punctuation">:</span>mEnd<span class="token punctuation">]</span>
mar <span class="token operator">=</span> mouth_aspect_ratio<span class="token punctuation">(</span>mouth<span class="token punctuation">)</span>
</code></pre> 
<p>然后通过函数<code>mouth_aspect_ratio</code>来计算出来mar数值！然后进行凸包检测，并且要画出来。</p> 
<pre><code class="prism language-python">		mouthHull <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convexHull<span class="token punctuation">(</span>mouth<span class="token punctuation">)</span>
		cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">[</span>mouthHull<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">		left <span class="token operator">=</span> rect<span class="token punctuation">.</span>left<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#绘制出来人脸框</span>
		top <span class="token operator">=</span> rect<span class="token punctuation">.</span>top<span class="token punctuation">(</span><span class="token punctuation">)</span>
		right <span class="token operator">=</span> rect<span class="token punctuation">.</span>right<span class="token punctuation">(</span><span class="token punctuation">)</span>
		bottom <span class="token operator">=</span> rect<span class="token punctuation">.</span>bottom<span class="token punctuation">(</span><span class="token punctuation">)</span>
		cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里面我们要加上一点就是说我们要绘制出来人脸框框！</p> 
<pre><code class="prism language-python">		<span class="token keyword">if</span> mar <span class="token operator">&gt;</span> MAR_THRESH<span class="token punctuation">:</span>  <span class="token comment"># 张嘴阈值0.5</span>
			mCOUNTER <span class="token operator">+=</span> <span class="token number">1</span>
			cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"Yawning!"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token comment"># 如果连续3次都小于阈值，则表示打了一次哈欠</span>
			<span class="token keyword">if</span> mCOUNTER <span class="token operator">&gt;=</span> MOUTH_AR_CONSEC_FRAMES<span class="token punctuation">:</span>  <span class="token comment"># 阈值：3</span>
				mTOTAL <span class="token operator">+=</span> <span class="token number">1</span>
			<span class="token comment"># 重置嘴帧计数器</span>
			mCOUNTER <span class="token operator">=</span> <span class="token number">0</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"Yawning: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mTOTAL<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"mCOUNTER: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mCOUNTER<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"MAR: {:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mar<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后进行判断，并且在视频当中展示出来！</p> 
<h2>
<a id="_258"></a>?项目改进方向（点头检测疲劳）</h2> 
<p>检测流程：<br> <strong>2D人脸关键点检测；3D人脸模型匹配；求解3D点和对应2D点的转换关系；根据旋转矩阵求解欧拉角。</strong><br> 一个物体相对于相机的姿态可以使用旋转矩阵和平移矩阵来表示。<br> !](https://img-blog.csdnimg.cn/a8286dc98d624f4183eed96daab991e2.png)</p> 
<ol>
<li>欧拉角<br> 简单来说，欧拉角就是物体绕坐标系三个坐标轴(x,y,z轴）的旋转角度。</li>
<li>世界坐标系和其他坐标系的转换<br> <img src="https://images2.imgbox.com/1a/98/gDJVLjXF_o.png" alt="在这里插入图片描述">世界坐标系到相机坐标系转换：<br> <img src="https://images2.imgbox.com/db/b0/JAsWTCxv_o.png" alt="在这里插入图片描述"><br> 相机坐标系到像素坐标系转换：<br> <img src="https://images2.imgbox.com/ff/48/bMCDLOo7_o.png" alt="在这里插入图片描述"><br> 因此像素坐标系和世界坐标系的关系如下：<br> <img src="https://images2.imgbox.com/74/78/AGKwMQc1_o.png" alt="在这里插入图片描述"><br> 然后我们根据论文来定义一下：</li>
</ol> 
<pre><code class="prism language-python">object_pts <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">6.825897</span><span class="token punctuation">,</span> <span class="token number">6.760612</span><span class="token punctuation">,</span> <span class="token number">4.402142</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">#33左眉左上角</span>
                         <span class="token punctuation">[</span><span class="token number">1.330353</span><span class="token punctuation">,</span> <span class="token number">7.122144</span><span class="token punctuation">,</span> <span class="token number">6.903745</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">#29左眉右角</span>
                         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.330353</span><span class="token punctuation">,</span> <span class="token number">7.122144</span><span class="token punctuation">,</span> <span class="token number">6.903745</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#34右眉左角</span>
                         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6.825897</span><span class="token punctuation">,</span> <span class="token number">6.760612</span><span class="token punctuation">,</span> <span class="token number">4.402142</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#38右眉右上角</span>
                         <span class="token punctuation">[</span><span class="token number">5.311432</span><span class="token punctuation">,</span> <span class="token number">5.485328</span><span class="token punctuation">,</span> <span class="token number">3.987654</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">#13左眼左上角</span>
                         <span class="token punctuation">[</span><span class="token number">1.789930</span><span class="token punctuation">,</span> <span class="token number">5.393625</span><span class="token punctuation">,</span> <span class="token number">4.413414</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">#17左眼右上角</span>
                         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.789930</span><span class="token punctuation">,</span> <span class="token number">5.393625</span><span class="token punctuation">,</span> <span class="token number">4.413414</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#25右眼左上角</span>
                         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5.311432</span><span class="token punctuation">,</span> <span class="token number">5.485328</span><span class="token punctuation">,</span> <span class="token number">3.987654</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#21右眼右上角</span>
                         <span class="token punctuation">[</span><span class="token number">2.005628</span><span class="token punctuation">,</span> <span class="token number">1.409845</span><span class="token punctuation">,</span> <span class="token number">6.165652</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">#55鼻子左上角</span>
                         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2.005628</span><span class="token punctuation">,</span> <span class="token number">1.409845</span><span class="token punctuation">,</span> <span class="token number">6.165652</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#49鼻子右上角</span>
                         <span class="token punctuation">[</span><span class="token number">2.774015</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.080775</span><span class="token punctuation">,</span> <span class="token number">5.048531</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#43嘴左上角</span>
                         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2.774015</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.080775</span><span class="token punctuation">,</span> <span class="token number">5.048531</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">#39嘴右上角</span>
                         <span class="token punctuation">[</span><span class="token number">0.000000</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.116408</span><span class="token punctuation">,</span> <span class="token number">6.097667</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#45嘴中央下角</span>
                         <span class="token punctuation">[</span><span class="token number">0.000000</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7.415691</span><span class="token punctuation">,</span> <span class="token number">4.070434</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#6下巴角</span>

K <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">6.5308391993466671e+002</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">3.1950000000000000e+002</span><span class="token punctuation">,</span>
     <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">6.5308391993466671e+002</span><span class="token punctuation">,</span> <span class="token number">2.3950000000000000e+002</span><span class="token punctuation">,</span>
     <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token comment"># 等价于矩阵[fx, 0, cx; 0, fy, cy; 0, 0, 1]</span>
<span class="token comment"># 图像中心坐标系(uv)：相机畸变参数[k1, k2, p1, p2, k3]</span>
D <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7.0834633684407095e-002</span><span class="token punctuation">,</span> <span class="token number">6.9140193737175351e-002</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.3073460323689292e+000</span><span class="token punctuation">]</span>
reprojectsrc <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token punctuation">[</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token punctuation">[</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token punctuation">[</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 绘制正方体12轴</span>
line_pairs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p>其中<code>reprojectsrc</code>和<code>line_pairs</code>这两个属于矩形和矩形连接框框的操作。后续会用得到。</p> 
<pre><code class="prism language-python">cam_matrix <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>K<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
dist_coeffs <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>D<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
</code></pre> 
<p>这里我们对K和D矩阵进行了reshape了一下！</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_head_pose</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 头部姿态估计</span>
	<span class="token comment"># （像素坐标集合）填写2D参考点，注释遵循https://ibug.doc.ic.ac.uk/resources/300-W/</span>
	<span class="token comment"># 17左眉左上角/21左眉右角/22右眉左上角/26右眉右上角/36左眼左上角/39左眼右上角/42右眼左上角/</span>
	<span class="token comment"># 45右眼右上角/31鼻子左上角/35鼻子右上角/48左上角/54嘴右上角/57嘴中央下角/8下巴角</span>
	image_pts <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span>shape<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
							shape<span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
							shape<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">57</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token comment"># solvePnP计算姿势——求解旋转和平移矩阵：</span>
	<span class="token comment"># rotation_vec表示旋转矩阵，translation_vec表示平移矩阵，cam_matrix与K矩阵对应，dist_coeffs与D矩阵对应。</span>
	_<span class="token punctuation">,</span> rotation_vec<span class="token punctuation">,</span> translation_vec <span class="token operator">=</span> cv2<span class="token punctuation">.</span>solvePnP<span class="token punctuation">(</span>object_pts<span class="token punctuation">,</span> image_pts<span class="token punctuation">,</span> cam_matrix<span class="token punctuation">,</span> dist_coeffs<span class="token punctuation">)</span>
	<span class="token comment"># projectPoints重新投影误差：原2d点和重投影2d点的距离（输入3d点、相机内参、相机畸变、r、t，输出重投影2d点）</span>
	reprojectdst<span class="token punctuation">,</span> _ <span class="token operator">=</span> cv2<span class="token punctuation">.</span>projectPoints<span class="token punctuation">(</span>reprojectsrc<span class="token punctuation">,</span> rotation_vec<span class="token punctuation">,</span> translation_vec<span class="token punctuation">,</span> cam_matrix<span class="token punctuation">,</span> dist_coeffs<span class="token punctuation">)</span>
	reprojectdst <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">tuple</span><span class="token punctuation">,</span> reprojectdst<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 以8行2列显示</span>

	<span class="token comment"># 计算欧拉角calc euler angle</span>
	<span class="token comment"># 参考https://docs.opencv.org/2.4/modules/calib3d/doc/camera_calibration_and_3d_reconstruction.html#decomposeprojectionmatrix</span>
	rotation_mat<span class="token punctuation">,</span> _ <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Rodrigues<span class="token punctuation">(</span>rotation_vec<span class="token punctuation">)</span>  <span class="token comment"># 罗德里格斯公式（将旋转矩阵转换为旋转向量）</span>
	pose_mat <span class="token operator">=</span> cv2<span class="token punctuation">.</span>hconcat<span class="token punctuation">(</span><span class="token punctuation">(</span>rotation_mat<span class="token punctuation">,</span> translation_vec<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 水平拼接，vconcat垂直拼接</span>
	<span class="token comment"># decomposeProjectionMatrix将投影矩阵分解为旋转矩阵和相机矩阵</span>
	_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> euler_angle <span class="token operator">=</span> cv2<span class="token punctuation">.</span>decomposeProjectionMatrix<span class="token punctuation">(</span>pose_mat<span class="token punctuation">)</span>

	pitch<span class="token punctuation">,</span> yaw<span class="token punctuation">,</span> roll <span class="token operator">=</span> <span class="token punctuation">[</span>math<span class="token punctuation">.</span>radians<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> euler_angle<span class="token punctuation">]</span>

	pitch <span class="token operator">=</span> math<span class="token punctuation">.</span>degrees<span class="token punctuation">(</span>math<span class="token punctuation">.</span>asin<span class="token punctuation">(</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	roll <span class="token operator">=</span> <span class="token operator">-</span>math<span class="token punctuation">.</span>degrees<span class="token punctuation">(</span>math<span class="token punctuation">.</span>asin<span class="token punctuation">(</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>roll<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	yaw <span class="token operator">=</span> math<span class="token punctuation">.</span>degrees<span class="token punctuation">(</span>math<span class="token punctuation">.</span>asin<span class="token punctuation">(</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'pitch:{}, yaw:{}, roll:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>pitch<span class="token punctuation">,</span> yaw<span class="token punctuation">,</span> roll<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> reprojectdst<span class="token punctuation">,</span> euler_angle  <span class="token comment"># 投影误差，欧拉角</span>
</code></pre> 
<p>这里我们对一些关键点进行了定位，并且我们将世界坐标系转化成了2D上的坐标。最后我们通过CV2计算出来了欧拉角，这样我们就可以判断司机是否点头了！<br> <img src="https://images2.imgbox.com/57/fe/zozBkOGf_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">HAR_THRESH <span class="token operator">=</span> <span class="token number">0.3</span>
NOD_AR_CONSEC_FRAMES <span class="token operator">=</span> <span class="token number">3</span>
hCOUNTER <span class="token operator">=</span> <span class="token number">0</span>
hTOTAL <span class="token operator">=</span> <span class="token number">0</span>
</code></pre> 
<p>同样这里我们也要设定一个阈值和计数器！</p> 
<pre><code class="prism language-python">		reprojectdst<span class="token punctuation">,</span> euler_angle <span class="token operator">=</span> get_head_pose<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>
		har <span class="token operator">=</span> euler_angle<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 取pitch旋转角度</span>
		<span class="token keyword">if</span> har <span class="token operator">&gt;</span> HAR_THRESH<span class="token punctuation">:</span>  <span class="token comment"># 点头阈值0.3</span>
			hCOUNTER <span class="token operator">+=</span> <span class="token number">1</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token comment"># 如果连续3次都小于阈值，则表示瞌睡点头一次</span>
			<span class="token keyword">if</span> hCOUNTER <span class="token operator">&gt;=</span> NOD_AR_CONSEC_FRAMES<span class="token punctuation">:</span>  <span class="token comment"># 阈值：3</span>
				hTOTAL <span class="token operator">+=</span> <span class="token number">1</span>
			<span class="token comment"># 重置点头帧计数器</span>
			hCOUNTER <span class="token operator">=</span> <span class="token number">0</span>

		<span class="token comment"># 绘制正方体12轴</span>
		<span class="token keyword">for</span> start<span class="token punctuation">,</span> end <span class="token keyword">in</span> line_pairs<span class="token punctuation">:</span>
			cv2<span class="token punctuation">.</span>line<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>reprojectdst<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>reprojectdst<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>reprojectdst<span class="token punctuation">[</span>end<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>reprojectdst<span class="token punctuation">[</span>end<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token comment"># 显示角度结果</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"X: "</span> <span class="token operator">+</span> <span class="token string">"{:7.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>euler_angle<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span>
					<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># GREEN</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"Y: "</span> <span class="token operator">+</span> <span class="token string">"{:7.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>euler_angle<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span>
					<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># BLUE</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"Z: "</span> <span class="token operator">+</span> <span class="token string">"{:7.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>euler_angle<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span>
					<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># RED</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"Nod: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>hTOTAL<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">450</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> shape<span class="token punctuation">:</span>
			cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> TOTAL <span class="token operator">&gt;=</span> <span class="token number">50</span> <span class="token keyword">or</span> mTOTAL <span class="token operator">&gt;=</span> <span class="token number">15</span><span class="token punctuation">:</span>
		cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token string">"SLEEP!!!"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里也是一些判断操作和将信息在视频中展示出来。<br> 最后的效果如下：<br> <img src="https://images2.imgbox.com/55/98/dTxaB7j3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/59/0a/jcJlTBZk_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="GUI_393"></a>?GUI界面设计展示</h2> 
<p><img src="https://images2.imgbox.com/4b/88/641tGNEK_o.png" alt="在这里插入图片描述"><br> 并且可以完成摄像头检测！<br> <img src="https://images2.imgbox.com/7a/ec/ahnJvpfy_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fb/35/Z9F90MN5_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>?<strong>支持</strong>：<font face="楷体" size="3" color="OliveDrab">???<strong>如果觉得博主的文章还不错或者您用得到的话，可以免费的关注一下博主，如果三连收藏支持就更好啦！这就是给予我最大的支持！</strong></font></p> 
</blockquote>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
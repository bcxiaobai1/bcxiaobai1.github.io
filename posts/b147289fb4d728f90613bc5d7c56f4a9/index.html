<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>机器学习-集成算法 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">机器学习-集成算法</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <p></p>
<div class="toc">
 <h3>文章目录</h3>
 <ul><li>
<ul><li>
<ul>
<li><a href="#_1">集成算法</a></li>
<li>
<ul>
<li><a href="#1__3">1. 定义</a></li>
<li><a href="#2__7">2. 具体模型</a></li>
<li>
<ul>
<li><a href="#21_Bagging_9">2.1. Bagging</a></li>
<li><a href="#22_Boosting_21">2.2. Boosting</a></li>
<li><a href="#23_Stacking_39">2.3. Stacking</a></li>
</ul>
     </li>
<li><a href="#3__43">3. 随机森林</a></li>
<li>
<ul>
<li><a href="#31__47">3.1. 树模型结构</a></li>
<li><a href="#32__51">3.2. 随机森林的优点</a></li>
<li><a href="#33__58">3.3. 分类与回归问题</a></li>
<li><a href="#34__62">3.4. 树模型个数问题</a></li>
<li><a href="#35__68">3.5. 参数问题(特征重要性)</a></li>
<li><a href="#36__82">3.6. 可视化展示问题</a></li>
</ul>
     </li>
<li><a href="#4__88">4. 集成基本思想</a></li>
<li>
<ul>
<li><a href="#41__95">4.1. 硬投票策略步骤</a></li>
<li><a href="#42__176">4.2. 软投票策略步骤</a></li>
</ul>
     </li>
<li><a href="#5_Bagging_220">5. Bagging策略</a></li>
<li>
<ul>
<li><a href="#51__222">5.1. 策略介绍</a></li>
<li><a href="#52__229">5.2. 具体实现步骤</a></li>
<li><a href="#53__347">5.3. 随机森林的特征重要性</a></li>
<li><a href="#54_mnist_396">5.4. mnist数据集特征重要性</a></li>
</ul>
     </li>
<li><a href="#6_Boosting_428">6. Boosting-提升策略</a></li>
<li>
<ul>
<li><a href="#61_AdaBoost_430">6.1. AdaBoost</a></li>
<li>
<ul>
<li><a href="#611__436">6.1.1. 模拟流程</a></li>
<li><a href="#612__474">6.1.2. 工具包实现</a></li>
</ul>
      </li>
<li><a href="#62_Gradient_Boosting_494">6.2. Gradient Boosting</a></li>
<li>
<ul>
<li><a href="#621__496">6.2.1. 模拟流程</a></li>
<li><a href="#622__593">6.2.2. 工具包实现</a></li>
<li><a href="#623__658">6.2.3. 提前终止策略</a></li>
</ul>
     </li>
</ul>
     </li>
<li><a href="#7_Stacking_747">7. Stacking策略</a></li>
<li>
<ul><li>
<ul>
<li><a href="#71__749">7.1. 策略介绍</a></li>
<li><a href="#72__758">7.2. 具体实现步骤</a></li>
</ul>
     </li></ul>
    </li>
</ul>
   </li>
</ul>
  </li></ul>
 </li></ul>
</div>
<p></p> 
<h3>
<a id="_1"></a>集成算法</h3> 
<h4>
<a id="1__3"></a>1. 定义</h4> 
<p>将多个分类器集成起来而形成的新的分类算法，主要包括<code>Bagging</code>、<code>Boosting</code>和<code>Stacking</code>三种类别，其中前两种比较常用。</p> 
<h4>
<a id="2__7"></a>2. 具体模型</h4> 
<h5>
<a id="21_Bagging_9"></a>2.1. Bagging</h5> 
<ul>
<li> <p><strong>概述</strong>：此类算法中每个模型之间是相互独立的，他们之间的评估结果互不影响，<strong>并行训练分类器</strong></p> </li>
<li> <p><strong>构建方法</strong>： 对于给定的含有n个样本数据集，每次从中抽取某些样本放入到采样集中，然后又将该样本放回到原数据集中，继续进行采样抽取，也就是做<strong>有放回抽样</strong>，在采样结束后可以根据每个采样集中的样本分别进行对基评估器进行训练。典型的代表就是随机森林算法，随机森林包含两层含义，其中随机的意思是数据采样随机和特征选择随机，采用的是有放回抽样，而森林是把多个决策树放在一起，这样组合起来才能使数据具有更大的随机性。</p> </li>
<li> <p><strong>数学表达式</strong>：由于样本独立，类似于并行电路，要对多个分类器取平均<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       
        
         
          
           f
          
          
           (
          
          
           x
          
          
           )
          
          
           =
          
          
           
            1
           
           
            M
           
          
          
           
            ∑
           
           
            
             m
            
            
             =
            
            
             1
            
           
           
            M
           
          
          
           
            
             f
            
            
             m
            
           
           
            (
           
           
            x
           
           
            )
           
          
         
         
           f(x)=frac{1}{M}sum_{m=1}^{M}{f_m(x)} 
         
        
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord mathdefault" style="margin-right: 0.10764em">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em"></span></span><span class="base"><span class="strut" style="height: 3.09545em;vertical-align: -1.26711em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em">M</span></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="frac-line" style="border-bottom-width: 0.04em"></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.82834em"><span class="" style="margin-left: 0em"><span class="pstrut" style="height: 3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class=""><span class="pstrut" style="height: 3.05em"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="margin-left: 0em"><span class="pstrut" style="height: 3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10903em">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.26711em"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em"><span class="" style="margin-left: -0.10764em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span></span></span></span></p> </li>
</ul> 
<h5>
<a id="22_Boosting_21"></a>2.2. Boosting</h5> 
<ul>
<li> <p><strong>概述</strong>：此类算法是每个模型是相互关联的，后面加入的模型要比之前的模型有更加突出的模型，比较严格，是从弱学习开始加强，通过加权来进行训练，<strong>串行训练分类器</strong>。</p> </li>
<li> <p><strong>构建方法</strong>：先反复学习得到一些弱分类器，然后组合这些弱分类器变成一个强分类器，主要包括两个部分，加强模型和向前分步，每一次的分步都要加上之前的所有模型的结果，慢慢叠加，达到最优的效果。典型的代表就是<code>AdaBoost</code>，<code>Xgboost</code></p> 
  <ul><li>AdaBoost：会根据前一次的分类效果调整数据权重，解释来说就是如果某一数据在这次分错了，那么下一次就会被分配更大的权重，最终的结果就是根据自身的准确性来确定各自的权重，再合体。具体工作流程如下图所示，每次都会根据权重重新分配。<br> <img src="https://images2.imgbox.com/de/78/u42QYndd_o.png" alt="在这里插入图片描述" width="540">
</li></ul> </li>
<li> <p><strong>数学表达式</strong>：每次都要加上之前所有的模型，所以是一个加的运算，然后之后每次加入的模型，都要与前一次的模型进行对比，如果由于之前的模型就加入，否则就舍弃，具体公式如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       
        
         
          
           
            F
           
           
            n
           
          
          
           (
          
          
           x
          
          
           )
          
          
           =
          
          
           
            F
           
           
            
             m
            
            
             −
            
            
             1
            
           
          
          
           (
          
          
           x
          
          
           )
          
          
           +
          
          
           a
          
          
           r
          
          
           g
          
          
           m
          
          
           i
          
          
           
            n
           
           
            h
           
          
          
           
            ∑
           
           
            
             i
            
            
             =
            
            
             1
            
           
           
            n
           
          
          
           
            L
           
           
            (
           
           
            
             y
            
            
             i
            
           
           
            ,
           
           
            
             F
            
            
             
              m
             
             
              −
             
             
              1
             
            
           
           
            (
           
           
            
             x
            
            
             i
            
           
           
            )
           
           
            +
           
           
            h
           
           
            (
           
           
            
             x
            
            
             i
            
           
           
            )
           
           
            )
           
          
         
         
           F_n(x)=F_{m-1} (x) + argmin_hsum_{i=1}^{n}{L(y_i,F_{m-1} (x_i)+h(x_i))} 
         
        
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em"><span class="" style="margin-left: -0.13889em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em"><span class="" style="margin-left: -0.13889em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em"></span></span><span class="base"><span class="strut" style="height: 2.92907em;vertical-align: -1.27767em"></span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.02778em">r</span><span class="mord mathdefault" style="margin-right: 0.03588em">g</span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em"><span class="" style="margin-left: 0em"><span class="pstrut" style="height: 3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class=""><span class="pstrut" style="height: 3.05em"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="margin-left: 0em"><span class="pstrut" style="height: 3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em"></span><span class="mord"><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em"><span class="" style="margin-left: -0.03588em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em"><span class="" style="margin-left: -0.13889em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em"></span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></span></span></p> </li>
</ul> 
<h5>
<a id="23_Stacking_39"></a>2.3. Stacking</h5> 
<p>此类算法就是简单的将多个<strong>不同的分类模型</strong>堆叠在一起（KNN,SVM,RF等），它是分阶段进行的，第一阶段得出各自的结果，第二阶段再用前一阶段结果进行训练，比较耗时，一般不常使用。</p> 
<h4>
<a id="3__43"></a>3. 随机森林</h4> 
<p>随机森林属于<code>Bagging</code>类别，构造的树模型由于<strong>数据</strong>和<strong>特征</strong>都是随机的，所以构造出来的树模型是不相同的</p> 
<h5>
<a id="31__47"></a>3.1. 树模型结构</h5> 
<p><img src="https://images2.imgbox.com/cd/0a/0UQjO0FS_o.png" alt="在这里插入图片描述" width="650"></p> 
<h5>
<a id="32__51"></a>3.2. 随机森林的优点</h5> 
<ol>
<li>能够处理很高维度的数据，并且不同做特征选择，机器学习的库中有专门的函数针对数据和特征进行分配</li>
<li>训练完成后，能够给出哪些特征比较重要</li>
<li>容易做并行化方法，速度比较快</li>
<li>可以进行可视化展示，便于分析</li>
</ol> 
<h5>
<a id="33__58"></a>3.3. 分类与回归问题</h5> 
<p>对于所有的树模型，分类任务中，求众数就是分类结果；在回归任务中，直接求平均值。</p> 
<h5>
<a id="34__62"></a>3.4. 树模型个数问题</h5> 
<p>树模型的个数不是越多越好，由下图可知，随着树模型的增加，准确率提升的比较快，但是当树模型个数到达<code>10</code>以后，可以看出准确率趋于稳定。稳定之后，出现的上下浮动的现象是因为构建决策树的时候，它们之间相互独立，很难保证每一棵树加起来之后都会比原来的结果要好，所以，要控制树模型的数量。<br> <img src="https://images2.imgbox.com/2f/b1/h8o23rus_o.png" alt="在这里插入图片描述" width="440"></p> 
<h5>
<a id="35__68"></a>3.5. 参数问题(特征重要性)</h5> 
<p>特征重要性就是每个特征的重要程度，哪些特征被多次使用，哪些特征就重要，如下图所示有一个<code>feature importance</code>。<br> <img src="https://images2.imgbox.com/d3/4a/EdTa8lZD_o.png" alt="在这里插入图片描述"></p> 
<p>下面来举一个计算的例子，使用<strong>错误率</strong>来衡量特征的重要程度，下图有四个特征，分别为<code>A、B、C、D</code>，本例子就是对比<code>B</code>特征的重要程度，所以引入噪音点<code>B'</code>，两组数据经过相同的训练模型，分别得到对应的错误率<code>err1</code>和<code>err2</code>，下面分析错误率：</p> 
<ol>
<li>当<code>err1≈err2</code>的时候，说明有没有特征B，得到的结果类似，说明B不重要</li>
<li>当<code>err1&lt;&lt;err2</code>的时候，说明把B特征数据打乱后，与原数据有很大的差别，说明B很重要</li>
<li>一般情况下不会出现<code>err1&gt;&gt;err2</code>的情况<br> <img src="https://images2.imgbox.com/fa/d7/RQ0Sr7Om_o.png" alt="在这里插入图片描述" width="300">
</li>
</ol> 
<h5>
<a id="36__82"></a>3.6. 可视化展示问题</h5> 
<p>当使用树模型时，可以非常清晰地得到整个分裂过程，方便进行可视化分析 ， 如下图所示，可视化展示很强。<br> <img src="https://images2.imgbox.com/2a/31/u7QGl7nK_o.png" alt="在这里插入图片描述" width="640"></p> 
<h4>
<a id="4__88"></a>4. 集成基本思想</h4> 
<p>训练时用多种分类器一起完成同一个任务，如下图所示，对于同一个数据集，使用逻辑回归算法、SVM算法、随机森林算法等等共同完成一个任务。<br> <img src="https://images2.imgbox.com/b2/71/p9fGblz3_o.png" alt="在这里插入图片描述" width="800"></p> 
<p>测试时对测试样本分别通过不同的分类器，汇总最后的结果<img src="https://images2.imgbox.com/cf/98/nHpUwwQn_o.png" alt="在这里插入图片描述" width="780"></p> 
<h5>
<a id="41__95"></a>4.1. 硬投票策略步骤</h5> 
<ol><li>导入基本数据处理、画图、警告处理的包</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> os
<span class="token operator">%</span>matplotlib inline
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.labelsize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">14</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'xtick.labelsize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'ytick.labelsize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span>
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>导入数据集分割和生成数据集的包</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> make_moons

<span class="token comment"># n_numbers: 生成样本数量; </span>
<span class="token comment"># noise: 默认是false，数据集是否加入高斯噪声;</span>
<span class="token comment"># random_state: 生成随机种子，给定一个int型数据，能够保证每次生成数据相同</span>
X<span class="token punctuation">,</span>y <span class="token operator">=</span> make_moons<span class="token punctuation">(</span>n_samples<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>noise<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
X_train<span class="token punctuation">,</span>X_test<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>画图展示</li></ol> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'ro'</span><span class="token punctuation">,</span>alpha <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'gs'</span><span class="token punctuation">,</span>alpha <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4">
<li> <p>数据集效果展示<br> <img src="https://images2.imgbox.com/f2/8a/hmb3GLgg_o.png" alt="在这里插入图片描述"></p> </li>
<li> <p>硬投票操作：直接用<strong>类别值</strong>，少数服从多数</p> </li>
</ol> 
<pre><code class="prism language-python"><span class="token comment"># 导入随机森林和投票器模块</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier<span class="token punctuation">,</span>VotingClassifier
<span class="token comment"># 导入逻辑回归模块</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token comment"># 导入SVM模块</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC

<span class="token comment"># 实例化</span>
rnd_clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>random_state <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">)</span>
log_clf <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>random_state <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">)</span>
svm_clf <span class="token operator">=</span> SVC<span class="token punctuation">(</span>random_state <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment"># 进行投票</span>
voting_clf <span class="token operator">=</span> VotingClassifier<span class="token punctuation">(</span>estimators <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'rf'</span><span class="token punctuation">,</span>rnd_clf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'lr'</span><span class="token punctuation">,</span>log_clf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'svc'</span><span class="token punctuation">,</span>svm_clf<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>voting<span class="token operator">=</span><span class="token string">'hard'</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="6"><li>实验结果评估</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 导入精确度模块</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score
<span class="token comment"># 分类别进行测试</span>
<span class="token keyword">for</span> clf <span class="token keyword">in</span> <span class="token punctuation">(</span>rnd_clf<span class="token punctuation">,</span>log_clf<span class="token punctuation">,</span>svm_clf<span class="token punctuation">,</span>voting_clf<span class="token punctuation">)</span><span class="token punctuation">:</span>
    clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
    y_pred <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>clf<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p><strong>结果</strong>：<br> RandomForestClassifier 0.896<br> LogisticRegression 0.864<br> SVC 0.896<br> VotingClassifier 0.912</p> 
 <p><strong>分析</strong>：从实验结果可以看出，硬投票比单个的实验结果的准确率要高一些</p> 
</blockquote> 
<h5>
<a id="42__176"></a>4.2. 软投票策略步骤</h5> 
<p>软投票策略的前4个步骤与硬投票相同，不再赘述。</p> 
<ol start="5"><li>软投票操作：各自分类器的<strong>概率值</strong>进行加权平均</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 导入随机森林和投票器模块</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier<span class="token punctuation">,</span>VotingClassifier
<span class="token comment"># 导入逻辑回归模块</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token comment"># 导入SVM模块</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC

<span class="token comment"># 实例化</span>
rnd_clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>random_state <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">)</span>
log_clf <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>random_state <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">)</span>
svm_clf <span class="token operator">=</span> SVC<span class="token punctuation">(</span>random_state <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">,</span>probability<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 进行投票</span>
voting_clf <span class="token operator">=</span> VotingClassifier<span class="token punctuation">(</span>estimators <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'rf'</span><span class="token punctuation">,</span>rnd_clf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'lr'</span><span class="token punctuation">,</span>log_clf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'svc'</span><span class="token punctuation">,</span>svm_clf<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>voting<span class="token operator">=</span><span class="token string">'soft'</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="6"><li>实验结果评估</li></ol> 
<pre><code># 导入精确度模块
from sklearn.metrics import accuracy_score
# 分类别进行测试
for clf in (rnd_clf,log_clf,svm_clf,voting_clf):
    clf.fit(X_train,y_train)
    y_pred = clf.predict(X_test)
    print(clf.__class__.__name__,accuracy_score(y_test,y_pred))
</code></pre> 
<blockquote> 
 <p><strong>结果</strong>：</p> 
 <p>RandomForestClassifier 0.896<br> LogisticRegression 0.864<br> SVC 0.896<br> VotingClassifier 0.92</p> 
 <p><strong>分析</strong>：从实验结果可以看出，软投票比单个的实验结果的准确率要高一些。同时对比硬投票与软投票，软投票结果比硬投票要好一点</p> 
</blockquote> 
<h4>
<a id="5_Bagging_220"></a>5. Bagging策略</h4> 
<h5>
<a id="51__222"></a>5.1. 策略介绍</h5> 
<ol>
<li>首先对训练数据集进行多次采样，保证每次得到的采样数据都是不同的</li>
<li>分别训练多个模型，例如树模型</li>
<li>预测时需要得到所有模型结果再进行集成<br> <img src="https://images2.imgbox.com/58/27/FKHpilLC_o.png" alt="在这里插入图片描述" width="800">
</li>
</ol> 
<h5>
<a id="52__229"></a>5.2. 具体实现步骤</h5> 
<ol><li>导包进行训练</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> BaggingClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier

<span class="token comment"># base_estimator: 选择的基本估计量的类型</span>
<span class="token comment"># n_estimators: 基本估计量的个数,此处为决策树的数量</span>
<span class="token comment"># max_samples: 每次从数据集中取出的样本的个数</span>
<span class="token comment"># bootstrap: 每次取的样本是随机的</span>
<span class="token comment"># n_jobs: 使用所有处理器</span>
<span class="token comment"># random_state: 生成随机种子，给定一个int型数据，能够保证每次生成数据相同</span>
bag_clf <span class="token operator">=</span> BaggingClassifier<span class="token punctuation">(</span>
    base_estimator <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    n_estimators <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
    max_samples <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
    bootstrap <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    n_jobs <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    random_state <span class="token operator">=</span> <span class="token number">42</span>
<span class="token punctuation">)</span>

<span class="token comment"># 进行训练</span>
bag_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
<span class="token comment"># 进行预测</span>
y_pred <span class="token operator">=</span> bag_clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>得到Bagging策略的准确度</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 使用Bagging方法获得的精确度</span>
accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_pred<span class="token punctuation">)</span>

<span class="token comment">## 结果: 0.904</span>
</code></pre> 
<ol start="3"><li>选择树模型进行对比</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 对比实验，使用树模型获得的准确度</span>
tree_clf <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>random_state <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">)</span>
tree_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_pred_tree <span class="token operator">=</span> tree_clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_pred_tree<span class="token punctuation">)</span>

<span class="token comment">## 结果: 0.856</span>
</code></pre> 
<ol start="4"><li>绘制决策边界</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>colors <span class="token keyword">import</span> ListedColormap
<span class="token keyword">def</span> <span class="token function">plot_decision_boundary</span><span class="token punctuation">(</span>clf<span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>contour <span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x1s<span class="token operator">=</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    x2s<span class="token operator">=</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token comment"># 绘制棋盘</span>
    x1<span class="token punctuation">,</span>x2 <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>x1s<span class="token punctuation">,</span>x2s<span class="token punctuation">)</span>
    <span class="token comment"># 拼接</span>
    X_new <span class="token operator">=</span> np<span class="token punctuation">.</span>c_<span class="token punctuation">[</span>x1<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x2<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    y_pred <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_new<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>x1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    custom_cmap <span class="token operator">=</span> ListedColormap<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'#fafab0'</span><span class="token punctuation">,</span><span class="token string">'#9898ff'</span><span class="token punctuation">,</span><span class="token string">'#a0faa0'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y_pred<span class="token punctuation">,</span>cmap <span class="token operator">=</span> custom_cmap<span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> contour<span class="token punctuation">:</span>
        custom_cmap2 <span class="token operator">=</span> ListedColormap<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'#7d7d58'</span><span class="token punctuation">,</span><span class="token string">'#4c4c7f'</span><span class="token punctuation">,</span><span class="token string">'#507d50'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y_pred<span class="token punctuation">,</span>cmap <span class="token operator">=</span> custom_cmap2<span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span>
    <span class="token comment"># 画出原始数据</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'ro'</span><span class="token punctuation">,</span>alpha <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'gs'</span><span class="token punctuation">,</span>alpha <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span>axes<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x1'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'x2'</span><span class="token punctuation">,</span>rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>画图展示</li></ol> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
plot_decision_boundary<span class="token punctuation">(</span>tree_clf<span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Decision Tree'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
plot_decision_boundary<span class="token punctuation">(</span>bag_clf<span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Decision Tree With Bagging'</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="6">
<li> <p>效果展示<br> <img src="https://images2.imgbox.com/26/f1/9Io186Ec_o.png" alt="在这里插入图片描述"></p> </li>
<li> <p>结果分析</p> <p>实验从两个角度进行对比，步骤2与步骤3从<strong>准确率</strong>的角度对Bagging策略与基本决策树模型进行对比，可以看出Bagging策略得到的准确率为<code>0.904</code>，而决策树模型得到的准确率为<code>0.856</code>，可以看出Bagging策略优于决策树模型；步骤4,5,6是<strong>绘制边界</strong>的角度进行对比，由上图所示，左侧是进行决策树算法得到的结果图，右侧是进行Bagging策略得到的结果图，从右图可知，拟合的曲线相对稳定，平稳的曲线才是我们想要的，左侧的决策树模型有过拟合的现象。</p> </li>
<li> <p>bagging自带的结果验证</p> <p>袋外数据验证，袋外的意思就是从原始数据集中抽取训练集之后，剩余的数据集，这是bagging策略自带的一种评价指标</p> </li>
</ol> 
<pre><code class="prism language-python">bag_clf <span class="token operator">=</span> BaggingClassifier<span class="token punctuation">(</span>
    base_estimator <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    n_estimators <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
    max_samples <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
    bootstrap <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    n_jobs <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    random_state <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">,</span>
    oob_score <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token punctuation">)</span>

<span class="token comment"># 进行训练</span>
bag_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
<span class="token comment"># 使用袋外数据进行验证结果</span>
bag_clf<span class="token punctuation">.</span>oob_score_


<span class="token comment">## 结果: 0.9253333333333333</span>
</code></pre> 
<h5>
<a id="53__347"></a>5.3. 随机森林的特征重要性</h5> 
<ol><li> <p>导包并训练</p> <p>根据随机森林里面特有的特征<code>feature_importances_</code>进行计算</p> </li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris

iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
rf_clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>n_jobs <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
rf_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>iris<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span>score <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token string">'feature_names'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rf_clf<span class="token punctuation">.</span>feature_importances_<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>score<span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>画图展示</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> random
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
 
name <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'sepal length'</span><span class="token punctuation">,</span> <span class="token string">'sepal width'</span><span class="token punctuation">,</span> <span class="token string">'petal length'</span><span class="token punctuation">,</span> <span class="token string">'petal width'</span><span class="token punctuation">]</span>

data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.10</span><span class="token punctuation">,</span><span class="token number">0.02</span><span class="token punctuation">,</span><span class="token number">0.43</span><span class="token punctuation">,</span><span class="token number">0.45</span><span class="token punctuation">]</span>

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> ax<span class="token punctuation">.</span>barh<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'#6699CC'</span><span class="token punctuation">)</span>
 
<span class="token keyword">for</span> rect <span class="token keyword">in</span> b<span class="token punctuation">:</span>
    w <span class="token operator">=</span> rect<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>w<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>get_y<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>rect<span class="token punctuation">.</span>get_height<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'%.2f'</span> <span class="token operator">%</span><span class="token builtin">float</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">)</span>

ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Characteristics of importance'</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token string">'16'</span><span class="token punctuation">,</span>fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
 
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li> <p>效果展示</p> <p>下图的结果表明，<code>petal width</code>和<code>petal length</code>是很重要的特征<br> <img src="https://images2.imgbox.com/80/f8/KhwqlR2r_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<h5>
<a id="54_mnist_396"></a>5.4. mnist数据集特征重要性</h5> 
<ol><li>导包获取数据集并进行训练</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> fetch_mldata
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier

mnist <span class="token operator">=</span> fecch_mldata<span class="token punctuation">(</span><span class="token string">'MNIST original'</span><span class="token punctuation">)</span>
rf_clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
rf_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>mnist<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>mnist<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>画图展示</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">plot_digit</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    image <span class="token operator">=</span> data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>image<span class="token punctuation">,</span>cmap<span class="token operator">=</span>matplotlib<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>hot<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
    
    
plot_digit<span class="token punctuation">(</span>rf_clf<span class="token punctuation">.</span>feature_importances_<span class="token punctuation">)</span>
char <span class="token operator">=</span> plt<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span>ticks<span class="token operator">=</span><span class="token punctuation">[</span>rf_clf<span class="token punctuation">.</span>feature_importances_<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rf_clf<span class="token punctuation">.</span>feature_importances_<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
char<span class="token punctuation">.</span>ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Not important'</span><span class="token punctuation">,</span><span class="token string">'Very important'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li> <p>效果展示</p> <p>mnist数据集中只有中间才是数字，其他都是白边， 数值特征在什么位置重要，用热度图进行展示，热度图一般与图像数据结合使用。<br> <img src="https://images2.imgbox.com/9e/a9/gwoHB4bS_o.png" alt="在这里插入图片描述" width="400"></p> </li></ol> 
<h4>
<a id="6_Boosting_428"></a>6. Boosting-提升策略</h4> 
<h5>
<a id="61_AdaBoost_430"></a>6.1. AdaBoost</h5> 
<p><strong>策略介绍</strong>：在原始数据集中直接进行预测，观察预测不好的点，然后提升它们的权重，再前一次的基础上进行预测，各个结果值按照不同的权重配比，组成最后的结果。<br> <img src="https://images2.imgbox.com/d7/c1/M0OLXyZl_o.png" alt="在这里插入图片描述" width="800"></p> 
<h6>
<a id="611__436"></a>6.1.1. 模拟流程</h6> 
<p><strong><code>(以SVM分类器为例来演示AdaBoost的基本策略)</code></strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC

<span class="token comment"># 计算样本个数</span>
m <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 不同的调节力度对结果的影响，用学习率来表示，然后画两个图来进行对比实验</span>
<span class="token keyword">for</span> subplot<span class="token punctuation">,</span>learning_rate <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 开始的时候权重相同</span>
    sample_weights <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span>subplot<span class="token punctuation">)</span>
    <span class="token comment"># 构建5次，得到5个模型，然后把五个模型串在一起</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        svm_clf <span class="token operator">=</span> SVC<span class="token punctuation">(</span>kernel <span class="token operator">=</span> <span class="token string">'rbf'</span><span class="token punctuation">,</span>C<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span> 
        <span class="token comment"># sample_weight: 当前样本的权重项</span>
        svm_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>sample_weight<span class="token operator">=</span>sample_weights<span class="token punctuation">)</span>
        y_pred <span class="token operator">=</span> svm_clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
        sample_weights<span class="token punctuation">[</span>y_pred <span class="token operator">!=</span> y_train<span class="token punctuation">]</span> <span class="token operator">*=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>learning_rate<span class="token punctuation">)</span>
        plot_decision_boundary<span class="token punctuation">(</span>svm_clf<span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'learning_rate = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>learning_rate<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> subplot <span class="token operator">==</span> <span class="token number">121</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.65</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.10</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0.10</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span>  <span class="token number">0.55</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>  <span class="token number">0.90</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>效果展示：<br> <img src="https://images2.imgbox.com/5a/79/i4A4EVWj_o.png" alt="在这里插入图片描述"></p> 
<h6>
<a id="612__474"></a>6.1.2. 工具包实现</h6> 
<p><code>(使用sklearn工具包实现)</code></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> AdaBoostClassifier
ada_clf <span class="token operator">=</span> AdaBoostClassifier<span class="token punctuation">(</span>
    base_estimator <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    n_estimators <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span>
    learning_rate <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    random_state <span class="token operator">=</span> <span class="token number">42</span>
<span class="token punctuation">)</span>
ada_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
plot_decision_boundary<span class="token punctuation">(</span>ada_clf<span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
</code></pre> 
<p>效果展示<br> <img src="https://images2.imgbox.com/fa/49/xhmrDddN_o.png" alt="在这里插入图片描述"></p> 
<h5>
<a id="62_Gradient_Boosting_494"></a>6.2. Gradient Boosting</h5> 
<h6>
<a id="621__496"></a>6.2.1. 模拟流程</h6> 
<ol><li>创造数据</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 先做数据集</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
X <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span>
y <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">*</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">0.05</span><span class="token operator">*</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>导包并进行训练</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeRegressor

<span class="token comment"># 第一次训练</span>
tree_reg1 <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
tree_reg1<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

<span class="token comment"># 第二次训练</span>
y2 <span class="token operator">=</span> y <span class="token operator">-</span> tree_reg1<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
tree_reg2 <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
tree_reg2<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y2<span class="token punctuation">)</span>

<span class="token comment"># 第三次训练</span>
y3 <span class="token operator">=</span> y2 <span class="token operator">-</span> tree_reg2<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
tree_reg3 <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
tree_reg3<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y3<span class="token punctuation">)</span>

<span class="token comment"># 第四次训练</span>
y4 <span class="token operator">=</span> y3 <span class="token operator">-</span> tree_reg3<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
tree_reg4 <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
tree_reg4<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y4<span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>画图展示</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">plot_predictions</span><span class="token punctuation">(</span>regressors<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> axes<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"g-"</span><span class="token punctuation">,</span> data_style<span class="token operator">=</span><span class="token string">"b."</span><span class="token punctuation">,</span> data_label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x1 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
    y_pred <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>regressor<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x1<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> regressor <span class="token keyword">in</span> regressors<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> data_style<span class="token punctuation">,</span> label<span class="token operator">=</span>data_label<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> style<span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> label<span class="token operator">=</span>label<span class="token punctuation">)</span>
    <span class="token keyword">if</span> label <span class="token keyword">or</span> data_label<span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">"upper center"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span>axes<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">421</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>tree_reg1<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"$h_1(x_1)$"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"r-"</span><span class="token punctuation">,</span> data_label<span class="token operator">=</span><span class="token string">"Training set"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"$y$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Residuals and tree predictions"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">422</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>tree_reg1<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"$h(x_1) = h_1(x_1)$"</span><span class="token punctuation">,</span> data_label<span class="token operator">=</span><span class="token string">"Training set"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"$y$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Ensemble predictions"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">423</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>tree_reg2<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"$h_2(x_1)$"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"r-"</span><span class="token punctuation">,</span> data_style<span class="token operator">=</span><span class="token string">"k+"</span><span class="token punctuation">,</span> data_label<span class="token operator">=</span><span class="token string">"Residuals"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"$y - h_1(x_1)$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">424</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>tree_reg1<span class="token punctuation">,</span> tree_reg2<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"$h(x_1) = h_1(x_1) + h_2(x_1)$"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"$y$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">425</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>tree_reg3<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">,</span> y3<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"$h_3(x_1)$"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"r-"</span><span class="token punctuation">,</span> data_style<span class="token operator">=</span><span class="token string">"k+"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"$y - h_1(x_1) - h_2(x_1)$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"$x_1$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">426</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>tree_reg1<span class="token punctuation">,</span> tree_reg2<span class="token punctuation">,</span> tree_reg3<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"$h(x_1) = h_1(x_1) + h_2(x_1) + h_3(x_1)$"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"$x_1$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"$y$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">427</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>tree_reg4<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">,</span> y4<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"$h_4(x_1)$"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"r-"</span><span class="token punctuation">,</span> data_style<span class="token operator">=</span><span class="token string">"k+"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"$y - h_1(x_1) - h_2(x_1) - h_3(x_1)$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"$x_1$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">428</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>tree_reg1<span class="token punctuation">,</span> tree_reg2<span class="token punctuation">,</span> tree_reg3<span class="token punctuation">,</span>tree_reg4<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"$h(x_1) = h_1(x_1) + h_2(x_1) + h_3(x_1) + h_4(x_1)$"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"$x_1$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"$y$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li> <p>效果展示<br> <img src="https://images2.imgbox.com/69/d2/w3gso65k_o.png" alt="在这里插入图片描述"></p> <p><strong>分析</strong>：图1(从上到下，从左至右排序)是第一棵树，蓝色的点为数据集，红色线条为预测结果；图2代表一个树的集成，与左侧图一样；图3是在图1的基础上进行预测的结果，在位置0的时候没有参差值，0的两侧是在图1的基础上的参差值，是第一次预测过程中效果不好的点；图4是集成两颗树的结果；图5是在前两次的基础上进行预测的结果，并且调整树的深度为4，得到的预测结果；图6是三棵树的集成结果；图7的预测结果看出，基本没有参差值，此时可以达到很好的预测结果；图8为4棵树的集成结果，可以看出，基本符合预期的结果。</p> </li></ol> 
<h6>
<a id="622__593"></a>6.2.2. 工具包实现</h6> 
<ol><li>导包并训练</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> GradientBoostingRegressor
gbrt <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>
                    max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    n_estimators <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token comment"># 代表每个数占的权重</span>
                    learning_rate <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    random_state <span class="token operator">=</span> <span class="token number">42</span>  
<span class="token punctuation">)</span>
gbrt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>进行对比实验</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 对比实验一: 调整权重</span>
gbrt_slow_1 <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>
                    max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    n_estimators <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token comment"># 代表每个数占的权重</span>
                    learning_rate <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
                    random_state <span class="token operator">=</span> <span class="token number">42</span>  
<span class="token punctuation">)</span>
gbrt_slow_1<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>


<span class="token comment"># 对比实验二: 调整推进阶段的数量</span>
gbrt_slow_2 <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>
                    max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    n_estimators <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span>
                    <span class="token comment"># 代表每个数占的权重</span>
                    learning_rate <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
                    random_state <span class="token operator">=</span> <span class="token number">42</span>  
<span class="token punctuation">)</span>
gbrt_slow_2<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>画图展示</li></ol> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>gbrt<span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>axes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>label <span class="token operator">=</span> <span class="token string">'Ensemble predictions'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'learning_rate = {},n_estimators = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>gbrt<span class="token punctuation">.</span>learning_rate<span class="token punctuation">,</span>gbrt<span class="token punctuation">.</span>n_estimators<span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>gbrt_slow_1<span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>axes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>label <span class="token operator">=</span> <span class="token string">'Ensemble predictions'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'learning_rate = {},n_estimators = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>gbrt_slow_1<span class="token punctuation">.</span>learning_rate<span class="token punctuation">,</span>gbrt_slow_1<span class="token punctuation">.</span>n_estimators<span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>gbrt_slow_2<span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>axes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>label <span class="token operator">=</span> <span class="token string">'Ensemble predictions'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'learning_rate = {},n_estimators = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>gbrt_slow_2<span class="token punctuation">.</span>learning_rate<span class="token punctuation">,</span>gbrt_slow_2<span class="token punctuation">.</span>n_estimators<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li> <p>效果展示<br> <img src="https://images2.imgbox.com/1f/25/Btmk7XC9_o.png" alt="在这里插入图片描述"></p> <p><strong>分析</strong>：上面三个图构成两组对比实验，由图1和图2可知，在要执行的推进阶段的数量相同的前提下，学习率越大反而越好，出现这种情况的原因是推进阶段的数量太少；由第2个图和第3个图的对比中，在学习率(代表每个数占的权重)相同的前提下，推进的数量越多，效果越好。因此，推进数量应当适当的大一点，学习率应适当小一点。</p> </li></ol> 
<h6>
<a id="623__658"></a>6.2.3. 提前终止策略</h6> 
<ol><li>导包并训练</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 导入均方误差</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error

X_train<span class="token punctuation">,</span>X_val<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>y_val <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>random_state <span class="token operator">=</span> <span class="token number">49</span><span class="token punctuation">)</span>

gbrt <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                          n_estimators <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">,</span>
                          random_state <span class="token operator">=</span> <span class="token number">42</span>
<span class="token punctuation">)</span>
gbrt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>

<span class="token comment"># 获取错误点</span>
errors <span class="token operator">=</span> <span class="token punctuation">[</span>mean_squared_error<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span>y_pred<span class="token punctuation">)</span> <span class="token keyword">for</span> y_pred <span class="token keyword">in</span> gbrt<span class="token punctuation">.</span>staged_predict<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment"># 找出出错前预测结果最好的点</span>
bst_n_estimators <span class="token operator">=</span> np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>errors<span class="token punctuation">)</span>

<span class="token comment"># 用最好的点进行预测</span>
gbrt_best <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                          n_estimators <span class="token operator">=</span> bst_n_estimators<span class="token punctuation">,</span>
                          random_state <span class="token operator">=</span> <span class="token number">42</span>
<span class="token punctuation">)</span>
gbrt_best<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
min_error <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>画图展示</li></ol> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>errors<span class="token punctuation">,</span><span class="token string">'b.-'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>bst_n_estimators<span class="token punctuation">,</span>bst_n_estimators<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>min_error<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'k--'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>min_error<span class="token punctuation">,</span>min_error<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'k--'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Val Error'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
plot_predictions<span class="token punctuation">(</span><span class="token punctuation">[</span>gbrt_best<span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Best Model(%d trees)'</span><span class="token operator">%</span>bst_n_estimators<span class="token punctuation">)</span>
</code></pre> 
<ol start="3">
<li> <p>效果展示<br> <img src="https://images2.imgbox.com/66/18/rNN9Ek97_o.png" alt="在这里插入图片描述"></p> <p><strong>分析</strong>：当树的数量达到55的时候，达到最好的效果，之后就开始回弹。</p> </li>
<li> <p>终止策略实现</p> </li>
</ol> 
<pre><code class="prism language-python"><span class="token comment"># warm_start在上一次的基础上进行叠加，速度会快一点</span>
gbrt <span class="token operator">=</span> GradientBoostingRegressor<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                             random_state <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">,</span>
                                 warm_start <span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span>
error_going_up <span class="token operator">=</span> <span class="token number">0</span>
min_val_error <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">'inf'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> n_estimators <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gbrt<span class="token punctuation">.</span>n_estimators <span class="token operator">=</span> n_estimators
    gbrt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
    y_pred <span class="token operator">=</span> gbrt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span>
    val_error <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>y_val<span class="token punctuation">,</span>y_pred<span class="token punctuation">)</span>
    <span class="token keyword">if</span> val_error <span class="token operator">&lt;</span> min_val_error<span class="token punctuation">:</span>
        min_val_error <span class="token operator">=</span> val_error
        error_going_up <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        error_going_up <span class="token operator">+=</span><span class="token number">1</span>
        <span class="token keyword">if</span> error_going_up <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
</code></pre> 
<ol start="5"><li>输出结果</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">print</span> <span class="token punctuation">(</span>gbrt<span class="token punctuation">.</span>n_estimators<span class="token punctuation">)</span>
<span class="token comment">## 结果: 61</span>
</code></pre> 
<p><strong>分析</strong>：从最佳树的数量55开始，计算5个树，如果之后加入的5个树全部使原数据回弹，则往前推5个就找到了最佳树的个数。</p> 
<h4>
<a id="7_Stacking_747"></a>7. Stacking策略</h4> 
<h6>
<a id="71__749"></a>7.1. 策略介绍</h6> 
<p>Stacking策略分两个阶段进行，第一个阶段是选择不同的分类器，得到多个预测值，第二个阶段根据每个预测值的权重进行集成，如下图所示。<br> <img src="https://images2.imgbox.com/5a/9b/PN9Cugb1_o.png" alt="在这里插入图片描述" width="800"></p> 
<p>训练示意图：<br> <img src="https://images2.imgbox.com/3d/bd/rLBb1Qm1_o.png" alt="在这里插入图片描述" width="800"></p> 
<h6>
<a id="72__758"></a>7.2. 具体实现步骤</h6> 
<ol><li>加载数据集</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> fetch_mldata
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split

mnist <span class="token operator">=</span> fetch_mldata<span class="token punctuation">(</span><span class="token string">'MNIST original'</span><span class="token punctuation">)</span>

X_train_val<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train_val<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>mnist<span class="token punctuation">.</span>data<span class="token punctuation">,</span> mnist<span class="token punctuation">.</span>target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
X_train<span class="token punctuation">,</span> X_val<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_val <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X_train_val<span class="token punctuation">,</span> y_train_val<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>导入各种分类器并生成分类器的对象，最后进行集成</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier<span class="token punctuation">,</span> ExtraTreesClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> LinearSVC
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neural_network <span class="token keyword">import</span> MLPClassifier

random_forest_clf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
extra_trees_clf <span class="token operator">=</span> ExtraTreesClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
svm_clf <span class="token operator">=</span> LinearSVC<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
mlp_clf <span class="token operator">=</span> MLPClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>

estimators <span class="token operator">=</span> <span class="token punctuation">[</span>random_forest_clf<span class="token punctuation">,</span> extra_trees_clf<span class="token punctuation">,</span> svm_clf<span class="token punctuation">,</span> mlp_clf<span class="token punctuation">]</span>
</code></pre> 
<ol start="3"><li>对每个分类器进行训练</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">for</span> estimator <span class="token keyword">in</span> estimators<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Training the"</span><span class="token punctuation">,</span> estimator<span class="token punctuation">)</span>
    estimator<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>对分类器进行预测</li></ol> 
<pre><code class="prism language-python">X_val_predictions <span class="token operator">=</span> np<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>X_val<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>estimators<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token keyword">for</span> index<span class="token punctuation">,</span> estimator <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>estimators<span class="token punctuation">)</span><span class="token punctuation">:</span>
    X_val_predictions<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span> <span class="token operator">=</span> estimator<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_val<span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>第二阶段集成分类器并进行训练</li></ol> 
<pre><code class="prism language-python">rnd_forest_blender <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> oob_score<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
rnd_forest_blender<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_val_predictions<span class="token punctuation">,</span> y_val<span class="token punctuation">)</span>
</code></pre> 
<ol start="6"><li>观察预测结果</li></ol> 
<pre><code class="prism language-python">rnd_forest_blender<span class="token punctuation">.</span>oob_score_
</code></pre>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
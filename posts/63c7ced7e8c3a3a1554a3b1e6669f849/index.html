<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>K-近邻算法 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K-近邻算法</h1>
			
		</header>
		<div class="content post__content clearfix">
			


        
                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <h3>
<a id="K_0"></a>一、K-近邻算法</h3> 
<h4>
<a id="1_2"></a>1.介绍</h4> 
<p>K-近邻算法(K Nearest Neighbor)又叫<strong>KNN算法</strong>，指如果一个样本在特征空间中的<strong>k个最相似的样本中的大多数属于某一个类别</strong>，则该样本也属于这个类别。也就是对于新输入的实例，从数据集中找到于该实例最邻近的k个实例，那么这k个实例大多数属于某一个类，那么就把该实例放到该类中。</p> 
<p>KNN算法<strong>不仅可以用于分类，还可以用于回归</strong>。通过找出一个样本的k个最近邻居，将这些邻居的属性的平均值赋给该样本，就可以得到该样本的属性。</p> 
<blockquote> 
 <p><strong>举个栗子</strong>：若已经对一部分人标明皮肤白还是黑，当新加入一个人时，若要对其判定皮肤是黑还是白，那么就可以看其皮肤颜色与已判定黑或者白的人群皮肤颜色进行对比，与哪方更贴近则可以表明该人皮肤到底属于哪一类</p> 
</blockquote> 
<h4>
<a id="2K_10"></a>2.K-近邻算法流程</h4> 
<ul>
<li>计算已知类别数据集中的点与当前点之间的距离</li>
<li>按距离递增次序排序</li>
<li>选取与当前点距离最小的k个点</li>
<li>统计前k个点所在的类别出现的频率</li>
<li>返回前k个点出现频率最高的类别作为当前点的预测分类</li>
</ul> 
<blockquote> 
 <p>计算距离一般使用欧氏距离公式，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         d
        
        
         (
        
        
         x
        
        
         ,
        
        
         y
        
        
         )
        
        
         =
        
        
         
          
           
            ∑
           
           
            
             i
            
            
             =
            
            
             1
            
           
           
            n
           
          
          
           (
          
          
           
            x
           
           
            i
           
          
          
           −
          
          
           
            y
           
           
            i
           
          
          
           
            )
           
           
            2
           
          
         
        
       
       
        d(x,y)=sqrt{sum_{i=1}^n(x_i-y_i)^2}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span style="margin-right: 0.0359em" class="mord mathnormal">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1.24em;vertical-align: -0.3027em"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9373em"><span class="svg-align"><span class="pstrut" style="height: 3.2em"></span><span class="mord" style="padding-left: 1em"><span class="mop"><span class="mop op-symbol small-op">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8043em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2997em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mord"><span style="margin-right: 0.0359em" class="mord mathnormal">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.0359em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7401em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class=""><span class="pstrut" style="height: 3.2em"></span><span class="hide-tail" style="min-width: 1.02em;height: 1.28em">
            
             
            </span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3027em"><span class=""></span></span></span></span></span></span></span></span></span><br> 机器学习流程</p> 
 <p>获取数据-》数据基本处理-》特征工程-》机器学习-》模型评估</p> 
</blockquote> 
<h4>
<a id="3Scikitlearn_23"></a>3.Scikit-learn机器学习库</h4> 
<p>Scikit-learn是python学习机器学习的工具，包括很多的机器学习算法。</p> 
<p><strong>优点：</strong></p> 
<ul>
<li>简单，易理解，精度高，既可以用来做分类也可以用来做回归</li>
<li>可用于数值型数据和离散型数据</li>
<li>无数据输入假定</li>
<li>适合对稀有事件进行分类</li>
</ul> 
<h5>
<a id="1_34"></a>(1)安装</h5> 
<p>安装：<code>pip3 install scikit-learn</code></p> 
<blockquote> 
 <p>注：安装scikit-learn需要Numpy, Scipy等库</p> 
</blockquote> 
<h5>
<a id="2Scikitlearn_40"></a>(2)Scikit-learn包含的内容</h5> 
<ul>
<li>分类、聚类、回归</li>
<li>特征工程</li>
<li>模型选择、调优</li>
</ul> 
<h4>
<a id="4KAPIsklearnneighborsKNeighborsClassifiern_neighbors5algorithmauto__46"></a>4.K-近邻算法API—<code>sklearn.neighbors.KNeighborsClassifier(n_neighbors=5,algorithm='auto') </code>
</h4> 
<ul>
<li>n_neighbors=5：int,可选（默认= 5），k_neighbors查询默认使用的邻居数</li>
<li>algorithm：{‘auto’，‘ball_tree’，‘kd_tree’，‘brute’} 
  <ul><li>快速k近邻搜索算法，默认参数为auto，可以理解<strong>为算法自己决定合适的搜索算法</strong>。除此之外，用户也可以自己指定搜索算法ball_tree、kd_tree、brute方法进行搜索， 
    <ul>
<li>brute是<strong>蛮力搜索</strong>，也就是线性扫描，当训练集很大时，计算非常耗时。</li>
<li>kd_tree，<strong>构造kd树</strong>存储数据以便对其进行快速检索的树形数据结构，kd树也就是数据结构中的二叉树。以中值切分构造的树，每个结点是一个超矩形，在<strong>维数小于20时效率高</strong>。</li>
<li>ball tree是为了<strong>克服kd树高维失效</strong>而发明的，其构造过程是<strong>以质心C和半径r分割样本空间</strong>，<strong>每个节点是一个超球体</strong>。</li>
</ul> </li></ul> </li>
</ul> 
<h5>
<a id="_55"></a>案例</h5> 
<h6>
<a id="31__57"></a>3.1 步骤分析</h6> 
<ul>
<li>1.获取数据集</li>
<li>2.数据基本处理（该案例中省略）</li>
<li>3.特征工程（该案例中省略）</li>
<li>4.机器学习</li>
<li>5.模型评估（该案例中省略）</li>
</ul> 
<h6>
<a id="32__65"></a>3.2 代码过程</h6> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
<span class="token comment"># 1.构造数据</span>
<span class="token comment"># x为特征值，是dataframe形式理解为二维[[]]</span>
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment"># y为目标值，可以表示为series，表示为一维数组[]</span>
y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span>
<span class="token comment"># 表示</span>
<span class="token comment"># x y</span>
<span class="token comment"># 1 0</span>
<span class="token comment"># 2 10</span>
<span class="token comment"># 3 20</span>
<span class="token comment"># 4 30</span>
<span class="token comment"># 2.训练模型</span>
<span class="token comment"># 2.1实例化API，实例化一个估计器对象，因为样本数只有4个，所以n_neighbors&lt;=4</span>
estimator <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 2.2使用fit方法进行训练，x为二维，y为一维</span>
estimator<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token comment"># 3.数据预测,将测试集的特征值传入，根据先前计算出的模型，来预测所给测试机的目标值，注意参数为二维[[]]</span>
ret1 <span class="token operator">=</span> estimator<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret1<span class="token punctuation">)</span>
<span class="token comment"># 0离1近，1的值为0，所以输出0</span>
ret2 <span class="token operator">=</span> estimator<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret2<span class="token punctuation">)</span>
<span class="token comment"># 10离4近，4的值为30，所以输出30</span>

<span class="token comment"># 输出结果[0] [30]</span>
</code></pre> 
<h4>
<a id="5_96"></a>5.距离度量</h4> 
<h5>
<a id="1_98"></a>(1)距离公式基本性质</h5> 
<ul>
<li>非负性： <span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         d
        
        
         i
        
        
         s
        
        
         t
        
        
         (
        
        
         
          X
         
         
          i
         
        
        
         ,
        
        
         
          X
         
         
          j
         
        
        
         )
        
        
         &gt;
        
        
         =
        
        
         0
        
       
       
        dist(X_i,X_j) &gt;= 0
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.0785em" class="mord mathnormal">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span style="margin-right: 0.0785em" class="mord mathnormal">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0572em" class="mord mathnormal mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">0</span></span></span></span></span> ；</li>
<li>同一性：<span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         d
        
        
         i
        
        
         s
        
        
         t
        
        
         (
        
        
         
          x
         
         
          i
         
        
        
         ,
        
        
         
          x
         
         
          j
         
        
        
         )
        
        
         =
        
        
         0
        
       
       
        dist(x_i,x_j)=0
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0572em" class="mord mathnormal mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.6444em"></span><span class="mord">0</span></span></span></span></span>。当且仅当 <span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
          X
         
         
          i
         
        
        
         =
        
        
         
          X
         
         
          j
         
        
       
       
        X_i = X_j
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em;vertical-align: -0.15em"></span><span class="mord"><span style="margin-right: 0.0785em" class="mord mathnormal">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.9694em;vertical-align: -0.2861em"></span><span class="mord"><span style="margin-right: 0.0785em" class="mord mathnormal">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.0785em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0572em" class="mord mathnormal mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span></span></span></span></span>；</li>
<li>对称性： <span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         d
        
        
         i
        
        
         s
        
        
         t
        
        
         (
        
        
         
          x
         
         
          i
         
        
        
         ,
        
        
         
          x
         
         
          j
         
        
        
         )
        
        
         =
        
        
         d
        
        
         i
        
        
         s
        
        
         t
        
        
         (
        
        
         
          x
         
         
          j
         
        
        
         ,
        
        
         
          x
         
         
          i
         
        
        
         )
        
       
       
        dist(x_i,x_j)=dist(x_j,x_i)
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0572em" class="mord mathnormal mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0572em" class="mord mathnormal mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>；</li>
<li>直递性： <span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         d
        
        
         i
        
        
         s
        
        
         t
        
        
         (
        
        
         
          x
         
         
          i
         
        
        
         ,
        
        
         
          x
         
         
          j
         
        
        
         )
        
        
         &lt;
        
        
         =
        
        
         d
        
        
         i
        
        
         s
        
        
         t
        
        
         (
        
        
         
          x
         
         
          i
         
        
        
         ,
        
        
         
          x
         
         
          k
         
        
        
         )
        
        
         +
        
        
         d
        
        
         i
        
        
         s
        
        
         t
        
        
         (
        
        
         
          x
         
         
          k
         
        
        
         ,
        
        
         
          x
         
         
          j
         
        
        
         )
        
       
       
        dist(x_i,x_j) &lt;= dist(x_i,x_k) +dist(x_k,x_j)
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0572em" class="mord mathnormal mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">&lt;=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1.0361em;vertical-align: -0.2861em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0572em" class="mord mathnormal mtight">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>
</li>
</ul> 
<blockquote> 
 <p>直递性常被直接称为“三角不等式”。</p> 
</blockquote> 
<h5>
<a id="2_106"></a>(2)常见距离公式</h5> 
<h6>
<a id="_108"></a>①欧氏距离—通过距离平方值</h6> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        d
       
       
        (
       
       
        x
       
       
        ,
       
       
        y
       
       
        )
       
       
        =
       
       
        
         
          
           ∑
          
          
           
            i
           
           
            =
           
           
            1
           
          
          
           n
          
         
         
          (
         
         
          
           x
          
          
           i
          
         
         
          −
         
         
          
           y
          
          
           i
          
         
         
          
           )
          
          
           2
          
         
        
       
      
      
       d(x,y)=sqrt{sum_{i=1}^n(x_i-y_i)^2}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em;vertical-align: -0.25em"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em"></span><span style="margin-right: 0.0359em" class="mord mathnormal">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 1.24em;vertical-align: -0.3027em"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9373em"><span class="svg-align"><span class="pstrut" style="height: 3.2em"></span><span class="mord" style="padding-left: 1em"><span class="mop"><span class="mop op-symbol small-op">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8043em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2997em"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: 0em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mord"><span style="margin-right: 0.0359em" class="mord mathnormal">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em"><span class="" style="margin-left: -0.0359em;margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7401em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class=""><span class="pstrut" style="height: 3.2em"></span><span class="hide-tail" style="min-width: 1.02em;height: 1.28em">
           
            
           </span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3027em"><span class=""></span></span></span></span></span></span></span></span></span></p> 
<pre><code>X=[[1,1],[2,2],[3,3],[4,4]];
经计算得:
d = 1.4142    2.8284    4.2426    1.4142    2.8284    1.4142
</code></pre> 
<h6>
<a id="_118"></a>②曼哈顿距离—通过距离的绝对值</h6> 
<p>在曼哈顿街区要从一个十字路口开车到另一个十字路口，驾驶距离显然不是两点间的直线距离。这个实际驾驶距离就是“曼哈顿距离”。曼哈顿距离也称为“城市街区距离”(City Block distance)。</p> 
<p><img src="https://images2.imgbox.com/96/d2/1695bFdC_o.png" alt="曼哈顿距离.png"></p> 
<p><img src="https://images2.imgbox.com/6c/2b/UblqD4Y3_o.png" alt="曼哈顿距离公式.png"></p> 
<pre><code>X=[[1,1],[2,2],[3,3],[4,4]];
经计算得:
d =   2     4     6     2     4     2
</code></pre> 
<h6>
<a id="_134"></a>③切比雪夫距离—维度的最大值</h6> 
<p>国际象棋中，国王可以直行、横行、斜行，所以国王走一步可以移动到相邻8个方格中的任意一个。国王从格子(x1,y1)走到格子(x2,y2)最少需要多少步？这个距离就叫切比雪夫距离。</p> 
<p><img src="https://images2.imgbox.com/3a/21/P0iRfiUn_o.png" alt="1.7 切比雪夫距离.png"></p> 
<p><img src="https://images2.imgbox.com/4c/75/fgCX3j91_o.png" alt="1.8 切比雪夫距离.png"></p> 
<pre><code>X=[[1,1],[2,2],[3,3],[4,4]];
经计算得:
d =   1     2     3     1     2     1
</code></pre> 
<h6>
<a id="_150"></a>④闵可夫斯基距离</h6> 
<p>闵氏距离不是一种距离，而是一组距离的定义，是对<strong>多个距离度量公式的概括性的表述</strong>。</p> 
<p>两个n维变量a(x11,x12,…,x1n)与b(x21,x22,…,x2n)间的闵可夫斯基距离定义为：</p> 
<p><img src="https://images2.imgbox.com/8e/ce/CZql9Xu1_o.png" alt="闵可夫斯基距离.png"></p> 
<p>其中p是一个变参数：</p> 
<ul>
<li> <p>当p=1时，就是曼哈顿距离；</p> </li>
<li> <p>当p=2时，就是欧氏距离；</p> </li>
<li> <p>当p→∞时，就是切比雪夫距离。</p> 
  <blockquote> 
   <p>当次方为无穷时，即可等效为最大值</p> 
  </blockquote> </li>
</ul> 
<p><strong>2 闵氏距离的缺点：</strong></p> 
<p>包括曼哈顿距离、欧氏距离和切比雪夫距离，都存在明显的缺点</p> 
<p>(1)将各个分量的量纲(scale)，也就是“单位”相同的看待了;</p> 
<p>(2)未考虑各个分量的分布（期望，方差等）可能是不同的。</p> 
<blockquote> 
 <p>e.g. 二维样本(身高[单位:cm],体重[单位:kg]),现有三个样本：a(180,50)，b(190,50)，c(180,60)。</p> 
 <p>a与b的闵氏距离（无论是曼哈顿距离、欧氏距离或切比雪夫距离）等于a与c的闵氏距离。但实际上身高的10cm并不能和体重的10kg划等号。</p> 
</blockquote> 
<h5>
<a id="3__181"></a>(3) “连续属性”和“离散属性”的距离计算</h5> 
<p>我们常将属性划分为"连续属性" 和"离散属性"，前者在定义域上有无穷多个可能的取值，后者在定义域上是有限个取值.</p> 
<ul>
<li>若属性值之间存在序关系，则可以将其转化为连续值，例如：身高属性“高”“中等”“矮”，可转化为{1, 0.5, 0}。 
  <ul><li>闵可夫斯基距离可以用于有序属性。</li></ul> </li>
<li>若属性值之间不存在序关系，则通常将其转化为向量的形式，例如：性别属性“男”“女”，可转化为{（1,0），（0,1）}。</li>
</ul> 
<h4>
<a id="6K_189"></a>6.K值选择</h4> 
<ul>
<li>K值过小： 
  <ul>
<li>容易受到异常点的影响</li>
<li>容易<strong>过拟合</strong>(即在训练集上表现好，但是在测试集上不好)</li>
</ul> </li>
<li>k值过大： 
  <ul>
<li>受到样本均衡的问题</li>
<li>容易<strong>欠拟合</strong>
</li>
</ul> </li>
</ul> 
<hr> 
<p><strong>K值选择问题，李航博士的一书「统计学习方法」上所说：</strong></p> 
<ul>
<li>1)选择<strong>较小的K值</strong>，就相当于用较小的领域中的训练实例进行预测， 
  <ul>
<li>“学习”<em><strong>近似误差会减小</strong></em>，只有与输入实例较近或相似的训练实例才会对预测结果起作用，与此同时带来的问题是“学习”的<em><strong>估计误差会增大</strong></em>，</li>
<li>换句话说，<strong>K值的减小就意味着整体模型变得复杂，容易发生过拟合；</strong>
</li>
</ul> </li>
<li>2)选择<strong>较大的K值</strong>，就相当于用较大领域中的训练实例进行预测， 
  <ul>
<li>其优点是<em><strong>可以减少学习的估计误差</strong></em>，但缺点是学习的<em><strong>近似误差会增大</strong></em>。这时候，<strong>与输入实例较远（不相似的）训练实例也会对预测器作用，使预测发生错误。</strong>
</li>
<li><strong>且K值的增大就意味着整体的模型变得简单。</strong></li>
</ul> </li>
<li>3)K=N（N为训练样本个数），则完全不足取， 
  <ul><li>因为此时无论输入实例是什么，都只是简单的预测它属于在训练实例中最多的类，模型过于简单，忽略了训练实例中大量有用信息。</li></ul> </li>
<li>在<strong>实际应用中，K值一般取一个比较小的数值</strong>，例如采用交叉验证法（简单来说，就是把训练数据在分成两组:训练集和验证集）来选择最优的K值。</li>
</ul> 
<hr> 
<p><strong>误差</strong></p> 
<ul>
<li>近似误差 
  <ul>
<li>对现有训练集的训练误差，<strong>关注训练集</strong>，</li>
<li>如果<strong>近似误差过小可能会出现过拟合的现象</strong>，对现有的训练集能有很好的预测，但是对未知的测试样本将会出现较大偏差的预测。</li>
<li>模型本身不是最接近最佳模型。</li>
</ul> </li>
<li>估计误差 
  <ul>
<li>可以理解为对测试集的测试误差，关注测试集，</li>
<li>估计误差小说明对未知数据的预测能力好，</li>
<li><strong>模型本身最接近最佳模型。</strong></li>
</ul> </li>
</ul> 
<h4>
<a id="7KD_225"></a>7.KD树</h4> 
<p>为了提高kNN搜索的效率，可以考虑使用特殊的结构存储训练数据，以减小计算距离的次数。</p> 
<p><strong>kd树</strong>：为了避免每次都重新计算一遍距离，算法会把距离信息保存在一棵树里，这样在计算之前从树里查询距离信息，尽量避免重新计算。</p> 
<blockquote> 
 <p>根据<strong>KNN</strong>每次需要预测一个点时，我们都需要计算训练数据集里每个点到这个点的距离，然后选出距离最近的k个点进行投票。</p> 
 <p>当数据集很大时，这个计算成本非常高，针对N个样本，D个特征的数据集，其算法复杂度为O(D*N^2)。</p> 
 <p>优化后的算法复杂度可降低到O(DNlog(N))。</p> 
</blockquote> 
<h5>
<a id="1_237"></a>(1)原理—平衡二叉树</h5> 
<h6>
<a id="_239"></a>①树的建立</h6> 
<h6>
<a id="NearestNeighbor_Lookup_241"></a>②最近邻域搜索（Nearest-Neighbor Lookup）</h6> 
<p>kd树(K-dimension tree)是**一种对k维空间中的实例点进行存储以便对其进行快速检索的树形数据结构。**kd树是一种二叉树，表示对k维空间的一个划分，<strong>构造kd树相当于不断地用垂直于坐标轴的超平面将K维空间切分，构成一系列的K维超矩形区域</strong>。kd树的每个结点对应于一个k维超矩形区域。</p> 
<p><strong>利用kd树可以省去对大部分数据点的搜索，从而减少搜索的计算量。</strong></p> 
<p><img src="https://images2.imgbox.com/0c/ab/cV7Xxi5e_o.jpg" alt="image-20190213223817957"></p> 
<p>类比“二分查找”：给出一组数据：[9 1 4 7 2 5 0 3 8]，要查找8。如果挨个查找（线性扫描），那么将会把数据集都遍历一遍。而如果排一下序那数据集就变成了：[0 1 2 3 4 5 6 7 8 9]，按前一种方式我们进行了很多没有必要的查找，现在如果我们以5为分界点，那么数据集就被划分为了左右两个“簇” [0 1 2 3 4]和[6 7 8 9]。</p> 
<p>因此，根本就没有必要进入第一个簇，可以直接进入第二个簇进行查找。把二分查找中的数据点换成k维数据点，这样的划分就变成了用超平面对k维空间的划分。空间划分就是对数据点进行分类，“挨得近”的数据点就在一个空间里面。</p> 
<h5>
<a id="2_253"></a>(2)构造方法</h5> 
<p>（1）<strong>构造根结点，使根结点对应于K维空间中包含所有实例点的超矩形区域；</strong></p> 
<p>（2）**通过递归的方法，不断地对k维空间进行切分，生成子结点。**在超矩形区域上选择一个坐标轴和在此坐标轴上的一个切分点，确定一个超平面，这个超平面通过选定的切分点并垂直于选定的坐标轴，将当前超矩形区域切分为左右两个子区域（子结点）；这时，实例被分到两个子区域。</p> 
<p>（3）<strong>上述过程直到子区域内没有实例时终止（终止时的结点为叶结点）</strong>。在此过程中，将实例保存在相应的结点上。</p> 
<p>（4）通常，循环的<strong>选择坐标轴对空间切分</strong>，选择训练实例点在坐标轴上的中位数为切分点，这样得到的<strong>kd树是平衡二叉树</strong></p> 
<p>KD树中每个节点是一个向量，和二叉树按照数的大小划分不同的是，KD树每层需要选定向量中的某一维，然后根据这一维按左小右大的方式划分数据。</p> 
<h5>
<a id="KD2_265"></a>在构建KD树时，关键需要解决2个问题：</h5> 
<h6>
<a id="_267"></a>①选择向量的哪一维进行划分；</h6> 
<h6>
<a id="_269"></a>②如何划分数据；</h6> 
<p>第一个问题简单的解决方法可以是随机选择某一维或按顺序选择，但是<strong>更好的方法应该是在数据比较分散的那一维进行划分（分散的程度可以根据方差来衡量）</strong>。</p> 
<p>第二个问题中，好的划分方法可以使构建的树比较平衡，可以每次选择中位数来进行划分。</p> 
<h5>
<a id="3kd_275"></a>(3)kd树的搜索过程</h5> 
<ul>
<li>1**.二叉树搜索比较待查询节点和分裂节点的分裂维的值**，（小于等于就进入左子树分支，大于就进入右子树分支直到叶子结点）</li>
<li>2.<strong>顺着“搜索路径”找到最近邻的近似点</strong>
</li>
<li>3.<strong>回溯搜索路径</strong>，并判断搜索路径上的结点的其他子结点空间中是否可能有距离查询点更近的数据点，如果有可能，则需要跳到其他子结点空间中去搜索</li>
<li>4.<strong>重复这个过程直到搜索路径为空</strong>
</li>
</ul> 
<h5>
<a id="_282"></a>举个栗子：树的建立</h5> 
<p>给定一个二维空间数据集：T={(2,3),(5,4),(9,6),(4,7),(8,1),(7,2)}，构造一个平衡kd树。</p> 
<p><img src="https://images2.imgbox.com/76/45/ERqcbhgo_o.jpg" alt="image-20190219102142984"></p> 
<h6>
<a id="_288"></a>①思路引导：</h6> 
<ul>
<li>因为x维度更分散，所以使用x(1)轴进行划分</li>
<li>中位数为6，最近的为(7,2)所以以平面x(1)=7将空间分为左、右两个子矩形（子结点）</li>
<li>2，4，5对应的y轴数据是：3，4，7。中位数是4，将4放到中间，3放到左边，7放到右边</li>
<li>8，9对应的y轴数据是：1，6</li>
<li>如此递归，最后得到如下图所示的特征空间划分和kd树。</li>
</ul> 
<p><img src="https://images2.imgbox.com/5b/a5/X9adzPnl_o.png" alt="kd树的构建1.png"></p> 
<p><strong>划分顺序1.紫色2.黄色3.黑色</strong></p> 
<p><img src="https://images2.imgbox.com/c8/fa/agrne2QO_o.png" alt="kd树的构建2.png"></p> 
<h6>
<a id="__304"></a>② 最近领域的搜索</h6> 
<p>假设标记为星星的点是 test point， 绿色的点是找到的近似点，在回溯过程中，需要用到一个队列，存储需要回溯的点，在判断其他子节点空间中是否有可能有距离查询点更近的数据点时，做法是以查询点为圆心，以当前的最近距离为半径画圆，这个圆称为候选超球（candidate hypersphere），如果圆与回溯点的轴相交，则需要将轴另一边的节点都放到回溯队列里面来。</p> 
<p><img src="https://images2.imgbox.com/2d/3e/YyauVKeO_o.jpg" alt="image-20190213224152601"></p> 
<h6>
<a id="eg245_310"></a>③eg:查找点(2,4.5)</h6> 
<p><img src="https://images2.imgbox.com/9f/6d/ifT1jlhW_o.png" alt="kd树案例.png"></p> 
<ol>
<li>先对比x轴，2比7小，来到左边</li>
<li>对比y轴，4.5比4小，来到右边，到达叶子结点，查找路径search_path中的结点为&lt;(7,2),(5,4), (4,7)&gt;</li>
<li>回溯找最近点：先拿叶子结点(4,7)当作最佳结点nearest，此时距离dist为3.202；</li>
<li>向上回溯，到(5,4)，以(2,4.5)为圆心，以dist=3.202为半径画一个圆与超平面y=4相交，所以需要跳到(5,4)的左子空间去搜索。所以要将(2,3)加入到search_path中，现在search_path中的结点为&lt;(7,2),(2, 3)&gt;；另外，(5,4)与(2,4.5)的距离为3.04 &lt; dist = 3.202，所以将(5,4)赋给nearest，并且dist=3.04。</li>
<li>回溯至(2,3)，(2,3)是叶子节点，直接平判断(2,3)是否离(2,4.5)更近，计算得到距离为1.5，所以nearest更新为(2,3)，dist更新为(1.5)</li>
<li>回溯至(7,2)，同理，以(2,4.5)为圆心，以dist=1.5为半径画一个圆并不和超平面x=7相交, 所以不用跳到结点(7,2)的右子空间去搜索。</li>
<li>至此，search_path为空，结束整个搜索，返回nearest(2,3)作为(2,4.5)的最近邻点，最近距离为1.5。</li>
</ol> 
<h3>
<a id="1_323"></a>二、案例1：鸢尾花种类预测–数据集介绍</h3> 
<h4>
<a id="1_325"></a>1.数据集介绍</h4> 
<p><img src="https://images2.imgbox.com/6c/12/7avISzNW_o.png" alt="鸢尾花数据集使用.png"></p> 
<h4>
<a id="2_scikitlearn_330"></a>2 scikit-learn中数据集介绍</h4> 
<h5>
<a id="1scikitlearnAPI_332"></a>(1)scikit-learn数据集API介绍</h5> 
<ul><li>sklearn.datasets 
  <ul>
<li>加载获取流行数据集</li>
<li>datasets.load_*() 
    <ul><li>获取<strong>小规模数据集</strong>，数据包含在<strong>datasets里</strong>
</li></ul> </li>
<li>datasets.fetch_*(data_home=None) 
    <ul><li>获取<strong>大规模数据集</strong>，需要<strong>从网络上下载</strong>，函数的第一个参数是data_home，表示数据集下载的目录,默认是 ~/scikit_learn_data/</li></ul> </li>
</ul> </li></ul> 
<blockquote> 
 <p>返回值类型是bunch–是一个字典类型</p> 
</blockquote> 
<h5>
<a id="2sklearn_345"></a>(2)sklearn小数据集</h5> 
<ul><li> <p>sklearn.datasets.load_iris()</p> <p>加载并返回鸢尾花数据集</p> </li></ul> 
<p><img src="https://images2.imgbox.com/e3/65/xAljxu1j_o.jpg" alt="img"></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris

iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>iris<span class="token punctuation">)</span>
</code></pre> 
<h5>
<a id="3sklearn_360"></a>(3)sklearn大数据集</h5> 
<ul><li>sklearn.datasets.fetch_20newsgroups(data_home=None,subset=‘train’) 
  <ul>
<li>subset：‘train’或者’test’，‘all’，可选，选择要加载的数据集。</li>
<li>训练集的“训练”，测试集的“测试”，两者的“全部”</li>
</ul> </li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris

news <span class="token operator">=</span> fetch_20newsgroups<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>news<span class="token punctuation">)</span>
</code></pre> 
<h5>
<a id="4sklearn_373"></a>(4)sklearn数据集返回值介绍</h5> 
<ul><li>load和fetch返回的数据类型datasets.base.Bunch(字典格式) 
  <ul>
<li>data：特征数据数组，是 [n_samples * n_features] 的二维 numpy.ndarray 数组</li>
<li>target：标签数组，是 n_samples 的一维 numpy.ndarray 数组</li>
<li>DESCR：数据描述</li>
<li>feature_names：特征名,新闻数据，手写数字、回归数据集没有</li>
<li>target_names：标签名</li>
</ul> </li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token comment"># 获取鸢尾花数据集</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"鸢尾花数据集的返回值：n"</span><span class="token punctuation">,</span> iris<span class="token punctuation">)</span>
<span class="token comment"># 返回值类型是bunch--是一个字典类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"鸢尾花数据集特征值是："</span><span class="token punctuation">,</span>iris<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 既可以使用[]输出也可以使用.输出</span>
<span class="token comment"># print("数据集特征值是：",iris.data)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"鸢尾花数据集目标值是："</span><span class="token punctuation">,</span>iris<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"鸢尾花数据集特征值名字是："</span><span class="token punctuation">,</span>iris<span class="token punctuation">.</span>feature_names<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"鸢尾花数据集目标值名字是："</span><span class="token punctuation">,</span>iris<span class="token punctuation">.</span>target_names<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"鸢尾花数据集的描述是："</span><span class="token punctuation">,</span>iris<span class="token punctuation">.</span>DESCR<span class="token punctuation">)</span>
</code></pre> 
<h5>
<a id="5_397"></a>(5)查看数据分布</h5> 
<p>通过创建一些图，以查看不同类别是如何通过特征来区分的。 在理想情况下，标签类将由一个或多个特征对完美分隔。 在现实世界中，这种理想情况很少会发生。</p> 
<blockquote> 
 <p>seaborn介绍</p> 
 <ul>
<li>Seaborn 是基于 Matplotlib 核心库进行了更高级的 API 封装，可以让你轻松地画出更漂亮的图形。而 Seaborn 的漂亮主要体现在配色更加舒服、以及图形元素的样式更加细腻。</li>
<li>安装 pip3 install seaborn</li>
<li>seaborn.lmplot() 是一个非常有用的方法，它会在绘制二维散点图时，自动完成回归拟合 
   <ul>
<li>sns.lmplot() 里的 x, y 分别代表横纵坐标的列名,</li>
<li>data= 是关联到数据集,</li>
<li>hue=*代表按照 species即花的类别分类显示,</li>
<li>fit_reg=是否进行线性拟合。</li>
</ul> </li>
</ul> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris

<span class="token comment"># 设置显示中文字体</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">"font.sans-serif"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"SimHei"</span><span class="token punctuation">]</span>
<span class="token comment"># 获取数据集</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 图像可视化</span>
<span class="token comment"># 把数据转换成dataframe的格式</span>
iris_d <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Sepal_Length'</span><span class="token punctuation">,</span> <span class="token string">'Sepal_Width'</span><span class="token punctuation">,</span> <span class="token string">'Petal_Length'</span><span class="token punctuation">,</span> <span class="token string">'Petal_Width'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># # 输出二维数组表格</span>
<span class="token comment"># print(iris_d)</span>
<span class="token comment"># 种类</span>
iris_d<span class="token punctuation">[</span><span class="token string">'Species'</span><span class="token punctuation">]</span> <span class="token operator">=</span> iris<span class="token punctuation">.</span>target

<span class="token keyword">def</span> <span class="token function">plot_iris</span><span class="token punctuation">(</span>iris<span class="token punctuation">,</span> col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># hue表示目标值，fit_reg = False表示不线性拟合，即不要线段</span>
    sns<span class="token punctuation">.</span>lmplot<span class="token punctuation">(</span>x <span class="token operator">=</span> col1<span class="token punctuation">,</span> y <span class="token operator">=</span> col2<span class="token punctuation">,</span> data <span class="token operator">=</span> iris<span class="token punctuation">,</span> hue <span class="token operator">=</span> <span class="token string">"Species"</span><span class="token punctuation">,</span> fit_reg <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token comment"># x,y轴标签</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span>col1<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span>col2<span class="token punctuation">)</span>
    <span class="token comment"># 表格标题</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'鸢尾花种类分布图'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
plot_iris<span class="token punctuation">(</span>iris_d<span class="token punctuation">,</span> <span class="token string">'Petal_Width'</span><span class="token punctuation">,</span> <span class="token string">'Sepal_Length'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9f/c7/vjq1w0Kw_o.png" alt="鸢尾花数据分类展示.png"></p> 
<h5>
<a id="6train_test_splitarrays_options_445"></a>(6)数据集的划分—<code>train_test_split(arrays, *options)</code>
</h5> 
<p>机器学习一般的数据集会划分为两个部分：</p> 
<ul>
<li>训练数据：用于训练，<strong>构建模型</strong>
</li>
<li>测试数据：在模型检验时使用，用于<strong>评估模型是否有效</strong>
</li>
</ul> 
<p>划分比例：</p> 
<ul>
<li>训练集：70% 80% 75%</li>
<li>测试集：30% 20% 25%</li>
</ul> 
<p><strong>数据集划分api</strong></p> 
<ul><li>
<code>sklearn.model_selection.train_test_split(arrays, *options)</code> 
  <ul>
<li>参数： 
    <ul>
<li>x 数据集的特征值</li>
<li>y 数据集的标签值</li>
<li>test_size 测试集的大小，一般为float，比如测试集是0.2，则表示测试集是20%，那么训练集是0.8，即80%</li>
<li>random_state 随机数种子,<strong>不同的种子会造成不同的随机采样结果。相同的种子采样结果相同。</strong>
</li>
</ul> </li>
<li>return 
    <ul>
<li>x_train, x_test, y_train, y_test</li>
<li>对应：特征值训练集，特征值的测试集，目标值的训练集，目标值的测试集</li>
</ul> </li>
</ul> </li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split

<span class="token comment"># 1.获取鸢尾花数据集</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 2.对鸢尾花数据集进行分割</span>
<span class="token comment"># 训练集的特征值x_train 测试集的特征值x_test 训练集的目标值y_train 测试集的目标值y_test。test_size=0.2,训练集是0.2，则测试集是0.8</span>
x_train<span class="token punctuation">,</span> x_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span> iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
<span class="token comment"># print("训练集特征值：n",x_train)</span>
<span class="token comment"># print("训练集目标值：n",y_train)</span>
<span class="token comment"># print("测试集特征值：n",x_test)</span>
<span class="token comment"># print("测试集目标值：n",y_test)</span>
<span class="token comment"># 可以通过.shape看形状，测试集30，训练集120</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"x_train:n"</span><span class="token punctuation">,</span> x_train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token comment">#x_train:(120, 4)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"x_test:n"</span><span class="token punctuation">,</span> x_test<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token comment">#x_test:(30, 4)</span>
<span class="token comment"># 2.2随机数种子不同的情况下结果不同</span>
x_train1<span class="token punctuation">,</span> x_test1<span class="token punctuation">,</span> y_train1<span class="token punctuation">,</span> y_test1 <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span> iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
x_train2<span class="token punctuation">,</span> x_test2<span class="token punctuation">,</span> y_train2<span class="token punctuation">,</span> y_test2 <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span> iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"如果随机数种子不一致：n"</span><span class="token punctuation">,</span> x_train <span class="token operator">==</span> x_train1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"如果随机数种子一致：n"</span><span class="token punctuation">,</span> x_train1 <span class="token operator">==</span> x_train2<span class="token punctuation">)</span>
<span class="token comment"># 输出结果：</span>
<span class="token comment"># 如果随机数种子不一致：</span>
<span class="token comment">#  [[ True False False False]</span>
<span class="token comment">#  [False False False False]</span>
<span class="token comment">#  [False False False False]</span>
<span class="token comment">#  [False False False False]...</span>
<span class="token comment"># 如果随机数种子一致：</span>
<span class="token comment">#  [[ True  True  True  True]</span>
<span class="token comment">#  [ True  True  True  True]</span>
<span class="token comment">#  [ True  True  True  True]</span>
<span class="token comment">#  [ True  True  True  True]...</span>
</code></pre> 
<h3>
<a id="_503"></a>三、特征工程-特征预处理</h3> 
<h4>
<a id="1_505"></a>1.特征预处理</h4> 
<p>通过<strong>一些转换函数</strong>将特征数据<strong>转换成更加适合算法模型</strong>的特征数据过程。</p> 
<h4>
<a id="2_509"></a>2.归一化/标准化</h4> 
<h5>
<a id="1_511"></a>(1)为什么需要归一化/标准化？</h5> 
<p>特征的<strong>单位或者大小相差较大，或者某特征的方差相比其他的特征要大出几个数量级</strong>，<strong>容易影响（支配）目标结果</strong>，使得一些算法无法学习到其它的特征</p> 
<p>我们需要用到一些方法进行<strong>无量纲化</strong>，<strong>使不同规格的数据转换到同一规格</strong></p> 
<h5>
<a id="2_517"></a>(2)包含内容(数值型数据的无量纲化)</h5> 
<h6>
<a id="MinMaxScaler_519"></a>①最小值最大值归一化处理—MinMaxScaler()</h6> 
<p>定义:</p> 
<ul><li>对原始数据进行变换把数据映射到(默认为[0,1])之间</li></ul> 
<p>公式：</p> 
<p><img src="https://images2.imgbox.com/0a/5a/kTSJ0bsg_o.png" alt="归一化公式.png"></p> 
<blockquote> 
 <p>作用于每一列，max为一列的最大值，min为一列的最小值,那么X’’为最终结果，mx，mi分别为指定区间值默认mx为1,mi为0</p> 
</blockquote> 
<p>举例：</p> 
<p><img src="https://images2.imgbox.com/56/7e/Hp4eZAk4_o.png" alt="归一化计算过程.png"></p> 
<p>api:</p> 
<ul>
<li>实例化一个转换器类<code>sklearn.preprocessing.MinMaxScaler (feature_range=(0,1)… )</code>
</li>
<li>参数:feature_range – 自己指定范围,默认0-1</li>
<li>归一化转换：<code>MinMaxScalar.fit_transform(X)</code> 
  <ul><li>X:numpy array格式的数据[n_samples,n_features]</li></ul> </li>
<li>返回值：转换后的形状相同的array</li>
</ul> 
<p>数据：dating.txt</p> 
<pre><code class="prism language-python">milage<span class="token punctuation">,</span>Liters<span class="token punctuation">,</span>Consumtime<span class="token punctuation">,</span>target
<span class="token number">40920</span><span class="token punctuation">,</span><span class="token number">8.326976</span><span class="token punctuation">,</span><span class="token number">0.953952</span><span class="token punctuation">,</span><span class="token number">3</span>
<span class="token number">14488</span><span class="token punctuation">,</span><span class="token number">7.153469</span><span class="token punctuation">,</span><span class="token number">1.673904</span><span class="token punctuation">,</span><span class="token number">2</span>
<span class="token number">26052</span><span class="token punctuation">,</span><span class="token number">1.441871</span><span class="token punctuation">,</span><span class="token number">0.805124</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token number">75136</span><span class="token punctuation">,</span><span class="token number">13.147394</span><span class="token punctuation">,</span><span class="token number">0.428964</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token number">38344</span><span class="token punctuation">,</span><span class="token number">1.669788</span><span class="token punctuation">,</span><span class="token number">0.134296</span><span class="token punctuation">,</span><span class="token number">1</span>
</code></pre> 
<p>步骤分析</p> 
<p>1、实例化MinMaxScalar</p> 
<p>2、通过fit_transform转换</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> MinMaxScaler

<span class="token comment"># 归一化</span>
<span class="token keyword">def</span> <span class="token function">MinMax_Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取数据</span>
    data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"./data/dating.txt"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment"># 1.实例化一个转换器类</span>
    transfer <span class="token operator">=</span> MinMaxScaler<span class="token punctuation">(</span>feature_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 2、调用fit_transform</span>
    data <span class="token operator">=</span> transfer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'milage'</span><span class="token punctuation">,</span> <span class="token string">'Liters'</span><span class="token punctuation">,</span> <span class="token string">'Consumtime'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最小值最大值归一化处理的结果：n"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token boolean">None</span>
MinMax_Test<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>返回结果：</p> 
<pre><code class="prism language-python">   milage     Liters  Consumtime  target
<span class="token number">0</span>   <span class="token number">40920</span>   <span class="token number">8.326976</span>    <span class="token number">0.953952</span>       <span class="token number">3</span>
<span class="token number">1</span>   <span class="token number">14488</span>   <span class="token number">7.153469</span>    <span class="token number">1.673904</span>       <span class="token number">2</span>
<span class="token number">2</span>   <span class="token number">26052</span>   <span class="token number">1.441871</span>    <span class="token number">0.805124</span>       <span class="token number">1</span>
<span class="token number">3</span>   <span class="token number">75136</span>  <span class="token number">13.147394</span>    <span class="token number">0.428964</span>       <span class="token number">1</span>
<span class="token number">4</span>   <span class="token number">38344</span>   <span class="token number">1.669788</span>    <span class="token number">0.134296</span>       <span class="token number">1</span>
最小值最大值归一化处理的结果：
 <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.43582641</span> <span class="token number">0.58819286</span> <span class="token number">0.53237967</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">0.</span>         <span class="token number">0.48794044</span> <span class="token number">1.</span>        <span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">0.19067405</span> <span class="token number">0.</span>         <span class="token number">0.43571351</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">1.</span>         <span class="token number">1.</span>         <span class="token number">0.19139157</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">0.3933518</span>  <span class="token number">0.01947089</span> <span class="token number">0.</span>        <span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p>总结:</p> 
<ul>
<li>鲁棒性比较差(<strong>容易受到异常点的影响</strong>)</li>
<li>只适合传统精确小数据场景(<strong>以后不会用你了</strong>)</li>
</ul> 
<h6>
<a id="StandardScaler_603"></a>②标准化—StandardScaler()</h6> 
<p>定义:</p> 
<ul><li>对原始数据进行变换把数据变换到均值为0,标准差为1范围内</li></ul> 
<p>公式：</p> 
<p><img src="https://images2.imgbox.com/b3/97/JTbNXO3z_o.png" alt="标准化公式.png"></p> 
<blockquote> 
 <p>作用于每一列，mean为平均值，σ为标准差</p> 
</blockquote> 
<p>api:</p> 
<ul>
<li> <p>实例化一个转换器类：<code>sklearn.preprocessing.StandardScaler( )</code></p> 
  <ul><li>处理之后每列来说所有数据都聚集在均值0附近标准差差为1</li></ul> </li>
<li> <p>表转化转换：<code>StandardScaler.fit_transform(X)</code></p> 
  <ul>
<li> <p>X:numpy array格式的数据[n_samples,n_features]</p> </li>
<li> <p>返回值：转换后的形状相同的array</p> </li>
</ul> </li>
</ul> 
<p>步骤分析</p> 
<p>1、实例化MinMaxScalar</p> 
<p>2、通过fit_transform转换</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler

<span class="token keyword">def</span> <span class="token function">Standard_Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取数据</span>
    data<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"./data/dating.txt"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment"># 1.实例化一个转换器类</span>
    transfer <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 2.调用fit_transform</span>
    data <span class="token operator">=</span> transfer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'milage'</span><span class="token punctuation">,</span><span class="token string">'Liters'</span><span class="token punctuation">,</span><span class="token string">'Consumtime'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"标准化的结果:n"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"每一列特征的平均值：n"</span><span class="token punctuation">,</span> transfer<span class="token punctuation">.</span>mean_<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"每一列特征的方差：n"</span><span class="token punctuation">,</span> transfer<span class="token punctuation">.</span>var_<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token boolean">None</span>
Standard_Test<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">   milage     Liters  Consumtime  target
<span class="token number">0</span>   <span class="token number">40920</span>   <span class="token number">8.326976</span>    <span class="token number">0.953952</span>       <span class="token number">3</span>
<span class="token number">1</span>   <span class="token number">14488</span>   <span class="token number">7.153469</span>    <span class="token number">1.673904</span>       <span class="token number">2</span>
<span class="token number">2</span>   <span class="token number">26052</span>   <span class="token number">1.441871</span>    <span class="token number">0.805124</span>       <span class="token number">1</span>
<span class="token number">3</span>   <span class="token number">75136</span>  <span class="token number">13.147394</span>    <span class="token number">0.428964</span>       <span class="token number">1</span>
<span class="token number">4</span>   <span class="token number">38344</span>   <span class="token number">1.669788</span>    <span class="token number">0.134296</span>       <span class="token number">1</span>
标准化的结果<span class="token punctuation">:</span>
 <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.0947602</span>   <span class="token number">0.44990013</span>  <span class="token number">0.29573441</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.20166916</span>  <span class="token number">0.18312874</span>  <span class="token number">1.67200507</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.63448132</span> <span class="token operator">-</span><span class="token number">1.11527928</span>  <span class="token number">0.01123265</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span> <span class="token number">1.77297701</span>  <span class="token number">1.54571769</span> <span class="token operator">-</span><span class="token number">0.70784025</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.03158673</span> <span class="token operator">-</span><span class="token number">1.06346729</span> <span class="token operator">-</span><span class="token number">1.27113187</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
每一列特征的平均值：
 <span class="token punctuation">[</span><span class="token number">3.8988000e+04</span> <span class="token number">6.3478996e+00</span> <span class="token number">7.9924800e-01</span><span class="token punctuation">]</span>
每一列特征的方差：
 <span class="token punctuation">[</span><span class="token number">4.15683072e+08</span> <span class="token number">1.93505309e+01</span> <span class="token number">2.73652475e-01</span><span class="token punctuation">]</span>
</code></pre> 
<p>总结:</p> 
<ul>
<li> <p><strong>异常值影响小</strong></p> </li>
<li> <p>适合现代嘈杂大数据场景(<strong>以后就是用你了</strong>)</p> </li>
<li> <p>对于归一化来说：如果出现异常点，影响了最大值和最小 值，那么结果显然会发生改变</p> </li>
<li> <p>对于标准化来说：如果出现异常点，由于具有一定数据量，少量的异常点对于平均值的影响并不大，从而方差改变较小。</p> </li>
</ul> 
<h3>
<a id="1_681"></a>四、案例1：鸢尾花种类预测–流程实现</h3> 
<h4>
<a id="1_683"></a>1.数据集介绍</h4> 
<p>实例属性：150（三个类各有50个）</p> 
<p>属性数量：4（数值型、数值型、帮助预测的属性和类）</p> 
<p>属性信息：</p> 
<ul>
<li>sepal length 萼片长度</li>
<li>sepal width 萼片宽度</li>
<li>petal length 花瓣长度</li>
<li>petal width 花瓣宽度</li>
<li>class： 
  <ul>
<li>Iris-Setosa 山鸢尾</li>
<li>Iris-Versicolour 变色鸢尾</li>
<li>Iris-Virginica 维吉尼亚鸢尾</li>
</ul> </li>
</ul> 
<h4>
<a id="2_700"></a>2.步骤分析</h4> 
<ul>
<li>1.获取数据集</li>
<li>2.数据基本处理</li>
<li>3.特征工程</li>
<li>4.机器学习(模型训练)</li>
<li>5.模型评估</li>
</ul> 
<pre><code class="prism language-python"><span class="token comment"># 导入模块</span>
<span class="token comment"># 鸢尾花数据</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token comment"># 分割数据集</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token comment"># 特征预处理</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
<span class="token comment"># KNN API</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
<span class="token comment"># 1.获取数据集</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 2.数据基本处理</span>
<span class="token comment"># x_train,x_test,y_train,y_test为训练集特征值、测试集特征值、训练集目标值、测试集目标值</span>
x_train<span class="token punctuation">,</span> x_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span> iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
<span class="token comment"># 3.特征工程：标准化</span>
<span class="token comment"># 实例化</span>
transfer <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 转换标准化</span>
x_train <span class="token operator">=</span> transfer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_test <span class="token operator">=</span> transfer<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
<span class="token comment"># 4.机器学习(KNN模型训练)</span>
<span class="token comment"># 实例化一个估计器</span>
estimator <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token comment"># 模型训练fit方法</span>
estimator<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token comment"># 5.模型评估</span>
<span class="token comment"># 预测值结果输出：比对真实值和预测值</span>
y_predict <span class="token operator">=</span> estimator<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"预测结果为:n"</span><span class="token punctuation">,</span> y_predict<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"比对真实值和预测值：n"</span><span class="token punctuation">,</span> y_predict <span class="token operator">==</span> y_test<span class="token punctuation">)</span>
<span class="token comment"># 准确率计算</span>
score <span class="token operator">=</span> estimator<span class="token punctuation">.</span>score<span class="token punctuation">(</span>x_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"准确率为：n"</span><span class="token punctuation">,</span> score<span class="token punctuation">)</span>

预测结果为<span class="token punctuation">:</span>
 <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span><span class="token punctuation">]</span>
比对真实值和预测值：
 <span class="token punctuation">[</span> <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span> <span class="token boolean">False</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>
  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span> <span class="token boolean">False</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>
  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span><span class="token punctuation">]</span>
准确率为：
 <span class="token number">0.9333333333333333</span>
</code></pre> 
<h5>
<a id="fit_transformfittransform_753"></a>扩展：fit_transform,fit,transform区别和作用</h5> 
<p><strong>fit和transform没有任何关系</strong>，仅仅是数据处理的两个不同环节，之所以出来fit_transform这个函数名，仅仅是为了写代码方便，会高效一点。</p> 
<p>sklearn里的封装好的各种算法使用前都要fit，fit相对于整个代码而言，为后续API服务。<strong>fit之后，然后调用各种API方法，transform只是其中一个API方法，所以当你调用transform之外的方法，也必须要先fit。</strong></p> 
<p><strong>fit</strong>原义指的是安装、使适合的意思，其实有点train的含义，但是和train不同的是，它并不是一个训练的过程，而<strong>是一个适配的过程</strong>，过程都是确定的，最后得到一个可用于转换的有价值的信息。</p> 
<ul>
<li> <p>fit():</p> <p>简单来说，就是求得训练集X的均值，方差，最大值，最小值,这些训练集X固有的属性。</p> </li>
<li> <p>transform():</p> <p>在fit的基础上，进行标准化，降维，归一化等操作（看具体用的是哪个工具，如PCA，StandardScaler等）。</p> </li>
<li> <p>fit_transform():</p> <p>fit_transform是fit和transform的组合，既包括了训练又包含了转换。</p> </li>
<li> <p>transform()和fit_transform()</p> <p>二者的功能都是对数据进行某种统一处理（比如标准化~N(0,1)，将数据缩放(映射)到某个固定区间，归一化，正则化等）</p> <p>fit_transform(trainData)对部分数据先拟合fit，找到该part的整体指标，如均值、方差、最大值最小值等等（根据具体转换的目的），然后对该trainData进行转换transform，从而实现数据的标准化、归一化等等。</p> </li>
</ul> 
<h3>
<a id="k_779"></a>五、k近邻算法优缺点</h3> 
<h4>
<a id="1_781"></a>1.优点</h4> 
<h5>
<a id="1_783"></a>(1)简单有效</h5> 
<h5>
<a id="2_785"></a>(2)重新训练的代价低</h5> 
<h5>
<a id="3_787"></a>(3)适合类域交叉样本</h5> 
<p><strong>KNN方法主要靠周围有限的邻近的样本</strong>,而不是靠判别类域的方法来确定所属类别的，因此对于类域的交叉或重叠较多的待分样本集来说，KNN方法较其他方法更为适合。</p> 
<h5>
<a id="4_791"></a>(4)适合大样本自动分类</h5> 
<p>该算法比较<strong>适用于样本容量比较大的类域的自动分类</strong>，而那些<strong>样本容量较小的类域采用这种算法比较容易产生误分</strong>。</p> 
<h4>
<a id="2_795"></a>2.缺点</h4> 
<h5>
<a id="1_797"></a>(1)惰性学习</h5> 
<p>KNN算法是懒散学习方法（lazy learning,基本上不学习），一些积极学习的算法要快很多</p> 
<h5>
<a id="2_801"></a>(2)类别评分不是规格化</h5> 
<p>不像一些通过概率评分的分类</p> 
<h5>
<a id="3_805"></a>(3)输出可解释性不强</h5> 
<p>例如决策树的输出可解释性就较强</p> 
<h5>
<a id="4_809"></a>(4)对不均衡的样本不擅长</h5> 
<p>当样本不平衡时，如一个类的样本容量很大，而其他类样本容量很小时，有可能导致当输入一个新样本时，该样本的K个邻居中大容量类的样本占多数。该算法只计算“最近的”邻居样本，某一类的样本数量很大，那么或者这类样本并不接近目标样本，或者这类样本很靠近目标样本。无论怎样，数量并不能影响运行结果。可以采用权值的方法（和该样本距离小的邻居权值大）来改进。</p> 
<h5>
<a id="5_813"></a>(5)计算量较大</h5> 
<p>目前常用的解决方法是事先对已知样本点进行剪辑，事先去除对分类作用不大的样本。</p> 
<h3>
<a id="_817"></a>六、交叉验证、网格搜索</h3> 
<h4>
<a id="1_819"></a>1.介绍</h4> 
<p>之前将数据分为训练集和测试集，但是<strong>为了让从训练得到模型结果更加准确。<strong>又将拿到的</strong>训练数据</strong>，<strong>分为训练和验证集</strong>。</p> 
<ul>
<li><strong>训练集：训练集+验证集</strong></li>
<li><strong>测试集：测试集</strong></li>
</ul> 
<p><strong>4折交叉验证：</strong></p> 
<p>将<strong>数据分成4份</strong>，其中<strong>1份作为验证集</strong>。然后<strong>经过4次(组)的测试</strong>，每次<strong>都更换不同的验证集</strong>。即得到4组模型的结果，<strong>取平均值作为最终结果</strong>。</p> 
<p><img src="https://images2.imgbox.com/1d/db/ts5BB1W1_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>交叉验证目的：<strong>为了让被评估的模型更加准确可信</strong>，并<strong>不能提高模型准确率</strong>，想要选择或者调优参数，需要使用网格搜索</p> 
</blockquote> 
<h4>
<a id="2_835"></a>2.网格搜索</h4> 
<p>通常情况下，<strong>有很多参数是需要手动指定的（如k-近邻算法中的K值），这种叫超参数</strong>。</p> 
<p><strong>网格搜索</strong>就是把这些<strong>超参数的值</strong>,通过<strong>字典的形式</strong>传递进去,<strong>每组超参数都采用交叉验证来进行评估。最后选出最优参数组合建立模型</strong>。</p> 
<p><img src="https://images2.imgbox.com/d3/ea/GT6qT17j_o.png" alt="超参数.png"></p> 
<h4>
<a id="3API_844"></a>3.交叉验证，网格搜索（模型选择与调优）API</h4> 
<p><code>sklearn.model_selection.GridSearchCV(estimator, param_grid=None,cv=None)</code></p> 
<ul>
<li> <p>对估计器的指定参数值进行详尽搜索</p> <p>参数</p> </li>
<li> <p>estimator：估计器对象</p> </li>
<li> <p>param_grid：估计器参数(dict){“n_neighbors”:[3,5,7]}</p> </li>
<li> <p>cv：指定几折交叉验证</p> </li>
<li> <p>fit：输入训练数据</p> </li>
<li> <p>score：准确率</p> </li>
<li> <p>属性：</p> 
  <ul>
<li>bestscore__:在交叉验证中验证的最好结果</li>
<li>bestestimator：最好的参数模型</li>
<li>cvresults:每次交叉验证后的验证集准确率结果和训练集准确率结果</li>
</ul> </li>
</ul> 
<h4>
<a id="4K_868"></a>4.鸢尾花案例增加K值调优</h4> 
<p>只用将之前KNeighborsClassifier()中的参数删除，并手动添加超参数进行交叉验证</p> 
<pre><code class="prism language-python">之前：
<span class="token comment"># 实例化一个估计器</span>
estimator <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>

现在：
<span class="token comment"># 实例化一个估计器</span>
estimator <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#   模型选择与调优——网格搜索和交叉验证</span>
<span class="token comment">#   准备要调的超参数</span>
param_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"n_neighbors"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
estimator <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>estimator<span class="token punctuation">,</span> param_grid<span class="token operator">=</span>param_dict<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> 
<p>全部代码：</p> 
<pre><code class="prism language-python"><span class="token comment"># 导入模块</span>
<span class="token comment"># 鸢尾花数据</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token comment"># 分割数据集，网格搜索和交叉验证</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split<span class="token punctuation">,</span> GridSearchCV
<span class="token comment"># 特征预处理</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
<span class="token comment"># KNN API</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
<span class="token comment"># 1.获取数据集</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 2.数据基本处理</span>
<span class="token comment"># x_train,x_test,y_train,y_test为训练集特征值、测试集特征值、训练集目标值、测试集目标值</span>
x_train<span class="token punctuation">,</span> x_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span> iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
<span class="token comment"># 3.特征工程：标准化</span>
<span class="token comment"># 实例化</span>
transfer <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 转换标准化</span>
x_train <span class="token operator">=</span> transfer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_test <span class="token operator">=</span> transfer<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
<span class="token comment"># 4.机器学习(KNN模型训练)</span>
<span class="token comment"># 实例化一个估计器</span>
estimator <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 增加：</span>
<span class="token comment">#   模型选择与调优——网格搜索和交叉验证</span>
<span class="token comment">#   准备要调的超参数</span>
param_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"n_neighbors"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
estimator <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>estimator<span class="token punctuation">,</span> param_grid<span class="token operator">=</span>param_dict<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment"># 模型训练fit方法</span>
estimator<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token comment"># 5.模型评估</span>
<span class="token comment"># 预测值结果输出：比对真实值和预测值</span>
y_predict <span class="token operator">=</span> estimator<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"预测结果为:n"</span><span class="token punctuation">,</span> y_predict<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"比对真实值和预测值：n"</span><span class="token punctuation">,</span> y_predict <span class="token operator">==</span> y_test<span class="token punctuation">)</span>
<span class="token comment"># 准确率计算</span>
score <span class="token operator">=</span> estimator<span class="token punctuation">.</span>score<span class="token punctuation">(</span>x_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"准确率为：n"</span><span class="token punctuation">,</span> score<span class="token punctuation">)</span>
<span class="token comment"># 评估查看最终选择的结果和交叉验证的结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"在交叉验证中验证的最好结果：n"</span><span class="token punctuation">,</span> estimator<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最好的参数模型：n"</span><span class="token punctuation">,</span> estimator<span class="token punctuation">.</span>best_estimator_<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"每次交叉验证后的准确率结果：n"</span><span class="token punctuation">,</span> estimator<span class="token punctuation">.</span>cv_results_<span class="token punctuation">)</span>

<span class="token comment"># 输出结果：</span>
预测结果为<span class="token punctuation">:</span>
 <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">0</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span><span class="token punctuation">]</span>
比对真实值和预测值：
 <span class="token punctuation">[</span> <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span> <span class="token boolean">False</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>
  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span> <span class="token boolean">False</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>
  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span><span class="token punctuation">]</span>
准确率为：
 <span class="token number">0.9333333333333333</span>
在交叉验证中验证的最好结果：
 <span class="token number">0.975</span>
最好的参数模型：
 KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
每次交叉验证后的准确率结果：
 <span class="token punctuation">{<!-- --></span><span class="token string">'mean_fit_time'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.00199429</span><span class="token punctuation">,</span> <span class="token number">0.00133077</span><span class="token punctuation">,</span> <span class="token number">0.00066384</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'std_fit_time'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.00081323</span><span class="token punctuation">,</span> <span class="token number">0.00046957</span><span class="token punctuation">,</span> <span class="token number">0.00046941</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'mean_score_time'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.00533168</span><span class="token punctuation">,</span> <span class="token number">0.00366902</span><span class="token punctuation">,</span> <span class="token number">0.00198976</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'std_score_time'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0012504</span> <span class="token punctuation">,</span> <span class="token number">0.0004784</span> <span class="token punctuation">,</span> <span class="token number">0.00081452</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'param_n_neighbors'</span><span class="token punctuation">:</span> masked_array<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>mask<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>fill_value<span class="token operator">=</span><span class="token string">'?'</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'params'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'split0_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.</span>   <span class="token punctuation">,</span> <span class="token number">0.975</span><span class="token punctuation">,</span> <span class="token number">1.</span>   <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'split1_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.925</span><span class="token punctuation">,</span> <span class="token number">0.975</span><span class="token punctuation">,</span> <span class="token number">0.975</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'split2_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.95</span><span class="token punctuation">,</span> <span class="token number">0.9</span> <span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'mean_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.95833333</span><span class="token punctuation">,</span> <span class="token number">0.95</span>      <span class="token punctuation">,</span> <span class="token number">0.975</span>     <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'std_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.03118048</span><span class="token punctuation">,</span> <span class="token number">0.03535534</span><span class="token punctuation">,</span> <span class="token number">0.02041241</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'rank_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre> 
<p>可以明显看到准确率提高</p> 
<p>之前准确率为：0.9333333333333333<br> 在交叉验证中验证的最好结果： 0.975</p> 
<blockquote> 
 <p>注：当数据集过大时，超参数尽量不要选则太多，否则跑起来非常慢，效果非常低</p> 
</blockquote> 
<h3>
<a id="2facebookkaggle_956"></a>七、案例2：预测facebook签到位置kaggle</h3> 
<h4>
<a id="1_958"></a>1.项目介绍</h4> 
<p>本次比赛的目的是<strong>预测一个人将要签到的地方。</strong> 为了本次比赛，Facebook创建了一个虚拟世界，其中包括<strong>10公里*10公里共100平方公里的约10万个地方。</strong> 对于给定的坐标集，您的任务将<strong>根据用户的位置，准确性和时间戳等预测用户下一次的签到位置。</strong> 数据被制作成类似于来自移动设备的位置数据。 请注意：您只能使用提供的数据进行预测。</p> 
<blockquote> 
 <p>数据从kaggle获取，官网：https://www.kaggle.com/c/facebook-v-predicting-check-ins</p> 
</blockquote> 
<h4>
<a id="2_964"></a>2.数据集介绍</h4> 
<p><strong>文件说明：train.csv, test.csv</strong></p> 
<ul>
<li> <p><strong>训练.csv、测试.csv</strong></p> </li>
<li> 
  <ul>
<li>row_id：签到事件的id</li>
<li>xy：坐标</li>
<li>精度：定位精度</li>
<li>时间：时间戳，是指格林威治时间1970年01月01日00时00分00秒(<strong>北京时间1970年01月01日08时00分00秒</strong>)起至现在的总秒数</li>
<li>place_id：签到的id，<strong>这是你需要预测的目标</strong>
</li>
</ul> </li>
</ul> 
<p><img src="https://images2.imgbox.com/2c/da/M6QtkHz6_o.png" alt="预测facebook签到位置.png"></p> 
<h4>
<a id="3_979"></a>3.步骤分析</h4> 
<ul>
<li>对于数据做一些基本处理（这里所做的一些处理不一定达到很好的效果，我们只是简单尝试，有些特征我们可以根据一些特征选择的方式去做处理） 
  <ul>
<li>1 缩小数据集范围 DataFrame.query()</li>
<li>2 选取有用的时间特征</li>
<li>3 将签到位置少于n个用户的删除</li>
</ul> </li>
<li>分割数据集</li>
<li>标准化处理</li>
<li>k-近邻预测</li>
</ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split<span class="token punctuation">,</span> GridSearchCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
<span class="token comment"># 1.获取数据集</span>
facebook <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"data/FaceBook-predicting-check-ins/train.csv"</span><span class="token punctuation">)</span>
<span class="token comment"># 2.基本数据处理</span>
<span class="token comment"># 2.1 缩小数据范围，选择x&gt;2.0 &amp; x&lt;2.5 &amp; y&gt;2.0 &amp; y&lt;2.5的数据</span>
facebook_data <span class="token operator">=</span> facebook<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"x&gt;2.0 &amp; x&lt;2.5 &amp; y&gt;2.0 &amp; y&lt;2.5"</span><span class="token punctuation">)</span>
<span class="token comment"># 2.2 选择时间特征，因为数据中时间是时间戳，所以转换成时间</span>
time <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>facebook_data<span class="token punctuation">[</span><span class="token string">"time"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> unit<span class="token operator">=</span><span class="token string">"s"</span><span class="token punctuation">)</span>
time <span class="token operator">=</span> pd<span class="token punctuation">.</span>DatetimeIndex<span class="token punctuation">(</span>time<span class="token punctuation">)</span>
facebook_data<span class="token punctuation">[</span><span class="token string">"day"</span><span class="token punctuation">]</span> <span class="token operator">=</span> time<span class="token punctuation">.</span>day
facebook_data<span class="token punctuation">[</span><span class="token string">"hour"</span><span class="token punctuation">]</span> <span class="token operator">=</span> time<span class="token punctuation">.</span>hour
facebook_data<span class="token punctuation">[</span><span class="token string">"weekday"</span><span class="token punctuation">]</span> <span class="token operator">=</span> time<span class="token punctuation">.</span>weekday
<span class="token comment"># 2.3 去掉签到较少的地方</span>
place_count <span class="token operator">=</span> facebook_data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">"place_id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
place_count <span class="token operator">=</span> place_count<span class="token punctuation">[</span>place_count<span class="token punctuation">[</span><span class="token string">"row_id"</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">]</span>
facebook_data <span class="token operator">=</span> facebook_data<span class="token punctuation">[</span>facebook_data<span class="token punctuation">[</span><span class="token string">"place_id"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span>place_count<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment"># 2.4 确定特征值和目标值</span>
x <span class="token operator">=</span> facebook_data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token punctuation">,</span> <span class="token string">"accuracy"</span><span class="token punctuation">,</span> <span class="token string">"day"</span><span class="token punctuation">,</span> <span class="token string">"hour"</span><span class="token punctuation">,</span> <span class="token string">"weekday"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> facebook_data<span class="token punctuation">[</span><span class="token string">"place_id"</span><span class="token punctuation">]</span>
<span class="token comment"># 2.5 分割数据集</span>
x_train<span class="token punctuation">,</span> x_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
<span class="token comment"># 3.特征工程 -- 特征预处理(标准化)</span>
transfer <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
x_train <span class="token operator">=</span> transfer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
x_test <span class="token operator">=</span> transfer<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
<span class="token comment"># 4.机器学习 -- knn+cv</span>
<span class="token comment"># 4.1 实例化一个估计器</span>
estimator <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 4.2 调用gridsearchCV</span>
param_grid <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"n_neighbors"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token comment"># 因为需要测试15次，n_jobs指定用几个CPU进行跑，n_jobs=-1表示用所有的CPU跑程序，n_jobs=k表示用k个CPU跑程序</span>
<span class="token comment"># 比如电脑是8核CPU，那么可以设置到8，推荐设置为6或者7</span>
estimator <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>estimator<span class="token punctuation">,</span> param_grid<span class="token operator">=</span>param_grid<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 4.3 模型训练</span>
estimator<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token comment"># 5.模型评估</span>
<span class="token comment"># 5.1 基本评估方式</span>
score <span class="token operator">=</span> estimator<span class="token punctuation">.</span>score<span class="token punctuation">(</span>x_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最后预测的准确率为:n"</span><span class="token punctuation">,</span> score<span class="token punctuation">)</span>
y_predict <span class="token operator">=</span> estimator<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最后的预测值为:n"</span><span class="token punctuation">,</span> y_predict<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"预测值和真实值的对比情况:n"</span><span class="token punctuation">,</span> y_predict <span class="token operator">==</span> y_test<span class="token punctuation">)</span>
<span class="token comment"># 5.2 使用交叉验证后的评估方式</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"在交叉验证中验证的最好结果:n"</span><span class="token punctuation">,</span> estimator<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最好的参数模型:n"</span><span class="token punctuation">,</span> estimator<span class="token punctuation">.</span>best_estimator_<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"每次交叉验证后的验证集准确率结果和训练集准确率结果:n"</span><span class="token punctuation">,</span>estimator<span class="token punctuation">.</span>cv_results_<span class="token punctuation">)</span>

<span class="token comment"># 输出结果：</span>
最后预测的准确率为<span class="token punctuation">:</span>
 <span class="token number">0.36515361515361516</span>
最后的预测值为<span class="token punctuation">:</span>
 <span class="token punctuation">[</span><span class="token number">9983648790</span> <span class="token number">6329243787</span> <span class="token number">9674001925</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">2990018952</span> <span class="token number">4830766946</span> <span class="token number">7065571836</span><span class="token punctuation">]</span>
预测值和真实值的对比情况<span class="token punctuation">:</span>
<span class="token number">24703810</span>     <span class="token boolean">True</span>
<span class="token number">19445902</span>    <span class="token boolean">False</span>
<span class="token number">18490063</span>     <span class="token boolean">True</span>
<span class="token number">7762709</span>     <span class="token boolean">False</span>
<span class="token number">6505956</span>     <span class="token boolean">False</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
<span class="token number">27632888</span>    <span class="token boolean">False</span>
<span class="token number">23367671</span>    <span class="token boolean">False</span>
<span class="token number">6692268</span>      <span class="token boolean">True</span>
<span class="token number">25834435</span>    <span class="token boolean">False</span>
<span class="token number">13319005</span>    <span class="token boolean">False</span>
Name<span class="token punctuation">:</span> place_id<span class="token punctuation">,</span> Length<span class="token punctuation">:</span> <span class="token number">17316</span><span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span>
在交叉验证中验证的最好结果<span class="token punctuation">:</span>
 <span class="token number">0.3546044971864908</span>
最好的参数模型<span class="token punctuation">:</span>
 KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
每次交叉验证后的验证集准确率结果和训练集准确率结果<span class="token punctuation">:</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'mean_fit_time'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.20372453</span><span class="token punctuation">,</span> <span class="token number">0.13444033</span><span class="token punctuation">,</span> <span class="token number">0.12627945</span><span class="token punctuation">,</span> <span class="token number">0.1162303</span> <span class="token punctuation">,</span> <span class="token number">0.14007068</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'std_fit_time'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.03891364</span><span class="token punctuation">,</span> <span class="token number">0.03487368</span><span class="token punctuation">,</span> <span class="token number">0.01710955</span><span class="token punctuation">,</span> <span class="token number">0.00849831</span><span class="token punctuation">,</span> <span class="token number">0.01045492</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'mean_score_time'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.84785113</span><span class="token punctuation">,</span> <span class="token number">0.81870608</span><span class="token punctuation">,</span> <span class="token number">0.66817446</span><span class="token punctuation">,</span> <span class="token number">0.85298319</span><span class="token punctuation">,</span> <span class="token number">0.77952976</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'std_score_time'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.01394286</span><span class="token punctuation">,</span> <span class="token number">0.15851887</span><span class="token punctuation">,</span> <span class="token number">0.01958566</span><span class="token punctuation">,</span> <span class="token number">0.10105889</span><span class="token punctuation">,</span> <span class="token number">0.05515816</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'param_n_neighbors'</span><span class="token punctuation">:</span> masked_array<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>mask<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>fill_value<span class="token operator">=</span><span class="token string">'?'</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'params'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_neighbors'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'split0_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.35948027</span><span class="token punctuation">,</span> <span class="token number">0.34311838</span><span class="token punctuation">,</span> <span class="token number">0.35235804</span><span class="token punctuation">,</span> <span class="token number">0.35303176</span><span class="token punctuation">,</span> <span class="token number">0.34927815</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'split1_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.35466795</span><span class="token punctuation">,</span> <span class="token number">0.34369586</span><span class="token punctuation">,</span> <span class="token number">0.35563041</span><span class="token punctuation">,</span> <span class="token number">0.35370549</span><span class="token punctuation">,</span> <span class="token number">0.34821944</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'split2_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.35524543</span><span class="token punctuation">,</span> <span class="token number">0.34119346</span><span class="token punctuation">,</span> <span class="token number">0.3506256</span> <span class="token punctuation">,</span> <span class="token number">0.35129933</span><span class="token punctuation">,</span> <span class="token number">0.34860443</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'split3_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.3514294</span> <span class="token punctuation">,</span> <span class="token number">0.34141881</span><span class="token punctuation">,</span> <span class="token number">0.35681971</span><span class="token punctuation">,</span> <span class="token number">0.35537588</span><span class="token punctuation">,</span> <span class="token number">0.35075561</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'split4_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.35219944</span><span class="token punctuation">,</span> <span class="token number">0.34161132</span><span class="token punctuation">,</span> <span class="token number">0.35152565</span><span class="token punctuation">,</span> <span class="token number">0.34757917</span><span class="token punctuation">,</span> <span class="token number">0.34132255</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'mean_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.3546045</span> <span class="token punctuation">,</span> <span class="token number">0.34220757</span><span class="token punctuation">,</span> <span class="token number">0.35339188</span><span class="token punctuation">,</span> <span class="token number">0.35219832</span><span class="token punctuation">,</span> <span class="token number">0.34763604</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'std_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.00283032</span><span class="token punctuation">,</span> <span class="token number">0.00100506</span><span class="token punctuation">,</span> <span class="token number">0.00240687</span><span class="token punctuation">,</span> <span class="token number">0.00265359</span><span class="token punctuation">,</span> <span class="token number">0.00327312</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'rank_test_score'</span><span class="token punctuation">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre> 
<h3>
<a id="_1066"></a>八、扩展：再议数据分割</h3> 
<p>前面已经讲过，我们可<strong>通过实验测试来对学习器的泛化误差进行评估并进而做出选择</strong>。</p> 
<p>为此，需使用一个“测试集”( testing set)来测试学习器对新样本的判别能力，然后<strong>以测试集上的“测试误差” (testing error)作为泛化误差的近似。</strong></p> 
<p>通常我们假设测试样本也是<strong>从样本真实分布中独立同分布采样而得</strong>。但需注意的是，<strong>测试集应该尽可能与训练集互斥。</strong></p> 
<p>那如何将数据集进行适当处理，划分出训练集S和测试集T，常见的方法有以下几种：</p> 
<ul>
<li>留出法</li>
<li>交叉验证法</li>
<li>自助法</li>
</ul> 
<h4>
<a id="1_1080"></a>1.留出法</h4> 
<p>“留出法”(hold-out)直接将数据集D划分为两个互斥的集合，其中一个集合作为训练集S，另一个作为测试集T</p> 
<p>常见做法是将大约2/3~4/5的样本用于训练，剩余样本用于测试</p> 
<p><strong>代码如二、2、(6)</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token comment">#使用train_test_split划分训练集和测试集</span>
train_X <span class="token punctuation">,</span> test_X<span class="token punctuation">,</span> train_Y <span class="token punctuation">,</span>test_Y <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
        X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h5>
<a id="_1095"></a>留一法：</h5> 
<p>即每次抽取一个样本做为测试集</p> 
<p>显然，留一法不受随机样本划分方式的影响，因为m个样本只有唯一的方式划分为m个子集一每个子集包含个样本；</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> LeaveOneOut

data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
loo <span class="token operator">=</span> LeaveOneOut<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> train<span class="token punctuation">,</span> test <span class="token keyword">in</span> loo<span class="token punctuation">.</span>split<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%s %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>train<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 输出结果</span>
<span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
</code></pre> 
<p><strong>留一法优缺点：</strong></p> 
<p>优点：</p> 
<ul><li>留一法使用的训练集与初始数据集相比只少了一个样本，这就使得在绝大多数情况下，留一法中被实际评估的模型与期望评估的用D训练出的模型很相似。因此，<strong>留一法的评估结果往往被认为比较准确</strong>。</li></ul> 
<p>缺点：</p> 
<ul><li>留一法也有其缺陷:在数据集比较大时，训练m个模型的计算开销可能是难以忍受的(例如数据集包含1百万个样本，则需训练1百万个模型，而这还是在未考虑算法调参的情况下。</li></ul> 
<h4>
<a id="2KFoldStratifiedKFold_1125"></a>2.交叉验证法-KFold和StratifiedKFold</h4> 
<p>交叉验证实现方法，除了咱们前面讲的GridSearchCV（见六、）之外，还有KFold, StratifiedKFold</p> 
<blockquote> 
 <p>交叉验证法通常K设置为10</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold<span class="token punctuation">,</span>StratifiedKFold
KFold<span class="token punctuation">(</span>n_splits<span class="token punctuation">,</span> random_state<span class="token punctuation">,</span> shuffle<span class="token punctuation">)</span>
sStratifiedKFold<span class="token punctuation">(</span>n_splits<span class="token punctuation">,</span> random_state<span class="token punctuation">,</span> shuffle<span class="token punctuation">)</span>
</code></pre> 
<ul>
<li>用法： 
  <ul>
<li>将训练/测试数据集划分n_splits个互斥子集，每次用其中一个子集当作验证集，剩下的n_splits-1个作为训练集，进行n_splits次训练和测试，得到n_splits个结果</li>
<li>
<strong>StratifiedKFold的用法和KFold的区别是</strong>：KFold是将测试机随机分割。SKFold是分层采样，确保训练集，测试集中，各类别样本的比例是和原始数据集中的一致。</li>
</ul> </li>
<li>注意点： 
  <ul><li>对于不能均等分数据集，其前n_samples % n_splits子集拥有n_samples // n_splits + 1个样本，其余子集都只有n_samples // n_splits样本</li></ul> </li>
<li>参数说明： 
  <ul>
<li>n_splits：表示划分几等份</li>
<li>shuffle：在每次划分时，是否进行洗牌 
    <ul>
<li>①若为Falses时，其效果等同于random_state等于整数，每次划分的结果相同</li>
<li>②若为True时，每次划分的结果都不一样，表示经过洗牌，随机取样的</li>
</ul> </li>
</ul> </li>
<li>属性： 
  <ul><li>①split(X, y=None, groups=None)：将数据集划分成训练集和测试集，返回索引生成器</li></ul> </li>
</ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold<span class="token punctuation">,</span>StratifiedKFold

X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token number">43</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token number">53</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">61</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">,</span><span class="token number">74</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 实例化KFold和StratifiedKFold</span>
folder <span class="token operator">=</span> KFold<span class="token punctuation">(</span>n_splits <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> shuffle <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
sfolder <span class="token operator">=</span> StratifiedKFold<span class="token punctuation">(</span>n_splits <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> shuffle <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'KFold'</span><span class="token punctuation">)</span>
<span class="token comment"># 分割数据</span>
<span class="token keyword">for</span> train<span class="token punctuation">,</span> test <span class="token keyword">in</span> folder<span class="token punctuation">.</span>split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'train:%s | test:%s'</span> <span class="token operator">%</span><span class="token punctuation">(</span>train<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'SKFold'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> train<span class="token punctuation">,</span> test <span class="token keyword">in</span> sfolder<span class="token punctuation">.</span>split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'train:%s | test:%s'</span><span class="token operator">%</span><span class="token punctuation">(</span>train<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 输出结果：</span>
KFold
train<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">|</span> test<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">]</span>
train<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">|</span> test<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">]</span>
train<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">6</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">|</span> test<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">]</span>
train<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">|</span> test<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">6</span> <span class="token number">7</span><span class="token punctuation">]</span>
SKFold
train<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">|</span> test<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">2</span><span class="token punctuation">]</span>
train<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">2</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">|</span> test<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">3</span><span class="token punctuation">]</span>
train<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">5</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">|</span> test<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token number">6</span><span class="token punctuation">]</span>
train<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">|</span> test<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">5</span> <span class="token number">7</span><span class="token punctuation">]</span>
</code></pre> 
<h4>
<a id="3_1189"></a>3.自助法</h4> 
<p><strong>综上所述：</strong></p> 
<ul>
<li>当我们<strong>数据量足够</strong>时，选择<strong>留出法</strong>简单省时，在牺牲很小的准确度的情况下，换取计算的简便；</li>
<li>当我们的<strong>数据量较小</strong>时，我们应该选择<strong>交叉验证法</strong>，因为此时划分样本集将会使训练数据过少；</li>
<li>当我们的<strong>数据量特别少</strong>的时候，我们可以考虑<strong>留一法</strong>。</li>
</ul>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
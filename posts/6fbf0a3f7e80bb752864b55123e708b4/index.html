<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>前端Web实战：从零打造一个类Visio的流程图拓扑图绘图工具 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">前端Web实战：从零打造一个类Visio的流程图拓扑图绘图工具</h1>
			
		</header>
		<div class="content post__content clearfix">
			


        
                <div id="content_views" class="htmledit_views">
                    <h1>前言</h1> 
<p>大家好，本系列从Web前端实战的角度，给大家分享介绍如何从零打造一个自己专属的绘图工具，实现流程图、拓扑图、脑图等类Visio的绘图工具。</p> 
<p></p> 
<p class="img-center"><img alt="" height="902" src="https://images2.imgbox.com/c7/d7/6pPOUqji_o.png" width="1200"></p> 
<p></p> 
<h2>你将收获</h2> 
<ul>
<li>免费好用、<strong>专属自己的绘图工具</strong>
</li>
<li>前端项目实战学习</li>
<li>如何从0搭建一个前端项目等基础框架</li>
<li>项目设计思路及优雅的架构技巧</li>
<li>开源项目学习</li>
<li>热门可视化引擎<a href="https://https//github.com/le5le-com/meta2d.js" title="Meta2d.js">Meta2d.js</a>等学习使用</li>
</ul> 
<h2>技术栈</h2> 
<p><a href="https://github.com/le5le-com/meta2d.js" title="Meta2d.js">Meta2d.js</a> - 国产开源免费好用的可视化引擎</p> 
<p><a href="https://https//vuejs.org/" title="Vue3">Vue3</a> - 流行的简单易用等前端Web框架</p> 
<p><a href="https://vitejs.dev/" title="Vite">Vite</a> - 高效好用的前端热门构建工具</p> 
<p><a href="https://tdesign.tencent.com/" title="TDesign">TDesign</a> - 支持Vue3的前端UI组件库</p> 
<p></p> 
<h1>需要提前掌握</h1> 
<ul>
<li>前端基础工具node.js安装（仅安装即可）</li>
<li>npm（pnpm、yarn）基本使用</li>
<li>package.json基本认识</li>
</ul> 
<p><em>以上基础知识可自行网上学习</em></p> 
<h1>一、 Vite + Vue3框架搭建</h1> 
<h2>1.1 搭建vue3的vite项目</h2> 
<p>参考vite文档（<a href="https://cn.vitejs.dev/guide/" title="开始 | Vite 官方中文文档">开始 | Vite 官方中文文档</a>）的<a href="https://pnpm.io/installation" title="pnpm">pnpm</a>的方式创建项目：</p> 
<pre><code>pnpm create vite</code></pre> 
<p>按照命令行提示，简单设置如下配置：</p> 
<p></p> 
<p class="img-center"><img alt="" height="80" src="https://images2.imgbox.com/7c/17/7hY2DEE2_o.png" width="475"></p> 
<h2>1.2 修改package.json</h2> 
<p>【注意】因为当前vite更新比较频繁，经常直接使用脚手架命令生成的框架运行会报错。可以尝试切换不同的包管理工具（pnpm、yarn、npm）试试；或看看vite、vue等是否有最新版本号，修改package.json升级。</p> 
<p></p> 
<p>当前，我们使用pnpm i安装依赖包后，发现运行错误。查看有新的<a href="mailto:vite@4.4.2">vite@4.4.2</a>，手动修改package.json升级。</p> 
<p></p> 
<p>另外，我个人习惯，把package.json中的dev重命名为start。</p> 
<p></p> 
<h2>1.3 运行检查基础框架</h2> 
<pre><code>// 安装依赖包
pnpm i
// 本地运行。脚手架默认命令为：pnpm dev
pnpm start </code></pre> 
<p>根据命令行提示，在浏览器打开：<a href="http://127.0.0.1:5173/" title="http://127.0.0.1:5173/">http://127.0.0.1:5173/</a> 正常运行，基础框架完成。</p> 
<p></p> 
<h2>1.4 丰富框架</h2> 
<ul><li>在package.json中添加meta2d.js、vue-router、tdesign、postcss等项目需要用的依赖包。</li></ul> 
<pre><code>{
  "name": "diagram-editor-vue3",
  "private": true,
  "version": "0.0.1",
  "scripts": {
    "start": "vite",
    "build": "vue-tsc &amp;&amp; vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@meta2d/activity-diagram": "^1.0.0",
    "@meta2d/chart-diagram": "^1.0.3",
    "@meta2d/class-diagram": "^1.0.0",
    "@meta2d/core": "^1.0.19",
    "@meta2d/flow-diagram": "^1.0.0",
    "@meta2d/form-diagram": "^1.0.3",
    "@meta2d/fta-diagram": "^1.0.0",
    "@meta2d/le5le-charts": "^1.0.2",
    "@meta2d/sequence-diagram": "^1.0.0",
    "@meta2d/svg": "^1.0.2",
    "tdesign-vue-next": "^1.3.10",
    "vue": "^3.3.4",
    "vue-router": "^4.2.4"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.2.3",
    "autoprefixer": "^10.4.13",
    "postcss": "^8.4.6",
    "postcss-import": "^14.1.0",
    "postcss-nested": "^6.0.1",
    "typescript": "^5.0.2",
    "vite": "^4.4.2",
    "vue-tsc": "^1.8.3"
  }
}</code></pre> 
<ul><li>添加postcss支持 
  <ul>
<li>在package.json中删除："type": "module"选项。</li>
<li>添加postcss.config.js文件：</li>
</ul>
</li></ul> 
<pre><code>module.exports = {
  plugins: {
    'postcss-import': {},
    'postcss-nested': {},
    autoprefixer: {},
  },
};
</code></pre> 
<h2>1.5 修改index.html</h2> 
<p>修改index.html为符合项目描述内容</p> 
<h2>1.6 初始化css</h2> 
<p>修改style.css为符合项目的默认初始样式</p> 
<p></p> 
<h2>1.7 添加router</h2> 
<p>新增src/router.ts文件:</p> 
<pre><code>import { createRouter, createWebHistory } from 'vue-router';

const routes = [
  { path: '/', component: () =&gt; import('./views/Index.vue') },
  { path: '/preview', component: () =&gt; import('./views/Preview.vue') },
];

const router = createRouter({
  history: createWebHistory('/'),
  routes,
});

export default router;
</code></pre> 
<p>其中：</p> 
<p>'/' - 编辑器页面</p> 
<p>'/preview' - 预览页面</p> 
<h2>1.8 加载vue-router、tdesign</h2> 
<p>在main.ts中加载vue-router、tdesign等基础服务。</p> 
<pre><code>import { createApp } from 'vue';
import './style.css';
import App from './App.vue';

import router from './router.ts';
import TDesign from 'tdesign-vue-next';

const app = createApp(App);

// 加载基础服务
app.use(router).use(TDesign);
// end

app.mount('#app');
</code></pre> 
<h2>1.9 设置路由</h2> 
<ol>
<li>添加路由页面：src/views/Index.vue、src/views/Preview.vue</li>
<li>修改App.vue内容为加载路由</li>
</ol> 
<p></p> 
<h2>1.10 设置@路径支持</h2> 
<ol><li>vue配置：vite.config.ts</li></ol> 
<p>安装依赖库：pnpm add -D path</p> 
<pre><code>import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import * as path from 'path';

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src/'),
    },
  },
});
</code></pre> 
<ol><li>typescript配置：tsconfig.json</li></ol> 
<pre><code>{
  "compilerOptions": {
    ...
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
    },
  },  
  ...
}
</code></pre> 
<h2>1.11 运行</h2> 
<p>运行pnpm start并在浏览器打开：</p> 
<p></p> 
<p class="img-center"><img alt="" height="702" src="https://images2.imgbox.com/e6/85/gGdFSVoG_o.png" width="1200"></p> 
<p></p> 
<p class="img-center"><img alt="" height="500" src="https://images2.imgbox.com/00/f0/4bVvFn8b_o.png" width="1200"></p> 
<p>至此，基础框架搭建完成。</p> 
<p></p> 
<h1>二、创建编辑器</h1> 
<h2>2.0 编辑器布局</h2> 
<p>拆分编辑器为：菜单工具栏（Header）、图形库（Graphics）、编辑器画布（View）、属性面板（Props）</p> 
<p></p> 
<p class="img-center"><img alt="" height="902" src="https://images2.imgbox.com/38/52/G6FOa1hq_o.png" width="1200"></p> 
<p>Index.vue直接由编辑器各个子组件构成：</p> 
<pre><code>&lt;template&gt;
  &lt;div class="app-page"&gt;
    &lt;Header /&gt;

    &lt;div class="designer"&gt;
      &lt;Graphics /&gt;
      &lt;View /&gt;
      &lt;Props /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
import Header from '../components/Header.vue';
import Graphics from '../components/Graphics.vue';
import View from '../components/View.vue';
import Props from '../components/Props.vue';
&lt;/script&gt;

&lt;style lang="postcss" scoped&gt;
.app-page {
  height: 100vh;
  overflow: hidden;
}
&lt;/style&gt;
</code></pre> 
<h2>2.1 创建编辑器画布 View</h2> 
<h3>2.1.1 挂载</h3> 
<p>Meta2d画布实例必须挂载在html中DOM元素上</p> 
<pre><code>&lt;div id="meta2d"&gt;&lt;/div&gt;</code></pre> 
<h3>2.1.2导入Meta2d类</h3> 
<pre><code>import { Meta2d } from '@meta2d/core';</code></pre> 
<h3>2.2.3 创建实例</h3> 
<p>创建实例必须等挂载容器（DOM元素）创建完成。因此我们一般在onMounted中创建实例。注意，如果挂载容器存在动画或其他原因导致挂载容器大小、位置不稳定时，需要等挂载容器样式稳定后在创建。</p> 
<pre><code>onMounted(() =&gt; {
  const myMeta2d = new Meta2d('meta2d', meta2dOptions);
});</code></pre> 
<p>通过new Meta2d创建实例后，默认会把当前实例挂载到global.meta2d全局变量上。后续可以直接通过meta2d来操作画布。</p> 
<h3>2.2.4 注册图形库</h3> 
<p>根据需求，按需注册图形库。</p> 
<pre><code>onMounted(() =&gt; {
  // 创建实例
  new Meta2d('meta2d', meta2dOptions);

  // 按需注册图形库
  // 以下为自带基础图形库
  register(flowPens());
  registerAnchors(flowAnchors());
  register(activityDiagram());
  registerCanvasDraw(activityDiagramByCtx());
  register(classPens());
  register(sequencePens());
  registerCanvasDraw(sequencePensbyCtx());
  registerEcharts();
  registerCanvasDraw(formPens());
  registerCanvasDraw(chartsPens());
  register(ftaPens());
  registerCanvasDraw(ftaPensbyCtx());
  registerAnchors(ftaAnchors());

  // 注册其他自定义图形库
  // ...
});</code></pre> 
<h2>2.2 创建菜单工具栏Header</h2> 
<h3>2.2.1 创建菜单栏</h3> 
<p></p> 
<p class="img-center"><img alt="" height="51" src="https://images2.imgbox.com/ca/8c/3QYRMJon_o.png" width="645"></p> 
<p>使用<a href="https://tdesign.tencent.com/" title="TDesign">TDesign</a>的<a href="https://tdesign.tencent.com/vue-next/components/dropdown" title="Dropdown下拉菜单">Dropdown下拉菜单</a>创建菜单栏</p> 
<pre><code>  &lt;div class="app-header"&gt;
    &lt;a class="logo" href="https://le5le.com" target="_blank"&gt;
      &lt;img src="/favicon.ico" /&gt;
      &lt;span&gt;乐吾乐&lt;/span&gt;
    &lt;/a&gt;
    &lt;t-dropdown
      :minColumnWidth="200"
      :maxHeight="560"
      overlayClassName="header-dropdown"
    &gt;
      &lt;a&gt; 文件 &lt;/a&gt;
      &lt;t-dropdown-menu&gt;
        &lt;t-dropdown-item @click="newFile"&gt;
          &lt;a&gt;新建文件&lt;/a&gt;
        &lt;/t-dropdown-item&gt;
        &lt;t-dropdown-item @click="openFile" divider="true"&gt;
          &lt;a&gt;打开文件&lt;/a&gt;
        &lt;/t-dropdown-item&gt;

        &lt;t-dropdown-item divider="true"&gt;
          &lt;a @click="downloadJson"&gt;下载JSON文件&lt;/a&gt;
        &lt;/t-dropdown-item&gt;

        &lt;t-dropdown-item&gt;
          &lt;a @click="downloadPng"&gt;下载为PNG&lt;/a&gt;
        &lt;/t-dropdown-item&gt;
        &lt;t-dropdown-item&gt;
          &lt;a @click="downloadSvg"&gt;下载为SVG&lt;/a&gt;
        &lt;/t-dropdown-item&gt;
      &lt;/t-dropdown-menu&gt;
    &lt;/t-dropdown&gt;
    &lt;t-dropdown
      :minColumnWidth="180"
      :maxHeight="500"
      overlayClassName="header-dropdown"
    &gt;
      &lt;a&gt; 编辑 &lt;/a&gt;
      &lt;t-dropdown-menu&gt;
        &lt;t-dropdown-item&gt;
          &lt;a @click="onUndo"&gt;
            &lt;div class="flex"&gt;
              撤销 &lt;span class="flex-grow"&gt;&lt;/span&gt; Ctrl + Z
            &lt;/div&gt;
          &lt;/a&gt;
        &lt;/t-dropdown-item&gt;
        &lt;t-dropdown-item divider="true"&gt;
          &lt;a @click="onRedo"&gt;
            &lt;div class="flex"&gt;
              恢复 &lt;span class="flex-grow"&gt;&lt;/span&gt; Ctrl + Y
            &lt;/div&gt;
          &lt;/a&gt;
        &lt;/t-dropdown-item&gt;
        &lt;t-dropdown-item&gt;
          &lt;a @click="onCut"&gt;
            &lt;div class="flex"&gt;
              剪切 &lt;span class="flex-grow"&gt;&lt;/span&gt; Ctrl + X
            &lt;/div&gt;
          &lt;/a&gt;
        &lt;/t-dropdown-item&gt;
        &lt;t-dropdown-item&gt;
          &lt;a @click="onCopy"&gt;
            &lt;div class="flex"&gt;
              复制 &lt;span class="flex-grow"&gt;&lt;/span&gt; Ctrl + C
            &lt;/div&gt;
          &lt;/a&gt;
        &lt;/t-dropdown-item&gt;
        &lt;t-dropdown-item divider="true"&gt;
          &lt;a @click="onPaste"&gt;
            &lt;div class="flex"&gt;
              粘贴 &lt;span class="flex-grow"&gt;&lt;/span&gt; Ctrl + V
            &lt;/div&gt;
          &lt;/a&gt;
        &lt;/t-dropdown-item&gt;
        &lt;t-dropdown-item&gt;
          &lt;a @click="onAll"&gt;
            &lt;div class="flex"&gt;
              全选 &lt;span class="flex-grow"&gt;&lt;/span&gt; Ctrl + A
            &lt;/div&gt;
          &lt;/a&gt;
        &lt;/t-dropdown-item&gt;
        &lt;t-dropdown-item&gt;
          &lt;a @click="onDelete"&gt;
            &lt;div class="flex"&gt;删除 &lt;span class="flex-grow"&gt;&lt;/span&gt; DELETE&lt;/div&gt;
          &lt;/a&gt;
        &lt;/t-dropdown-item&gt;
      &lt;/t-dropdown-menu&gt;
    &lt;/t-dropdown&gt;
    &lt;t-dropdown
      :minColumnWidth="180"
      :maxHeight="500"
      :delay2="[10, 150]"
      overlayClassName="header-dropdown"
    &gt;
      &lt;a&gt; 帮助 &lt;/a&gt;
      &lt;t-dropdown-menu&gt;
        &lt;t-dropdown-item v-for="item in assets.helps" :divider="item.divider"&gt;
          &lt;a :href="item.url" target="_blank"&gt;{<!-- -->{ item.name }}&lt;/a&gt;
        &lt;/t-dropdown-item&gt;
      &lt;/t-dropdown-menu&gt;
    &lt;/t-dropdown&gt;
  &lt;/div&gt;</code></pre> 
<p>菜单事件通过查阅<a href="https://doc.le5le.com/document/119359590" title="Meta2d.js">Meta2d.js</a>的<a href="https://doc.le5le.com/document/119882449" title="API帮助文档">API帮助文档</a>来实现</p> 
<h4>新建文件</h4> 
<p>新建文件是通过<a href="https://doc.le5le.com/document/119882449#open" title="打开">打开</a>一个空白画布来实现</p> 
<pre><code>// 打开默认空白文件
const newFile = () =&gt; {
  meta2d.open();
};

// 打开一个指定名称的空白文件
const newFile = () =&gt; {
  meta2d.open({ name: '新建项目', pens: [] } as any);
};</code></pre> 
<h4>打开文件</h4> 
<pre><code>function readFile(file: Blob) {
  return new Promise&lt;string&gt;((resolve, reject) =&gt; {
    const reader = new FileReader();
    reader.onload = () =&gt; {
      resolve(reader.result as string);
    };
    reader.onerror = reject;
    reader.readAsText(file);
  });
}

const openFile = () =&gt; {
  // 1. 显示选择文件对话框
  const input = document.createElement('input');
  input.type = 'file';
  input.onchange = async (event) =&gt; {
    const elem = event.target as HTMLInputElement;
    if (elem.files &amp;&amp; elem.files[0]) {
      // 2. 读取文件字符串内容
      const text = await readFile(elem.files[0]);
      try {
        // 3. 打开文件内容
        meta2d.open(JSON.parse(text));

        // 可选：缩放到窗口大小展示
        meta2d.fitView();
      } catch (e) {
        console.log(e);
      }
    }
  };
  input.click();
};</code></pre> 
<h4>保存为JSON文件</h4> 
<ul><li>安装file-saver</li></ul> 
<pre><code>pnpm add file-saver</code></pre> 
<ul><li>下载文件</li></ul> 
<pre><code>const downloadJson = () =&gt; {
  const data: any = meta2d.data();
  FileSaver.saveAs(
    new Blob([JSON.stringify(data)], {
      type: 'text/plain;charset=utf-8',
    }),
    `${data.name || 'le5le.meta2d'}.json`
  );
};</code></pre> 
<h4>保存为PNG文件</h4> 
<pre><code>const downloadPng = () =&gt; {
  let name = (meta2d.store.data as any).name;
  if (name) {
    name += '.png';
  }
  meta2d.downloadPng(name);
};</code></pre> 
<h4>保存为SVG文件</h4> 
<ul>
<li>下载<a href="https://assets.le5lecdn.com/2d/canvas2svg.js" title="canvas2svg.js">canvas2svg.js</a>
</li>
<li>在index.html中加载</li>
</ul> 
<p></p> 
<ul><li>下载svg</li></ul> 
<pre><code>// 判断该画笔 是否是组合为状态中 展示的画笔
function isShowChild(pen: any, store: any) {
  let selfPen = pen;
  while (selfPen &amp;&amp; selfPen.parentId) {
    const oldPen = selfPen;
    selfPen = store.pens[selfPen.parentId];
    const showChildIndex = selfPen?.calculative?.showChild;
    if (showChildIndex != undefined) {
      const showChildId = selfPen.children[showChildIndex];
      if (showChildId !== oldPen.id) {
        return false;
      }
    }
  }
  return true;
}

const downloadSvg = () =&gt; {
  if (!C2S) {
    MessagePlugin.error('请先加载乐吾乐官网下的canvas2svg.js');
    return;
  }

  const rect: any = meta2d.getRect();
  rect.x -= 10;
  rect.y -= 10;
  const ctx = new C2S(rect.width + 20, rect.height + 20);
  ctx.textBaseline = 'middle';
  for (const pen of meta2d.store.data.pens) {
    if (pen.visible == false || !isShowChild(pen, meta2d.store)) {
      continue;
    }
    meta2d.renderPenRaw(ctx, pen, rect);
  }

  let mySerializedSVG = ctx.getSerializedSvg();
  if (meta2d.store.data.background) {
    mySerializedSVG = mySerializedSVG.replace('{<!-- -->{bk}}', '');
    mySerializedSVG = mySerializedSVG.replace(
      '{<!-- -->{bkRect}}',
      `&lt;rect x="0" y="0" width="100%" height="100%" fill="${meta2d.store.data.background}"&gt;&lt;/rect&gt;`
    );
  } else {
    mySerializedSVG = mySerializedSVG.replace('{<!-- -->{bk}}', '');
    mySerializedSVG = mySerializedSVG.replace('{<!-- -->{bkRect}}', '');
  }

  mySerializedSVG = mySerializedSVG.replace(/--le5le--/g, '&amp;#x');

  const urlObject: any = (window as any).URL || window;
  const export_blob = new Blob([mySerializedSVG]);
  const url = urlObject.createObjectURL(export_blob);

  const a = document.createElement('a');
  a.setAttribute(
    'download',
    `${(meta2d.store.data as any).name || 'le5le.meta2d'}.svg`
  );
  a.setAttribute('href', url);
  const evt = document.createEvent('MouseEvents');
  evt.initEvent('click', true, true);
  a.dispatchEvent(evt);
};</code></pre> 
<h4>撤销</h4> 
<pre><code>const onUndo = () =&gt; {
  meta2d.undo();
};</code></pre> 
<h4>重做</h4> 
<pre><code>const onRedo = () =&gt; {
  meta2d.redo();
};</code></pre> 
<h4>剪切</h4> 
<pre><code>const onCut = () =&gt; {
  meta2d.cut();
};</code></pre> 
<h4>复制</h4> 
<pre><code>const onCopy = () =&gt; {
  meta2d.copy();
};</code></pre> 
<h4>粘贴</h4> 
<pre><code>const onPaste = () =&gt; {
  meta2d.paste();
};</code></pre> 
<h4>全选</h4> 
<pre><code>const onAll = () =&gt; {
  meta2d.activeAll();
};
</code></pre> 
<h4>删除</h4> 
<pre><code>const onPaste = () =&gt; {
  meta2d.paste();
};</code></pre> 
<h4>其他</h4> 
<p>其他未操作，可查阅<a href="https://doc.le5le.com/document/119359590" title="Meta2d.js">Meta2d.js</a>的<a href="https://doc.le5le.com/document/119882449" title="API帮助文档">API帮助文档</a>来实现</p> 
<p></p> 
<h3>2.2.2 创建工具栏</h3> 
<p></p> 
<p class="img-center"><img alt="" height="51" src="https://images2.imgbox.com/42/ca/0V1VRBcs_o.png" width="727"></p> 
<h4>画直线</h4> 
<p>设置html DOM元素属性，支持拖拽和点击</p> 
<pre><code>&lt;t-tooltip content="直线"&gt;
  &lt;span
    :draggable="true"
    @dragstart="onAddShape($event, 'line')"
    @click="onAddShape($event, 'line')"
  &gt;
    &lt;t-icon name="slash" /&gt;
  &lt;/span&gt;
&lt;/t-tooltip&gt;</code></pre> 
<p>设置图元数据</p> 
<pre><code>const onAddShape = (event: DragEvent | MouseEvent, name: string) =&gt; {
  event.stopPropagation();
  let data: any;
  if (name === 'text') {
    data = {
      text: 'text',
      width: 100,
      height: 20,
      name: 'text',
    };
  } else if (name === 'line') {
    data = {
      anchors: [
        { id: '0', x: 1, y: 0 },
        { id: '1', x: 0, y: 1 },
      ],
      width: 100,
      height: 100,
      name: 'line',
      lineName: 'line',
      type: 1,
    };
  }
  if (!(event as DragEvent).dataTransfer) {
    meta2d.canvas.addCaches = deepClone([data]);
  } else {
    (event as DragEvent).dataTransfer?.setData('Meta2d', JSON.stringify(data));
  }
};</code></pre> 
<h4>添加文字</h4> 
<p>设置html DOM元素属性，支持拖拽和点击</p> 
<pre><code> &lt;t-tooltip content="文字"&gt;
  &lt;span
    :draggable="true"
    @dragstart="onAddShape($event, 'text')"
    @click="onAddShape($event, 'text')"
  &gt;
    &lt;svg class="l-icon" aria-hidden="true"&gt;
      &lt;use xlink:href="#l-text"&gt;&lt;/use&gt;
    &lt;/svg&gt;
  &lt;/span&gt;
&lt;/t-tooltip&gt;</code></pre> 
<p>设置图元数据</p> 
<pre><code>const onAddShape = (event: DragEvent | MouseEvent, name: string) =&gt; {
  event.stopPropagation();
  let data: any;
  if (name === 'text') {
    data = {
      text: 'text',
      width: 100,
      height: 20,
      name: 'text',
    };
  } else if (name === 'line') {
    data = {
      anchors: [
        { id: '0', x: 1, y: 0 },
        { id: '1', x: 0, y: 1 },
      ],
      width: 100,
      height: 100,
      name: 'line',
      lineName: 'line',
      type: 1,
    };
  }
  if (!(event as DragEvent).dataTransfer) {
    meta2d.canvas.addCaches = deepClone([data]);
  } else {
    (event as DragEvent).dataTransfer?.setData('Meta2d', JSON.stringify(data));
  }
};</code></pre> 
<h4>连线</h4> 
<p>设置click事件</p> 
<pre><code>&lt;t-tooltip content="连线"&gt;
  &lt;svg
    width="1em"
    height="1em"
    viewBox="0 0 1024 1024"
    xmlns="http://www.w3.org/2000/svg"
    @click="drawLine"
    :style="{
      color: isDrawLine ? ' #1677ff' : '',
    }"
  &gt;
    &lt;path
      d="M192 64a128 128 0 0 1 123.968 96H384a160 160 0 0 1 159.68 149.504L544 320v384a96 96 0 0 0 86.784 95.552L640 800h68.032a128 128 0 1 1 0 64.064L640 864a160 160 0 0 1-159.68-149.504L480 704V320a96 96 0 0 0-86.784-95.552L384 224l-68.032 0.064A128 128 0 1 1 192 64z m640 704a64 64 0 1 0 0 128 64 64 0 0 0 0-128zM192 128a64 64 0 1 0 0 128 64 64 0 0 0 0-128z"
      fill="currentColor"
    &gt;&lt;/path&gt;
  &lt;/svg&gt;
&lt;/t-tooltip&gt;</code></pre> 
<p>实现连线</p> 
<pre><code>// 连线状态
const isDrawLine = ref&lt;boolean&gt;(false);

// 连线实现
const drawLine = () =&gt; {
  if (isDrawLine.value) {
    isDrawLine.value = false;
    meta2d.finishDrawLine();
    meta2d.drawLine();
    meta2d.store.options.disableAnchor = true;
  } else {
    isDrawLine.value = true;
    meta2d.drawLine(meta2d.store.options.drawingLineName);
    meta2d.store.options.disableAnchor = false;
  }
};</code></pre> 
<h4>设置连线类型</h4> 
<p>设置html属性</p> 
<pre><code> &lt;t-dropdown
      :minColumnWidth="160"
      :maxHeight="560"
      overlayClassName="header-dropdown"
    &gt;
      &lt;a&gt;
        &lt;svg class="l-icon" aria-hidden="true"&gt;
          &lt;use
            :xlink:href="
              lineTypes.find((item) =&gt; item.value === currentLineType)?.icon
            "
          &gt;&lt;/use&gt;
        &lt;/svg&gt;
      &lt;/a&gt;
      &lt;t-dropdown-menu&gt;
        &lt;t-dropdown-item v-for="item in lineTypes"&gt;
          &lt;div class="flex middle" @click="changeLineType(item.value)"&gt;
            {<!-- -->{ item.name }} &lt;span class="flex-grow"&gt;&lt;/span&gt;
            &lt;svg class="l-icon" aria-hidden="true"&gt;
              &lt;use :xlink:href="item.icon"&gt;&lt;/use&gt;
            &lt;/svg&gt;
          &lt;/div&gt;
        &lt;/t-dropdown-item&gt;
      &lt;/t-dropdown-menu&gt;
    &lt;/t-dropdown&gt;</code></pre> 
<p>连线类型设置</p> 
<pre><code>const lineTypes = reactive([
  { name: '曲线', icon: '#l-curve2', value: 'curve' },
  { name: '线段', icon: '#l-polyline', value: 'polyline' },
  { name: '直线', icon: '#l-line', value: 'line' },
  { name: '脑图曲线', icon: '#l-mind', value: 'mind' },
]);
const currentLineType = ref('curve');

const changeLineType = (value: string) =&gt; {
  currentLineType.value = value;
  if (meta2d) {
    meta2d.store.options.drawingLineName = value;
    meta2d.canvas.drawingLineName &amp;&amp; (meta2d.canvas.drawingLineName = value);
    meta2d.store.active?.forEach((pen) =&gt; {
      meta2d.updateLineType(pen, value);
    });
  }
};</code></pre> 
<h4>设置连线箭头</h4> 
<p>设置html属性</p> 
<pre><code>   &lt;t-dropdown
      :minColumnWidth="160"
      :maxHeight="560"
      :delay2="[10, 150]"
      overlayClassName="header-dropdown"
    &gt;
      &lt;a&gt;
        &lt;svg class="l-icon" aria-hidden="true"&gt;
          &lt;use
            :xlink:href="
              fromArrows.find((item) =&gt; item.value === fromArrow)?.icon
            "
          &gt;&lt;/use&gt;
        &lt;/svg&gt;
      &lt;/a&gt;
      &lt;t-dropdown-menu&gt;
        &lt;t-dropdown-item v-for="item in fromArrows"&gt;
          &lt;div
            class="flex middle"
            style="height: 30px"
            @click="changeFromArrow(item.value)"
          &gt;
            &lt;svg class="l-icon" aria-hidden="true"&gt;
              &lt;use :xlink:href="item.icon"&gt;&lt;/use&gt;
            &lt;/svg&gt;
          &lt;/div&gt;
        &lt;/t-dropdown-item&gt;
      &lt;/t-dropdown-menu&gt;
    &lt;/t-dropdown&gt;
    &lt;t-dropdown
      :minColumnWidth="160"
      :maxHeight="560"
      :delay2="[10, 150]"
      overlayClassName="header-dropdown"
    &gt;
      &lt;a&gt;
        &lt;svg class="l-icon" aria-hidden="true"&gt;
          &lt;use
            :xlink:href="toArrows.find((item) =&gt; item.value === toArrow)?.icon"
          &gt;&lt;/use&gt;
        &lt;/svg&gt;
      &lt;/a&gt;
      &lt;t-dropdown-menu&gt;
        &lt;t-dropdown-item v-for="item in toArrows"&gt;
          &lt;div
            class="flex middle"
            style="height: 30px"
            @click="changeToArrow(item.value)"
          &gt;
            &lt;svg class="l-icon" aria-hidden="true"&gt;
              &lt;use :xlink:href="item.icon"&gt;&lt;/use&gt;
            &lt;/svg&gt;
          &lt;/div&gt;
        &lt;/t-dropdown-item&gt;
      &lt;/t-dropdown-menu&gt;
    &lt;/t-dropdown&gt;</code></pre> 
<p>箭头设置</p> 
<pre><code>const fromArrow = ref('');
const fromArrows = [
  { icon: '#l-line', value: '' },
  { icon: '#l-from-triangle', value: 'triangle' },
  { icon: '#l-from-diamond', value: 'diamond' },
  { icon: '#l-from-circle', value: 'circle' },
  { icon: '#l-from-lineDown', value: 'lineDown' },
  { icon: '#l-from-lineUp', value: 'lineUp' },
  { icon: '#l-from-triangleSolid', value: 'triangleSolid' },
  { icon: '#l-from-diamondSolid', value: 'diamondSolid' },
  { icon: '#l-from-circleSolid', value: 'circleSolid' },
  { icon: '#l-from-line', value: 'line' },
];
const toArrow = ref('');
const toArrows = [
  { icon: '#l-line', value: '' },
  { icon: '#l-to-triangle', value: 'triangle' },
  { icon: '#l-to-diamond', value: 'diamond' },
  { icon: '#l-to-circle', value: 'circle' },
  { icon: '#l-to-lineDown', value: 'lineDown' },
  { icon: '#l-to-lineUp', value: 'lineUp' },
  { icon: '#l-to-triangleSolid', value: 'triangleSolid' },
  { icon: '#l-to-diamondSolid', value: 'diamondSolid' },
  { icon: '#l-to-circleSolid', value: 'circleSolid' },
  { icon: '#l-to-line', value: 'line' },
];

const changeFromArrow = (value: string) =&gt; {
  fromArrow.value = value;
  // 画布默认值
  meta2d.store.data.fromArrow = value;
  // 活动层的箭头都变化
  if (meta2d.store.active) {
    meta2d.store.active.forEach((pen: Pen) =&gt; {
      if (pen.type === PenType.Line) {
        pen.fromArrow = value;
        meta2d.setValue(
          {
            id: pen.id,
            fromArrow: pen.fromArrow,
          },
          {
            render: false,
          }
        );
      }
    });
    meta2d.render();
  }
};

const changeToArrow = (value: string) =&gt; {
  toArrow.value = value;
  // 画布默认值
  meta2d.store.data.toArrow = value;
  // 活动层的箭头都变化
  if (meta2d.store.active) {
    meta2d.store.active.forEach((pen: Pen) =&gt; {
      if (pen.type === PenType.Line) {
        pen.toArrow = value;
        meta2d.setValue(
          {
            id: pen.id,
            toArrow: pen.toArrow,
          },
          {
            render: false,
          }
        );
      }
    });
    meta2d.render();
  }
};</code></pre> 
<h4>画布缩放</h4> 
<ul><li>监听当前画布比例</li></ul> 
<pre><code>onMounted(() =&gt; {
  const timer = setInterval(() =&gt; {
    if (meta2d) {
      clearInterval(timer);
      // 获取初始缩放比例
      scaleSubscriber(meta2d.store.data.scale);

      // 监听缩放
      // @ts-ignore
      meta2d.on('scale', scaleSubscriber);
    }
  }, 200);
});

const scaleSubscriber = (val: number) =&gt; {
  scale.value = Math.round(val * 100);
};</code></pre> 
<ul><li>缩放到100%</li></ul> 
<pre><code>const onScaleDefault = () =&gt; {
  meta2d.scale(1);
  meta2d.centerView();
};</code></pre> 
<ul><li>缩放到窗口大小</li></ul> 
<pre><code>const onScaleWindow = () =&gt; {
  meta2d.fitView();
};</code></pre> 
<h4>运行查看</h4> 
<p>这里由于是单机环境，数据保存在前本地存储。</p> 
<p>无论是否单机环境，运行查看大致流程基本上是：保存数据（这里是前端本地存储）-&gt; 跳转运行页面 -&gt; 新页面读取加载数据。</p> 
<p></p> 
<ul><li>添加click事件</li></ul> 
<pre><code>&lt;t-tooltip content="运行查看"&gt;
  &lt;t-icon name="play-circle-stroke" @click="onView" /&gt;
&lt;/t-tooltip&gt;</code></pre> 
<ul>
<li>保存数据到本地存储</li>
<li>跳转运行页面</li>
</ul> 
<pre><code>const onView = () =&gt; {
  // 先停止动画，避免数据波动
  meta2d.stopAnimate();

  // 本地存储
  const data: any = meta2d.data();
  localStorage.setItem('meta2d', JSON.stringify(data));

  // 跳转到预览页面
  router.push({
    path: '/preview',
    query: {
      r: Date.now() + '',
      id: data._id,
    },
  });
};</code></pre> 
<ul><li>加载数据</li></ul> 
<p>Preview.vue</p> 
<pre><code>&lt;template&gt;
  &lt;div class="app-page"&gt;
    &lt;View /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
import { onMounted } from 'vue';
import View from '../components/View.vue';

onMounted(() =&gt; {
  // 读取本地存储
  let data: any = localStorage.getItem('meta2d');
  if (data) {
    data = JSON.parse(data);
    // 设置为预览模式
    data.locked = 1;
  }
  meta2d.open(data);
});
&lt;/script&gt;

&lt;style lang="postcss" scoped&gt;
.app-page {
  height: 100vh;
}
&lt;/style&gt;
</code></pre> 
<h4>返回编辑</h4> 
<p>返回编辑的基本流程是： 跳转编辑页面 -&gt; 新页面读取加载数据。</p> 
<p>这和运行查看有重复的逻辑（新页面读取加载数据），因此，我们可以把这部分放到公共的View.vue组件里面实现。</p> 
<p>View.vue</p> 
<pre><code>...

onMounted(() =&gt; {
  // 创建实例
  new Meta2d('meta2d', meta2dOptions);

  // 按需注册图形库
  // 以下为自带基础图形库
  register(flowPens());
  registerAnchors(flowAnchors());
  register(activityDiagram());
  registerCanvasDraw(activityDiagramByCtx());
  register(classPens());
  register(sequencePens());
  registerCanvasDraw(sequencePensbyCtx());
  registerEcharts();
  registerCanvasDraw(formPens());
  registerCanvasDraw(chartsPens());
  register(ftaPens());
  registerCanvasDraw(ftaPensbyCtx());
  registerAnchors(ftaAnchors());

  // 注册其他自定义图形库
  // ...

  // 加载数据
  let data: any = localStorage.getItem('meta2d');
  if (data) {
    data = JSON.parse(data);

    // 判断是否为运行查看，是-设置为预览模式
    if (location.pathname === '/preview') {
      data.locked = 1;
    } else {
      data.locked = 0;
    }
    meta2d.open(data);
  }
});

...</code></pre> 
<h4>自动保存</h4> 
<p>这里是单机环境，我们自动保存到前端本地存储。</p> 
<ul>
<li>监听数据变化</li>
<li>自动保存</li>
</ul> 
<p>Index.Vue</p> 
<pre><code>let timer: any;
function save() {
  if (timer) {
    clearTimeout(timer);
  }
  timer = setTimeout(() =&gt; {
    const data: any = meta2d.data();
    localStorage.setItem('meta2d', JSON.stringify(data));
    timer = undefined;
  }, 1000);
}

onMounted(() =&gt; {
  meta2d.on('scale', save);
  meta2d.on('add', save);
  meta2d.on('opened', save);
  meta2d.on('undo', save);
  meta2d.on('redo', save);
  meta2d.on('add', save);
  meta2d.on('delete', save);
  meta2d.on('rotatePens', save);
  meta2d.on('translatePens', save);
});</code></pre> 
<h2>2.3 创建图形库Graphics</h2> 
<p></p> 
<p class="img-center"><img alt="" height="906" src="https://images2.imgbox.com/80/ab/EE8X74eZ_o.png" width="485"></p> 
<h3>2.3.1 定义图元数据列表</h3> 
<p>因为是内置基础图元，我们暂时直接写死数组。实际项目中，可以通过API接口获取图元数据列表。</p> 
<pre><code>const graphicGroups = [
  {
    name: '基本形状',     // 分组名称
    list: [
      {
        name: '正方形',   // 图元显示名称
        icon: 'l-rect',  // 图元显示图标，这里用的是iconfont图标
        data: {          // Meta2d.js图元数据
          width: 100,
          height: 100,
          name: 'square',
        },
      },
    ]
  },
  {
    name: '脑图',
    list: [...]
  }
]</code></pre> 
<p>由于篇幅问题，这里仅展示数据结构示意，详细可参考文末教程相关代码。</p> 
<p></p> 
<p>上面数据结构列表包含2种数据：</p> 
<ul>
<li>“Meta2d.js图元数据”- <a href="https://github.com/le5le-com/meta2d.js" title="Meta2d.js">Meta2d.js</a>可视化引擎需要的数据，实际绘图数据</li>
<li>其他 - Vue UI用的数据，编辑器显示用的数据</li>
</ul> 
<p></p> 
<h3>2.3.2 显示图元列表</h3> 
<p>这里我们使用<a href="https://tdesign.tencent.com/vue-next/components/collapse" title="折叠面板">折叠面板</a>来实现图元列表显示。</p> 
<pre><code>&lt;t-collapse :defaultExpandAll="true"&gt;
      &lt;t-collapse-panel
        :header="item.name"
        v-for="item in graphicGroups"
        :key="item.name"
      &gt;
        &lt;template v-for="elem in item.list"&gt;
          &lt;div
            class="graphic"
            :draggable="true"
            @dragstart="dragStart($event, elem)"
            @click.prevent="dragStart($event, elem)"
          &gt;
            &lt;svg class="l-icon" aria-hidden="true"&gt;
              &lt;use :xlink:href="'#' + elem.icon"&gt;&lt;/use&gt;
            &lt;/svg&gt;
            &lt;p :title="elem.name"&gt;{<!-- -->{ elem.name }}&lt;/p&gt;
          &lt;/div&gt;
        &lt;/template&gt;
      &lt;/t-collapse-panel&gt;
    &lt;/t-collapse&gt;</code></pre> 
<p></p> 
<h3>2.3.3 图元拖拽</h3> 
<p>由于Meta2d.js已经内置接收拖拽数据的功能。这里，我们只用实现拖拽绑定数据过程即可，只需2步，简单方便。</p> 
<p></p> 
<p class="img-center"><img alt="" height="267" src="https://images2.imgbox.com/aa/e9/CVUOUesK_o.png" width="882"></p> 
<pre><code>const dragStart = (e: any, elem: any) =&gt; {
  if (!elem) {
    return;
  }
  e.stopPropagation();

  // 拖拽事件
  if (e instanceof DragEvent) {
    // 设置拖拽数据
    e.dataTransfer?.setData('Meta2d', JSON.stringify(elem.data));
  } else {
    // 支持单击添加图元。平板模式
    meta2d.canvas.addCaches = [elem.data];
  }
};</code></pre> 
<h3>2.3.4 平板模式单击添加图元</h3> 
<p>Meta2d.js支持单击图元添加，方便触摸场景。</p> 
<ol><li><strong>设置单击事件</strong></li></ol> 
<p></p> 
<p class="img-center"><img alt="" height="262" src="https://images2.imgbox.com/b6/d1/Y1S126B0_o.png" width="724"></p> 
<p>这里为了方便，直接合并在拖拽函数里面了</p> 
<ol><li><strong>绑定单击数据</strong></li></ol> 
<p></p> 
<p class="img-center"><img alt="" height="358" src="https://images2.imgbox.com/f8/5b/vQ179J9a_o.png" width="753"></p> 
<p></p> 
<h2>2.4 创建属性面板Props</h2> 
<p>这里，我们属性面板包含2种（实际项目中，根据需求设计）： <strong>图纸属性</strong>、<strong>图元属性</strong>。</p> 
<p>我们通过鼠标点击的不同，切换不同的属性面板：</p> 
<ul>
<li>点击画布空白地方：显示图纸属性；</li>
<li>点击图元：显示图元属性；</li>
</ul> 
<h3>2.4.1 组合式函数</h3> 
<p>这里，我们学习下非常有用的Vue知识和一些优雅的架构技巧：组合式函数、状态管理</p> 
<p><strong>什么是组合式函数</strong></p> 
<p>组合式函数（Composite function）是一种通过将多个独立的函数组合起来，来解决复合问题的函数。组合式函数的好处在于可以通过简单地组合多个函数来减少代码量，提高代码的可读性，并提高程序的灵活性和可扩展性。以下是组合式函数的一些主要优点：</p> 
<ol>
<li>代码重用：通过组合多个函数，可以减少代码量，提高代码的可读性和可维护性。在实际编程过程中，我们常常需要重复使用某些功能，组合式函数可以帮助我们更轻松地实现代码重用。</li>
<li>模块化：通过将函数组合在一起，可以实现程序的模块化，使得代码结构更清晰，模块之间的关系更明确。这有助于提高程序的可维护性和可读性。</li>
<li>提高代码的可读性：组合式函数将多个相关的函数组合在一起，有助于提高代码的可读性。通过这种方式，开发者可以更容易地理解函数的作用，以及各个函数之间的关系。</li>
<li>灵活性：组合式函数可以根据需要动态地调整各个函数的顺序、参数或调用方式，以便更好地满足问题的需求。这使得程序具有更高的灵活性和可扩展性。</li>
<li>复用逻辑：组合式函数可以将一些常用的逻辑代码封装起来，使得这些代码可以在程序的多个地方复用。这有助于减少重复代码，提高代码的质量。</li>
<li>可测试性：组合式函数更容易编写单元测试，因为每个函数都可以独立测试。这有助于提高程序的可测试性，降低调试成本。</li>
<li>易于维护和扩展：通过将函数组合在一起，开发者可以更容易地发现和解决程序中的问题，从而提高程序的维护和扩展能力。</li>
</ol> 
<p>总之，组合式函数具有代码重用、模块化、提高可读性、灵活性、复用逻辑、可测试性和易于维护和扩展等优点，可以帮助开发者编写更高效、更简洁的代码。</p> 
<p></p> 
<p><strong>状态管理</strong></p> 
<p>【注意注意】【敲黑板】这里的状态管理不是Pinia，而是我们自己实现的：响应式+组合式函数</p> 
<p><strong><em>为什么不用Pinia</em></strong></p> 
<ul>
<li>不为了使用而使用</li>
<li>有入侵性</li>
<li>响应式+组合式函数更高内聚低耦合</li>
</ul> 
<p></p> 
<p><strong><em>什么时候使用Pinia</em></strong></p> 
<ul>
<li>项目规定</li>
<li>时间轴或时间旅行等调试功能</li>
</ul> 
<p></p> 
<p><strong>组合式函数 useSelection</strong></p> 
<p>我们定义一个useSelection来表示图元不同的选中状态（暂时2种）：选中图纸；选中单个图元；</p> 
<p><em>新建一个src/services/selections.ts文件</em></p> 
<pre><code>import { Pen } from '@meta2d/core';
import { reactive } from 'vue';

// 选中对象类型：0 - 画布；1 - 单个图元
export enum SelectionMode {
  File,
  Pen,
}

const selections = reactive&lt;{
  mode: SelectionMode;
  pen?: Pen;
}&gt;({
  mode: SelectionMode.File,
  pen: undefined,
});

export const useSelection = () =&gt; {
  const select = (pens?: Pen[]) =&gt; {
    if (!pens || pens.length !== 1) {
      selections.mode = SelectionMode.File;
      selections.pen = undefined;
      return;
    }

    selections.mode = SelectionMode.Pen;
    selections.pen = pens[0];
  };
  return {
    selections,
    select,
  };
};
</code></pre> 
<p>【注意注意】【敲黑板】优雅的架构技巧</p> 
<ul><li>组合式函数的数据为什么放在组合式函数外面</li></ul> 
<p>方便实现状态管理</p> 
<ul><li>什么时候数据放在组合式函数里面</li></ul> 
<p>每次使用组合式函数希望拥有独立的数据拷贝，不与其他使用者冲突</p> 
<p></p> 
<h3>2.4.2 事件监听</h3> 
<p>监听画布的acitve事件实现面板切换。在View.vue文件中新增：</p> 
<pre><code>import { useSelection } from '@/services/selections';

const { select } = useSelection();

onMounted(() =&gt; {
  // 创建实例
  new Meta2d('meta2d', meta2dOptions);
  ...
  meta2d.on('active', active);
  meta2d.on('inactive', inactive);
});

const active = (pens?: Pen[]) =&gt; {
  select(pens);
};

const inactive = () =&gt; {
  select();
};</code></pre> 
<h3>2.4.3 属性面板</h3> 
<p>Props.Vue中根据不同的管理状态，显示不同子组件即可</p> 
<pre><code>&lt;template&gt;
  &lt;div class="app-props"&gt;
    {<!-- -->{ selections.mode }}
    &lt;FileProps v-if="selections.mode === SelectionMode.File" /&gt;
    &lt;PenProps v-else-if="selections.mode === SelectionMode.Pen" /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
import FileProps from './FileProps.vue';
import PenProps from './PenProps.vue';

import { useSelection, SelectionMode } from '@/services/selections';

const { selections } = useSelection();
&lt;/script&gt;
&lt;style lang="postcss" scoped&gt;
.app-props {
  border-left: 1px solid var(--color-border);
  z-index: 2;
  height: calc(100vh - 80px);
  overflow-y: auto;
}
&lt;/style&gt;
</code></pre> 
<p></p> 
<h3>2.4.4 图纸属性面板</h3> 
<p>这里暂时设置图纸属性有：图纸名称、网格、标尺、颜色等。</p> 
<p><strong>【注意注意注意】：</strong></p> 
<p>图纸名称、颜色属于<a href="https://doc.le5le.com/document/119882449#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" title="图纸数据">图纸数据</a>，参考<a href="https://doc.le5le.com/document/119882449#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" title="Meta2d.js文档">Meta2d.js文档</a>。图纸名称属于自定义业务数据，自己扩展定义的；</p> 
<p>网格、标尺即可以在<a href="https://doc.le5le.com/document/119882449#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" title="图纸数据">图纸数据</a>设置，也可以在Meta2d.js <a href="https://doc.le5le.com/document/119882449#Options" title="Options选项">Options选项</a>设置。这里，我们在<a href="https://doc.le5le.com/document/119882449#Options" title="Options选项">Options选项</a>设置。</p> 
<p></p> 
<p>Options被视为独立于图纸外的默认通用样式，而图纸数据则归属于图纸专属数据。</p> 
<p></p> 
<p><strong>A. 定义Vue组件数据</strong></p> 
<pre><code>// 图纸数据
const data = reactive&lt;any&gt;({
  name: '',
  background: undefined,
  color: undefined,
});

// 画布选项
const options = reactive&lt;any&gt;({
  grid: false,
  gridSize: 10,
  gridRotate: undefined,
  gridColor: undefined,
  rule: true,
});</code></pre> 
<p><strong>B. 定义组件UI</strong></p> 
<pre><code>&lt;template&gt;
  &lt;div class="props-panel"&gt;
    &lt;t-form label-align="left"&gt;
      &lt;h5 class="mb-24"&gt;图纸&lt;/h5&gt;
      &lt;t-form-item label="图纸名称" name="name"&gt;
        &lt;t-input v-model="data.name" @change="onChangeData" /&gt;
      &lt;/t-form-item&gt;
      &lt;t-divider /&gt;
      &lt;t-form-item label="网格" name="grid"&gt;
        &lt;t-switch v-model="options.grid" @change="onChangeOptions" /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="网格大小" name="gridSize"&gt;
        &lt;t-input v-model.number="options.gridSize" @change="onChangeOptions" /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="网格角度" name="gridRotate"&gt;
        &lt;t-input
          v-model.number="options.gridRotate"
          @change="onChangeOptions"
        /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="网格颜色" name="gridColor"&gt;
        &lt;t-color-picker
          class="w-full"
          v-model="options.gridColor"
          :show-primary-color-preview="false"
          format="CSS"
          :color-modes="['monochrome']"
          @change="onChangeOptions"
        /&gt;
      &lt;/t-form-item&gt;

      &lt;t-divider /&gt;

      &lt;t-form-item label="标尺" name="rule"&gt;
        &lt;t-switch v-model="options.rule" @change="onChangeOptions" /&gt;
      &lt;/t-form-item&gt;

      &lt;t-divider /&gt;

      &lt;t-form-item label="背景颜色" name="background"&gt;
        &lt;t-color-picker
          class="w-full"
          v-model="data.background"
          :show-primary-color-preview="false"
          format="CSS"
          :color-modes="['monochrome']"
          @change="onChangeData"
        /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="图元默认颜色" name="color"&gt;
        &lt;t-color-picker
          class="w-full"
          v-model="data.color"
          :show-primary-color-preview="false"
          format="CSS"
          :color-modes="['monochrome']"
          @change="onChangeData"
        /&gt;
      &lt;/t-form-item&gt;
    &lt;/t-form&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre> 
<p><strong>C. 设置图纸数据</strong></p> 
<pre><code>const onChangeData = () =&gt; {
  Object.assign(meta2d.store.data, data);
  meta2d.store.patchFlagsBackground = true;
  meta2d.render();
};</code></pre> 
<p>因为涉及到背景，需要设置一个背景更新标志：meta2d.store.patchFlagsBackground = true;</p> 
<p><strong>D. 设置编辑器选项</strong></p> 
<pre><code>const onChangeOptions = () =&gt; {
  meta2d.setOptions(options);
  meta2d.store.patchFlagsTop = true;
  meta2d.store.patchFlagsBackground = true;
  meta2d.render();
};</code></pre> 
<p>因为涉及到标尺，需要设置一个标尺图层更新标志：meta2d.store.patchFlagsTop = true;</p> 
<h3>2.4.5 图元属性面板</h3> 
<p><strong>A. 定义图元数据</strong></p> 
<pre><code>const pen = ref&lt;any&gt;();
// 位置数据。当前版本位置需要动态计算获取
const rect = ref&lt;any&gt;();</code></pre> 
<p>这里由于图元位置需要动态计算，因此需要单独定义。</p> 
<p></p> 
<p><strong>B. 获取选中图元数据</strong></p> 
<pre><code>import { onMounted, onUnmounted, ref, watch } from 'vue';
import { useSelection } from '@/services/selections';

const { selections } = useSelection();


onMounted(() =&gt; {
  getPen();
});

const getPen = () =&gt; {
  pen.value = selections.pen;
  if (pen.value.globalAlpha == undefined) {
    pen.value.globalAlpha = 1;
  }

  rect.value = meta2d.getPenRect(pen.value);
};

// 监听选中不同图元
// @ts-ignore
const watcher = watch(() =&gt; selections.pen.id, getPen);

onUnmounted(() =&gt; {
  watcher();
});</code></pre> 
<p><strong>C. 编写UI</strong></p> 
<pre><code>&lt;template&gt;
  &lt;div class="props-panel"&gt;
    &lt;t-form label-align="left" v-if="pen"&gt;
      &lt;h5 class="mb-24"&gt;图元&lt;/h5&gt;
      &lt;t-form-item label="文本" name="text"&gt;
        &lt;t-input v-model="pen.text" @change="changeValue('text')" /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="颜色" name="color"&gt;
        &lt;t-color-picker
          class="w-full"
          v-model="pen.color"
          :show-primary-color-preview="false"
          format="CSS"
          :color-modes="['monochrome']"
          @change="changeValue('color')"
        /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="背景" name="background"&gt;
        &lt;t-color-picker
          class="w-full"
          v-model="pen.background"
          :show-primary-color-preview="false"
          format="CSS"
          :color-modes="['monochrome']"
          @change="changeValue('background')"
        /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="线条" name="dash"&gt;
        &lt;t-select v-model="pen.dash" @change="changeValue('dash')"&gt;
          &lt;t-option :key="0" :value="0" label="实线"&gt;&lt;/t-option&gt;
          &lt;t-option :key="1" :value="1" label="虚线"&gt;&lt;/t-option&gt;
        &lt;/t-select&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="圆角" name="borderRadius"&gt;
        &lt;t-input-number
          :min="0"
          :max="1"
          :step="0.01"
          v-model="pen.borderRadius"
          @change="changeValue('borderRadius')"
        /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="不透明度" name="globalAlpha"&gt;
        &lt;t-slider
          v-model="pen.globalAlpha"
          :min="0"
          :max="1"
          :step="0.01"
          @change="changeValue('globalAlpha')"
        /&gt;
        &lt;span class="ml-16" style="width: 50px; line-height: 30px"&gt;
          {<!-- -->{ pen.globalAlpha }}
        &lt;/span&gt;
      &lt;/t-form-item&gt;

      &lt;t-divider /&gt;

      &lt;t-form-item label="X" name="x"&gt;
        &lt;t-input-number v-model="rect.x" @change="changeRect('x')" /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="Y" name="y"&gt;
        &lt;t-input-number v-model="rect.y" @change="changeRect('y')" /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="宽" name="width"&gt;
        &lt;t-input-number v-model="rect.width" @change="changeRect('width')" /&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="高" name="height"&gt;
        &lt;t-input-number v-model="rect.height" @change="changeRect('height')" /&gt;
      &lt;/t-form-item&gt;

      &lt;t-divider /&gt;

      &lt;t-form-item label="文字水平对齐" name="textAlign"&gt;
        &lt;t-select v-model="pen.textAlign" @change="changeValue('textAlign')"&gt;
          &lt;t-option key="left" value="left" label="左对齐"&gt;&lt;/t-option&gt;
          &lt;t-option key="center" value="center" label="居中"&gt;&lt;/t-option&gt;
          &lt;t-option key="right" value="right" label="右对齐"&gt;&lt;/t-option&gt;
        &lt;/t-select&gt;
      &lt;/t-form-item&gt;
      &lt;t-form-item label="文字垂直对齐" name="textBaseline"&gt;
        &lt;t-select
          v-model="pen.textBaseline"
          @change="changeValue('textBaseline')"
        &gt;
          &lt;t-option key="top" value="top" label="顶部对齐"&gt;&lt;/t-option&gt;
          &lt;t-option key="middle" value="middle" label="居中"&gt;&lt;/t-option&gt;
          &lt;t-option key="bottom" value="bottom" label="底部对齐"&gt;&lt;/t-option&gt;
        &lt;/t-select&gt;
      &lt;/t-form-item&gt;

      &lt;t-divider /&gt;

      &lt;t-space&gt;
        &lt;t-button @click="top"&gt;置顶&lt;/t-button&gt;
        &lt;t-button @click="bottom"&gt;置底&lt;/t-button&gt;
        &lt;t-button @click="up"&gt;上一层&lt;/t-button&gt;
        &lt;t-button @click="down"&gt;下一层&lt;/t-button&gt;
      &lt;/t-space&gt;
    &lt;/t-form&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre> 
<p><strong>D. 设置图元数据</strong></p> 
<p>设置图元数据是调用meta2d.setValue实现。</p> 
<p>当前需要注意的是：</p> 
<pre><code>
const lineDashs = [undefined, [5, 5]];

const changeValue = (prop: string) =&gt; {
  const v: any = { id: pen.value.id };
  v[prop] = pen.value[prop];
  if (prop === 'dash') {
    v.lineDash = lineDashs[v[prop]];
  }
  meta2d.setValue(v, { render: true });
};

const changeRect = (prop: string) =&gt; {
  const v: any = { id: pen.value.id };
  v[prop] = rect.value[prop];
  meta2d.setValue(v, { render: true });
};</code></pre> 
<p><strong>E. 设置图元层级</strong></p> 
<p>根据Meta2d.js <a href="https://doc.le5le.com/document/119895613" title="图元API文档">图元API文档</a>，调用相关函数即可</p> 
<pre><code>const top = () =&gt; {
  meta2d.top();
  meta2d.render();
};
const bottom = () =&gt; {
  meta2d.bottom();
  meta2d.render();
};
const up = () =&gt; {
  meta2d.up();
  meta2d.render();
};
const down = () =&gt; {
  meta2d.down();
  meta2d.render();
};</code></pre> 
<h3>2.4.6 更多图元属性</h3> 
<p>更多属性功能可参考Meta2d.js <a href="https://doc.le5le.com/document/119882449" title="引擎API文档">引擎API文档</a>、<a href="https://doc.le5le.com/document/119895613" title="图元API文档">图元API文档</a>去编写</p> 
<h1>三、运行查看</h1> 
<p>因为前面结构规划清晰，所以运行查看比较简单，只需要加载View.vue子组件即可。整个页面只需短短几行代码即可：</p> 
<pre><code>&lt;template&gt;
  &lt;div class="app-page"&gt;
    &lt;View /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
import View from '../components/View.vue';
&lt;/script&gt;

&lt;style lang="postcss" scoped&gt;
.app-page {
  height: 100vh;
}
&lt;/style&gt;
</code></pre> 
<h1>四、开源与代码</h1> 
<h2>Meta2d.js开源地址</h2> 
<p>Github：<a href="https://github.com/le5le-com/meta2d.js" title="https://github.com/le5le-com/meta2d.js">https://github.com/le5le-com/meta2d.js</a></p> 
<p>Gitee: <a href="https://gitee.com/le5le/meta2d.js" title="meta2d.js: The meta2d.js is real-time data exchange and interactive web 2D engine. Developers are able to build Web SCADA, IoT, Digital twins and so on. Meta2d.js是一个实时数据响应和交互的2d引擎，可用于Web组态，物联网，数字孪生等场景。">meta2d.js: The meta2d.js is real-time data exchange and interactive web 2D engine. Developers are able to build Web SCADA, IoT, Digital twins and so on. Meta2d.js是一个实时数据响应和交互的2d引擎，可用于Web组态，物联网，数字孪生等场景。</a></p> 
<h2>本教程相关代码开源地址</h2> 
<p><a href="https://github.com/le5le-com/meta2d.js/tree/main/examples/diagram-editor-vue3" title="https://github.com/le5le-com/meta2d.js/tree/main/examples/diagram-editor-vue3">https://github.com/le5le-com/meta2d.js/tree/main/examples/diagram-editor-vue3</a></p> 
<p></p> 
<p><strong>开源不易，欢迎大家点星点赞支持</strong></p> 
<p>大家的热烈支持，是我们做的更好的动力：</p> 
<p>Github Star地址：<a href="https://github.com/le5le-com/meta2d.js" title="GitHub - le5le-com/meta2d.js: The meta2d.js is real-time data exchange and interactive web 2D engine. Developers are able to build Web SCADA, IoT, Digital twins and so on. Meta2d.js是一个实时数据响应和交互的2d引擎，可用于Web组态，物联网，数字孪生等场景。">GitHub - le5le-com/meta2d.js: The meta2d.js is real-time data exchange and interactive web 2D engine. Developers are able to build Web SCADA, IoT, Digital twins and so on. Meta2d.js是一个实时数据响应和交互的2d引擎，可用于Web组态，物联网，数字孪生等场景。</a></p> 
<h1>五、其他</h1> 
<p>如果大家觉得实用、喜欢，欢迎转发点赞留言，共同学习！由于教程都是按照作者自己的视角写的，难免考虑不到所有细节，欢迎大家写一些自己的学习心得分享！</p> 
<p></p> 
<p>我们计划陆续推出一些系列文章，欢迎关注。</p> 
<p>最后，开源不易，写作更不易，欢迎<strong>点星</strong>支持：<a href="https://github.com/le5le-com/meta2d.js" title="https://github.com/le5le-com/meta2d.js">https://github.com/le5le-com/meta2d.js</a></p> 
<p></p>
                </div>

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
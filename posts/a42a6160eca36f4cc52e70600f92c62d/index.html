<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>要过年了，最新的12306实时监控抢购车票软件已经写好了，这多亏我Python学的好 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">要过年了，最新的12306实时监控抢购车票软件已经写好了，这多亏我Python学的好</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="heading-0-toc" style="margin-left:40px"><a href="#heading-0">一、效果展示</a></p> 
<p id="heading-1-toc" style="margin-left:40px"><a href="#heading-1">二、代码详解</a></p> 
<p id="heading-2-toc" style="margin-left:80px"><a href="#heading-2">1 导入库</a></p> 
<p id="heading-3-toc" style="margin-left:80px"><a href="#heading-3">2 确定好购票基本信息</a></p> 
<p id="heading-4-toc" style="margin-left:80px"><a href="#heading-4">3 登录12306</a></p> 
<p id="heading-5-toc" style="margin-left:80px"><a href="#heading-5">4 模拟滑动滑块</a></p> 
<p id="heading-6-toc" style="margin-left:80px"><a href="#heading-6">5 处理疫情特殊要求</a></p> 
<p id="heading-7-toc" style="margin-left:80px"><a href="#heading-7">6 点击购票并填写出发地、目的地、出发时间</a></p> 
<p id="heading-8-toc" style="margin-left:80px"><a href="#heading-8">7 锁定车票</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%AE%9E%E7%8E%B0%E7%9B%91%E6%8E%A7%E8%B4%AD%E4%B9%B0-toc" style="margin-left:0px"><a href="#%E4%B8%89%E3%80%81%E5%AE%9E%E7%8E%B0%E7%9B%91%E6%8E%A7%E8%B4%AD%E4%B9%B0">        </a> <a href="#%E4%B8%89%E3%80%81%E5%AE%9E%E7%8E%B0%E7%9B%91%E6%8E%A7%E8%B4%AD%E4%B9%B0">三、实现监控购买</a></p> 
<p id="%E6%B3%A8%E6%84%8F-toc" style="margin-left:40px"><a href="#%E6%B3%A8%E6%84%8F">        </a> <a href="#%E6%B3%A8%E6%84%8F">注意</a></p> 
<p id="%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px"><a href="#%E7%8E%AF%E5%A2%83">        </a> <a href="#%E7%8E%AF%E5%A2%83">环境</a></p> 
<p id="%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px"><a href="#%E4%BB%A3%E7%A0%81">        </a> <a href="#%E4%BB%A3%E7%A0%81">代码</a></p> 
<hr id="hr-toc">
<p></p> 
<p>大家有没有这种感觉，一到国庆、春节这种长假，抢火车票就非常困难？各大互联网公司都推出抢票服务，只要加钱给服务费就可以增加抢到票的几率。有些火车票代售网点和一些加速买票软件，说你只要给100元服务费就可以优先帮忙抢到票。</p> 
<p>本文和你一起探索抢票软件背后的原理。</p> 
<p><a name="_label0"></a></p> 
<h2 id="heading-0">一、效果展示</h2> 
<div class="csdn-video-box">
 
 <p>自动买火车票</p>
</div> 
<p>在正式进入代码讲解之前，先来看下本文的实现效果。</p> 
<p>如果不是为了演示效果，直接在最后确定阶段加一个延时点击确定，应该不到45秒可以锁定一张票，只要在30分钟之内付款即可。</p> 
<p><a name="_label1"></a></p> 
<h2 id="heading-1">二、代码详解</h2> 
<p>本小节会详细解锁抢票软件是如何模拟登录网站，进行自动买票的。为了更清晰地给大家展示，部分代码没有写成函数，直接裸代码运行，让需要买票的朋友可以自己应用软件进行购票。</p> 
<p><a name="_lab2_1_0"></a></p> 
<h3 id="heading-2">1 导入库</h3> 
<p>首先导入本文需要加载的库，如果你有些库还没有安装，导致运行代码时报错，可以在Anaconda Prompt中用pip方法安装。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>
<td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> </td>
<td> <p><code>import</code> <code>json</code></p> <p><code>import</code> <code>time</code></p> <p><code>from</code> <code>captcha </code><code>import</code> <code>*</code></p> <p><code>from</code> <code>selenium </code><code>import</code> <code>webdriver</code></p> <p><code>from</code> <code>selenium.webdriver.common.by </code><code>import</code> <code>By</code></p> <p><code>from</code> <code>selenium.webdriver.support </code><code>import</code> <code>wait</code></p> <p><code>from</code> <code>selenium.webdriver.common.keys </code><code>import</code> <code>Keys</code></p> <p><code>from</code> <code>selenium.common.exceptions </code><code>import</code> <code>NoSuchElementException</code></p> <p><code>from</code> <code>selenium.webdriver.common.action_chains </code><code>import</code> <code>ActionChains</code></p> <p><code>from</code> <code>selenium.webdriver.support </code><code>import</code> <code>expected_conditions as EC</code></p> <p><code>#导入库</code></p> </td>
</tr></tbody></table>
<p><a name="_lab2_1_1"></a></p> 
<h3 id="heading-3">2 确定好购票基本信息</h3> 
<p>导入库后，在python代码中填写你购票的基本信息。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>
<td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> </td>
<td> <p><code>purpose </code><code>=</code> <code>'ADULT'</code>               <code>#购买成人票，如果是学生票，需调整代码</code></p> <p><code>names </code><code>=</code> <code>[</code><code>'谢朝阳'</code><code>]              </code><code>#填写购票人姓名</code></p> <p><code>date </code><code>=</code> <code>'2021-09-21'</code>             <code>#填写购票日期</code></p> <p><code>start_station </code><code>=</code> <code>'深圳'</code>          <code>#购票出发站</code></p> <p><code>end_station </code><code>=</code> <code>'长沙南'</code>          <code>#购票目的站</code></p> <p><code>password </code><code>=</code> <code>'11234567xyz'</code>        <code>#登录12306的秘密</code></p> <p><code>username </code><code>=</code><code>'xiezhaoyang122700'</code>   <code>#登录12306的账号</code></p> <p><code>trains </code><code>=</code> <code>[</code><code>'G1004'</code><code>, </code><code>'G80'</code><code>, </code><code>'G6028'</code><code>, </code><code>'G6182'</code><code>, </code><code>'G6016'</code><code>]  </code><code>#你想买的班次</code></p> <p><code>#填写基本信息</code></p> </td>
</tr></tbody></table>
<p>本文预订的是2021年9月21日从深圳到长沙南的高铁票，你可以根据自己的实际需要进行调整。由于有些班次的时间过早或过晚，买了也很不方便，所以可以在trains中挑选出你满意的班次进行购票。在这里需要提醒大家，我之前在尝试代码时碰到的坑，那就是时间中如果有个位数要在前面填0。比如2021年9月2日，你在填写购票日期date时要写成'2021-09-02'，否则在运行代码时日期总是填不进去。</p> 
<p><a name="_lab2_1_2"></a></p> 
<h3 id="heading-4">3 登录12306</h3> 
<p>确定好购票的基本信息后，就可以应用python模拟登录12306了，代码如下：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>
<td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> </td>
<td> <p><code>options </code><code>=</code> <code>webdriver.ChromeOptions()</code></p> <p><code>options.add_argument(</code><code>"--disable-blink-features=AutomationControlled"</code><code>)  </code></p> <p><code>browser </code><code>=</code> <code>webdriver.Chrome(options</code><code>=</code><code>options)</code></p> <p><code>browser.maximize_window()</code></p> <p><code>login_url </code><code>=</code> <code>'<a href="https://kyfw.12306.cn/otn/resources/login.html" title="中国铁路12306">中国铁路12306</a>'</code></p> <p><code>#ticket_url = '<a href="https://kyfw.12306.cn/otn/leftTicket/init" title="中国铁路12306">中国铁路12306</a>'</code></p> <p><code>browser.get(login_url)</code></p> <p><code>time.sleep(</code><code>0.5</code><code>)</code></p> <p><code>wait.WebDriverWait(browser, </code><code>5</code><code>).until(EC.element_to_be_clickable((By.CLASS_NAME,</code><code>'login-hd-account'</code><code>))).click()</code></p> <p><code>input_name </code><code>=</code> <code>browser.find_element_by_id(</code><code>'J-userName'</code><code>)</code></p> <p><code>input_pd </code><code>=</code> <code>browser.find_element_by_id(</code><code>'J-password'</code><code>)</code></p> <p><code>input_name.send_keys(username)</code></p> <p><code>input_pd.send_keys(password)</code></p> <p><code>login </code><code>=</code> <code>browser.find_element_by_id(</code><code>'J-login'</code><code>)</code></p> <p><code>login.click()</code></p> <p><code>#登录12306</code></p> </td>
</tr></tbody></table>
<p>整体思路是： </p> 
<p>1.应用python模拟调用google浏览器；</p> 
<p>2.输入12306网址；</p> 
<p>3.等网页加载完全后点击账户密码登录；</p> 
<p>4.找到账号密码的id，把账户密码信息填充进去；</p> 
<p>5.找到登录id，模拟点击登录按钮。</p> 
<p>在这一小节中要注意两个点。</p> 
<p>一、要在python安装目录中放和google版本匹配的chromedriver，供python调用。</p> 
<p>二、要学会找填写账户密码信息的id。</p> 
<p>首先，在google浏览器中输入12306登录网址：</p> 
<p><a href="https://kyfw.12306.cn/otn/resources/login.html" title="中国铁路12306">中国铁路12306</a></p> 
<p>接着点击账户密码登录，会出现如下界面：</p> 
<p style="text-align:center"><img alt="" src="https://images2.imgbox.com/11/40/jUyBIvu0_o.png"></p> 
<p>然后点击红框中的三个点，找到更多工具，点击开发者工具，会出现如下界面：</p> 
<p style="text-align:center"><img alt="" src="https://images2.imgbox.com/b1/b6/Z48H1d0B_o.png"></p> 
<p>点击红框中的箭头，把鼠标移动到账户框上去，就会出现如下界面：</p> 
<p style="text-align:center"><img alt="" src="https://images2.imgbox.com/1d/0e/MLOwzV7a_o.png"></p> 
<p>右边变灰的框里就会出现对应的id，点击账号框，再把鼠标移动到右边变灰的字符上去，点击右键，会出现copy element的选项，复制下来即可。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>
<td> <p>1</p> </td>
<td> <p><code>&lt;</code><code>input</code> <code>type</code><code>=</code><code>"text"</code> <code>class</code><code>=</code><code>"input"</code> <code>id</code><code>=</code><code>"J-userName"</code> <code>placeholder</code><code>=</code><code>"用户名/邮箱/手机号"</code> <code>style</code><code>=</code><code>"height: 44px; line-height: 44px; outline: black 0px;"</code> <code>aria-label</code><code>=</code><code>"请输入用户名／邮箱／手机号"</code> <code>title</code><code>=</code><code>"请输入用户名／邮箱／手机号"</code><code>&gt;</code></p> </td>
</tr></tbody></table>
<p>发现了吗？源代码input_name中要填写的<code>browser.find_element_by_id('J-userName')</code>内容，即为<code>id="J-userName"</code>中的信息。</p> 
<p><a name="_lab2_1_3"></a></p> 
<h3 id="heading-5">4 模拟滑动滑块</h3> 
<p>输入完用户名和密码，点击立即登录后，会出现如下滑块验证要求。</p> 
<p style="text-align:center"><img alt="" src="https://images2.imgbox.com/63/5a/nKR1qKm0_o.png"></p> 
<p>运行如下代码即可拖动滑块进行验证。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>
<td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> </td>
<td> <p><code>browser.implicitly_wait(</code><code>5</code><code>)</code></p> <p><code>print</code><code>(</code><code>'=====开始处理滑动验证码====='</code><code>)</code></p> <p><code>track </code><code>=</code> <code>[</code><code>300</code><code>, </code><code>400</code><code>, </code><code>500</code><code>]  </code></p> <p><code>for</code> <code>i </code><code>in</code> <code>track:</code></p> <p><code>    </code><code>try</code><code>:</code></p> <p><code>        </code><code>btn </code><code>=</code> <code>browser.find_element_by_xpath(</code><code>'//*[@id="nc_1__scale_text"]/span'</code><code>)</code></p> <p><code>        </code><code>ActionChains(browser).drag_and_drop_by_offset(btn,i,</code><code>0</code><code>).perform()</code></p> <p><code>    </code><code>except</code><code>:</code></p> <p><code>        </code><code>time.sleep(</code><code>2</code><code>)  </code></p> <p><code>#拉动滑块验证</code></p> </td>
</tr></tbody></table>
<p>其中，<code>browser.implicitly_wait(5)</code>表示隐性等待5秒，track中放的是滑块拉动的距离。</p> 
<p><a name="_lab2_1_4"></a></p> 
<h3 id="heading-6">5 处理疫情特殊要求</h3> 
<p>完成滑块验证要求后，会出现如下疫情特殊要求提示：</p> 
<p style="text-align:center"><img alt="" src="https://images2.imgbox.com/ac/77/Bz6O80Q1_o.png"></p> 
<p>用如下代码点击确认即可。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>
<td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> </td>
<td> <p><code>browser.implicitly_wait(</code><code>5</code><code>)</code></p> <p><code>browser.find_element_by_xpath(</code><code>'/html/body/div[5]/div[2]/div[3]/a'</code><code>).click()</code></p> <p><code>time.sleep(</code><code>2</code><code>)  </code></p> <p><code>#疫情特殊要求</code></p> </td>
</tr></tbody></table>
<p><code>browser.find_element_by_xpath</code>和id的区别是，在右键复制时要copy XPath或copy full XPath。</p> 
<p><a name="_lab2_1_5"></a></p> 
<h3 id="heading-7">6 点击购票并填写出发地、目的地、出发时间</h3> 
<p>接下来是选择买票，并将出发地、目的地、出发时间等信息填写进去。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>
<td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> </td>
<td> <p><code>browser.find_element_by_xpath(</code><code>'//*[@id="J-chepiao"]/a'</code><code>).click()</code></p> <p><code>browser.find_element_by_xpath(</code><code>'//*[@id="megamenu-3"]/div[1]/ul/li[1]/a'</code><code>).click()</code></p> <p><code>browser.find_element_by_xpath(</code><code>'//*[@id="qd_closeDefaultWarningWindowDialog_id"]'</code><code>).click()</code></p> <p><code>#选择买票</code></p> <p><code>def</code> <code>input_info():</code></p> <p><code>    </code><code>print</code><code>(</code><code>'=====开始买票====='</code><code>)</code></p> <p><code>    </code><code>from_station </code><code>=</code> <code>browser.find_element_by_xpath(</code><code>'//*[@id="fromStationText"]'</code><code>)</code></p> <p><code>    </code><code>from_station.send_keys(Keys.ENTER)</code></p> <p><code>    </code><code>from_station.send_keys(Keys.CONTROL, </code><code>'a'</code><code>)</code></p> <p><code>    </code><code>from_station.send_keys(start_station, Keys.ENTER)</code></p> <p><code>    </code><code>browser.implicitly_wait(</code><code>5</code><code>)</code></p> <p><code>    </code><code>to_station </code><code>=</code> <code>browser.find_element_by_xpath(</code><code>'//*[@id="toStationText"]'</code><code>)</code></p> <p><code>    </code><code>to_station.send_keys(Keys.ENTER)</code></p> <p><code>    </code><code>to_station.send_keys(Keys.CONTROL, </code><code>'a'</code><code>)</code></p> <p><code>    </code><code>to_station.send_keys(end_station, Keys.ENTER)</code></p> <p><code>    </code><code>browser.implicitly_wait(</code><code>5</code><code>)</code></p> <p><code>    </code><code>start_date </code><code>=</code> <code>browser.find_element_by_xpath(</code><code>'//*[@id="train_date"]'</code><code>)</code></p> <p><code>    </code><code>start_date.send_keys(Keys.ENTER)</code></p> <p><code>    </code><code>start_date.send_keys(Keys.CONTROL, </code><code>'a'</code><code>)</code></p> <p><code>    </code><code>start_date.send_keys(Keys.CONTROL, </code><code>'x'</code><code>)</code></p> <p><code>    </code><code>start_date.send_keys(date, Keys.ENTER)</code></p> <p><code>    </code><code>browser.implicitly_wait(</code><code>5</code><code>)</code></p> <p><code>    </code><code>wait.WebDriverWait(browser, </code><code>3</code><code>).until(EC.element_to_be_clickable((By.</code><code>ID</code><code>,</code><code>'query_ticket'</code><code>))).click()</code></p> <p><code>input_info()</code></p> <p><code>input_info()</code></p> <p><code>#将出发地、目的地、出发日期填进去</code></p> </td>
</tr></tbody></table>
<p>得到结果如下：</p> 
<p style="text-align:center"><img alt="" src="https://images2.imgbox.com/3d/86/QBWrGJLo_o.png"></p> 
<p>这里需要注意的是我调用了两遍input_info函数，因为12306可能采取了一些反爬措施，一遍输入进去后查不出东西，显示为灰色。</p> 
<p><a name="_lab2_1_6"></a></p> 
<h3 id="heading-8">7 锁定车票</h3> 
<p>最后是依次查找trains中的车次是否有票，有的话点击购买锁定车票。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>
<td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> </td>
<td> <p><code>trList </code><code>=</code> <code>browser.find_elements_by_xpath(</code><code>".//tbody[@id='queryLeftTable']/tr[not(@datatran)]"</code><code>)</code></p> <p><code>for</code> <code>tr </code><code>in</code> <code>trList:</code></p> <p><code>    </code><code>trainNum </code><code>=</code> <code>tr.find_element_by_class_name(</code><code>"number"</code><code>).text</code></p> <p><code>    </code><code>if</code> <code>trainNum </code><code>in</code> <code>trains:</code></p> <p><code>        </code><code>leftTicket </code><code>=</code> <code>tr.find_element_by_xpath(</code><code>".//td[4]"</code><code>).text</code></p> <p><code>        </code><code>print</code><code>(</code><code>'leftTicket'</code><code>, leftTicket)</code></p> <p><code>        </code><code>if</code> <code>leftTicket </code><code>=</code><code>=</code> <code>'有'</code> <code>or</code> <code>leftTicket.isdigit():</code></p> <p><code>            </code><code>orderBtn </code><code>=</code> <code>tr.find_element_by_class_name(</code><code>"btn72"</code><code>)</code></p> <p><code>            </code><code>orderBtn.click()</code></p> <p><code>            </code><code>browser.implicitly_wait(</code><code>5</code><code>)</code></p> <p><code>            </code><code>passengerLabels </code><code>=</code> <code>browser.find_elements_by_xpath(</code><code>".//ul[@id='normal_passenger_id']/li/label"</code><code>)</code></p> <p><code>            </code><code>for</code> <code>passengerLabel </code><code>in</code> <code>passengerLabels: </code></p> <p><code>                </code><code>name </code><code>=</code> <code>passengerLabel.text</code></p> <p><code>                </code><code>if</code> <code>name </code><code>in</code> <code>names: </code></p> <p><code>                    </code><code>passengerLabel.click() </code></p> <p><code>            </code><code>browser.implicitly_wait(</code><code>20</code><code>)</code></p> <p><code>            </code><code># 获取提交按钮</code></p> <p><code>            </code><code>submitBtn </code><code>=</code> <code>browser.find_element_by_id(</code><code>"submitOrder_id"</code><code>)</code></p> <p><code>            </code><code>submitBtn.click()</code></p> <p><code>            </code><code>browser.implicitly_wait(</code><code>20</code><code>)</code></p> <p><code>            </code><code>confirmBtn </code><code>=</code> <code>browser.find_element_by_id(</code><code>"qr_submit_id"</code><code>)</code></p> <p><code>            </code><code>confirmBtn.click()</code></p> <p><code>            </code><code>time.sleep(</code><code>2</code><code>)</code></p> <p><code>            </code><code>browser.implicitly_wait(</code><code>20</code><code>)</code></p> <p><code>            </code><code>confirmBtn </code><code>=</code> <code>browser.find_element_by_id(</code><code>"qr_submit_id"</code><code>)</code></p> <p><code>            </code><code>confirmBtn.click()</code></p> <p><code>            </code><code>break</code></p> <p><code>#依次查找trains中的车次是否有票，有的话点击购买</code></p> </td>
</tr></tbody></table>
<p>所以，如果你有特别心仪的车次，可以在trains中放在最前面，依次填写觉得还行的车次。至此，应用python解锁抢票软件背后的原理已讲解完毕，感兴趣的朋友可以自己跟着本文实现一遍。</p> 
<p>12306不定期会更新买票界面，所以过一段时间可能之前的代码就要进行一些调整，需要自己弄清里面的原理，才可以以不变应万变。本文的代码没有进行高级的封装，只为大家能更清楚地了解每一步，能在抢票高峰期买到自己心仪的票。</p> 
<p>也写得很基础，没有进一步的调优缩短时效，感兴趣的朋友可以自行研究，如有任何疑问可以跟我沟通。</p> 
<h1 id="%E4%B8%89%E3%80%81%E5%AE%9E%E7%8E%B0%E7%9B%91%E6%8E%A7%E8%B4%AD%E4%B9%B0">三、实现监控购买</h1> 
<p>原代码只能实现购票，我对代码进行了修改，增加了监测和抢票成功推送功能。<br> 需要自行输入12306账号、密码，购买车次、时间、出发站、目的站、server酱key（<a href="https://sct.ftqq.com/upgrade?fr=sc" title="Server酱·Turbo版 (ftqq.com)">Server酱·Turbo版 (ftqq.com)</a>去申请）<br><br> 经测试可成功购票，但有如下问题需要</p> 
<h2 id="%E6%B3%A8%E6%84%8F">注意</h2> 
<p>1.登录测试过多可能会导致滑块验证失败，可自行点击刷新，即可自动执行后续代码（懒得写刷新验证了，只要不是多次运行，一般不会有这个问题）</p> 
<p>2.main（）中，买票buy那一块，因为我是要抢票，等待时间设置为2，如果是监测，建议设置时间长一点，因为有可能被反爬</p> 
<p>3.买票提交按钮可能会有bug，于是我在main中增加了一次选择来确保。但无论如何，进入提交页面你都会收到微信提示，为了保险，建议去看一下是否真的提交了，手动提交也不是不可以。</p> 
<p>4.多人买票请在buy（）函数下names里填入</p> 
<p>5.代码中那么多**code，是我用来标记这段代码是否执行成功，如果没有成功就重复执行，如果code=0，代码没成功，再从头执行，gmcode和code感觉有点重复了，但是，管他呢，能运行就行了， 滑稽.jpg</p> 
<p>6.我只是个业余程序猿，代码改的丑陋，我尽量写的通俗易懂了，大佬勿喷。</p> 
<h2 id="%E7%8E%AF%E5%A2%83">
<br> 环境</h2> 
<p>（食用本代码需要一定的基础知识，新手估计挺难得）</p> 
<ul>
<li>python3</li>
<li>webdriver</li>
</ul>
<p>以及一些库，我用pycharm，没有的库可以直接导入<br> 还有，我觉得最主要的就是webdriver，自己有的话更好，配置的话可能需要很久时间，也挺麻烦的</p> 
<p></p> 
<h2 id="%E4%BB%A3%E7%A0%81">代码</h2> 
<pre><code class="language-python"># -*- coding:utf-8 -*-
import json
import requests
import time
from captcha import *
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support import wait
from selenium.webdriver.common.keys import Keys
from selenium.common.exceptions import NoSuchElementException
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.support import expected_conditions as EC
 
 
 
 
# 定义一系列code来确保每一步执行成功再进入下一步
global logincode, hkcode, yzcode, xpcode, cpcode, gmcode, code
 
 
# 初始化
def init_program():
    options = webdriver.ChromeOptions()
    options.add_argument("--disable-blink-features=AutomationControlled")
    browser = webdriver.Chrome(options=options)
    browser.maximize_window()
 
    return browser
 
 
# 登录12306
def login(browser):
    global logincode
    logincode = 0
    password = ''  # 登录12306的秘密
    username = ''  # 登录12306的账号
    login_url = 'https://kyfw.12306.cn/otn/resources/login.html'
    # ticket_url = 'https://kyfw.12306.cn/otn/leftTicket/init'
    try:
        browser.get(login_url)
        time.sleep(0.5)
        wait.WebDriverWait(browser, 5).until(EC.element_to_be_clickable((By.CLASS_NAME, 'login-hd-code'))).click()
        input_name = browser.find_element_by_id('J-userName')
        input_pd = browser.find_element_by_id('J-password')
        input_name.send_keys(username)
        input_pd.send_keys(password)
        login = browser.find_element_by_id('J-login')
        login.click()
        logincode = 1
    except Exception as e:
        logincode = 0
        print(e)
 
     
 
 
# 拉动滑块验证
def huakuai(browser):
    global hkcode
    hkcode = 0
    try:
        browser.implicitly_wait(5)
        print('=====开始处理滑动验证码=====')
        track = [300, 400, 500]
        for i in track:
            try:
                btn = browser.find_element_by_xpath('//*[@id="nc_1__scale_text"]/span')
                ActionChains(browser).drag_and_drop_by_offset(btn, i, 0).perform()
                hkcode = 1
            except:
                time.sleep(2)
    except Exception as e:
        hkcode = 0
        print(e)
     
 
# 疫情特殊要求
def yiqingyaoqiu(browser):
    global yzcode
    yzcode = 0
    try:
        browser.implicitly_wait(5)
        try:
            browser.find_element_by_xpath('/html/body/div[4]/div[2]/div[3]/a').click()
            yzcode = 1
        except:
            try:
                browser.find_element_by_xpath('/html/body/div[2]/div[7]/div[2]/div[3]/a').click()
                yzcode = 1
            except:
                yzcode = 0
        finally:
            time.sleep(2)
    except Exception as e:
        yzcode = 0
        print(e)
     
 
 
# 进入买票页面
def enterbuy(browser):
    global xpcode
    xpcode = 0
    try:
        browser.find_element_by_xpath('//*[@id="J-chepiao"]/a').click()
        browser.find_element_by_xpath('//*[@id="megamenu-3"]/div[1]/ul/li[1]/a').click()
        browser.find_element_by_xpath('//*[@id="qd_closeDefaultWarningWindowDialog_id"]').click()
        xpcode = 1
    except Exception as e:
        print(e)
        xpcode = 0
     
 
 
# 将出发地、目的地、出发日期填进去
def input_info(browser):
    global cpcode
    cpcode = 0
 
    date = '2022-01-24'  # 填写购票日期
    start_station = ''  # 购票出发站，例如南京南
    end_station = ''  # 购票目的站
    try:
        print('=====开始买票=====')
        from_station = browser.find_element_by_xpath('//*[@id="fromStationText"]')
        from_station.send_keys(Keys.ENTER)
        from_station.send_keys(Keys.CONTROL, 'a')
        from_station.send_keys(start_station, Keys.ENTER)
        browser.implicitly_wait(5)
        to_station = browser.find_element_by_xpath('//*[@id="toStationText"]')
        to_station.send_keys(Keys.ENTER)
        to_station.send_keys(Keys.CONTROL, 'a')
        to_station.send_keys(end_station, Keys.ENTER)
        browser.implicitly_wait(5)
        start_date = browser.find_element_by_xpath('//*[@id="train_date"]')
        start_date.send_keys(Keys.ENTER)
        start_date.send_keys(Keys.CONTROL, 'a')
        start_date.send_keys(Keys.CONTROL, 'x')
        start_date.send_keys(date, Keys.ENTER)
        browser.implicitly_wait(5)
        wait.WebDriverWait(browser, 3).until(EC.element_to_be_clickable((By.ID, 'query_ticket'))).click()
        cpcode = 1
    except Exception as e:
        print(e)
        cpcode = 0
 
 
 
 
# 依次查找trains中的车次是否有票，有的话点击购买
def buy(browser):
    global gmcode, code
    gmcode = 0
    code = 0
    purpose = 'ADULT'  # 购买成人票，如果是学生票，需调整代码
    names = ['']  # 填写购票人姓名，需要在你的乘车人管理里有的
    trains = []  # 你想买的班次，例如'D666',  'G666'
    browser.implicitly_wait(5)
    try:
        trList = browser.find_elements_by_xpath(".//tbody[@id='queryLeftTable']/tr[not(@datatran)]")
        for tr in trList:
            trainNum = tr.find_element_by_class_name("number").text
            if trainNum in trains:
                leftTicket = tr.find_element_by_xpath(".//td[4]").text
                print('leftTicket', leftTicket)
                if leftTicket == '有' or leftTicket.isdigit():
                    orderBtn = tr.find_element_by_class_name("btn72")
                    orderBtn.click()
                    browser.implicitly_wait(5)
                    passengerLabels = browser.find_elements_by_xpath(".//ul[@id='normal_passenger_id']/li/label")
                    for passengerLabel in passengerLabels:
                        name = passengerLabel.text
                        if name in names:
                            passengerLabel.click()
                    browser.implicitly_wait(20)
                    # 获取提交按钮
                    submitBtn = browser.find_element_by_id("submitOrder_id")
                    submitBtn.click()
                    browser.implicitly_wait(20)
                    confirmBtn = browser.find_element_by_id("qr_submit_id")
                    confirmBtn.click()
                    time.sleep(2)
                    browser.implicitly_wait(20)
                    confirmBtn = browser.find_element_by_id("qr_submit_id")
                    confirmBtn.click()
                    code = 1
                    gmcode = 1
                    break
 
    except Exception as e:
        print(e)
        gmcode = 0
     
 
 
def tuisong():
    api = "https://sctapi.ftqq.com/*****.send" #*****替换成你的微信server酱的key，可以实现购票成功推送，然后你就自己去12306付款
 
    title = '购买成功'
 
    data = {
        "text": title
    }
    req = requests.post(api, data=data)
 
 
if __name__ == "__main__":
    global logincode, yzcode, hkcode, xpcode, cpcode, gmcode, code
    code = 0
    logincode = 0
    yzcode = 0
    hkcode = 0
    xpcode = 0
    cpcode = 0
    gmcode = 0
    browser = init_program()
    while code == 0:
        while logincode == 0:
            login(browser)
            print('logincode:', logincode)
 
        while hkcode == 0:
            huakuai(browser)
            print('hkcode:', hkcode)
 
        while yzcode == 0:
            yiqingyaoqiu(browser)
            print('yzcode:', yzcode)
 
        while xpcode == 0:
            enterbuy(browser)
            print('xpcode:', xpcode)
 
        while cpcode == 0:
            input_info(browser)
            input_info(browser)#经测试，一次有可能不成功，我直接两次提交
            print('cpcode:', cpcode)
 
        while gmcode == 0:
            buy(browser)
            print('gmcode:', gmcode)
            print('code:', code)
            if gmcode == 0:
                browser.refresh()
                time.sleep(2)
                browser.find_element_by_xpath('//*[@id="qd_closeDefaultWarningWindowDialog_id"]').click()
                input_info(browser)
                input_info(browser)
            else:
                try:
                    print('tijiao')
                    confirmBtn = browser.find_element_by_id("qr_submit_id")
                    browser.implicitly_wait(20)
                    time.sleep(3)
                    confirmBtn.click()
                except:pass
 
 
 
        if code == 1:
            tuisong()
            break</code></pre> 
<p><img alt="" height="764" src="https://images2.imgbox.com/20/80/sYvDwEfI_o.png" width="1200"></p> 
<p></p>
                </div>

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Rocky Linux操作指南 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Rocky Linux操作指南</h1>
			
		</header>
		<div class="content post__content clearfix">
			


        
                <div id="content_views" class="markdown_views prism-atom-one-light">
                    
                        
                    
                    <h3>
<a id="rocky_Linux_Ubuntucentosrocky_Linux_centos8centos8____rhel8__rocky8_0"></a>rocky Linux 相信还有一些同学会比较陌生。好像平常只听说过Ubuntu和centos。rocky Linux 是个什么东西呢。它其实就是centos8的更稳定版本：centos8 测试版 --&gt; rhel8 --&gt; rocky8</h3> 
<h3>
<a id="rocky86_1"></a>它现在已经更新到了第九代的一个版本，我们暂时先不用那么高的。先用rocky8.6版本熟悉一下基础的操作。</h3> 
<p><img src="https://images2.imgbox.com/9d/bc/HMRZaZWr_o.png" alt="在这里插入图片描述"></p> 
<h2>
<a id="httpsdeveloperaliyuncommirrorrockyhttpsdeveloperaliyuncommirrorrocky_4"></a>阿里云镜像下载地址：<a href="https://developer.aliyun.com/mirror/rocky">https://developer.aliyun.com/mirror/rocky</a>
</h2> 
<h2>
<a id="rockyhttpsrockylinuxorgdownloadhttpsrockylinuxorgdownload_5"></a>rocky官方下载地址：<a href="https://rockylinux.org/download/">https://rockylinux.org/download/</a>
</h2> 
<h2>
<a id="_7"></a>新特性</h2> 
<p>CentOS 8 新特性</p> 
<ul>
<li>DNF 成为了默认的软件包管理器，同时 yum 仍然是可用的（yum 是 dnf 的链接）</li>
<li>使用网络管理器（nmcli 和 nmtui）进行网络配置，移除了网络脚本</li>
<li>使用 Podman 进行容器管理</li>
<li>引入了两个新的包仓库：BaseOS 和 AppStream</li>
<li>使用 Cockpit 作为默认的系统管理工具</li>
<li>默认使用 Wayland 作为显示服务器</li>
<li>iptables 将被 nftables 取代</li>
<li>使用 Linux 内核 4.18</li>
<li>动态编程语言、Web 和数据库服务器<br> Python 3.6 是默认的 Python 环境，有限支持 Python 2.7<br> Node.js 是在 RHEL 最新包含的，其他动态语言更新包括: PHP 7.2 , Ruby 2.5 , Perl 5.26 , SWIG 3.0<br> RHEL 8 提供的数据库服务包括：MariaDB 10.3 , MySQL 8.0 , PostgreSQL 10 , PostgreSQL 9.6 , 和 Redis 5<br> RHEL 8 提供 Apache HTTP Server 2.4 以及首次引入的, nginx 1.14<br> Squid 版本升级到 4.4 ，同时也首次提供 Varnish Cache 6.0</li>
</ul> 
<h2>
<a id="_24"></a>一、系统配置</h2> 
<h4>
<a id="1__25"></a>1. 格式化网卡命名</h4> 
<p>即禁用 consistent interface device naming</p> 
<pre><code>**要点：与 CentOS 7 配置上略有不同。**

CentOS 7：net.ifnames=0 biosdevname=0
CentOS 8：net.ifnames=0
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span> <span class="token builtin class-name">cd</span> /etc/sysconfig/network-scripts/
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span> <span class="token function">ls</span>
ifcfg-ens33
</code></pre> 
<p>注意这里的名称根据硬件有所变动，这里是 vm 环境，本次名称为 ens33，如果你希望继续使用 eth0 这样的传统名称，那么在安装启动时加上参数：net.ifnames=0</p> 
<blockquote> 
 <h4>
<a id="_CentOS_7__systemd__udev___CONSISTENT_NETWORK_DEVICE_NAMING_enp5s0_40"></a>这里是引用这种变化的原因，从 CentOS 7 开始，是由于 systemd 和 udev 引入了一种新的网络设备命名方式 – 一致网络设备命名（CONSISTENT NETWORK DEVICE NAMING）。可以根据固件、拓扑、位置信息来设置固定名字，带来的好处是命名自动化，名字完全可预测，在硬件坏了以后更换也不会影响设备的命名，这样可以让硬件的更换无缝化。带来的不利是新的设备名称比传统的名称难以阅读。比如新的名称是 enp5s0.</h4> 
</blockquote> 
<p>Rocky Linux 8 grub 默认配置如下：</p> 
<pre><code class="prism language-bash"><span class="token comment"># cat /etc/default/grub</span>
<span class="token assign-left variable">GRUB_TIMEOUT</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">GRUB_DISTRIBUTOR</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">sed</span><span class="token string">'s, release .*$,,g'</span>/etc/system-release<span class="token variable">)</span></span>"</span>
<span class="token assign-left variable">GRUB_DEFAULT</span><span class="token operator">=</span>saved
<span class="token assign-left variable">GRUB_DISABLE_SUBMENU</span><span class="token operator">=</span>true
<span class="token assign-left variable">GRUB_TERMINAL_OUTPUT</span><span class="token operator">=</span><span class="token string">"console"</span>
<span class="token assign-left variable">GRUB_CMDLINE_LINUX</span><span class="token operator">=</span><span class="token string">"crashkernel=auto resume=/dev/mapper/rl-swap rd.lvm.lv=rl/root rd.lvm.lv=rl/swap"</span>
<span class="token assign-left variable">GRUB_DISABLE_RECOVERY</span><span class="token operator">=</span><span class="token string">"true"</span>
<span class="token assign-left variable">GRUB_ENABLE_BLSCFG</span><span class="token operator">=</span>true
</code></pre> 
<p>不同于 CentOS 8，没有 <strong>rhgb quiet</strong></p> 
<blockquote> 
 <h4>
<a id="rhgb__redhat_graphics_boot_dmesg__56"></a>rhgb 表示 redhat graphics boot，就是会看到图片来代替启动过程中显示的文本信息，这些信息在启动后用 dmesg 也可以看到</h4> 
 <h4>
<a id="quiet__57"></a>quiet 表示在启动过程中只有重要信息显示，类似硬件自检的消息不会显示</h4> 
</blockquote> 
<h4>
<a id="11__grub__58"></a>1.1 编辑 grub 配置文件</h4> 
<pre><code class="prism language-bash"> 如果系统已经安装，希望改成 eth0 这样的名称，那么需要：
 修改 grub2 启动参数
 <span class="token function">vi</span> /etc/default/grub
 也有文章修改 /etc/sysconfig/grub，该文件是 /etc/default/grub 的链接
 增加内容：net.ifnames<span class="token operator">=</span><span class="token number">0</span>
 原内容：
<span class="token assign-left variable">GRUB_CMDLINE_LINUX</span><span class="token operator">=</span><span class="token string">"crashkernel=auto resume=/dev/mapper/rl-swap rd.lvm.lv=rl/root rd.lvm.lv=rl/swap"</span>
 修改后 <span class="token punctuation">(</span>位置并没有严格要求，一般添加在最后面即可<span class="token punctuation">)</span>：
<span class="token assign-left variable">GRUB_CMDLINE_LINUX</span><span class="token operator">=</span><span class="token string">"crashkernel=auto resume=/dev/mapper/rl-swap rd.lvm.lv=rl/root rd.lvm.lv=rl/swap net.ifnames=0"</span>
保存
:x
</code></pre> 
<p>因为默认没有 rhgb quiet 参数，以下仅适用于 CentOS</p> 
<pre><code class="prism language-bash"> 直接用 <span class="token function">sed</span> 命令替换
 CentOS <span class="token number">8</span>
<span class="token function">sed</span> -i <span class="token string">'s/rhgb/net.ifnames=0 rhgb/'</span> /etc/default/grub
 CentOS <span class="token number">7</span>
<span class="token function">sed</span> -i <span class="token string">'s/rhgb/net.ifnames=0 biosdevname=0 rhgb/'</span> /etc/default/grub
</code></pre> 
<h4>
<a id="12__grubcfg__82"></a>1.2 运行如下命令重建 grub.cfg 文件</h4> 
<pre><code class="prism language-bash"><span class="token comment"># legacy boot mode:</span>
grub2-mkconfig -o /boot/grub2/grub.cfg

<span class="token comment"># UEFI boot mode:</span>
grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg
</code></pre> 
<h4>
<a id="13__91"></a>1.3 重命名网卡配置文件</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 重新对文件进行命名：</span>
<span class="token builtin class-name">cd</span> /etc/sysconfig/network-scripts/
<span class="token function">mv</span> ifcfg-ens33 ifcfg-eth0
<span class="token function">vi</span> ifcfg-eth0
编辑 <span class="token assign-left variable">NAME</span><span class="token operator">=</span>eth0
编辑 <span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth0
注释 HWADDR，如果有
</code></pre> 
<h5>
<a id="14__102"></a>1.4 重启生效</h5> 
<pre><code class="prism language-bash"><span class="token function">reboot</span>
</code></pre> 
<p>重新登录后，执行命令 nmcli 可以看到网卡名称已经变成 “eth0”，则配置成功。</p> 
<h2>
<a id="__108"></a>二、 配置网络</h2> 
<h4>
<a id="21__ifcfg_nmcli__109"></a>2.1 方法一：手工配置 ifcfg，使用 nmcli 来生效新的网络配置</h4> 
<p>安装过程中最好配置好网络，如果需要编辑网络，修改配置文件如下：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span> <span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-eth0

<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">PROXY_METHOD</span><span class="token operator">=</span>none
<span class="token assign-left variable">BROWSER_ONLY</span><span class="token operator">=</span>no
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none  <span class="token comment">#static，使用静态 IP 配置（CentOS 8 这里是 none 也是静态）</span>
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_AUTOCONF</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6_ADDR_GEN_MODE</span><span class="token operator">=</span>stable-privacy
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>eth0
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>34f808f1-1232-4900-83db-82d32533f776
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth0
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes  <span class="token comment">#开机自动启用网络连接</span>
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">10.3</span>.5.5  <span class="token comment">#IP 地址</span>
<span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token number">24</span>  <span class="token comment">#掩码</span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">10.3</span>.5.1  <span class="token comment">#默认网关</span>
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">10.3</span>.5.11  <span class="token comment">#DNS 服务器</span>
<span class="token assign-left variable">DNS2</span><span class="token operator">=</span><span class="token number">10.3</span>.5.12  <span class="token comment">#备用 NDS 服务器</span>
<span class="token assign-left variable">DOMAIN</span><span class="token operator">=</span>sysin.org  <span class="token comment">#域名</span>
<span class="token assign-left variable">IPV6_PRIVACY</span><span class="token operator">=</span>no
</code></pre> 
<pre><code class="prism language-bash">nmcli c reload  <span class="token comment">#重新加载网络配置</span>

<span class="token function">ping</span> www.baidu.com  <span class="token comment">#测试网络是否正常</span>

<span class="token function">ip</span> addr  <span class="token comment">#查看 IP 地址</span>
</code></pre> 
<p>重启网络</p> 
<blockquote> 
 <h4>
<a id="_nmcli_c_reload__148"></a>比如配置了静态路由，使用 nmcli c reload 无法生效，需要重启网络</h4> 
</blockquote> 
<pre><code class="prism language-bash">systemctl restart NetworkManager.service
nmcli networking off <span class="token operator">&amp;&amp;</span> nmcli networking on
</code></pre> 
<blockquote> 
 <h4>
<a id="CentOS_8___systemctl_restart_network__155"></a>注意：CentOS 8 (默认安装) 重启网络 “systemctl restart network” 已经不可用。</h4> 
</blockquote> 
<p>CentOS 8 网卡命令 (CentOS 7 也可用)</p> 
<pre><code class="prism language-bash">nmcli n  <span class="token comment">#查看 nmcli 状态</span>
nmcli n on  <span class="token comment">#启动 nmcli</span>
nmcli c up eth0  <span class="token comment">#启动网卡 eth0</span>
nmcli c down eth0  <span class="token comment">#关闭网卡 eth0</span>
nmcli d c eth0  <span class="token comment">#激活网卡</span>
nmcli d show eth0  <span class="token comment">#查看网卡 eth0 信息</span>
nmcli r all off  <span class="token comment">#关闭无线</span>
</code></pre> 
<h4>
<a id="22_RHEL8CentOS8__nmcli__167"></a>2.2 方法二：RHEL8/CentOS8 完全使用 nmcli 来管理网络</h4> 
<p>nmcli 命令帮助：</p> 
<p>命令不支持自动补全，但是可以通过 - h 参数逐步获得帮助</p> 
<pre><code class="prism language-bash"><span class="token comment">## 说明 nmcli 后面的命令关键字都可以用第一个字母简写来标识，例如：</span>
<span class="token comment">## nmcli connection = nmcli c</span>
<span class="token comment">## nmcli connection show --active = nmcli c s --a</span>
nmcli -h
nmcli connection -h
nmcli connection <span class="token function">add</span> -h
nmcli connection modify -h
</code></pre> 
<p><strong>创建一个完整的配置文件：</strong></p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">IFACE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>nmcli dev<span class="token operator">|</span><span class="token function">grep</span> ethernet<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">`</span></span>
nmcli con delete <span class="token variable">$IFACE</span>
<span class="token comment"># 下面将使用传统的 eth0 命名方式，前提是已经做了格式化网卡名称的配置</span>
nmcli con <span class="token function">add</span> con-name eth0 ifname eth0 <span class="token builtin class-name">type</span> ethernet autoconnect <span class="token function">yes</span>

nmcli connection modify eth0 ipv4.method manual 
ipv4.addresses <span class="token number">10.3</span>.5.5/24 
ipv4.dns <span class="token string">"10.3.5.11, 10.3.5.12"</span> 
ipv4.gateway <span class="token number">10.3</span>.5.1 
ipv4.dns-search sysin.org

nmcli c up eth0
nmcli c reload
</code></pre> 
<p>可以配置的参数选项：<br> ipv4.[method, dns, dns-search, dns-options, dns-priority, addresses, gateway, routes, route-metric, route-table, ignore-auto-routes, ignore-auto-dns, dhcp-client-id, dhcp-timeout, dhcp-send-hostname, dhcp-hostname, dhcp-fqdn, never-default, may-fail, dad-timeout]</p> 
<p><strong>nmcli 示例命令参考：</strong></p> 
<pre><code class="prism language-bash"><span class="token comment"># 查看网卡信息</span>
nmcli connection
NAME    UUID                                  TYPE      DEVICE
eth0    db05ccae-3a48-4300-b3a6-7c56429c4f54  ethernet  eth0
<span class="token comment"># 显示具体的网络接口信息</span>
nmcli connection show eth0
<span class="token comment"># 显示所有活动连接</span>
nmcli connection show --active
<span class="token comment"># 删除一个网卡连接</span>
nmcli connection delete eth0
<span class="token comment"># 创建一个网卡连接</span>
<span class="token assign-left variable">IFACE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>nmcli dev<span class="token operator">|</span><span class="token function">grep</span> ethernet<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">`</span></span>
nmcli con delete <span class="token variable">$IFACE</span>
nmcli con <span class="token function">add</span> con-name <span class="token string">"<span class="token variable">$IFACE</span>"</span> ifname <span class="token string">"<span class="token variable">$IFACE</span>"</span> <span class="token builtin class-name">type</span> ethernet autoconnect <span class="token function">yes</span>
<span class="token comment"># 给 eth0 添加一个 IP 和子网掩码（NETMASK）</span>
nmcli connection modify eth0 ipv4.addresses <span class="token number">10.3</span>.5.5/24
<span class="token comment"># 给 eth0 添加两个 IP 地址和掩码</span>
nmcli connection modify eth0 ipv4.addresses <span class="token string">"10.3.5.5/24, 10.3.5.6/24"</span>
<span class="token comment"># IP 获取方式设置成手动（BOOTPROTO=static/none）</span>
nmcli connection modify eth0 ipv4.method manual
<span class="token comment"># 添加一个 ipv4</span>
nmcli connection modify eth0 +ipv4.addresses <span class="token number">10.3</span>.5.6/24
<span class="token comment"># 删除一个 ipv4</span>
nmcli connection modify eth0 -ipv4.addresses <span class="token number">10.3</span>.5.6/24
<span class="token comment"># 添加 DNS</span>
nmcli connection modify eth0 ipv4.dns <span class="token number">10.3</span>.5.11
<span class="token comment"># 同时添加两个 DNS</span>
nmcli connection modify eth0 ipv4.dns <span class="token string">"10.3.5.11, 10.3.5.12"</span>
<span class="token comment"># 删除 DNS</span>
nmcli connection modify eth0 -ipv4.dns <span class="token number">10.3</span>.5.11
<span class="token comment"># 删除第一个 DNS</span>
nmcli connection modify eth0 -ipv4.dns <span class="token number">1</span>
<span class="token comment"># 添加一个网关（GATEWAY）</span>
nmcli connection modify eth0 ipv4.gateway <span class="token number">10.3</span>.5.1
<span class="token comment"># 都可以同时写，例如：</span>
nmcli connection modify eth0 ipv4.dns <span class="token number">10.3</span>.5.11 ipv4.gateway <span class="token number">10.3</span>.5.1
<span class="token comment"># 域名 dns-search，对应 ifcfg 中的 DOMAIN</span>
nmcli connection modify eth0 ipv4.dns-search sysin.org

<span class="token comment"># 使用 nmcli 重新回载网络配置</span>
nmcli c reload
<span class="token comment"># 如果之前没有 eth0 的 connection，则上一步 reload 后就已经自动生效了</span>
nmcli c up eth0
</code></pre> 
<h4>
<a id="23__ifcfg_networkservice__248"></a>2.3 方法三：手工配置 ifcfg，安装 network.service 服务</h4> 
<p>可以通过 yum install network-scripts 来安装传统的 network.service，不过 redhat 说了，在下一个 RHEL 的大版本里将彻底废除，因此不建议使用 network.service。</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> network-scripts
<span class="token function">service</span> network restart   <span class="token comment">#重启网络服务</span>
systemctl restart network.service   <span class="token comment">#重启网络服务</span>
</code></pre> 
<h2>
<a id="_256"></a>三、修改主机名</h2> 
<p>说明：与 CentOS 7 方法相同</p> 
<ul><li>即时生效</li></ul> 
<pre><code class="prism language-bash"><span class="token function">hostname</span>  sysin  <span class="token comment">#设置主机名为 sysin</span>
</code></pre> 
<ul><li>永久生效</li></ul> 
<pre><code class="prism language-bash"><span class="token function">vi</span> /etc/hostname <span class="token comment">#编辑配置文件</span>
sysin   <span class="token comment">#修改 localhost.localdomain 为 sysin</span>
:x  <span class="token comment">#保存退出</span>

或者使用命令：<span class="token variable"><span class="token variable">`</span>hostnamectl set-hostname sysin<span class="token variable">`</span></span>

同时修改 hosts 文件：
<span class="token function">vi</span> /etc/hosts <span class="token comment">#编辑配置文件</span>
<span class="token number">127.0</span>.0.1   sysin   <span class="token comment">#增加一条</span>
:x  <span class="token comment">#保存退出</span>
</code></pre> 
<ul><li>通过命令快速修改示例</li></ul> 
<pre><code class="prism language-bash">hostnamectl set-hostname sysin
<span class="token comment"># 主机名这里是 sysin，替换实际名称直接执行</span>
<span class="token assign-left variable">NICName</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ip</span> <span class="token function">add</span><span class="token operator">|</span><span class="token function">egrep</span> global<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $NF}'</span><span class="token operator">|</span><span class="token function">head</span> -n <span class="token number">1</span><span class="token variable">`</span></span>
<span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ip</span> <span class="token function">add</span><span class="token operator">|</span><span class="token function">grep</span> global<span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">'[/]+'</span> <span class="token string">'{ print $3 }'</span><span class="token operator">|</span><span class="token function">head</span> -n <span class="token number">1</span><span class="token variable">`</span></span>
<span class="token assign-left variable">Hostname</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">hostname</span><span class="token variable">`</span></span>
<span class="token assign-left variable">HostnameAll</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">hostname</span> --fqdn<span class="token variable">`</span></span> <span class="token comment">#注意这里 `` 不是引号</span>
<span class="token builtin class-name">echo</span>  <span class="token string">"网卡名称:<span class="token variable">$NICName</span>"</span>
<span class="token builtin class-name">echo</span>  <span class="token string">"IP 地址:  <span class="token variable">$IP</span>"</span>
<span class="token builtin class-name">echo</span>  <span class="token string">"主机名称:  <span class="token variable">$Hostname</span> <span class="token variable">$HostnameAll</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$IP</span>   <span class="token variable">$Hostname</span> <span class="token variable">$HostnameAll</span>"</span><span class="token operator">&gt;&gt;</span>/etc/hosts
</code></pre> 
<h2>
<a id="_cockpit_web_console_295"></a>四、激活 cockpit web console</h2> 
<p>CentOS 8 默认集成了 cockpit，登录画面提示激活方法（模板未启用）：</p> 
<pre><code class="prism language-bash">systemctl <span class="token builtin class-name">enable</span> --now cockpit.socket
</code></pre> 
<blockquote> 
 <h4>
<a id="httpIP9090_302"></a>然后通过浏览器访问：http://:9090</h4> 
</blockquote> 
<p><strong>补充说明：</strong></p> 
<pre><code class="prism language-bash">Cockpit（飞机驾驶舱）使用方法
在 web 浏览器中查看服务器并使用鼠标执行系统任务。很容易管理存储、配置网络和检查日志等操作。

<span class="token number">1</span><span class="token punctuation">)</span> RHEL <span class="token number">8</span> 自动安装了 Cockpit，Cockpit 所需的防火墙端口会自动打开
<span class="token number">2</span><span class="token punctuation">)</span> Cockpit 界面可用于将基于策略的解密（PBD）规则应用于受管系统上的磁盘
<span class="token number">3</span><span class="token punctuation">)</span> 对于在身份管理（IdM）域中注册的系统，Cockpit 默认使用域的集中管理的 IdM 资源
<span class="token number">4</span><span class="token punctuation">)</span> Cockpit 菜单和页面可以在移劢浏览器上导航
<span class="token number">5</span><span class="token punctuation">)</span> 可以从 Cockpit Web 界面创建和管理虚拟机
<span class="token number">6</span><span class="token punctuation">)</span> 现在可以将 “虚拟机” 页面添加到 Cockpit 界面，该界面使用户可以创建和管理基于 libvirt 的虚拟机

安装 cockpit
<span class="token variable"><span class="token variable">`</span>yum -y <span class="token function">install</span> cockpit<span class="token variable">`</span></span>

启用 cockpit
<span class="token variable"><span class="token variable">`</span>systemctl <span class="token builtin class-name">enable</span> --now cockpit.socket<span class="token variable">`</span></span>

设置开机自启动同时开启服务一条命令就可以搞定

使用 Cockpit
Cockpit 监听 <span class="token number">9090</span> 端口
使用浏览器访问 <span class="token variable"><span class="token variable">`</span>http://<span class="token operator">&lt;</span>IP<span class="token operator">&gt;</span>:9090<span class="token variable">`</span></span>
</code></pre> 
<h2>
<a id="SELINUX_328"></a>五、关闭SELINUX</h2> 
<pre><code class="prism language-bash"><span class="token function">vi</span> /etc/selinux/config
<span class="token comment"># SELINUX=enforcing       #注释掉</span>
<span class="token comment"># SELINUXTYPE=targeted    #注释掉</span>
<span class="token assign-left variable">SELINUX</span><span class="token operator">=</span>disabled         <span class="token comment">#增加</span>
:x  <span class="token comment">#保存，关闭</span>
setenforce <span class="token number">0</span> <span class="token comment">#使配置立即生效，或者重启系统</span>
<span class="token comment">#shutdown -r now   #重启系统生效</span>

sestatus  <span class="token comment">#查看状态</span>

<span class="token comment"># 直接使用 sed 命令修改</span>
<span class="token comment"># 修改 ELINUX=enforcing 为 SELINUX=disabled，即替换行</span>
<span class="token function">sed</span> -i <span class="token string">'/^SELINUX=.*/c SELINUX=disabled'</span> /etc/selinux/config
<span class="token comment"># 或者：sed -i '/^SELINUX=enforcing/c SELINUX=disabled' /etc/selinux/config</span>
<span class="token comment"># 注释 SELINUXTYPE=targeted</span>
<span class="token function">sed</span> -i <span class="token string">'s/^SELINUXTYPE=targeted/#&amp;/'</span> /etc/selinux/config
</code></pre> 
<h2>
<a id="firewalld_348"></a>六、配置firewalld</h2> 
<p><strong>关闭 firewalld（模板配置）</strong><br> CentOS 8 主要改动和 RedHat Enterprise Linux 8 是一致的，基于 Fedora 28 和内核版本 4.18，其中网络方面的主要改动是用 nftables 框架替代 iptables 框架作为默认的网络包过滤工具。</p> 
<pre><code class="prism language-bash">systemctl stop firewalld.service  <span class="token comment">#停止 firewall</span>
systemctl disable firewalld.service  <span class="token comment">#禁止 firewall 开机启动</span>
firewall-cmd --state  <span class="token comment">#查看状态</span>
</code></pre> 
<p><strong>firewalld 常用命令（nftables 使用 nft 命令，参看其他文档）</strong><br> CentOS 8 中 firewalld 已经与 iptables 解绑，后端改用 nftables，需要用 nft 或者 firewall-cmd 开放端口或者服务。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查看配置</span>
firewall-cmd --list-all

firewall-cmd --list-services  <span class="token comment">#默认开放：ssh dhcpv6-client</span>
firewall-cmd --zone<span class="token operator">=</span>public --list-services  <span class="token comment">#指定区域进行查看</span>
firewall-cmd --list-ports
firewall-cmd --zone<span class="token operator">=</span>public --list-ports  <span class="token comment">#指定区域进行查看</span>

<span class="token comment"># 查看配置保存文件</span>
<span class="token function">cat</span> /etc/firewalld/zones/public.xml

<span class="token comment"># 添加一个 TCP 端口 (删除将 add 关键字修改为 remove)</span>
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp --permanent  <span class="token comment">#--permanent 表示永久生效</span>
firewall-cmd --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp --permanent  <span class="token comment">#与上面是等价的，默认 zone 为 pulic</span>
firewall-cmd --reload  <span class="token comment">#重新加载配置生效</span>

<span class="token comment"># 关于 zone</span>
firewall-cmd --get-zones  <span class="token comment">#查看所有 zone 的命令，CentOS 7 一共有 9 个 zone</span>
block dmz drop external home internal public trusted work
firewall-cmd --get-zones  <span class="token comment">##CentOS 8 有 10 个 zone</span>
block dmz drop external home internal libvirt public trusted work
firewall-cmd --get-default-zone  <span class="token comment">#查看默认的 zone 的命令</span>
public

<span class="token comment"># 添加一个服务</span>
firewall-cmd --add-service<span class="token operator">=</span>snmp --permanent
firewall-cmd --reload
firewall-cmd --get-services  <span class="token comment">#查看可用的服务</span>

<span class="token comment"># 限定源地址访问</span>
firewall-cmd --add-rich-rule<span class="token operator">=</span><span class="token string">"rule family="</span>ipv4<span class="token string">"source address="</span><span class="token number">192.168</span>.1.0/24<span class="token string">"port protocol="</span>tcp<span class="token string">"port="</span><span class="token number">3306</span><span class="token string">"accept"</span> --permanent
firewall-cmd --reload
</code></pre> 
<p><strong>添加几个常用的服务：</strong></p> 
<pre><code class="prism language-bash">firewall-cmd --add-service<span class="token operator">=</span>snmp --permanent
firewall-cmd --add-service<span class="token operator">=</span>http --permanent
firewall-cmd --add-service<span class="token operator">=</span>https --permanent
firewall-cmd --reload
</code></pre> 
<p><strong>禁 Ping：</strong></p> 
<pre><code class="prism language-bash">firewall-cmd --permanent --add-rich-rule<span class="token operator">=</span><span class="token string">'rule protocol value=icmp drop'</span>  <span class="token comment">#全部禁 ping</span>
firewall-cmd --permanent --add-rich-rule<span class="token operator">=</span><span class="token string">'rule family="ipv4"source address="192.168.1.0/24"protocol value="icmp"accept'</span>  <span class="token comment">#指定 192.168.1.0/24 允许 icmp</span>
</code></pre> 
<h2>
<a id="EPELExtra_Packages_for_Enterprise_Linux_408"></a>七、安装EPEL(Extra Packages for Enterprise Linux)</h2> 
<pre><code class="prism language-bash">yum -y <span class="token function">install</span> epel-release

或者 <span class="token punctuation">(</span>EL8<span class="token punctuation">)</span>:
<span class="token function">rpm</span> -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
<span class="token function">rpm</span> –import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8
</code></pre> 
<h2>
<a id="_417"></a>八、安装一些必备工具</h2> 
<pre><code class="prism language-bash"><span class="token comment"># 一些基本工具最小化安装可能没有 (经测 vim 和 wget 等没有安装)</span>
yum -y <span class="token function">install</span> <span class="token function">vim</span> <span class="token function">wget</span> <span class="token function">zip</span> <span class="token function">unzip</span>

<span class="token comment"># gcc 等选择开发工具（上述安装过程建议勾选了"Development Tools"）</span>
dnf groupinstall <span class="token string">"Development Tools"</span>

<span class="token comment"># Rocky Linux 默认没有 tar 命令，AlmaLinux 也没有，但是 CentOS 默认有</span>
yum -y <span class="token function">install</span> <span class="token function">tar</span>

<span class="token comment"># 以下网络工具已经不存在</span>
<span class="token comment"># yum -y install setuptool system-config-network-tui system-config-firewall-tui</span>

<span class="token comment"># 默认安装没有 ifconfig 命令，安装 net-tools</span>
<span class="token comment"># ifconfig、netstat、route 等命令集</span>
yum -y <span class="token function">install</span> net-tools

<span class="token comment"># host、dig 和 nslookup</span>
yum -y <span class="token function">install</span> bind-utils

<span class="token comment"># 更好的 top 工具</span>
yum -y <span class="token function">install</span> <span class="token function">htop</span>
<span class="token comment">#Anolis OS 中没有</span>
<span class="token comment">#https://github.com/hishamhm/htop</span>

<span class="token comment"># 文件传输：sz 和 rz</span>
yum -y <span class="token function">install</span> lrzsz

<span class="token comment"># 查看日志神器 Log file Navigator</span>
yum -y <span class="token function">install</span> lnav
<span class="token comment"># 该软件现在已经包含在 EPEL 中</span>
<span class="token comment"># 初期 EPEL 中没有，直接在线安装</span>
<span class="token comment">#rpm -ivh https://github.com/tstack/lnav/releases/download/v0.9.0/lnav-0.9.0-1.x86_64.rpm</span>
<span class="token comment">#Anolis OS 中没有</span>

<span class="token comment"># NTP 已经废弃，改用 chrony，默认自带</span>
<span class="token comment"># yum -y install ntp</span>

<span class="token comment"># nc:</span>
yum -y <span class="token function">install</span> <span class="token function">nc</span>

<span class="token comment"># lsof:</span>
yum -y <span class="token function">install</span> <span class="token function">lsof</span>

<span class="token comment"># tree:</span>
yum -y <span class="token function">install</span> tree

<span class="token comment"># pstree:</span>
yum -y <span class="token function">install</span> psmisc

<span class="token comment"># ncdu：NCurses Disk Usage</span>
yum -y <span class="token function">install</span> ncdu <span class="token comment">#新增工具，模板尚未加入，下个版本更新</span>

<span class="token comment"># dstat 监控 CPU、磁盘和网络使用率，下个版本加入</span>
yum -y <span class="token function">install</span> dstat
</code></pre> 
<p><strong>fd 命令（fd-find，强烈推荐）</strong></p> 
<pre><code class="prism language-bash">下载（二选一）：
<span class="token comment"># gcc 编译版本</span>
<span class="token function">wget</span> https://github.com/sharkdp/fd/releases/download/v8.0.0/fd-v8.0.0-x86_64-unknown-linux-gnu.tar.gz
<span class="token comment"># musl libc 编译版本 (推荐)</span>
<span class="token function">wget</span> https://github.com/sharkdp/fd/releases/download/v8.0.0/fd-v8.0.0-x86_64-unknown-linux-musl.tar.gz

<span class="token comment"># 安装：</span>
<span class="token function">tar</span> -zxvf fd-v8.0.0-x86_64-unknown-linux-*.tar.gz
<span class="token builtin class-name">cd</span> fd-v8.0.0-x86_64-unknown-linux-musl

<span class="token function">cp</span> ./fd /usr/local/bin/
<span class="token function">cp</span> ./fd.1 /usr/local/share/man/man1/
mandb
</code></pre> 
<blockquote> 
 <h4>
<a id="_493"></a>可以根据个人习惯安装一些常用工具。</h4> 
</blockquote> 
<h2>
<a id="NTP_494"></a>九、配置NTP</h2> 
<p>在 CentOS 8.0 中默认不再支持 ntp 软件包，时间同步将由 chrony 来实现。</p> 
<pre><code class="prism language-bash"><span class="token function">cat</span> /etc/chrony.conf
<span class="token comment"># Use public servers from the pool.ntp.org project.</span>
<span class="token comment"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span>
<span class="token comment"># These servers were defined in the installation:</span>
pool <span class="token number">2</span>.pool.ntp.org iburst  <span class="token comment">#Rocky default</span>
pool <span class="token number">2</span>.centos.pool.ntp.org iburst <span class="token comment">#CentOS default</span>
pool <span class="token number">0</span>.pool.ntp.org iburst
pool ntp1.aliyun.com iburst
pool ntp2.aliyun.com iburst
</code></pre> 
<h2>
<a id="SNMP_508"></a>十、安装SNMP</h2> 
<pre><code class="prism language-bash">yum -y <span class="token function">install</span> net-snmp net-snmp-devel net-snmp-libs net-snmp-utils

<span class="token comment"># 对比 CentOS 7 net-snmp-perl 已经不存在 (未知)</span>
<span class="token comment"># 因为是模板，这里暂不配置</span>
</code></pre> 
<h2>
<a id="_VMtools_516"></a>十一、虚机安装 VM-tools</h2> 
<p>在系统安装时候勾选了 “Guest Agent”，将自动安装 open-vm-tools</p> 
<pre><code class="prism language-bash">手动安装 open-vm-tools：
<span class="token comment"># http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2073803</span>
yum -y <span class="token function">install</span> open-vm-tools

<span class="token comment"># 开启服务</span>
<span class="token comment">#chkconfig vmtoolsd on</span>
systemctl <span class="token builtin class-name">enable</span> vmtoolsd.service

<span class="token comment"># 启动服务</span>
<span class="token comment">#service vmtoolsd start</span>
systemctl start vmtoolsd

<span class="token comment"># 查看版本</span>
vmtoolsd -v
<span class="token comment">#现在已经 11.2.0</span>
VMware Tools daemon, version <span class="token number">11.2</span>.0.23855 <span class="token punctuation">(</span>build-16938113<span class="token punctuation">)</span>
</code></pre> 
<h2>
<a id="_yum__537"></a>十二、用 yum 排除不需要的更新包</h2> 
<pre><code class="prism language-bash"><span class="token comment"># 修改 yum 的配置文件</span>
<span class="token function">vi</span> /etc/yum.conf
<span class="token comment"># 在 [main] 的最后添加 exclude=kernel*</span>

<span class="token comment"># 示例：</span>
<span class="token punctuation">[</span>main<span class="token punctuation">]</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">installonly_limit</span><span class="token operator">=</span><span class="token number">3</span>
<span class="token assign-left variable">clean_requirements_on_remove</span><span class="token operator">=</span>True
<span class="token assign-left variable">best</span><span class="token operator">=</span>True
<span class="token assign-left variable">skip_if_unavailable</span><span class="token operator">=</span>False
<span class="token assign-left variable">exclude</span><span class="token operator">=</span>kernel*
</code></pre> 
<blockquote> 
 <h4>
<a id="_554"></a>说明：</h4> 
 <h4>
<a id="_yum__555"></a>通常在用 yum 进行更新时老是会更新内核，这样就造成了两个问题：</h4> 
 <h4>
<a id="1__556"></a>1). 内核过多，占用系统的空间</h4> 
 <h4>
<a id="2__nvidia__557"></a>2). 如果是自行编译安装的 nvidia 显卡驱动的话，进入更新的核心时需要再重新安装显卡驱动</h4> 
</blockquote> 
<blockquote> 
 <h4>
<a id="_559"></a>这里介绍好的办法解决这个问题，就是在更新时排除对内核的更新，方法有两个:</h4> 
 <h4>
<a id="1__yum__vi_etcyumconf_main__excludekernel_560"></a>1). 修改 yum 的配置文件 vi /etc/yum.conf，在 [main] 的最后添加 exclude=kernel*</h4> 
 <h4>
<a id="2__yum__yum_excludekernel_update_561"></a>2). 直接在 yum 的命令行执行如下的命令： yum --exclude=kernel* update</h4> 
</blockquote> 
<blockquote> 
 <h4>
<a id="_563"></a>以上的办法也适合你要求自行排除的其它更新软件包。</h4> 
 <h4>
<a id="_564"></a>备注：安装某些软件包需要新版内核支持，需要删除以上配置。</h4> 
</blockquote> 
<h2>
<a id="yum_565"></a>十三、更换国内镜像yum源</h2> 
<p>Rocky Linux 默认 repo 如下：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span> dnf repolist
repo <span class="token function">id</span>                                                      repo name
appstream                                                    Rocky Linux <span class="token number">8</span> - AppStream
baseos                                                       Rocky Linux <span class="token number">8</span> - BaseOS
extras                                                       Rocky Linux <span class="token number">8</span> - Extras
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span> <span class="token builtin class-name">cd</span> /etc/yum.repos.d/
<span class="token punctuation">[</span>root@localhost yum.repos.d<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">44</span>
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">700</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-AppStream.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">685</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-BaseOS.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">713</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-Devel.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">685</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-Extras.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">721</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-HighAvailability.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">680</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-Media.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">685</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-Plus.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">705</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-PowerTools.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">736</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-ResilientStorage.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">671</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-RT.repo
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">2407</span> Jun <span class="token number">19</span> <span class="token number">22</span>:20 Rocky-Sources.repo
</code></pre> 
<p>Rocky Linux 国内镜像源<br> 阿里云示例：</p> 
<pre><code class="prism language-bash"><span class="token function">sed</span> -e <span class="token string">'s|^mirrorlist=|#mirrorlist=|g'</span> <span class="token punctuation"></span>
    -e <span class="token string">'s|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g'</span> <span class="token punctuation"></span>
    -i.bak <span class="token punctuation"></span>
    /etc/yum.repos.d/Rocky-*.repo

dnf makecache

</code></pre> 
<p>修改 epel，若安装了 epel，同时修改如下：</p> 
<pre><code class="prism language-bash"><span class="token comment"># dnf repolist</span>
repo <span class="token function">id</span>                                         repo name
appstream                                       Rocky Linux <span class="token number">8</span> - AppStream
baseos                                          Rocky Linux <span class="token number">8</span> - BaseOS
epel                                            Extra Packages <span class="token keyword">for</span> Enterprise Linux <span class="token number">8</span> - x86_64
epel-modular                                    Extra Packages <span class="token keyword">for</span> Enterprise Linux Modular <span class="token number">8</span> - x86_64
extras                                          Rocky Linux <span class="token number">8</span> - Extras

<span class="token comment"># 修改 epel(url 不一样)</span>
<span class="token function">sed</span> -e <span class="token string">'s/metalink=/#metalink=/g'</span> 
    -e <span class="token string">'s/#baseurl=/baseurl=/g'</span> 
    -e <span class="token string">'s/https://download.fedoraproject.org/pub/https://mirrors.aliyun.com/g'</span> 
    -i.bak 
    /etc/yum.repos.d/epel*.repo
</code></pre> 
<p>清理并重新生成软件包信息缓存</p> 
<pre><code class="prism language-bash">yum clean all
yum autoremove
<span class="token function">rm</span> -rf /var/cache/yum
yum makecache
</code></pre> 
<h2>
<a id="_627"></a>十四、更新软件包</h2> 
<pre><code class="prism language-bash">dnf clean all
dnf mackecache  <span class="token comment">#缓存软件包信息</span>
dnf upgrade  <span class="token comment">#更新软件包</span>
<span class="token comment">#rm -rf /var/cache/dnf</span>
</code></pre> 
<h2>
<a id="__635"></a>十五、 安装图形界面</h2> 
<p>基于特定场景需要，一般不用安装</p> 
<pre><code class="prism language-bash">yum grouplist  <span class="token comment">#查看可安装的组件</span>

yum groupinstall <span class="token string">"Server with GUI"</span>  <span class="token comment">#安装 GNOME 图形界面 (与 CentOS 7 名称不一样)</span>
yum groupinstall <span class="token string">"Graphical Administration Tools"</span>  <span class="token comment">#将自动安装</span>

startx  <span class="token comment">#启动图形界面</span>
</code></pre> 
<p><strong>实例：</strong></p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># yum grouplist</span>
Last metadata expiration check: <span class="token number">1</span>:12:58 ago on Sat 09 Nov <span class="token number">2019</span> 03:59:09 PM CST.
Available Environment Groups:
   Server with GUI
   Server
   Workstation
   KDE Plasma Workspaces
   Virtualization Host
   Custom Operating System
Installed Environment Groups:
   Minimal Install
Installed Groups:
   Development Tools
Available Groups:
   Container Management
   .NET Core Development
   RPM Development Tools
   Smart Card Support
   Graphical Administration Tools
   Headless Management
   Legacy UNIX Compatibility
   Network Servers
   Scientific Support
   Security Tools
   System Tools
   Fedora Packager
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># yum groupinstall "Server with GUI"</span>
Installing Environment Groups:
 Server with GUI
Installing Groups:
 Container Management
 Core
 Fonts
 GNOME
 Guest Desktop Agents
 Hardware Monitoring Utilities
 Hardware Support
 Headless Management
 Internet Browser
 Multimedia
 Common NetworkManager submodules
 Printing Client
 Server product core
 Standard

Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Install  <span class="token number">744</span> Packages

Total download size: <span class="token number">696</span> M
Installed size: <span class="token number">2.1</span> G
Is this ok <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>:
</code></pre> 
<h2>
<a id="Shell__705"></a>十六、Shell 配置</h2> 
<p>命令自动补全忽略大小写<br> 该配置针对 Bash，仅使用 Zsh 可以忽略。</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'set completion-ignore-case on'</span> <span class="token operator">&gt;&gt;</span> ~/.inputrc
</code></pre> 
<p>修改 ll 命令 Linux 中默认定义了 ll 别名，<br> 但参数比较少，需要使用更加强大的 ll 别名。<br> 写入环境变量（当前用户优先执行）：</p> 
<p>zsh：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'alias ll="ls -lahF --color=auto --time-style=long-iso"'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc
</code></pre> 
<p>bash：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'alias ll="ls -lahF --color=auto --time-style=long-iso"'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
</code></pre> 
<blockquote> 
 <h4>
<a id="etcskelbashrc__etcskelzshrc_728"></a>注意：仅仅针对当前用户，写入全局用户配置文件：/etc/skel/.bashrc 或者 /etc/skel/.zshrc</h4> 
</blockquote> 
<p>高级版 ls：以数字显示权限<br> 这里我们把命令叫做 lll<br> 命令：</p> 
<pre><code class="prism language-bash"><span class="token function">ls</span> -lahF --color<span class="token operator">=</span>auto --time-style<span class="token operator">=</span>long-iso <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{k=0;s=0;for(i=0;i&lt;=8;i++){k+=((substr($1,i+2,1)~/[rwxst]/)*2^(8-i))}j=4;for(i=4;i&lt;=10;i+=3){s+=((substr($1,i,1)~/[stST]/)*j);j/=2}if(k){printf("%0o%0o ",s,k)}print}'</span>
</code></pre> 
<p>创建文件</p> 
<blockquote> 
 <h4>
<a id="_cat_EOF_______738"></a>在使用 cat EOF 中出现 $ 变量通常会直接被执行，显示执行的结果。若想保持 $ 变量不变需要使用 符进行注释。</h4> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#如果非 root 用户，切换到 root</span>
<span class="token function">sudo</span> -i
<span class="token function">cat</span> <span class="token operator">&gt;</span> /usr/local/bin/lll <span class="token operator">&lt;&lt;</span><span class="token string">EOF
#!/bin/bash
ls -lahF --color=auto --time-style=long-iso | awk '{k=0;s=0;for(i=0;i&lt;=8;i++){k+=<span class="token variable"><span class="token punctuation">((</span>substr<span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">~</span><span class="token operator">/</span>[rwxst]<span class="token operator">/</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token operator">-</span>i<span class="token punctuation">))</span></span>}j=4;for(i=4;i&lt;=10;i+=3){s+=((substr(<span class="token variable">$1</span>,i,1)~/[stST]/)*j);j/=2}if(k){printf("%0o%0o ",s,k)}print}'
EOF</span>
<span class="token comment">#赋予执行权限：</span>
<span class="token function">chmod</span> +x /usr/local/bin/lll
<span class="token comment">#如果非 root 用户，执行完毕退出</span>
<span class="token builtin class-name">exit</span>
</code></pre> 
<p>vi 和 vim CentOS 8 系列 vi 和 vim 是不同的软件，<br> 默认安装的是 vi，vim 需要手动安装。<br> 创建 vi链接直接使用 vim：</p> 
<pre><code class="prism language-bash"><span class="token function">ln</span> -s /usr/bin/vim /usr/local/bin/vi
</code></pre> 
<p>创建 vimrc 配置文件：</p> 
<p>可以根据个人习惯来配置 vim，并用于全局配置。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 当面用户</span>
~/.vimrc
<span class="token comment"># 全局新用户默认</span>
/etc/skel/.vimrc
</code></pre> 
<h2>
<a id="Zsh_770"></a>十七、Zsh</h2> 
<p>以下是针对当前用户配置。全局配置请参看其他文章，这里直接使用全局配置文件即可。</p> 
<pre><code class="prism language-bash"><span class="token comment"># Zsh</span>
yum -y <span class="token function">install</span> <span class="token function">zsh</span>
<span class="token comment"># or</span>
<span class="token comment">#dnf -y install zsh</span>

chsh -s /bin/zsh

yum -y <span class="token function">install</span> <span class="token function">git</span>

<span class="token function">sh</span> -c <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh<span class="token variable">)</span></span>"</span>

<span class="token function">sed</span> -i <span class="token string">'/^ZSH_THEME=.*/c ZSH_THEME="ys"'</span> ~/.zshrc

<span class="token builtin class-name">echo</span> <span class="token string">'alias ll="ls -lahF --color=auto --time-style=long-iso"'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc

<span class="token function">git</span> clone https://github.com/sangrealest/zsh-autosuggestions.git ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions

<span class="token function">sed</span> -i <span class="token string">'/^plugins=.*/c plugins=(git zsh-autosuggestions)'</span> ~/.zshrc

<span class="token builtin class-name">source</span> ~/.zshrc
</code></pre> 
<h2>
<a id="_795"></a>十八、清理并制作镜像模板</h2> 
<p>清理 dnf/yum 缓存</p> 
<pre><code class="prism language-bash">dnf autoremove
dnf clean all
</code></pre> 
<p>清理临时文件夹</p> 
<pre><code class="prism language-bash"><span class="token function">rm</span> -rf /tmp/*  <span class="token comment">#清空临时文件夹</span>
</code></pre> 
<p>清空历史记录</p> 
<pre><code class="prism language-bash"><span class="token comment">#比较完整的清空历史记录</span>
<span class="token function">rm</span> -f /var/log/audit/audit*
<span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span> /var/log/audit/audit.log
<span class="token function">rm</span> -f /var/log/secure*
<span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span> /var/log/secure
<span class="token function">rm</span> -f /var/log/btmp*
<span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span> /var/log/btmp
<span class="token function">rm</span> -f /var/log/wtmp*
<span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span> /var/log/wtmp
<span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span> /var/log/lastlog
<span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span> ~/.bash_history
<span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span> ~/.zsh_history
<span class="token function">history</span> -c
</code></pre> 
<h4>
<a id="Rocky_Linux__824"></a>至此，Rocky Linux 的基本配置已经完成，可以制作模板了。</h4>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>完整详细的Redis学习笔记 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">完整详细的Redis学习笔记</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <blockquote> 
 <p>学习参考视频：<a href="https://www.bilibili.com/video/BV1S54y1R7SB">【狂神说Java】Redis</a></p> 
</blockquote> 
<h1>
<a id="Redis_2"></a>Redis</h1> 
<h2>
<a id="redis_3"></a>一、redis相关概述</h2> 
<p>redis属于非关系型数据库。</p> 
<h3>
<a id="1_7"></a>1.关于非关系型数据库的介绍</h3> 
<p>非关系型的数据库，也就是NoSQL（Not Only SQL）。</p> 
<p>关系型数据库：列+行，同一个表下数据的结构是一样的。</p> 
<p>非关系型数据库：数据存储没有固定的格式，并且可以进行横向扩展。</p> 
<p>NoSQL泛指非关系型数据库，随着web2.0互联网的诞生，传统的关系型数据库很难对付web2.0时代！尤其是超大规模的高并发的社区，暴露出来很多难以克服的问题，NoSQL在当今大数据环境下发展的十分迅速，Redis是发展最快的。</p> 
<p><strong>NoSQL的特点</strong></p> 
<ol>
<li>方便扩展（数据之间没有关系，很好扩展！）</li>
<li>大数据量高性能（Redis一秒可以写8万次，读11万次，NoSQL的缓存记录级，是一种细粒度的缓存，性能会比较高！）</li>
<li>数据类型是多样型的！（不需要事先设计数据库，随取随用）</li>
</ol> 
<p><strong>NoSQL的分类</strong></p> 
<table>
<thead><tr>
<th align="left">类型</th>
<th align="left">部分代表</th>
<th>特点</th>
</tr></thead>
<tbody>
<tr>
<td align="left">列存储</td>
<td align="left">Hbase<br>Cassandra<br>HypertableHypertable</td>
<td>顾名思义，是按列存储数据的。<br>最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。</td>
</tr>
<tr>
<td align="left">文档存储</td>
<td align="left">MongoDB<br>CouchDB</td>
<td>文档存储一般用类似json的格式存储，存储的内容是文档型的。<br>这样也就有有机会对某些字段建立索引，实现关系数据库的某些功能。</td>
</tr>
<tr>
<td align="left">key-value存储</td>
<td align="left">Tokyo Cabinet/Tyrant<br>Berkeley DB<br>MemcacheDB<br>Redis</td>
<td>可以通过key快速查询到其value。<br>一般来说，存储不管value的格式，照单全收。（Redis包含了其他功能）</td>
</tr>
<tr>
<td align="left">图存储</td>
<td align="left">Neo4J<br>FlockDB</td>
<td>图形关系的最佳存储。<br>使用传统关系数据库来解决的话性能低下，而且设计使用不方便。</td>
</tr>
<tr>
<td align="left">对象存储</td>
<td align="left">db4o<br>Versant</td>
<td>通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据。</td>
</tr>
<tr>
<td align="left">xml数据库</td>
<td align="left">Berkeley DB XML<br>BaseX</td>
<td>高效的存储XML数据，并支持XML的内部查询语法，</td>
</tr>
</tbody>
</table>
<h3>
<a id="2redis_34"></a>2.什么是redis</h3> 
<p>​ Redis是一款内存高速缓存数据库。Redis全称为：Remote Dictionary Server （远程数据服务），使用C语言编写，Redis是一个key-value存储系统（键值存储系统），支持丰富的数据类型，如：String、list、set、zset、hash。</p> 
<h3>
<a id="3redis_38"></a>3.redis的应用场景</h3> 
<p>​ 众多语言都支持Redis，因为Redis交换数据快，在服务器中常用来存储一些需要频繁调取的数据，节省内存开销，也极大的提升了速度。</p> 
<p>​ 将一些热点数据存储到Redis中，要用的时候，直接从内存取，极大的提高了速度和节约了服务器的开销。</p> 
<p>​ 1、会话缓存（最常用）</p> 
<p>​ 2、消息队列（支付）</p> 
<p>​ 3、活动排行榜或计数</p> 
<p>​ 4、发布，订阅消息（消息通知）</p> 
<p>​ 5、商品列表，评论列表</p> 
<h2>
<a id="_54"></a>二、五大数据类型</h2> 
<blockquote> 
 <p>在介绍五大数据类型之前，我们先来了解一下关于key操作的基础命令</p> 
</blockquote> 
<table>
<thead><tr>
<th>命令</th>
<th>说明</th>
</tr></thead>
<tbody>
<tr>
<td>keys *</td>
<td>查看当前数据库所有的key</td>
</tr>
<tr>
<td>exists</td>
<td>判断指定key是否存在</td>
</tr>
<tr>
<td>del</td>
<td>删除指定key</td>
</tr>
<tr>
<td>expire</td>
<td>设置key的过期时间</td>
</tr>
<tr>
<td>type</td>
<td>查看key的类型</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> exists name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">type</span> name
string
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> expire name <span class="token number">10</span> <span class="token comment">#设置10s到期时间</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> exists name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> exists name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> exists name <span class="token comment">#10s后过期了</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *   <span class="token comment">#在查看当前数据库所有的key，发现无了</span>
<span class="token punctuation">(</span>empty list or <span class="token builtin class-name">set</span><span class="token punctuation">)</span>
</code></pre> 
<h3>
<a id="String_85"></a>String（字符串）</h3> 
<p>由于redis输入命令后面会有提示，我这里就写他的关键词了</p> 
<table>
<thead><tr>
<th align="left">命令</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td align="left"><code>APPEND</code></td>
<td>向指定的key的value后追加字符串</td>
</tr>
<tr>
<td align="left"><code>DECR/INCR</code></td>
<td>将指定key的value数值进行+1/-1(仅对于数字)</td>
</tr>
<tr>
<td align="left"><code>INCRBY/DECRBY</code></td>
<td>按指定的步长对数值进行加减</td>
</tr>
<tr>
<td align="left"><code>INCRBYFLOAT</code></td>
<td>为数值加上浮点型数值</td>
</tr>
<tr>
<td align="left"><code>STRLEN</code></td>
<td>获取key保存值的字符串长度</td>
</tr>
<tr>
<td align="left"><code>GETRANGE</code></td>
<td>按起止位置获取字符串（闭区间，起止位置都取）</td>
</tr>
<tr>
<td align="left"><code>SETRANGE</code></td>
<td>用指定的value 替换key中 offset开始的值</td>
</tr>
<tr>
<td align="left"><code>GETSET</code></td>
<td>将给定 key 的值设为 value ，并返回 key 的旧值(old value)。</td>
</tr>
<tr>
<td align="left"><code>SETNX</code></td>
<td>仅当key不存在时进行set</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"age"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">"thenie"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get age
<span class="token string">"18"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> append name Shuai  <span class="token comment">#向指定字符串后加Shuai</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">11</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">"thenieShuai"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> DECR age <span class="token comment">#自减</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">17</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> INCR age <span class="token comment">#自增</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">18</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> DECRBY age <span class="token number">5</span> <span class="token comment">#指定减少</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">13</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> INCRBY age <span class="token number">5</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">18</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> STRLEN age <span class="token comment">#返回字符串长度</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> getrange name <span class="token number">0</span> -1 <span class="token comment">#返回完整字符串</span>
<span class="token string">"thenieShuai"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> getrange name <span class="token number">0</span> <span class="token number">6</span> <span class="token comment">#返回下标为0~6的字符串</span>
<span class="token string">"thenieS"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setrange name <span class="token number">6</span> Haokan <span class="token comment">#从6的位置开始用Haokan进行覆盖</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">12</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">"thenieHaokan"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> GETSET name kuaijieshule <span class="token comment">#返回name的值，并进行指定的修改</span>
<span class="token string">"thenieHaokan"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> GET name
<span class="token string">"kuaijieshule"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx name ,  <span class="token comment">#创建,失败，因为存在key为name</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
<span class="token string">"kuaijieshule"</span>
</code></pre> 
<p>String类似的使用场景：value除了是字符串还可以是数字，用途举例：</p> 
<ul>
<li>计数器</li>
<li>统计多单位的数量：uid:123666：follow 0</li>
<li>粉丝数</li>
<li>对象存储缓存</li>
</ul> 
<h3>
<a id="Hash_148"></a>Hash（哈希）</h3> 
<blockquote> 
 <p>Redis hash 是一个string类型的field和value的映射表，hash特别适合用于存储对象。</p> 
</blockquote> 
<table>
<thead><tr>
<th>命令</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td><code>HSET</code></td>
<td>将哈希表 key 中的字段 field 的值设为 value 。重复设置同一个field会覆盖,返回0</td>
</tr>
<tr>
<td><code>HMSET</code></td>
<td>同时将多个 field-value (域-值)对设置到哈希表 key 中。</td>
</tr>
<tr>
<td><code>HSETNX</code></td>
<td>只有在字段 field 不存在时，设置哈希表字段的值。</td>
</tr>
<tr>
<td><code>HEXISTS</code></td>
<td>查看哈希表 key 中，指定的字段是否存在。</td>
</tr>
<tr>
<td><code>HGET</code></td>
<td>获取存储在哈希表中指定字段的值</td>
</tr>
<tr>
<td><code>HMGET</code></td>
<td>获取所有给定字段的值</td>
</tr>
<tr>
<td><code>HGETALL</code></td>
<td>获取在哈希表key 的所有字段和值</td>
</tr>
<tr>
<td><code>HKEYS</code></td>
<td>获取哈希表key中所有的字段</td>
</tr>
<tr>
<td><code>HLEN</code></td>
<td>获取哈希表中字段的数量</td>
</tr>
<tr>
<td><code>HVALS</code></td>
<td>获取哈希表中所有值</td>
</tr>
<tr>
<td><code>HDEL</code></td>
<td>删除哈希表key中一个/多个field字段</td>
</tr>
<tr>
<td><code>HINCRBY</code></td>
<td>为哈希表 key 中的指定字段的整数值加上增量n，并返回增量后结果 一样只适用于整数型字段</td>
</tr>
<tr>
<td><code>HINCRBYFLOAT</code></td>
<td>为哈希表 key 中的指定字段的浮点数值加上增量 n。</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HSET mymap k1 v1 <span class="token comment">#初始化一个key为mymap的集合</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HSET mymap k2 v2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HMSET mymap k3 v3 k4 v4
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HEXISTS mymap k1 <span class="token comment">#判断k1在mymap中是否存在</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HEXISTS mymap k5
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HGETALL mymap  <span class="token comment">#返回mymap中所有的key和value</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"k1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v1"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"k2"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"k3"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"v3"</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"k4"</span>
<span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">"v4"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HGET mymap k1
<span class="token string">"v1"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HKEYS mymap <span class="token comment">#返回mymap中所有的key</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"k1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"k2"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"k3"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"k4"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HVALS mymap
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"v3"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"v4"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HDEL mymap k2 <span class="token comment">#删除mymap中的k2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HKEYS mymap
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"k1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"k3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"k4"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HSET mymap number <span class="token number">10</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> hget mymap number
<span class="token string">"10"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> HINCRBY mymap number <span class="token number">10</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">20</span>
</code></pre> 
<p>Hash变更的数据user name age，尤其是用户信息之类的，经常变动的信息！<strong>Hash更适合于对象的存储，Sring更加适合字符串存储！</strong></p> 
<h3>
<a id="List_216"></a>List（列表）</h3> 
<blockquote> 
 <p>Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）</p> 
 <p>一个列表最多可以包含 232 - 1 个元素 (4294967295, 每个列表超过40亿个元素)。</p> 
</blockquote> 
<p>首先我们列表，可以经过规则定义将其变为队列、栈、双端队列等</p> 
<p><img src="https://images2.imgbox.com/4d/08/aRbCYsMu_o.png" alt="列表1"></p> 
<p>正如图Redis中List是可以进行双端操作的，所以命令也就分为了LXXX和RLLL两类，有时候L也表示List例如LLEN</p> 
<table>
<thead><tr>
<th>命令</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td><code>LPUSH/RPUSH</code></td>
<td>从左边/右边向列表中PUSH值(一个或者多个)。</td>
</tr>
<tr>
<td><code>LRANGE</code></td>
<td>获取list 起止元素==（索引从左往右 递增）==</td>
</tr>
<tr>
<td><code>LPUSHX/RPUSHX</code></td>
<td>向已存在的列名中push值（一个或者多个）</td>
</tr>
<tr>
<td><code>LINSERT key BEFORE|AFTER pivot value</code></td>
<td>在指定列表元素的前/后 插入value</td>
</tr>
<tr>
<td><code>LLEN</code></td>
<td>查看列表长度</td>
</tr>
<tr>
<td><code>LINDEX</code></td>
<td>通过索引获取列表元素</td>
</tr>
<tr>
<td><code>LSET</code></td>
<td>通过索引为元素设值</td>
</tr>
<tr>
<td><code>LPOP/RPOP</code></td>
<td>从最左边/最右边移除值 并返回</td>
</tr>
<tr>
<td><code>RPOPLPUSH source destination</code></td>
<td>将列表的尾部(右)最后一个值弹出，并返回，然后加到另一个列表的头部</td>
</tr>
<tr>
<td><code>LTRIM</code></td>
<td>通过下标截取指定范围内的列表</td>
</tr>
<tr>
<td><code>LREM key count value</code></td>
<td>List中是允许value重复的 <code>count &gt; 0</code>：从头部开始搜索 然后删除指定的value 至多删除count个 <code>count &lt; 0</code>：从尾部开始搜索… <code>count = 0</code>：删除列表中所有的指定value。</td>
</tr>
<tr>
<td><code>BLPOP/BRPOP</code></td>
<td>移出并获取列表的第一个/最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> rpush list a b c d e f  <span class="token comment">#初始化key为list的列表</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LRANGE list <span class="token number">0</span> -1   <span class="token comment">#从左至右返回list</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"a"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"b"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"c"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"d"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"e"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"f"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LPUSH list <span class="token number">1</span>  <span class="token comment">#向左插入1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LRANGE list <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"a"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"b"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"c"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"d"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"e"</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"f"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> RPUSH list <span class="token number">2</span>  <span class="token comment">#向右插入2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">8</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LRANGE list <span class="token number">0</span> -1  <span class="token comment">#从左至右返回list</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"a"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"b"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"c"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"d"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"e"</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"f"</span>
<span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">"2"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> llen list
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">8</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LINDEX list <span class="token number">2</span> 
<span class="token string">"b"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LPUSH list1 <span class="token number">1</span>  <span class="token comment">#初始化一个list1的列表</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> RPOPLPUSH list list1  <span class="token comment">#从list的右边弹出一个值并向list的左边插入</span>
<span class="token string">"2"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LRANGE list1 <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"2"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"1"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LPOP list1
<span class="token string">"2"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LPOP list1
<span class="token string">"1"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LTRIM list <span class="token number">1</span> <span class="token number">8</span>
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> LRANGE list <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"a"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"b"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"c"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"d"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"e"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"f"</span>
</code></pre> 
<blockquote> 
 <p>小结</p> 
</blockquote> 
<ul>
<li>list实际上是一个链表，before Node after , left, right 都可以插入值</li>
<li><strong>如果key不存在，则创建新的链表</strong></li>
<li>如果key存在，新增内容</li>
<li>如果移除了所有值，空链表，也代表不存在</li>
<li>在两边插入或者改动值，效率最高！修改中间元素，效率相对较低</li>
</ul> 
<p><strong>应用：</strong></p> 
<p><strong>消息排队！消息队列（Lpush Rpop）,栈（Lpush Lpop）</strong></p> 
<h3>
<a id="Set_312"></a>Set（集合）</h3> 
<blockquote> 
 <p>Redis的Set是<strong>string类型</strong>的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。</p> 
 <p>Redis 中 集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。</p> 
 <p>集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。</p> 
</blockquote> 
<table>
<thead><tr>
<th>命令</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td><code>SADD</code></td>
<td>向集合中无序增加一个/多个成员</td>
</tr>
<tr>
<td><code>SCARD</code></td>
<td>获取集合的成员数</td>
</tr>
<tr>
<td><code>SMEMBERS</code></td>
<td>返回集合中所有的成员</td>
</tr>
<tr>
<td><code>SISMEMBER</code></td>
<td>查询member元素是否是集合的成员,结果是无序的</td>
</tr>
<tr>
<td><code>SRANDMEMBER</code></td>
<td>随机返回集合中count个成员，count缺省值为1</td>
</tr>
<tr>
<td><code>SPOP</code></td>
<td>随机移除并返回集合中count个成员，count缺省值为1</td>
</tr>
<tr>
<td><code>SMOVE source destination member</code></td>
<td>将source集合的成员member移动到destination集合</td>
</tr>
<tr>
<td><code>SREM</code></td>
<td>移除集合中一个/多个成员</td>
</tr>
<tr>
<td><code>SDIFF</code></td>
<td>返回所有集合的差集 key1- key2 - …</td>
</tr>
<tr>
<td><code>SDIFFSTORE destination key1[key2..]</code></td>
<td>在SDIFF的基础上，将结果保存到集合中==(覆盖)==。不能保存到其他类型key噢！</td>
</tr>
<tr>
<td><code>SINTER key1 [key2..]</code></td>
<td>返回所有集合的交集</td>
</tr>
<tr>
<td><code>SINTERSTORE destination key1[key2..]</code></td>
<td>在SINTER的基础上，存储结果到集合中。覆盖</td>
</tr>
<tr>
<td><code>SUNION key1 [key2..]</code></td>
<td>返回所有集合的并集</td>
</tr>
<tr>
<td><code>SUNIONSTORE destination key1 [key2..]</code></td>
<td>在SUNION的基础上，存储结果到及和张。覆盖</td>
</tr>
<tr>
<td><code>SSCAN KEY [MATCH pattern] [COUNT count]</code></td>
<td>在大量数据环境下，使用此命令遍历集合中元素，每次遍历部分</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd <span class="token builtin class-name">set</span> a b c  <span class="token comment">#初始化key为set的集合</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd set1 d e f <span class="token comment">#初始化key为set1的集合</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SMEMBERS <span class="token builtin class-name">set</span>  <span class="token comment">#查看指定集合的全部成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"b"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"c"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"a"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SISMEMBER <span class="token builtin class-name">set</span> b <span class="token comment">#判断b是否存在于集合中</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SISMEMBER <span class="token builtin class-name">set</span> c
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SISMEMBER <span class="token builtin class-name">set</span> e
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SRANDMEMBER <span class="token builtin class-name">set</span> <span class="token number">2</span> <span class="token comment">#随机返回两个成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"b"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"c"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SRANDMEMBER <span class="token builtin class-name">set</span> <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"a"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"c"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SADD <span class="token builtin class-name">set</span> d
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SMOVE <span class="token builtin class-name">set</span> set1 a <span class="token comment">#将set中的a移入set1中</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SMEMBERS <span class="token builtin class-name">set</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"b"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"c"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"d"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SMEMBERS set1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"a"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"f"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"e"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"d"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SREM set1 a  <span class="token comment">#删除set1中的a元素</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SMEMBERS set1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"f"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"e"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"d"</span>
</code></pre> 
<h3>
<a id="ZSetsorted_set__380"></a>ZSet（sorted set 有序集合）</h3> 
<blockquote> 
 <p>不同的是每个元素都会关联一个double类型的分数（score）。redis正是通过分数来为集合中的成员进行从小到大的排序。</p> 
 <p>score相同：按字典顺序排序</p> 
 <p>有序集合的成员是唯一的,但分数(score)却可以重复。</p> 
</blockquote> 
<table>
<thead><tr>
<th>命令</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td><code>ZADD key score member1 [score2 member2]</code></td>
<td>向有序集合添加一个或多个成员，或者更新已存在成员的分数</td>
</tr>
<tr>
<td><code>ZCARD key</code></td>
<td>获取有序集合的成员数</td>
</tr>
<tr>
<td><code>ZCOUNT key min max</code></td>
<td>计算在有序集合中指定区间score的成员数</td>
</tr>
<tr>
<td><code>ZINCRBY key n member</code></td>
<td>有序集合中对指定成员的分数加上增量 n</td>
</tr>
<tr>
<td><code>ZSCORE key member</code></td>
<td>返回有序集中，成员的分数值</td>
</tr>
<tr>
<td><code>ZRANK key member</code></td>
<td>返回有序集合中指定成员的索引</td>
</tr>
<tr>
<td><code>ZRANGE key start end</code></td>
<td>通过索引区间返回有序集合成指定区间内的成员</td>
</tr>
<tr>
<td><code>ZRANGEBYLEX key min max</code></td>
<td>通过字典区间返回有序集合的成员</td>
</tr>
<tr>
<td><code>ZRANGEBYSCORE key min max</code></td>
<td>通过分数返回有序集合指定区间内的成员==-inf 和 +inf分别表示最小最大值，只支持开区间()==</td>
</tr>
<tr>
<td><code>ZLEXCOUNT key min max</code></td>
<td>在有序集合中计算指定字典区间内成员数量</td>
</tr>
<tr>
<td><code>ZREM key member1 [member2..]</code></td>
<td>移除有序集合中一个/多个成员</td>
</tr>
<tr>
<td><code>ZREMRANGEBYLEX key min max</code></td>
<td>移除有序集合中给定的字典区间的所有成员</td>
</tr>
<tr>
<td><code>ZREMRANGEBYRANK key start stop</code></td>
<td>移除有序集合中给定的排名区间的所有成员</td>
</tr>
<tr>
<td><code>ZREMRANGEBYSCORE key min max</code></td>
<td>移除有序集合中给定的分数区间的所有成员</td>
</tr>
<tr>
<td><code>ZREVRANGE key start end</code></td>
<td>返回有序集中指定区间内的成员，通过索引，分数从高到底</td>
</tr>
<tr>
<td><code>ZREVRANGEBYSCORRE key max min</code></td>
<td>返回有序集中指定分数区间内的成员，分数从高到低排序</td>
</tr>
<tr>
<td><code>ZREVRANGEBYLEX key max min</code></td>
<td>返回有序集中指定字典区间内的成员，按字典顺序倒序</td>
</tr>
<tr>
<td><code>ZREVRANK key member</code></td>
<td>返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</td>
</tr>
<tr>
<td><code>ZINTERSTORE destination numkeys key1 [key2 ..]</code></td>
<td>计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 key 中，numkeys：表示参与运算的集合数，将score相加作为结果的score</td>
</tr>
<tr>
<td><code>ZUNIONSTORE destination numkeys key1 [key2..]</code></td>
<td>计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 key 中</td>
</tr>
<tr>
<td><code>ZSCAN key cursor [MATCH pattern] [COUNT count]</code></td>
<td>迭代有序集合中的元素（包括元素成员和元素分值）</td>
</tr>
</tbody>
</table>
<pre><code class="prism language-bash">-------------------ZADD--ZCARD--ZCOUNT--------------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZADD myzset <span class="token number">1</span> m1 <span class="token number">2</span> m2 <span class="token number">3</span> m3 <span class="token comment"># 向有序集合myzset中添加成员m1 score=1 以及成员m2 score=2..</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZCARD myzset <span class="token comment"># 获取有序集合的成员数</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZCOUNT myzset <span class="token number">0</span> <span class="token number">1</span> <span class="token comment"># 获取score在 [0,1]区间的成员数量</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZCOUNT myzset <span class="token number">0</span> <span class="token number">2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>

----------------ZINCRBY--ZSCORE--------------------------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZINCRBY myzset <span class="token number">5</span> m2 <span class="token comment"># 将成员m2的score +5</span>
<span class="token string">"7"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZSCORE myzset m1 <span class="token comment"># 获取成员m1的score</span>
<span class="token string">"1"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZSCORE myzset m2
<span class="token string">"7"</span>

--------------ZRANK--ZRANGE-----------------------------------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANK myzset m1 <span class="token comment"># 获取成员m1的索引，索引按照score排序，score相同索引值按字典顺序顺序增加</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANK myzset m2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGE myzset <span class="token number">0</span> <span class="token number">1</span> <span class="token comment"># 获取索引在 0~1的成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"m1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"m3"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGE myzset <span class="token number">0</span> -1 <span class="token comment"># 获取全部成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"m1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"m3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"m2"</span>

<span class="token comment">#testset=&gt;{abc,add,amaze,apple,back,java,redis} score均为0</span>
------------------ZRANGEBYLEX---------------------------------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGEBYLEX testset - + <span class="token comment"># 返回所有成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"abc"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"add"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"amaze"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"apple"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"back"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"java"</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"redis"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGEBYLEX testset - + LIMIT <span class="token number">0</span> <span class="token number">3</span> <span class="token comment"># 分页 按索引显示查询结果的 0,1,2条记录</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"abc"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"add"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"amaze"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGEBYLEX testset - + LIMIT <span class="token number">3</span> <span class="token number">3</span> <span class="token comment"># 显示 3,4,5条记录</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"apple"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"back"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"java"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGEBYLEX testset <span class="token punctuation">(</span>- <span class="token punctuation">[</span>apple <span class="token comment"># 显示 (-,apple] 区间内的成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"abc"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"add"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"amaze"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"apple"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGEBYLEX testset <span class="token punctuation">[</span>apple <span class="token punctuation">[</span>java <span class="token comment"># 显示 [apple,java]字典区间的成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"apple"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"back"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"java"</span>

-----------------------ZRANGEBYSCORE---------------------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGEBYSCORE myzset <span class="token number">1</span> <span class="token number">10</span> <span class="token comment"># 返回score在 [1,10]之间的的成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"m1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"m3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"m2"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGEBYSCORE myzset <span class="token number">1</span> <span class="token number">5</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"m1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"m3"</span>

--------------------ZLEXCOUNT-----------------------------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZLEXCOUNT testset - +
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZLEXCOUNT testset <span class="token punctuation">[</span>apple <span class="token punctuation">[</span>java
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>

------------------ZREM--ZREMRANGEBYLEX--ZREMRANGBYRANK--ZREMRANGEBYSCORE--------------------------------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREM testset abc <span class="token comment"># 移除成员abc</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREMRANGEBYLEX testset <span class="token punctuation">[</span>apple <span class="token punctuation">[</span>java <span class="token comment"># 移除字典区间[apple,java]中的所有成员</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREMRANGEBYRANK testset <span class="token number">0</span> <span class="token number">1</span> <span class="token comment"># 移除排名0~1的所有成员</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREMRANGEBYSCORE myzset <span class="token number">0</span> <span class="token number">3</span> <span class="token comment"># 移除score在 [0,3]的成员</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>


<span class="token comment"># testset=&gt; {abc,add,apple,amaze,back,java,redis} score均为0</span>
<span class="token comment"># myzset=&gt; {(m1,1),(m2,2),(m3,3),(m4,4),(m7,7),(m9,9)}</span>
----------------ZREVRANGE--ZREVRANGEBYSCORE--ZREVRANGEBYLEX-----------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREVRANGE myzset <span class="token number">0</span> <span class="token number">3</span> <span class="token comment"># 按score递减排序，然后按索引，返回结果的 0~3</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"m9"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"m7"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"m4"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"m3"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREVRANGE myzset <span class="token number">2</span> <span class="token number">4</span> <span class="token comment"># 返回排序结果的 索引的2~4</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"m4"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"m3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"m2"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREVRANGEBYSCORE myzset <span class="token number">6</span> <span class="token number">2</span> <span class="token comment"># 按score递减顺序 返回集合中分数在[2,6]之间的成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"m4"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"m3"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"m2"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREVRANGEBYLEX testset <span class="token punctuation">[</span>java <span class="token punctuation">(</span>add <span class="token comment"># 按字典倒序 返回集合中(add,java]字典区间的成员</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"java"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"back"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"apple"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"amaze"</span>

-------------------------ZREVRANK------------------------------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREVRANK myzset m7 <span class="token comment"># 按score递减顺序，返回成员m7索引</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZREVRANK myzset m2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>


<span class="token comment"># mathscore=&gt;{(xm,90),(xh,95),(xg,87)} 小明、小红、小刚的数学成绩</span>
<span class="token comment"># enscore=&gt;{(xm,70),(xh,93),(xg,90)} 小明、小红、小刚的英语成绩</span>
-------------------ZINTERSTORE--ZUNIONSTORE-----------------------------------
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZINTERSTORE sumscore <span class="token number">2</span> mathscore enscore <span class="token comment"># 将mathscore enscore进行合并 结果存放到sumscore</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGE sumscore <span class="token number">0</span> -1 withscores <span class="token comment"># 合并后的score是之前集合中所有score的和</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xm"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"160"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"xg"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"177"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"xh"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"188"</span>

<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZUNIONSTORE lowestscore <span class="token number">2</span> mathscore enscore AGGREGATE MIN <span class="token comment"># 取两个集合的成员score最小值作为结果的</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> ZRANGE lowestscore <span class="token number">0</span> -1 withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xm"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"70"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"xg"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"87"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"xh"</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"93"</span>

</code></pre> 
<p>应用案例：</p> 
<ul>
<li>set排序 存储班级成绩表 工资表排序！</li>
<li>普通消息，1.重要消息 2.带权重进行判断</li>
<li>排行榜应用实现，取Top N测试</li>
</ul> 
<h2>
<a id="_558"></a>三、事务</h2> 
<blockquote> 
 <p>Redis的单条命令是保证原子性的，而Redis事务不保证原子性。</p> 
</blockquote> 
<h3>
<a id="1_562"></a>1.如何使用事务</h3> 
<ul>
<li> <p>开启事务（<code>multi</code>）</p> </li>
<li> <p>命令入队</p> </li>
<li> <p>执行事务(<code>exec</code>)</p> <p>开启事务后的命令不会立即执行，而是<code>exec</code>输入后一起执行</p> <pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
<span class="token punctuation">(</span>empty list or <span class="token builtin class-name">set</span><span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI  <span class="token comment">#开启</span>
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> name thenie    <span class="token comment">#命令入队</span>
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> age <span class="token number">18</span>
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get age
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> EXEC  <span class="token comment">#结束--执行</span>
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> OK
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"thenie"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"thenie"</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"18"</span>
</code></pre> <p>在redis与其称作事务，不如叫批处理更为合适。</p> <p>如果在开启事务中途<strong>不想执行</strong>了，输入<code>DISCARD</code>放弃。</p> </li>
</ul> 
<h3>
<a id="2_599"></a>2.事务中的命令错误会怎么样</h3> 
<blockquote> 
 <p>代码语法错误（编译时异常）所有的命令都不执行</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> KEYS *
<span class="token punctuation">(</span>empty list or <span class="token builtin class-name">set</span><span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI  <span class="token comment">#开启</span>
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> name thenie
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> age <span class="token number">18</span>
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setset name er   <span class="token comment">#错误的命令</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown <span class="token builtin class-name">command</span> <span class="token variable"><span class="token variable">`</span>setset<span class="token variable">`</span></span>, with args beginning with: <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>er<span class="token variable">`</span></span>, 
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get name
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> EXEC  <span class="token comment">#结束后全部没有执行</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.
</code></pre> 
<blockquote> 
 <p>代码逻辑错误 (运行时异常) **其他命令可以正常执行 ** &gt;&gt;&gt; 所以不保证事务原子性</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> KEYS *
<span class="token punctuation">(</span>empty list or <span class="token builtin class-name">set</span><span class="token punctuation">)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> name thenie
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> age <span class="token number">18</span>
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> INCR name  <span class="token comment">#逻辑错误，最字符串进行了自增</span>
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> INCR age
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> EXEC
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> OK
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range  <span class="token comment">#第三条命令错误，但是其他命令也都执行了</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">19</span>
</code></pre> 
<h2>
<a id="SpringBootreids_642"></a>四、SpringBoot整合reids</h2> 
<p>可以看我的这篇博客<a href="https://blog.csdn.net/weixin_46804107/article/details/121415474?spm=1001.2014.3001.5502">SpringBoot整合reids</a></p> 
<h2>
<a id="RDB_646"></a>五、持久化——RDB</h2> 
<blockquote> 
 <p>redis中的数据是缓存在内存中的，而内存中的数据是断电即失的，这就需要我们在<strong>指定时间间隔后将内存中的数据写入到硬盘中</strong></p> 
 <p>这个过程就叫做持久化，RDB（Redis Databases）是其中的一种方式。</p> 
</blockquote> 
<h3>
<a id="RDB_652"></a>什么是RDB</h3> 
<p>在指定时间间隔后，将内存中的数据集快照写入数据库 ；在恢复时候，直接读取快照文件，进行数据的恢复 ；</p> 
<p><img src="https://images2.imgbox.com/2c/5f/tUlltBcn_o.png" alt="image-20211119124007322"></p> 
<p>默认情况下， Redis 将数据库快照保存在名字为 dump.rdb的二进制文件中。文件名可以在配置文件中进行自定义。</p> 
<h3>
<a id="_660"></a>如何触发</h3> 
<ul>
<li> <p>触发持久化规则</p> <p>持久化规则配置在名为redis.conf配置文件中：</p> <p><img src="https://images2.imgbox.com/76/b8/4SDN6o61_o.png" alt="image-20211119124931967"></p> </li>
<li> <p>flushall命令</p> <p>当执行此命令时，也会默认触发持久化。</p> <p>重启redis数据库后，数据复原。</p> </li>
<li> <p>save</p> <p>使用 <code>save</code> 命令，会立刻对当前内存中的数据进行持久化 ,但是会阻塞，也就是不接受其他操作了；</p> 
  <blockquote> 
   <p>由于 <code>save</code> 命令是同步命令，会占用Redis的主进程。若Redis数据非常多时，<code>save</code>命令执行速度会非常慢，阻塞所有客户端的请求。</p> 
  </blockquote> </li>
<li> <p>bgsave</p> <p><code>bgsave</code> 是异步进行，进行持久化的时候，<code>redis</code> 还可以将继续响应客户端请求 ；</p> <p>也就是fork()一个子进程去进行持久化，而主进程继续工作。</p> </li>
</ul> 
<h3>
<a id="_688"></a>工作原理</h3> 
<p>在进行 <strong><code>RDB</code></strong> 的时候，<strong><code>redis</code></strong> 的主线程是不会做 <strong><code>io</code></strong> 操作的，主线程会 <strong><code>fork</code></strong> 一个子线程来完成该操作；</p> 
<ol>
<li>Redis 调用forks。同时拥有父进程和子进程。</li>
<li>子进程将数据集写入到一个临时 RDB 文件中。</li>
<li>当子进程完成对新 RDB 文件的写入时，Redis 用新 RDB 文件替换原来的 RDB 文件，并删除旧的 RDB 文件。</li>
</ol> 
<p>这种工作方式使得 Redis 可以从写时复制（copy-on-write）机制中获益(因为是使用子进程进行写操作，而父进程依然可以接收来自客户端的请求。)</p> 
<h3>
<a id="_698"></a>优缺点</h3> 
<p><strong>优点：</strong></p> 
<ol>
<li>适合大规模的数据恢复</li>
<li>对数据的完整性要求不高</li>
</ol> 
<p><strong>缺点：</strong></p> 
<ol>
<li>需要一定的时间间隔进行操作，如果redis意外宕机了，这个最后一次修改的数据就没有了。</li>
<li>fork进程的时候，会占用一定的内容空间。</li>
</ol> 
<h2>
<a id="AOF_710"></a>六、持久化——AOF</h2> 
<h3>
<a id="AOF_712"></a>什么是AOF</h3> 
<p>将我们所有的命令都记录下来，history，恢复的时候就把这个文件全部再执行一遍</p> 
<blockquote> 
 <p>以日志的形式来<strong>记录每个写的操作</strong>，将Redis执行过的所有指令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis<strong>重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</strong>。</p> 
</blockquote> 
<h3>
<a id="_718"></a>如何开启</h3> 
<p>默认是不开启的，我们需要手动配置，然后重启redis，就可以生效了！</p> 
<p>如果要使用AOF，需要修改配置文件redis.conf：</p> 
<p><img src="https://images2.imgbox.com/63/49/W5xuUwr7_o.png" alt="image-20211119195411052"></p> 
<p><code>appendonly no yes</code>则表示启用AOF</p> 
<h3>
<a id="_728"></a>转存文件出问题</h3> 
<p>如果这个aof文件有错位，这时候redis是启动不起来的，我需要修改这个aof文件</p> 
<p>redis给我们提供了一个工具<code>redis-check-aof --fix</code>会将这个文件中出问题的命令剔除掉</p> 
<h3>
<a id="_734"></a>优缺点</h3> 
<p><strong>优点</strong></p> 
<ol>
<li>每一次修改都会同步，文件的完整性会更加好</li>
<li>没秒同步一次，可能会丢失一秒的数据</li>
<li>从不同步，效率最高</li>
</ol> 
<p><strong>缺点</strong></p> 
<ol>
<li>相对于数据文件来说，aof远远大于rdb，修复速度比rdb慢！</li>
<li>Aof运行效率也要比rdb慢，所以我们redis默认的配置就是rdb持久化</li>
</ol> 
<h2>
<a id="redis_749"></a>七、redis主从复制</h2> 
<h3>
<a id="_751"></a>概念</h3> 
<blockquote> 
 <p>在redis主从架构中，Master节点负责处理写请求，Slave节点只处理读请求。对于写请求少，读请求多的场景，例如电商详情页，通过这种读写分离的操作可以大幅提高并发量，通过增加redis从节点的数量可以使得redis的QPS达到10W+。</p> 
</blockquote> 
<p>当Master结点写入数据后会同步到Slave结点，简易版架构图如下：</p> 
<p><img src="https://images2.imgbox.com/78/2e/u4Qo0r4h_o.png" alt="image-20211119172537619"></p> 
<h3>
<a id="redis_759"></a>在一台服务器上模拟一主二从（redis）</h3> 
<ol>
<li> <p>设置三个redis服务进程，并进行配置</p> <p>cp三个配置文件：</p> <p><img src="https://images2.imgbox.com/42/f4/22IrgytU_o.png" alt="image-20211119175739492"></p> <pre><code class="prism language-bash"><span class="token comment">#分别修改三个redis的配置文件</span>
--------------主（redis.conf）-------------
<span class="token comment">#端口号</span>
port <span class="token number">6379</span>
<span class="token comment">#pid文件名</span>
pidfile /var/run/redis_6379.pid
<span class="token comment">#日志文件名</span>
logfile <span class="token string">"6379.log"</span>
<span class="token comment">#rdb文件名</span>
dbfilename dump.rdb
--------------从（slave1.conf）-------------
port <span class="token number">6380</span>
pidfile /var/run/redis_6380.pid
logfile <span class="token string">"6380.log"</span>
dbfilename dump6380.rdb
--------------从（slave2.conf）-------------
port <span class="token number">6381</span>
pidfile /var/run/redis_6381.pid
logfile <span class="token string">"6381.log"</span>
dbfilename dump6381.rdb
</code></pre> <p>启动服务成功：</p> <p><img src="https://images2.imgbox.com/de/57/CIxEBfqm_o.png" alt="image-20211119180502947"></p> </li>
<li> <p>建立联系</p> <p><mark>默认情况下每台redis都是主机点</mark>，所以我们只用配置从机就好了</p> <p>使用<code>SLAVEOF host port</code>就可以为从机配置主机了。</p> <p><strong>配置成功并用<code>info replication</code>查看主从状态信息</strong>：</p> <p><img src="https://images2.imgbox.com/77/42/SUxVyEjp_o.png" alt="image-20211119181239588"></p> <p><mark>使用规则</mark></p> 
  <ul>
<li> <p>从机只能进行读操作，主机可以读但是多用于写</p> </li>
<li> <p>当主机断电宕机后，默认情况下从机的角色不会发生变化 ，集群中只是失去了写操作，当主机恢复以后，又会连接上从机恢复原状。</p> </li>
<li> <p>当从机断电宕机后，若不是使用配置文件配置的从机，再次启动后作为主机是无法获取之前主机的数据的，若此时重新配置称为从机，又可以获取到主机的所有数据。这里就要提到一个同步原理。</p> </li>
<li> <p>第二条中提到，默认情况下，主机故障后，不会出现新的主机，有两种方式可以产生新的主机：</p> 
    <ul>
<li>从机手动执行命令<code>slaveof no one</code>,这样执行以后从机会独立出来成为一个主机</li>
<li>使用哨兵模式（自动选举）</li>
</ul> </li>
</ul> </li>
</ol> 
<h2>
<a id="_817"></a>八、哨兵模式</h2> 
<p>当主服务器宕机后，如果手动切换主服务器显然是不太现实的，更多时候采用哨兵模式。</p> 
<blockquote> 
 <p>概述</p> 
</blockquote> 
<p>哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是<strong>哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例。</strong></p> 
<p><img src="https://images2.imgbox.com/6b/65/jHZPbDet_o.png" alt="11320039-57a77ca2757d0924.webp"></p> 
<p>这里<strong>哨兵的作用：</strong></p> 
<ul>
<li>通过发送命令，监控redis，让其返回运行状态（包括主服务器和从服务器）</li>
<li>当哨兵检测到master宕机后，会自动将一台slave切换成master，然后通过<strong>发布订阅模式</strong>通知其他的从服务器，修改配置文件，让它们切换主机。</li>
</ul> 
<p>然而一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了多哨兵模式。</p> 
<p><img src="https://images2.imgbox.com/c5/6e/wUctUmGk_o.png" alt="11320039-3f40b17c0412116c.webp"></p> 
<blockquote> 
 <p>故障切换（failover）的过程</p> 
</blockquote> 
<p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象成为<strong>主观下线</strong>。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong>。这样对于客户端而言，一切都是透明的。</p> 
<h2>
<a id="_840"></a>九、缓存穿透与雪崩</h2> 
<h3>
<a id="_842"></a>缓存穿透</h3> 
<blockquote> 
 <p>概念</p> 
</blockquote> 
<p>在默认情况下，用户请求数据时，会先去缓存中去查找，未命中再去数据库中查找。但如果访问量过大，并且缓存未命中，这时都会转移到数据库中，导致压力过大，就可能导致数据库崩溃。网络安全中也有人恶意使用这种手段进行攻击被称为洪水攻击。</p> 
<blockquote> 
 <p>解决方案</p> 
</blockquote> 
<p><strong>布隆过滤器</strong></p> 
<p>顾名思义，布隆，在前方举起一个盾牌。</p> 
<p>最所有可能查询的参数进行Hash存储，以便快速判断是否有该数据；在控制层进行拦截校验，如果不存在直接返回。</p> 
<p><img src="https://images2.imgbox.com/4d/37/15UkHZ48_o.png" alt="布隆"></p> 
<p><strong>缓存空对象</strong></p> 
<p>若某次请求在缓存和数据库中没有找到，就在缓存中放一个空对象，便于后续处理。</p> 
<p>这样做有一个缺陷：存储空对象也需要空间，大量的空对象会耗费一定的空间，存储效率并不高。解决这个缺陷的方式就是设置较短过期时间；</p> 
<p>即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</p> 
<h3>
<a id="_866"></a>缓存击穿</h3> 
<blockquote> 
 <p>概念</p> 
</blockquote> 
<p>相较于缓存穿透，<strong>缓存击穿</strong>目的性更强，当某个key在缓存中过期，同时有多个请求同时访问此key，这些请求都会击穿到DB中，造成瞬时DB请求量大、压力骤增。这就是缓存被击穿，只是针对其中某个key的缓存不可用而导致击穿，但是其他的key依然可以使用缓存响应。</p> 
<p>比如热搜排行上，一个热点新闻被同时大量访问就可能导致缓存击穿。</p> 
<blockquote> 
 <p>解决方案</p> 
</blockquote> 
<ol>
<li> <p><strong>设置热点数据永不过期</strong></p> <p>这样就不会出现热点数据过期的情况，但是这样会占用空间，一旦热点数据过多占用空间就会更多。当redis内存空间满的时候也会清理部分数据。</p> </li>
<li> <p><strong>加互斥锁（分布式锁）</strong></p> <p>在访问key之前，采用SETNX（set if not exists）来设置另一个短期key来锁住当前key的访问，访问结束再删除该短期key。保证同时刻只有一个线程访问。这样对锁的要求就十分高。</p> </li>
</ol> 
<h3>
<a id="_884"></a>缓存雪崩</h3> 
<blockquote> 
 <p>概念</p> 
</blockquote> 
<p>大量的key设置了相同的过期时间，导致在缓存在同一时刻全部失效，造成瞬时DB请求量大、压力骤增，引起雪崩。</p> 
<p><img src="https://images2.imgbox.com/1a/a5/yHBq55oh_o.png" alt="缓存失效"></p> 
<blockquote> 
 <p>解决方案</p> 
</blockquote> 
<ul>
<li> <p>redis高可用</p> <p>这个思想的含义是，既然redis有可能挂掉，那我多增设几台redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群</p> </li>
<li> <p>限流降级</p> <p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p> </li>
<li> <p>数据预热</p> <p>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。<br> 对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</p> </li>
</ul> 
<hr> 
<p><img src="https://images2.imgbox.com/f2/a3/mFtHXrA1_o.jpg" alt="在这里插入图片描述"></p> 
<p><strong>如果文章对您有帮助，还请赏个赞，加个关~~</strong></p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Go Machine Learning - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Go Machine Learning</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-light">
                    
                        
                    
                    <h1>
<a id="Go_Machine_Learning_0"></a>Go Machine Learning</h1> 
<h2>
<a id="_2"></a>前言</h2> 
<p>最近因为一直在弄部署整天c++写的非常头疼,趁着昨天把分割部署写好后打算换换口味,想着试试Go语言来实现一些机器学习,深度学习会是什么样子.之前推荐过<strong>Go+(goplus)</strong>,不过这次打算用更基础的go语法来尝试.</p> 
<h2>
<a id="1_8"></a>1.准备工作</h2> 
<p>对于某个从未涉及的领域一开始肯定是一脸茫然,所以需要先找点资料入门.网上相关资料也没有特别多,搜的话基本就只有那几本书.不过这不重要随便找一本书了解入个门,后面的就都可以举一反三了</p> 
<p>这里我看的是这本<a href="https://pan.baidu.com/s/1fLVdXE5kFid4-M4fqIyGeg">机器学习Go语言实现</a>,提取码:<code>o69s</code>.这本书的出版时间是2018年,也就代表着书中的代码不一定全部能用,毕竟一些三方库肯定会有更新改动.</p> 
<p>对应的仓库地址:<a href="https://github.com/PacktPublishing/Machine-Learning-With-Go">https://github.com/PacktPublishing/Machine-Learning-With-Go</a></p> 
<h3>
<a id="11__16"></a>1.1 基本知识</h3> 
<p>这里的基本知识不止包括Go语言语法,编程知识和一些机器学习深度学习的知识,更主要的是了解第三方的库如何使用.拿到书以后迅速看一看前几章(两章左右吧,不用太细致看文字毕竟还有第二次细读),主要关注里面使用的库,这里总结一下我使用到的(有的书里的库我替换成了自己在github上找的)</p> 
<ul>
<li> <p>gonum: ”gonum.org/v1/gonum“</p> </li>
<li> <p>gota: “github.com/go-gota/gota”</p> </li>
<li> <p>sklearn “github.com/pa-m/sklearn”</p> </li>
<li> <p>plot “gonum.org/v1/plot”</p> </li>
</ul> 
<p>大致总结一下:<strong>gonum</strong>提供一些矩阵计算,类似于numpy;<strong>gota</strong>下有dataframe和series,类似于pandas;<strong>sklearn</strong>就是go实现部分sklearn的方法;<strong>plot</strong>顾名思义就是画图</p> 
<p>对于Go来说,由于静态类型的限制在机器学习的代码编写上肯定是不如python便捷的,这一点心里要做好准备.如果习惯了python的灵活性,或者是只会python的那部分人最好不要尝试,当然估计这部分人也不会有这种兴趣爱好花时间在其他语言的探索上,有些话最后再说.</p> 
<p>扯回这篇Blog,上面的三方库都可以去github上搜到源码和文档说明,配合着书里的代码很容易理解使用.</p> 
<h3>
<a id="12__34"></a>1.2 项目创建</h3> 
<p>这个应该是最简单的,<code>go mod init </code>随便创建一个新的项目,然后根据自己的想法创建相关的文件结构</p> 
<h2>
<a id="2__40"></a>2. 正式开始</h2> 
<h3>
<a id="21__42"></a>2.1 数据读取部分</h3> 
<p>既然是机器学习,那么数据当然是必不可少的.所以书上一开始就讲述了数据的收集和组织.这里我不多作赘述,只要学会怎么读取数据就好,给个基本的读取csv文件模板(下面的demo都是基于csv文件)</p> 
<pre><code class="prism language-go">file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

irisDF <span class="token operator">:=</span> dataframe<span class="token punctuation">.</span><span class="token function">ReadCSV</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>irisDF<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/33/ea/8dHiW9cb_o.png" alt="image-20221020200904415"></p> 
<p>当然如果不想借助dataframe,自己写个读取函数也很简单</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">PrintCSV</span><span class="token punctuation">(</span>filename <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	r <span class="token operator">:=</span> csv<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>

	records<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> record <span class="token operator">:=</span> <span class="token keyword">range</span> records <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> record <span class="token punctuation">{<!-- --></span>
			<span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
			<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/24/d6/46BJQA29_o.png" alt="image-20221020200732574"></p> 
<p>还有一些其他数据格式,例如jsondatabase等都可以通过各自的方法实现读取,剩下的就是在dataframe里面对数据进行操作</p> 
<h3>
<a id="22__92"></a>2.2 矩阵计算部分</h3> 
<p>这部分主要就是利用gonum对数据进行计算,类似的还有numcpp,主要是实现一些矩阵计算.这部分看看书里demo就好,用的时候还是得自己查官网相关的文档</p> 
<h3>
<a id="23_demo_98"></a>2.3 基本demo</h3> 
<p>这部分基本就是一些实战,从数据读取到探索性分析,再到建模评估.这里书上的库我没用,而是选择go语言版的sklearn,虽然功能还不太完善,但是基本的几个模型,预处理方法以及评价指标都还比较全.同样的查看文档后去实现书上的几个demo</p> 
<h4>
<a id="231__102"></a>2.3.1 回归</h4> 
<p>书上的例子是<strong>Advertising.csv</strong>,根据自变量回归得到target Sales.根据上述流程,读取数据就直接使用dataframe.然后进行探索性分析,主要是查看自变量和目标是否符合线性关系或者说存在相关性,我们肯定不会拿一个一看就毫不相关的变量去拟合回归.</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">PlotImg</span><span class="token punctuation">(</span>filename <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	DF <span class="token operator">:=</span> dataframe<span class="token punctuation">.</span><span class="token function">ReadCSV</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

	target <span class="token operator">:=</span> DF<span class="token punctuation">.</span><span class="token function">Col</span><span class="token punctuation">(</span><span class="token string">"Sales"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> colName <span class="token operator">:=</span> <span class="token keyword">range</span> DF<span class="token punctuation">.</span><span class="token function">Names</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		pts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span>plotter<span class="token punctuation">.</span>XYs<span class="token punctuation">,</span> DF<span class="token punctuation">.</span><span class="token function">Nrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token keyword">for</span> i<span class="token punctuation">,</span> floatVal <span class="token operator">:=</span> <span class="token keyword">range</span> DF<span class="token punctuation">.</span><span class="token function">Col</span><span class="token punctuation">(</span>colName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Float</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>X <span class="token operator">=</span> floatVal
			pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Y <span class="token operator">=</span> target<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
		<span class="token punctuation">}</span>

		p <span class="token operator">:=</span> plot<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		p<span class="token punctuation">.</span>X<span class="token punctuation">.</span>Label<span class="token punctuation">.</span>Text <span class="token operator">=</span> colName
		p<span class="token punctuation">.</span>Y<span class="token punctuation">.</span>Label<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"y"</span>

		p<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>plotter<span class="token punctuation">.</span><span class="token function">NewGrid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		s<span class="token punctuation">,</span> err <span class="token operator">:=</span> plotter<span class="token punctuation">.</span><span class="token function">NewScatter</span><span class="token punctuation">(</span>pts<span class="token punctuation">)</span>

		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		s<span class="token punctuation">.</span>GlyphStyle<span class="token punctuation">.</span>Radius <span class="token operator">=</span> vg<span class="token punctuation">.</span><span class="token function">Points</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
		p<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

		<span class="token keyword">if</span> err <span class="token operator">:=</span> p<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> colName<span class="token operator">+</span><span class="token string">"_scatter.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>想比matplotlib等python的画图库来说这个是不是复杂很多,除了要自己新建figure,还得一对对的添加(x,y).当然也可以把遍历部分封装成一个函数,只需要输入想要画的列名,不过如果不是需要多次使用也没必要,毕竟灵活性在这放着.如果改成绘制其他图表,不仅plotter的对象得用if或者switch判断,其他的格式也有可能要改.这里列的选择可以用<code>DF.Select([]string{"xx","xxx"})</code></p> 
<p><img src="https://images2.imgbox.com/3c/4a/94JNvxDm_o.png" alt="image-20221020203009051"></p> 
<p><img src="https://images2.imgbox.com/60/9b/4Q5csuPr_o.png" alt="image-20221020203035137"></p> 
<p>应该可以得到书上的效果,从图上也可以看出哪些变量和Sales具有线性关系.这里demo我选择一元线性回归,目标是找到<code>Sales=w*TV+b</code></p> 
<p>线性回归的原理很多书,博客都有介绍,如何利用梯度下降一步步拟合减小损失函数,所以这里直接用sklearn来实现.</p> 
<p>sklearn的模型输入是gonum中的<code>mat.Matrix</code>,但是我们是dataframe读取的数据,并不是同一种类型,这里就是静态类型的麻烦之处.不过还好mat.Matrix只是一个interface,所以为了能够转换,我们实现接口相应的方法就好.</p> 
<p><img src="https://images2.imgbox.com/6f/66/0hjPFw8A_o.png" alt="image-20221020203850392"></p> 
<pre><code class="prism language-go"><span class="token keyword">type</span> matrix <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
   dataframe<span class="token punctuation">.</span>DataFrame
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m matrix<span class="token punctuation">)</span> <span class="token function">At</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> m<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m matrix<span class="token punctuation">)</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span> mat<span class="token punctuation">.</span>Matrix <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> mat<span class="token punctuation">.</span>Transpose<span class="token punctuation">{<!-- --></span>m<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f7/b0/7I0HblUp_o.png" alt="image-20221020203947278"></p> 
<p>我们只需要实现At()和T(),也就是取值和转置,Dims()方法在dataframe中本身就有实现;其实仔细看的话,方法基本都有只是名字不一样.当然这只是针对float,如果是int或者string,At()中也要改为.Int()或者.String().</p> 
<p>转为Matrix之后,剩下的就和python类似了,创建模型-&gt;fit()-&gt;predict()-&gt;评估,完整代码</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> p3

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/go-gota/gota/dataframe"</span>
	<span class="token string">"github.com/pa-m/sklearn/linear_model"</span>
	<span class="token string">"github.com/pa-m/sklearn/metrics"</span>
	modelselection <span class="token string">"github.com/pa-m/sklearn/model_selection"</span>
	<span class="token string">"gonum.org/v1/gonum/mat"</span>
	<span class="token string">"gonum.org/v1/plot"</span>
	<span class="token string">"gonum.org/v1/plot/plotter"</span>
	<span class="token string">"gonum.org/v1/plot/vg"</span>
	<span class="token string">"image/color"</span>
	<span class="token string">"log"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token comment">// for convert dataframe to matrix</span>
<span class="token comment">// create nessesary implementations</span>

<span class="token keyword">type</span> matrix <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	dataframe<span class="token punctuation">.</span>DataFrame
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m matrix<span class="token punctuation">)</span> <span class="token function">At</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> m<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m matrix<span class="token punctuation">)</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span> mat<span class="token punctuation">.</span>Matrix <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> mat<span class="token punctuation">.</span>Transpose<span class="token punctuation">{<!-- --></span>m<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// sales=w*TV+b</span>
<span class="token keyword">func</span> <span class="token function">LinearDemo</span><span class="token punctuation">(</span>Isplot <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//load file</span>
	filename <span class="token operator">:=</span> <span class="token string">"Advertising.csv"</span>
	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	DF <span class="token operator">:=</span> dataframe<span class="token punctuation">.</span><span class="token function">ReadCSV</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

	X <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">DenseCopyOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>matrix<span class="token punctuation">{<!-- --></span>DF<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"TV"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	Y <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">DenseCopyOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>matrix<span class="token punctuation">{<!-- --></span>DF<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"Sales"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	XTrain<span class="token punctuation">,</span> XTest<span class="token punctuation">,</span> YTrain<span class="token punctuation">,</span> YTest <span class="token operator">:=</span> modelselection<span class="token punctuation">.</span><span class="token function">TrainTestSplit</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

	lr <span class="token operator">:=</span> linearmodel<span class="token punctuation">.</span><span class="token function">NewLinearRegression</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	lr<span class="token punctuation">.</span><span class="token function">Fit</span><span class="token punctuation">(</span>XTrain<span class="token punctuation">,</span> YTrain<span class="token punctuation">)</span>

	NPred<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> XTest<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	Pred <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>NPred<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

	lr<span class="token punctuation">.</span><span class="token function">Predict</span><span class="token punctuation">(</span>XTest<span class="token punctuation">,</span> Pred<span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Coefficients: %.3fn"</span><span class="token punctuation">,</span> mat<span class="token punctuation">.</span><span class="token function">Formatted</span><span class="token punctuation">(</span>lr<span class="token punctuation">.</span>Coef<span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Coefficients: %.3fn"</span><span class="token punctuation">,</span> mat<span class="token punctuation">.</span><span class="token function">Formatted</span><span class="token punctuation">(</span>lr<span class="token punctuation">.</span>Intercept<span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"the pred result is: Sales=%.3f *TV + %.3fn"</span><span class="token punctuation">,</span> mat<span class="token punctuation">.</span><span class="token function">Formatted</span><span class="token punctuation">(</span>lr<span class="token punctuation">.</span>Intercept<span class="token punctuation">)</span><span class="token punctuation">,</span> mat<span class="token punctuation">.</span><span class="token function">Formatted</span><span class="token punctuation">(</span>lr<span class="token punctuation">.</span>Coef<span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Mean squared error: %.2fn"</span><span class="token punctuation">,</span> metrics<span class="token punctuation">.</span><span class="token function">MeanSquaredError</span><span class="token punctuation">(</span>YTest<span class="token punctuation">,</span> Pred<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Mean absolute error: %.2fn"</span><span class="token punctuation">,</span> metrics<span class="token punctuation">.</span><span class="token function">MeanAbsoluteError</span><span class="token punctuation">(</span>YTest<span class="token punctuation">,</span> Pred<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Variance score: %.2fn"</span><span class="token punctuation">,</span> metrics<span class="token punctuation">.</span><span class="token function">R2Score</span><span class="token punctuation">(</span>YTest<span class="token punctuation">,</span> Pred<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> Isplot <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//predict all</span>
		NPred<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> X<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		Pred <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>NPred<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		lr<span class="token punctuation">.</span><span class="token function">Predict</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Pred<span class="token punctuation">)</span>

		p <span class="token operator">:=</span> plot<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		xys <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y mat<span class="token punctuation">.</span>Matrix<span class="token punctuation">)</span> plotter<span class="token punctuation">.</span>XYs <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">var</span> data plotter<span class="token punctuation">.</span>XYs
			<span class="token keyword">for</span> sample <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> sample <span class="token operator">&lt;</span> NPred<span class="token punctuation">;</span> sample<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
				data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span> X<span class="token punctuation">,</span> Y <span class="token builtin">float64</span> <span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span>X<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span>sample<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Y<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span>sample<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> data
		<span class="token punctuation">}</span>

		s<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> plotter<span class="token punctuation">.</span><span class="token function">NewScatter</span><span class="token punctuation">(</span><span class="token function">xys</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">)</span>
		l<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> plotter<span class="token punctuation">.</span><span class="token function">NewLine</span><span class="token punctuation">(</span><span class="token function">xys</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
		l<span class="token punctuation">.</span>Color <span class="token operator">=</span> color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">}</span>
		p<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> l<span class="token punctuation">)</span>

		<span class="token comment">// Save the plot to a PNG file.</span>
		pngfile <span class="token operator">:=</span> <span class="token string">"linearregression.png"</span>
		os<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>pngfile<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> p<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span>vg<span class="token punctuation">.</span>Inch<span class="token punctuation">,</span> pngfile<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/e9/61/gTsqqZDn_o.png" alt="image-20221020204505805"></p> 
<p><img src="https://images2.imgbox.com/a7/12/KsSvE8o4_o.png" alt="image-20221020204527712"></p> 
<h4>
<a id="232__285"></a>2.3.2 分类</h4> 
<p>这里以iris为例,首先尝试一下传统的机器学习模型</p> 
<h5>
<a id="2321_KNNSVM_289"></a>2.3.2.1 KNN&amp;&amp;SVM</h5> 
<p>还是一样先查看数据,探索性分析这部分我直接略过,主要是后续对数据的处理.</p> 
<p>iris.csv的内容如下</p> 
<p><img src="https://images2.imgbox.com/50/52/RblhcCuA_o.png" alt="image-20221020205028322"></p> 
<p>对应的label是string,所以需要先变为数值型.这部分可以使用sklearn中的<a href="https://github.com/pa-m/sklearn/blob/beb861ee48b1/preprocessing/label.go#L273">LabelEncoder</a> <a href="https://pkg.go.dev/github.com/pa-m/sklearn/preprocessing#LabelEncoder">¶</a>或者<a href="https://github.com/pa-m/sklearn/blob/beb861ee48b1/preprocessing/data.go#L682">OneHotEncoder</a>,也可以利用dataframe的Capply()自定义方法实现,这是我的转换函数</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">replaceLabel</span><span class="token punctuation">(</span>col series<span class="token punctuation">.</span>Series<span class="token punctuation">)</span> series<span class="token punctuation">.</span>Series <span class="token punctuation">{<!-- --></span>
	rows <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	NewSeries <span class="token operator">:=</span> series<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> series<span class="token punctuation">.</span>Float<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
	changeMap <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{<!-- --></span>
		<span class="token string">"Iris-setosa"</span><span class="token punctuation">:</span>     <span class="token number">0.0</span><span class="token punctuation">,</span>
		<span class="token string">"Iris-versicolor"</span><span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
		<span class="token string">"Iris-virginica"</span><span class="token punctuation">:</span>  <span class="token number">2.0</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		NewSeries<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>changeMap<span class="token punctuation">[</span>col<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> NewSeries

<span class="token punctuation">}</span>
</code></pre> 
<p>查看文档可以知道Capply()需要入参和输出都是Series,所以得根据方法要求写转换函数,再次体会一下类型限制.其余的就是使用sklearn没啥好说的,完整代码如下</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> p3

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/go-gota/gota/dataframe"</span>
	<span class="token string">"github.com/go-gota/gota/series"</span>
	<span class="token string">"github.com/pa-m/sklearn/metrics"</span>
	modelselection <span class="token string">"github.com/pa-m/sklearn/model_selection"</span>
	<span class="token string">"github.com/pa-m/sklearn/neighbors"</span>
	<span class="token string">"github.com/pa-m/sklearn/svm"</span>
	<span class="token string">"gonum.org/v1/gonum/mat"</span>
	<span class="token string">"log"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">replaceLabel</span><span class="token punctuation">(</span>col series<span class="token punctuation">.</span>Series<span class="token punctuation">)</span> series<span class="token punctuation">.</span>Series <span class="token punctuation">{<!-- --></span>
	rows <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	NewSeries <span class="token operator">:=</span> series<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> series<span class="token punctuation">.</span>Float<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
	changeMap <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{<!-- --></span>
		<span class="token string">"Iris-setosa"</span><span class="token punctuation">:</span>     <span class="token number">0.0</span><span class="token punctuation">,</span>
		<span class="token string">"Iris-versicolor"</span><span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
		<span class="token string">"Iris-virginica"</span><span class="token punctuation">:</span>  <span class="token number">2.0</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		NewSeries<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>changeMap<span class="token punctuation">[</span>col<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> NewSeries

<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">ClassifyDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	filename <span class="token operator">:=</span> <span class="token string">"iris.csv"</span>
	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	DF <span class="token operator">:=</span> dataframe<span class="token punctuation">.</span><span class="token function">ReadCSV</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

	<span class="token comment">//replace the label from string to float</span>
	X <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">DenseCopyOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>matrix<span class="token punctuation">{<!-- --></span>DF<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	Y <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">DenseCopyOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>matrix<span class="token punctuation">{<!-- --></span>DF<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Capply</span><span class="token punctuation">(</span>replaceLabel<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	XTrain<span class="token punctuation">,</span> XTest<span class="token punctuation">,</span> YTrain<span class="token punctuation">,</span> YTest <span class="token operator">:=</span> modelselection<span class="token punctuation">.</span><span class="token function">TrainTestSplit</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

	clf <span class="token operator">:=</span> neighbors<span class="token punctuation">.</span><span class="token function">NewKNeighborsClassifier</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"uniform"</span><span class="token punctuation">)</span>
	clf<span class="token punctuation">.</span><span class="token function">Fit</span><span class="token punctuation">(</span>XTrain<span class="token punctuation">,</span> YTrain<span class="token punctuation">)</span>

	NPred<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> XTest<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	Pred <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>NPred<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	clf<span class="token punctuation">.</span><span class="token function">Predict</span><span class="token punctuation">(</span>XTest<span class="token punctuation">,</span> Pred<span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"The accuracy of KNN: %.02f%%n"</span><span class="token punctuation">,</span> metrics<span class="token punctuation">.</span><span class="token function">AccuracyScore</span><span class="token punctuation">(</span>YTest<span class="token punctuation">,</span> Pred<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span>

	clf2 <span class="token operator">:=</span> svm<span class="token punctuation">.</span><span class="token function">NewSVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//clf2.Degree = 3</span>
	clf2<span class="token punctuation">.</span>Kernel <span class="token operator">=</span> <span class="token string">"linear"</span>
	clf2<span class="token punctuation">.</span><span class="token function">Fit</span><span class="token punctuation">(</span>XTrain<span class="token punctuation">,</span> YTrain<span class="token punctuation">)</span>
	clf2<span class="token punctuation">.</span><span class="token function">Predict</span><span class="token punctuation">(</span>XTest<span class="token punctuation">,</span> Pred<span class="token punctuation">)</span>
	<span class="token comment">//fmt.Printf("Pred:n%gn", mat.Formatted(Pred))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"The accuracy of SVM: %.02f%%n"</span><span class="token punctuation">,</span> metrics<span class="token punctuation">.</span><span class="token function">AccuracyScore</span><span class="token punctuation">(</span>YTest<span class="token punctuation">,</span> Pred<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/d5/27/8aw1Pbs0_o.png" alt="image-20221020211125078"></p> 
<p>KNN本来就是用于多分类问题,所以效果还可以;svm只是二分类,没有用上一对多等策略,所以预测的大多都是某一类导致准确率很差;</p> 
<h5>
<a id="2322_MLP_395"></a>2.3.2.2 MLP</h5> 
<p>尝试了传统的方法,在简单数据集上选择了合适的模型,效果已经非常好了,那再用深度学习方法来试试呢</p> 
<p>这里可以选择用sklearn的MLPClassifier,不过书上也给出了纯go实现,这部分还是值得好好品一品的.</p> 
<p>回顾一下神经网络训练的基本内容</p> 
<ol>
<li>构造简单网络,定义输入,隐藏层和输出,中间加入激活函数</li>
<li>正向传播,计算网络输出与目标的损失</li>
<li>根据损失函数反向传播计算梯度,对网络中的权重和偏置项进行更新</li>
</ol> 
<p>对于计算推导,可以看看这篇博客,有图有计算步骤<a href="https://www.cnblogs.com/charlotte77/p/5629865.html">https://www.cnblogs.com/charlotte77/p/5629865.html</a></p> 
<p>下面主要来分析一下这本书中的写法,首先要构思如何去写这个功能,根据上面几个库的使用,应该体会到如果想复用或者模块化,那肯定得构建一个对象,然后一步步实现里面的类方法.go语言虽然没有class,但是struct也能实现我们想要的.</p> 
<pre><code class="prism language-go"><span class="token keyword">type</span> neuralNet <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	config  neuralNetConfig
	wHidden <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
	bHidden <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
	wOut    <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
	bOut    <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
<span class="token punctuation">}</span>

<span class="token keyword">type</span> neuralNetConfig <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	inputNum     <span class="token builtin">int</span>
	outputNum    <span class="token builtin">int</span>
	hiddenNum    <span class="token builtin">int</span>
	Epochs       <span class="token builtin">int</span>
	learningRate <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewNetwork</span><span class="token punctuation">(</span>config neuralNetConfig<span class="token punctuation">)</span> <span class="token operator">*</span>neuralNet <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>neuralNet<span class="token punctuation">{<!-- --></span>config<span class="token punctuation">:</span> config<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这就是最基本的类以及初始化方法,我们构造神经网络的时候必须指定输入输出的大小,隐藏层的层数以及训练时的Epochs和学习率</p> 
<p>再来看看两个最基本的类方法,<code>train()</code>和<code>predict()</code></p> 
<p>对于<code>train()</code>,根据上面说的流程,我们先初始化一些权重和bias,然后一次次迭代,正向传播计算输出,再反向传播更新网络参数.<strong>这里需要注意的是现在的mat不再允许创建行列均为0的Matrix,所以得自己一步步计算原代码中的维度大小进行修改填充</strong></p> 
<p>原代码中激活函数用的<code>Sigmoid()</code>,损失就是<code>target-output</code>,好处是对于损失的梯度不用计算,默认就是error<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        (
       
       
        
         1
        
        
         2
        
       
       
        (
       
       
        y
       
       
        −
       
       
        
         y
        
        
         ^
        
       
       
        
         )
        
        
         2
        
       
       
        
         )
        
        
         
         
          ′
         
        
       
       
        =
       
       
        y
       
       
        −
       
       
        
         y
        
        
         ^
        
       
      
      
       (frac{1}{2}(y-hat{y})^2)^{'}=y-hat{y}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.1901em;vertical-align: -0.345em"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8451em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="frac-line" style="border-bottom-width: 0.04em"></span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0359em">y</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 1.1925em;vertical-align: -0.25em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.6944em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0359em">y</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.1944em"><span class=""></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9425em"><span class="" style="margin-right: 0.05em"><span class="pstrut" style="height: 2.5795em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class=""></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8278em"><span class="" style="margin-right: 0.0714em"><span class="pstrut" style="height: 2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em"></span></span><span class="base"><span class="strut" style="height: 0.7778em;vertical-align: -0.1944em"></span><span class="mord mathnormal" style="margin-right: 0.0359em">y</span><span class="mspace" style="margin-right: 0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em"></span></span><span class="base"><span class="strut" style="height: 0.8889em;vertical-align: -0.1944em"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.6944em"><span class=""><span class="pstrut" style="height: 3em"></span><span class="mord mathnormal" style="margin-right: 0.0359em">y</span></span><span class=""><span class="pstrut" style="height: 3em"></span><span class="accent-body"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.1944em"><span class=""></span></span></span></span></span></span></span></span></span>.sigmoid的导数也可以预先计算设置好.修改后的相关代码如下</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>nn <span class="token operator">*</span>neuralNet<span class="token punctuation">)</span> <span class="token function">train</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	N<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	randSource <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">NewSource</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	randGen <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>randSource<span class="token punctuation">)</span>

	wHiddenRaw <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token operator">*</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>inputNum<span class="token punctuation">)</span>
	bHiddenRaw <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">)</span>
	wOutRaw <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token operator">*</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">)</span>
	bOutRaw <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> param <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{<!-- --></span>wHiddenRaw<span class="token punctuation">,</span> bHiddenRaw<span class="token punctuation">,</span> wOutRaw<span class="token punctuation">,</span> bOutRaw<span class="token punctuation">}</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> param <span class="token punctuation">{<!-- --></span>
			param<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> randGen<span class="token punctuation">.</span><span class="token function">Float64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	wHidden <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>inputNum<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> wHiddenRaw<span class="token punctuation">)</span>
	bHidden <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> bHiddenRaw<span class="token punctuation">)</span>
	wOut <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> wOutRaw<span class="token punctuation">)</span>
	bOut <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> bOutRaw<span class="token punctuation">)</span>

	output <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token comment">// train model.</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>Epochs<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// forward</span>
		hiddenLayerInput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		hiddenLayerInput<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> wHidden<span class="token punctuation">)</span>
		addBHidden <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> col <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> v <span class="token operator">+</span> bHidden<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		hiddenLayerInput<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>addBHidden<span class="token punctuation">,</span> hiddenLayerInput<span class="token punctuation">)</span>

		hiddenLayerActivations <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		applySigmoid <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">Sigmoid</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		hiddenLayerActivations<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoid<span class="token punctuation">,</span> hiddenLayerInput<span class="token punctuation">)</span>

		outputLayerInput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		outputLayerInput<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>hiddenLayerActivations<span class="token punctuation">,</span> wOut<span class="token punctuation">)</span>
		addBOut <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> col <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> v <span class="token operator">+</span> bOut<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		outputLayerInput<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>addBOut<span class="token punctuation">,</span> outputLayerInput<span class="token punctuation">)</span>
		output<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoid<span class="token punctuation">,</span> outputLayerInput<span class="token punctuation">)</span>

		<span class="token comment">// backpropagation.</span>
		networkError <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		networkError<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> output<span class="token punctuation">)</span>

		slopeOutputLayer <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		applySigmoidPrime <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">SigmoidPrime</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		slopeOutputLayer<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoidPrime<span class="token punctuation">,</span> output<span class="token punctuation">)</span>
		slopeHiddenLayer <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		slopeHiddenLayer<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoidPrime<span class="token punctuation">,</span> hiddenLayerActivations<span class="token punctuation">)</span>

		dOutput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		dOutput<span class="token punctuation">.</span><span class="token function">MulElem</span><span class="token punctuation">(</span>networkError<span class="token punctuation">,</span> slopeOutputLayer<span class="token punctuation">)</span>
		errorAtHiddenLayer <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		errorAtHiddenLayer<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>dOutput<span class="token punctuation">,</span> wOut<span class="token punctuation">.</span><span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		dHiddenLayer <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		dHiddenLayer<span class="token punctuation">.</span><span class="token function">MulElem</span><span class="token punctuation">(</span>errorAtHiddenLayer<span class="token punctuation">,</span> slopeHiddenLayer<span class="token punctuation">)</span>

		<span class="token comment">// Adjust the parameters.</span>
		wOutAdj <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		wOutAdj<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>hiddenLayerActivations<span class="token punctuation">.</span><span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dOutput<span class="token punctuation">)</span>
		wOutAdj<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>learningRate<span class="token punctuation">,</span> wOutAdj<span class="token punctuation">)</span>
		wOut<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>wOut<span class="token punctuation">,</span> wOutAdj<span class="token punctuation">)</span>

		bOutAdj<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">sumAlongAxis</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> dOutput<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> err
		<span class="token punctuation">}</span>
		bOutAdj<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>learningRate<span class="token punctuation">,</span> bOutAdj<span class="token punctuation">)</span>
		bOut<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>bOut<span class="token punctuation">,</span> bOutAdj<span class="token punctuation">)</span>

		wHiddenAdj <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>inputNum<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		wHiddenAdj<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dHiddenLayer<span class="token punctuation">)</span>
		wHiddenAdj<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>learningRate<span class="token punctuation">,</span> wHiddenAdj<span class="token punctuation">)</span>
		wHidden<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>wHidden<span class="token punctuation">,</span> wHiddenAdj<span class="token punctuation">)</span>

		bHiddenAdj<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">sumAlongAxis</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> dHiddenLayer<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> err
		<span class="token punctuation">}</span>
		bHiddenAdj<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>learningRate<span class="token punctuation">,</span> bHiddenAdj<span class="token punctuation">)</span>
		bHidden<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>bHidden<span class="token punctuation">,</span> bHiddenAdj<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	nn<span class="token punctuation">.</span>wHidden <span class="token operator">=</span> wHidden
	nn<span class="token punctuation">.</span>bHidden <span class="token operator">=</span> bHidden
	nn<span class="token punctuation">.</span>wOut <span class="token operator">=</span> wOut
	nn<span class="token punctuation">.</span>bOut <span class="token operator">=</span> bOut

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>nn <span class="token operator">*</span>neuralNet<span class="token punctuation">)</span> <span class="token function">predict</span><span class="token punctuation">(</span>x <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	N<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// Check to make sure that our neuralNet value</span>
	<span class="token comment">// represents a trained model.</span>
	<span class="token keyword">if</span> nn<span class="token punctuation">.</span>wHidden <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> nn<span class="token punctuation">.</span>wOut <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> nn<span class="token punctuation">.</span>bHidden <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> nn<span class="token punctuation">.</span>bOut <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"the supplied neurnal net weights and biases are empty"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Define the output of the neural network.</span>
	output <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

	<span class="token comment">// Complete the feed forward process.</span>
	hiddenLayerInput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	hiddenLayerInput<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>wHidden<span class="token punctuation">)</span>
	addBHidden <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> col <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> v <span class="token operator">+</span> nn<span class="token punctuation">.</span>bHidden<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token punctuation">}</span>
	hiddenLayerInput<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>addBHidden<span class="token punctuation">,</span> hiddenLayerInput<span class="token punctuation">)</span>

	hiddenLayerActivations <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	applySigmoid <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">Sigmoid</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
	hiddenLayerActivations<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoid<span class="token punctuation">,</span> hiddenLayerInput<span class="token punctuation">)</span>

	outputLayerInput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	outputLayerInput<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>hiddenLayerActivations<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>wOut<span class="token punctuation">)</span>
	addBOut <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> col <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> v <span class="token operator">+</span> nn<span class="token punctuation">.</span>bOut<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token punctuation">}</span>
	outputLayerInput<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>addBOut<span class="token punctuation">,</span> outputLayerInput<span class="token punctuation">)</span>
	output<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoid<span class="token punctuation">,</span> outputLayerInput<span class="token punctuation">)</span>

	<span class="token keyword">return</span> output<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Sigmoid</span><span class="token punctuation">(</span>x <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">+</span> math<span class="token punctuation">.</span><span class="token function">Exp</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">SigmoidPrime</span><span class="token punctuation">(</span>x <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后这次将iris的标签进行one-hot,实现如下</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">replaceLabel2</span><span class="token punctuation">(</span>col dataframe<span class="token punctuation">.</span>DataFrame<span class="token punctuation">)</span> dataframe<span class="token punctuation">.</span>DataFrame <span class="token punctuation">{<!-- --></span>
	rows<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> NewDF <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	changeMap <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span>
		<span class="token string">"Iris-setosa"</span><span class="token punctuation">:</span>     <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"1."</span><span class="token punctuation">,</span> <span class="token string">"0."</span><span class="token punctuation">,</span> <span class="token string">"0."</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"Iris-versicolor"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"0."</span><span class="token punctuation">,</span> <span class="token string">"1."</span><span class="token punctuation">,</span> <span class="token string">"0."</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"Iris-virginica"</span><span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"0."</span><span class="token punctuation">,</span> <span class="token string">"0."</span><span class="token punctuation">,</span> <span class="token string">"1."</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		NewDF <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>NewDF<span class="token punctuation">,</span> changeMap<span class="token punctuation">[</span>col<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> dataframe<span class="token punctuation">.</span><span class="token function">LoadRecords</span><span class="token punctuation">(</span>NewDF<span class="token punctuation">,</span> dataframe<span class="token punctuation">.</span><span class="token function">HasHeader</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>为什么这次得这样,因为Capply()返回的是Series,而one-hot之后肯定是二维的dataframe,因此干脆直接转为dataframe.然后就是一些维度求和以及求每一行最大值下标的函数(为了将predict变为one-hot),最后这部分完整代码如下</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> p3

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"errors"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/go-gota/gota/dataframe"</span>
	<span class="token string">"github.com/pa-m/sklearn/metrics"</span>
	modelselection <span class="token string">"github.com/pa-m/sklearn/model_selection"</span>
	<span class="token string">"gonum.org/v1/gonum/floats"</span>
	<span class="token string">"gonum.org/v1/gonum/mat"</span>
	<span class="token string">"log"</span>
	<span class="token string">"math"</span>
	<span class="token string">"math/rand"</span>
	<span class="token string">"os"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> neuralNet <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	config  neuralNetConfig
	wHidden <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
	bHidden <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
	wOut    <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
	bOut    <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
<span class="token punctuation">}</span>

<span class="token keyword">type</span> neuralNetConfig <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	inputNum     <span class="token builtin">int</span>
	outputNum    <span class="token builtin">int</span>
	hiddenNum    <span class="token builtin">int</span>
	Epochs       <span class="token builtin">int</span>
	learningRate <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewNetwork</span><span class="token punctuation">(</span>config neuralNetConfig<span class="token punctuation">)</span> <span class="token operator">*</span>neuralNet <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>neuralNet<span class="token punctuation">{<!-- --></span>config<span class="token punctuation">:</span> config<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>nn <span class="token operator">*</span>neuralNet<span class="token punctuation">)</span> <span class="token function">train</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	N<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	randSource <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">NewSource</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	randGen <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>randSource<span class="token punctuation">)</span>

	wHiddenRaw <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token operator">*</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>inputNum<span class="token punctuation">)</span>
	bHiddenRaw <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">)</span>
	wOutRaw <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token operator">*</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">)</span>
	bOutRaw <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> param <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{<!-- --></span>wHiddenRaw<span class="token punctuation">,</span> bHiddenRaw<span class="token punctuation">,</span> wOutRaw<span class="token punctuation">,</span> bOutRaw<span class="token punctuation">}</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> param <span class="token punctuation">{<!-- --></span>
			param<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> randGen<span class="token punctuation">.</span><span class="token function">Float64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	wHidden <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>inputNum<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> wHiddenRaw<span class="token punctuation">)</span>
	bHidden <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> bHiddenRaw<span class="token punctuation">)</span>
	wOut <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> wOutRaw<span class="token punctuation">)</span>
	bOut <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> bOutRaw<span class="token punctuation">)</span>

	output <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token comment">// train model.</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>Epochs<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// forward</span>
		hiddenLayerInput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		hiddenLayerInput<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> wHidden<span class="token punctuation">)</span>
		addBHidden <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> col <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> v <span class="token operator">+</span> bHidden<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		hiddenLayerInput<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>addBHidden<span class="token punctuation">,</span> hiddenLayerInput<span class="token punctuation">)</span>

		hiddenLayerActivations <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		applySigmoid <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">Sigmoid</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		hiddenLayerActivations<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoid<span class="token punctuation">,</span> hiddenLayerInput<span class="token punctuation">)</span>

		outputLayerInput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		outputLayerInput<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>hiddenLayerActivations<span class="token punctuation">,</span> wOut<span class="token punctuation">)</span>
		addBOut <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> col <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> v <span class="token operator">+</span> bOut<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		outputLayerInput<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>addBOut<span class="token punctuation">,</span> outputLayerInput<span class="token punctuation">)</span>
		output<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoid<span class="token punctuation">,</span> outputLayerInput<span class="token punctuation">)</span>

		<span class="token comment">// backpropagation.</span>
		networkError <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		networkError<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> output<span class="token punctuation">)</span>

		slopeOutputLayer <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		applySigmoidPrime <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">SigmoidPrime</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		slopeOutputLayer<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoidPrime<span class="token punctuation">,</span> output<span class="token punctuation">)</span>
		slopeHiddenLayer <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		slopeHiddenLayer<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoidPrime<span class="token punctuation">,</span> hiddenLayerActivations<span class="token punctuation">)</span>

		dOutput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		dOutput<span class="token punctuation">.</span><span class="token function">MulElem</span><span class="token punctuation">(</span>networkError<span class="token punctuation">,</span> slopeOutputLayer<span class="token punctuation">)</span>
		errorAtHiddenLayer <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		errorAtHiddenLayer<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>dOutput<span class="token punctuation">,</span> wOut<span class="token punctuation">.</span><span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		dHiddenLayer <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		dHiddenLayer<span class="token punctuation">.</span><span class="token function">MulElem</span><span class="token punctuation">(</span>errorAtHiddenLayer<span class="token punctuation">,</span> slopeHiddenLayer<span class="token punctuation">)</span>

		<span class="token comment">// Adjust the parameters.</span>
		wOutAdj <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		wOutAdj<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>hiddenLayerActivations<span class="token punctuation">.</span><span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dOutput<span class="token punctuation">)</span>
		wOutAdj<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>learningRate<span class="token punctuation">,</span> wOutAdj<span class="token punctuation">)</span>
		wOut<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>wOut<span class="token punctuation">,</span> wOutAdj<span class="token punctuation">)</span>

		bOutAdj<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">sumAlongAxis</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> dOutput<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> err
		<span class="token punctuation">}</span>
		bOutAdj<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>learningRate<span class="token punctuation">,</span> bOutAdj<span class="token punctuation">)</span>
		bOut<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>bOut<span class="token punctuation">,</span> bOutAdj<span class="token punctuation">)</span>

		wHiddenAdj <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>inputNum<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
		wHiddenAdj<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dHiddenLayer<span class="token punctuation">)</span>
		wHiddenAdj<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>learningRate<span class="token punctuation">,</span> wHiddenAdj<span class="token punctuation">)</span>
		wHidden<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>wHidden<span class="token punctuation">,</span> wHiddenAdj<span class="token punctuation">)</span>

		bHiddenAdj<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">sumAlongAxis</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> dHiddenLayer<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> err
		<span class="token punctuation">}</span>
		bHiddenAdj<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>learningRate<span class="token punctuation">,</span> bHiddenAdj<span class="token punctuation">)</span>
		bHidden<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>bHidden<span class="token punctuation">,</span> bHiddenAdj<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	nn<span class="token punctuation">.</span>wHidden <span class="token operator">=</span> wHidden
	nn<span class="token punctuation">.</span>bHidden <span class="token operator">=</span> bHidden
	nn<span class="token punctuation">.</span>wOut <span class="token operator">=</span> wOut
	nn<span class="token punctuation">.</span>bOut <span class="token operator">=</span> bOut

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>nn <span class="token operator">*</span>neuralNet<span class="token punctuation">)</span> <span class="token function">predict</span><span class="token punctuation">(</span>x <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	N<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// Check to make sure that our neuralNet value</span>
	<span class="token comment">// represents a trained model.</span>
	<span class="token keyword">if</span> nn<span class="token punctuation">.</span>wHidden <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> nn<span class="token punctuation">.</span>wOut <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> nn<span class="token punctuation">.</span>bHidden <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> nn<span class="token punctuation">.</span>bOut <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"the supplied neurnal net weights and biases are empty"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Define the output of the neural network.</span>
	output <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

	<span class="token comment">// Complete the feed forward process.</span>
	hiddenLayerInput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	hiddenLayerInput<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>wHidden<span class="token punctuation">)</span>
	addBHidden <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> col <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> v <span class="token operator">+</span> nn<span class="token punctuation">.</span>bHidden<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token punctuation">}</span>
	hiddenLayerInput<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>addBHidden<span class="token punctuation">,</span> hiddenLayerInput<span class="token punctuation">)</span>

	hiddenLayerActivations <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>hiddenNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	applySigmoid <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">Sigmoid</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
	hiddenLayerActivations<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoid<span class="token punctuation">,</span> hiddenLayerInput<span class="token punctuation">)</span>

	outputLayerInput <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>config<span class="token punctuation">.</span>outputNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	outputLayerInput<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>hiddenLayerActivations<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>wOut<span class="token punctuation">)</span>
	addBOut <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token boolean">_</span><span class="token punctuation">,</span> col <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> v <span class="token operator">+</span> nn<span class="token punctuation">.</span>bOut<span class="token punctuation">.</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> col<span class="token punctuation">)</span> <span class="token punctuation">}</span>
	outputLayerInput<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>addBOut<span class="token punctuation">,</span> outputLayerInput<span class="token punctuation">)</span>
	output<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span>applySigmoid<span class="token punctuation">,</span> outputLayerInput<span class="token punctuation">)</span>

	<span class="token keyword">return</span> output<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Sigmoid</span><span class="token punctuation">(</span>x <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">+</span> math<span class="token punctuation">.</span><span class="token function">Exp</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">SigmoidPrime</span><span class="token punctuation">(</span>x <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">sumAlongAxis</span><span class="token punctuation">(</span>axis <span class="token builtin">int</span><span class="token punctuation">,</span> m <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	numRows<span class="token punctuation">,</span> numCols <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> output <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
	<span class="token keyword">switch</span> axis <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
		data <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> numCols<span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numCols<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			col <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">Col</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
			data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> floats<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		output <span class="token operator">=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> numCols<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
		data <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> numRows<span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numRows<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			row <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
			data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> floats<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		output <span class="token operator">=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>numRows<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"invalid axis, must be 0 or 1"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> output<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">MaxAlongAxis</span><span class="token punctuation">(</span>m <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	numRows<span class="token punctuation">,</span> numCols <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> output <span class="token operator">*</span>mat<span class="token punctuation">.</span>Dense
	res <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numRows<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		row <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
		idx <span class="token operator">:=</span> floats<span class="token punctuation">.</span><span class="token function">MaxIdx</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
		<span class="token keyword">for</span> j <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> numCols<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> j <span class="token operator">==</span> idx <span class="token punctuation">{<!-- --></span>
				res <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				res <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	output <span class="token operator">=</span> mat<span class="token punctuation">.</span><span class="token function">NewDense</span><span class="token punctuation">(</span>numRows<span class="token punctuation">,</span> numCols<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
	<span class="token keyword">return</span> output<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">replaceLabel2</span><span class="token punctuation">(</span>col dataframe<span class="token punctuation">.</span>DataFrame<span class="token punctuation">)</span> dataframe<span class="token punctuation">.</span>DataFrame <span class="token punctuation">{<!-- --></span>
	rows<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Dims</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> NewDF <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	changeMap <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span>
		<span class="token string">"Iris-setosa"</span><span class="token punctuation">:</span>     <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"1."</span><span class="token punctuation">,</span> <span class="token string">"0."</span><span class="token punctuation">,</span> <span class="token string">"0."</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"Iris-versicolor"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"0."</span><span class="token punctuation">,</span> <span class="token string">"1."</span><span class="token punctuation">,</span> <span class="token string">"0."</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"Iris-virginica"</span><span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"0."</span><span class="token punctuation">,</span> <span class="token string">"0."</span><span class="token punctuation">,</span> <span class="token string">"1."</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		NewDF <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>NewDF<span class="token punctuation">,</span> changeMap<span class="token punctuation">[</span>col<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> dataframe<span class="token punctuation">.</span><span class="token function">LoadRecords</span><span class="token punctuation">(</span>NewDF<span class="token punctuation">,</span> dataframe<span class="token punctuation">.</span><span class="token function">HasHeader</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NNClassify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	config <span class="token operator">:=</span> neuralNetConfig<span class="token punctuation">{<!-- --></span>
		inputNum<span class="token punctuation">:</span>     <span class="token number">4</span><span class="token punctuation">,</span>
		outputNum<span class="token punctuation">:</span>    <span class="token number">3</span><span class="token punctuation">,</span>
		hiddenNum<span class="token punctuation">:</span>    <span class="token number">10</span><span class="token punctuation">,</span>
		Epochs<span class="token punctuation">:</span>       <span class="token number">1000</span><span class="token punctuation">,</span>
		learningRate<span class="token punctuation">:</span> <span class="token number">0.009</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	filename <span class="token operator">:=</span> <span class="token string">"iris.csv"</span>
	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	DF <span class="token operator">:=</span> dataframe<span class="token punctuation">.</span><span class="token function">ReadCSV</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> dataframe<span class="token punctuation">.</span><span class="token function">HasHeader</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">//replace the label from string to float</span>
	X <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">DenseCopyOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>matrix<span class="token punctuation">{<!-- --></span>DF<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	Y <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">DenseCopyOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>matrix<span class="token punctuation">{<!-- --></span><span class="token function">replaceLabel2</span><span class="token punctuation">(</span>DF<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	XTrain<span class="token punctuation">,</span> XTest<span class="token punctuation">,</span> YTrain<span class="token punctuation">,</span> YTest <span class="token operator">:=</span> modelselection<span class="token punctuation">.</span><span class="token function">TrainTestSplit</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> <span class="token number">0.33</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token comment">//fmt.Printf("X_train:n%gn", mat.Formatted(XTrain))</span>
	<span class="token comment">//fmt.Printf("Y_train:n%gn", mat.Formatted(YTrain))</span>
	network <span class="token operator">:=</span> <span class="token function">NewNetwork</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> network<span class="token punctuation">.</span><span class="token function">train</span><span class="token punctuation">(</span>XTrain<span class="token punctuation">,</span> YTrain<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Train cost time:"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span>

	f <span class="token operator">:=</span> mat<span class="token punctuation">.</span><span class="token function">Formatted</span><span class="token punctuation">(</span>network<span class="token punctuation">.</span>wHidden<span class="token punctuation">,</span> mat<span class="token punctuation">.</span><span class="token function">Prefix</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"nwHidden = % vnn"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span>

	f <span class="token operator">=</span> mat<span class="token punctuation">.</span><span class="token function">Formatted</span><span class="token punctuation">(</span>network<span class="token punctuation">.</span>bHidden<span class="token punctuation">,</span> mat<span class="token punctuation">.</span><span class="token function">Prefix</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"nbHidden = % vnn"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span>

	f <span class="token operator">=</span> mat<span class="token punctuation">.</span><span class="token function">Formatted</span><span class="token punctuation">(</span>network<span class="token punctuation">.</span>wOut<span class="token punctuation">,</span> mat<span class="token punctuation">.</span><span class="token function">Prefix</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"nwOut = % vnn"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span>

	f <span class="token operator">=</span> mat<span class="token punctuation">.</span><span class="token function">Formatted</span><span class="token punctuation">(</span>network<span class="token punctuation">.</span>bOut<span class="token punctuation">,</span> mat<span class="token punctuation">.</span><span class="token function">Prefix</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"nbOut = % vnn"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span>

	<span class="token comment">//predict</span>
	predictions<span class="token punctuation">,</span> err <span class="token operator">:=</span> network<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>XTest<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"npredictions = % vnn"</span><span class="token punctuation">,</span> mat<span class="token punctuation">.</span><span class="token function">Formatted</span><span class="token punctuation">(</span>predictions<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//fmt.Println(mat.Formatted(predictions))</span>
	pred<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">MaxAlongAxis</span><span class="token punctuation">(</span>predictions<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//fmt.Println(mat.Formatted(pred))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"The accuracy of MLP: %.02f%%n"</span><span class="token punctuation">,</span> metrics<span class="token punctuation">.</span><span class="token function">AccuracyScore</span><span class="token punctuation">(</span>YTest<span class="token punctuation">,</span> pred<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/84/0c/h0gJCzpz_o.png" alt="image-20221020215844126"></p> 
<p><img src="https://images2.imgbox.com/a7/4b/rQT2py59_o.png" alt="image-20221020215857628"></p> 
<p>迭代1000次只花了66ms,准确率98%也超过了传统模型.</p> 
<h3>
<a id="24_More_890"></a>2.4 More</h3> 
<p>当然远远不止书上这些,社区里还有很多很好的库能帮助go实现机器学习/深度学习.比如tensorflow(libtorch) binding for Go,可惜已经很久没更新.特别是libtorch的,我去了解的时候一看安装,里面还是cuda10.x,就没有再去探索了.相反的一些点赞数不多的库https://github.com/kuroko1t/gotorch看着真的还很不错,也许目前功能还不完善但拿来作为项目学习下还是可以的.之前很早就提到的Go+也是数据科学方面非常好的go语言拓展.未来如果有时间,会好好探索如何将go转为易用于深度学习的语言之一</p> 
<h2>
<a id="_894"></a>最后</h2> 
<p>花了一天抛开聚类和时间序列两章没具体细看,从完全不会这些库的使用到根据文档基本能实现自己想要的功能;同时还把自己放空了一天.不用再去想为什么onnx转换后trt的精度会有损失,部署的时候各种后处理怎么实现等等,我觉得这种自我调节休息还是很有必要的.长期只使用python,c++,都快忘了其他语言怎么写.</p> 
<p>作为喜欢写写代码,研究技术的人,在闲暇时抛开工作自我学习本身就是一种休闲.python在好几年前刚学习的时候我对它爱不释手,因为学习成本很低也不用编译,只要配好解释器随处可以运行,不像c++有的时候为了验证一个demo还得写CMakeLists或者命令行链接一堆头文件.随着不断学习,有的时候运行效率,适用性根本达不到要求.不可能每台电脑都得配python环境再给你pip装一堆库,pyinstaller打包只要引入一些三方库(numpy,pandas等)出来的文件就不会很小,不用三方库那python的优势又在哪呢?</p> 
<p>像我们这种科研狗,如果毕业打算继续从事研究,那用python快速验证模型效果等等无可厚非.如果打算从事互联网开发或者算法工程师,仅仅会写点python只能说坑了同事也坑了自己.不是clone一个项目稍微改几句,或者添加点东西点个run能跑就是会写代码.不考虑项目结构,不考虑代码效率,不考虑格式规范真的很头疼.(<strong>有感而发,别怼怼就是你对</strong>)</p> 
<p>现在很多“火箭”三方库已经实现了,我们只需要会用就行.小的“轮子”在这基础上自己造一造,举一反三.</p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
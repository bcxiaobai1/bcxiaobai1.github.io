<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>【MySQL InnoDB读书笔记】08 InnoDB下逻辑存储结构（一） - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【MySQL InnoDB读书笔记】08 InnoDB下逻辑存储结构（一）</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-github-gist">
                    
                        
                    
                    <p></p>
<div class="toc">
 <h3>总体存储结构+行记录存储结构</h3>
 <ul>
<li><a href="#_1">一、索引组织表</a></li>
<li><a href="#InnoDB__57">二、InnoDB 逻辑存储结构</a></li>
<li>
<ul>
<li><a href="#1__63">1. 表空间</a></li>
<li><a href="#2__89">2. 段</a></li>
<li><a href="#3__93">3. 区</a></li>
<li><a href="#4__103">4. 页</a></li>
<li><a href="#5__126">5. 行记录</a></li>
</ul>
  </li>
<li><a href="#InnoDB__130">三、InnoDB 行记录的格式</a></li>
<li>
<ul>
<li><a href="#1_Compact__179">1. Compact 行记录格式</a></li>
<li><a href="#2_Redundant__221">2. Redundant 行记录格式</a></li>
<li><a href="#3_Compressed__Dynamic__265">3. Compressed 行记录格式和 Dynamic 行记录格式</a></li>
</ul>
  </li>
<li><a href="#_273">四、不同数据类型的存储方式探究</a></li>
<li>
<ul>
<li><a href="#1_varchar_275">1. varchar</a></li>
<li><a href="#2_char_409">2. char</a></li>
</ul>
  </li>
<li><a href="#_457">五、探究独立表空间大小变化过程</a></li>
</ul>
</div>
<p></p> 
<h1>
<a id="_1"></a>一、索引组织表</h1> 
<p>在 InnoDB 存储引擎中，表中的数据都是根据<code>主键顺序</code>组织存放的，这种组织数据的方式的表称为<code>索引组织表</code></p> 
<p>表主键的定义方式有以下三种：</p> 
<ol>
<li>显式定义一个非空属性为主键</li>
<li>若没有使用 1 定义主键，则首先判断表中是否有<code>非空的唯一索引</code>，若有则该列为主键</li>
<li>若 1 和 2 都没有满足，则 InnoDB 存储引擎自动创建一个 6 字节的指针，即 <code>_rowid</code>来作为主键</li>
</ol> 
<p>见示例：</p> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> z<span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> a <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> b <span class="token keyword">int</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> c <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> d <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">unique</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">unique</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">unique</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> z <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> z <span class="token keyword">select</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> z <span class="token keyword">select</span> <span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>_rowid <span class="token keyword">from</span> z<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---+------+----+----+--------+</span>
<span class="token operator">|</span> a <span class="token operator">|</span> b    <span class="token operator">|</span> c  <span class="token operator">|</span> d  <span class="token operator">|</span> _rowid <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+------+----+----+--------+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span>      <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span>      <span class="token number">8</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">9</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span>     <span class="token number">12</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+------+----+----+--------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>由 <code>_rowid</code>的值我们可知：z 表的主键是 d</p> 
 <p>由于 b 是可为 null 的，所以不符合设置为主键的条件</p> 
 <p>属性 d 和属性 c 都是符合条件的，但是 d 比 c 先定义，故选择 d 作为主键</p> 
</blockquote> 
<p><code>_rowid</code>只能用来查看<code>单列主键</code>，对于<code>联合主键</code>就无能为力了</p> 
<h1>
<a id="InnoDB__57"></a>二、InnoDB 逻辑存储结构</h1> 
<p>在 InnoDB 存储引擎下，所有的数据都被逻辑的存放在表空间（tablespace）中，表空间又由各种段组成，段由区组成，区由页组成，页由行记录结构组成</p> 
<p><img src="https://images2.imgbox.com/53/c8/0jHxZbl2_o.png" alt="image-20211223112559472"></p> 
<h2>
<a id="1__63"></a>1. 表空间</h2> 
<ul>
<li>若没开启 <code>innodb_file_per_table</code>，则所有表的数据都放在<code>共享表空间 ibdata1</code>中</li>
<li>若开启 <code>innodb_file_per_table</code>，则每张表的<code>数据、索引、insert buffer bitmap page</code>放在<code>独立的表空间</code>内，其他数据（undo log page、insert buffer index page、double write buffer等）还是放在<code>共享表空间 ibdata1</code> 中</li>
</ul> 
<p>使用 <code>py_innodb_page_info.py</code>工具查看共享表空间中有哪些数据页：</p> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py ibdata1
Total number of page: <span class="token number">4864</span>:
Insert Buffer Bitmap: <span class="token number">6</span>
System Page: <span class="token number">133</span>
Transaction system Page: <span class="token number">3</span>
Freshly Allocated Page: <span class="token number">4440</span>
Undo Log Page: <span class="token number">234</span>
File Segment inode: <span class="token number">11</span>
B-tree Node: <span class="token number">30</span>
File Space Header: <span class="token number">7</span>
</code></pre> 
<blockquote> 
 <p>我们可以看到在<code>共享表空间 ibdata1</code>中，一共有 4864 个页：</p> 
 <p>undo log 页有 234 个</p> 
 <p>B-tree Node （数据）页有 30 个</p> 
</blockquote> 
<h2>
<a id="2__89"></a>2. 段</h2> 
<p><code>叶子节点段</code>即是<code>数据段</code>，<code>非叶子节点段</code>即是<code>索引段</code>，回滚段后续文章再续述，每个段由若干个区（Extend）组成，段的管理由 InnoDB 引擎完成。</p> 
<h2>
<a id="3__93"></a>3. 区</h2> 
<p>区是由连续的页组成的空间，每个区的大小恒为 1MB，一个区包含 64 个正常页，如果区内存的是压缩页，那么对应页大小为 2K、4K、8K 的页数量为 512 个、256个、128个，所以不论页的大小如何变化，区的大小恒不变</p> 
<p>独立表空间的区大小变化：新建的表的表空间大小为 96 K（只有一个数据页） -&gt; 刚开始的32个数据页是随着表中记录的增加而逐个增加的 -&gt; 后续都每次表空间按照连续 64 个数据页的大小开始增长</p> 
<p>独立表空间区变化图解：</p> 
<p><img src="https://images2.imgbox.com/86/b6/7ICIr5xy_o.png" alt="image-20211223161523761"></p> 
<h2>
<a id="4__103"></a>4. 页</h2> 
<p>页（Page）是 InnoDB 磁盘管理的最小单位，默认每个页大小为 16KB ，可通过参数<code>innodb_page_size</code>来修改页大小</p> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'innodb_page_size'</span>G<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
Variable_name: innodb_page_size
        <span class="token keyword">Value</span>: <span class="token number">16384</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>常见的页类型有：</p> 
<ul>
<li>数据页（B-tree Node）</li>
<li>undo 页（undo log page）</li>
<li>系统页（system page）</li>
<li>插入缓冲位图页（insert buffer bitmap page）</li>
<li>插入缓冲空闲列表页（insert buffer free list page）</li>
<li>事务数据页（Transaction system page）</li>
<li>未压缩的二进制大对象页（uncompressed BLOB page）</li>
<li>压缩的二进制大对象页（compressed BLOB page）</li>
</ul> 
<h2>
<a id="5__126"></a>5. 行记录</h2> 
<p>InnoDB 存储引擎是面向行（row - oriented）的，即数据是按照行进行存储的，每个页中存储的行记录的格式都是定义好的，最多允许存储（16KB / 2 - 200）行记录，即 7992 条行记录</p> 
<h1>
<a id="InnoDB__130"></a>三、InnoDB 行记录的格式</h1> 
<p>InnoDB 存储引擎提供了两种行记录的存储格式：<code>Compact</code> 、 <code>Redundant</code>、<code>Compressed</code>、<code>Dynamic</code></p> 
<p>查看表的行记录存储格式方法：通过 <code>show table status like</code>来看 <code>Row_format</code>字段即可</p> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">table</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'t%'</span>G<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
           Name: t
         <span class="token keyword">Engine</span>: <span class="token keyword">InnoDB</span>
        Version: <span class="token number">10</span>
     Row_format: Dynamic
           <span class="token keyword">Rows</span>: <span class="token number">4</span>
 Avg_row_length: <span class="token number">4096</span>
    Data_length: <span class="token number">16384</span>
Max_data_length: <span class="token number">0</span>
   Index_length: <span class="token number">0</span>
      Data_free: <span class="token number">0</span>
 <span class="token keyword">Auto_increment</span>: <span class="token boolean">NULL</span>
    Create_time: <span class="token number">2021</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">15</span>:<span class="token number">56</span>:<span class="token number">47</span>
    Update_time: <span class="token number">2021</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">15</span>:<span class="token number">59</span>:<span class="token number">17</span>
     Check_time: <span class="token boolean">NULL</span>
      Collation: latin1_swedish_ci
       Checksum: <span class="token boolean">NULL</span>
 Create_options: 
        <span class="token keyword">Comment</span>: 
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">2.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
           Name: test
         <span class="token keyword">Engine</span>: <span class="token keyword">InnoDB</span>
        Version: <span class="token number">10</span>
     Row_format: Dynamic
           <span class="token keyword">Rows</span>: <span class="token number">31</span>
 Avg_row_length: <span class="token number">17441</span>
    Data_length: <span class="token number">540672</span>
Max_data_length: <span class="token number">0</span>
   Index_length: <span class="token number">0</span>
      Data_free: <span class="token number">0</span>
 <span class="token keyword">Auto_increment</span>: <span class="token number">65</span>
    Create_time: <span class="token number">2021</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">14</span>:<span class="token number">59</span>:<span class="token number">34</span>
    Update_time: <span class="token number">2021</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">15</span>:<span class="token number">42</span>:<span class="token number">36</span>
     Check_time: <span class="token boolean">NULL</span>
      Collation: latin1_swedish_ci
       Checksum: <span class="token boolean">NULL</span>
 Create_options: 
        <span class="token keyword">Comment</span>: 
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h2>
<a id="1_Compact__179"></a>1. Compact 行记录格式</h2> 
<p>Compact 行记录的格式如下图：</p> 
<p><img src="https://images2.imgbox.com/ad/58/zbMpPoac_o.png" alt="image-20211224110159734"></p> 
<ul>
<li>变长字段长度列表：该字段的长度是变化的，若列的长度小于 255 字节，用 1 字节表示，若列大于 255 字节，用 2 字节表示</li>
<li>NULL标志位：共 8 位，每一位表示当前列是否为 NULL，是 NULL 则当前位为 1</li>
<li>头信息：占5字节，每一位的含义如下表</li>
</ul> 
<table>
<thead><tr>
<th>名称</th>
<th>大小（单位：位）</th>
<th>含义</th>
</tr></thead>
<tbody>
<tr>
<td>（）</td>
<td>1</td>
<td>未知</td>
</tr>
<tr>
<td>（）</td>
<td>1</td>
<td>未知</td>
</tr>
<tr>
<td>deleted_flag</td>
<td>1</td>
<td>标记此行是否删除</td>
</tr>
<tr>
<td>min_rec_flag</td>
<td>1</td>
<td>如果此行被预先定义为最小的记录，则设置为1</td>
</tr>
<tr>
<td>n_owned</td>
<td>4</td>
<td>此行拥有的记录数</td>
</tr>
<tr>
<td>heap_no</td>
<td>13</td>
<td>索引堆中该记录的排序记录</td>
</tr>
<tr>
<td>record_type</td>
<td>3</td>
<td>记录类型，000表示普通，001表示B+树节点指针，010表示Infimum，011表示Supremum，1xx表示保留</td>
</tr>
<tr>
<td>next_record</td>
<td>16</td>
<td>页中下一条记录的相对位置</td>
</tr>
</tbody>
</table>
<p>每行数据中除了用户定义的列外还有两个隐藏列：事务ID列（6字节）和回滚指针列（7字节），如果用户没有定义主键，可能还会多出来一个 rowid 列（6字节）</p> 
<blockquote> 
 <p>举例1：如果一个表使用 <code>row_format = compact</code>方式存储， 一共有四列（varchar(10) , varchar(10), char(10), varchar(10)），插入一条数据为（‘a’, NULL, ‘bb’, ‘ccc’）</p> 
 <p>则使用 Compact 行记录的格式存储在独立表空间中的数据为：</p> 
 <p><code>NULL标志位</code>：0x02，二进制为 10，表示第二列为NULL值</p> 
 <p><code>col1</code> ：61(‘a’)</p> 
 <p><code>col3</code>：62(‘b’) 62(‘b’) 20 20 20 20 20 20 20 20</p> 
 <p><code>col4</code>：63(‘c’) 63(‘c’) 63(‘c’)</p> 
 <p>由此，我们可以观察到以下规律：</p> 
 <ol>
<li>我们可以看出第三列为固定长度的char，如果该列中存储的数据没有达到固定长度，则剩余的字节使用 <code>0x20</code> 填充</li>
<li>无论是 char 还是 varchar 在 Compact 格式下存储 NULL 都不占用空间</li>
</ol> 
</blockquote> 
<h2>
<a id="2_Redundant__221"></a>2. Redundant 行记录格式</h2> 
<p>Redundant 行记录格式如下图：</p> 
<p><img src="https://images2.imgbox.com/e6/a2/qCDJDnSP_o.png" alt="image-20211224123813594"></p> 
<ul>
<li>字段长度偏移列表：同 Compact 的变长字段长度列表</li>
<li>头信息：占 6 个字节，具体位信息如下表</li>
</ul> 
<table>
<thead><tr>
<th>名称</th>
<th>大小（单位：位）</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td>（）</td>
<td>1</td>
<td>未知</td>
</tr>
<tr>
<td>（）</td>
<td>1</td>
<td>未知</td>
</tr>
<tr>
<td>deleted_flag</td>
<td>1</td>
<td>标记此行是否已经被删除</td>
</tr>
<tr>
<td>min_rec_flag</td>
<td>1</td>
<td>如果此行被预先定义为最小的记录，则设置为1</td>
</tr>
<tr>
<td>n_owned</td>
<td>4</td>
<td>该记录拥有的记录数</td>
</tr>
<tr>
<td>heap_no</td>
<td>13</td>
<td>索引堆中该条记录的索引号</td>
</tr>
<tr>
<td>n_fields</td>
<td>10</td>
<td>记录中列的数量</td>
</tr>
<tr>
<td>1byte_offs_flag</td>
<td>1</td>
<td>偏移列表为 1 字节还是 2 字节</td>
</tr>
<tr>
<td>next_record</td>
<td>16</td>
<td>页中下一条记录的相对位置</td>
</tr>
</tbody>
</table>
<p>MySQL数据库一行支持最多的列个数由<code>n_fields</code>控制，即 <code>2^10 -1 = 1023 个</code></p> 
<p>我们发现：redundant 格式与 compact 格式不同的是没有 <code>NULL标志位</code>，可以看看下面例子中 redundant 格式是如何处理 NULL 列的</p> 
<blockquote> 
 <p>举例1：如果一个表使用 <code>row_format = redundant</code>方式存储， 一共有四列（varchar(10) , varchar(10), char(10), varchar(10)），插入一条数据为（‘d’, NULL, NULL, ‘fff’）</p> 
 <p>则使用 Redundant行记录的格式存储在独立表空间中的数据为：</p> 
 <p><code>字段长度偏移列表</code>：21 9e 94 14 13 0c 06</p> 
 <p><code>col1</code> ：64(‘d’)</p> 
 <p><code>col3</code>：00 00 00 00 00 00 00 00 00 00</p> 
 <p><code>col4</code>：66(‘f’) 66(‘f’) 66(‘f’)</p> 
 <p>由数据我们发现：</p> 
 <ol>
<li>数据类型为 Char 的 NULL 列，会使用定义长度的个数个 0x00 来填充</li>
<li>数据类型为 varchar 的 NULL 列，则不存储</li>
</ol> 
</blockquote> 
<h2>
<a id="3_Compressed__Dynamic__265"></a>3. Compressed 行记录格式和 Dynamic 行记录格式</h2> 
<p>这两种行记录格式采用了<code>完全行溢出</code>的方式，B+ 数的叶子节点上面存储的是数据页，完全行溢出的方式是在数据页中存储 20 字节的指针，时间的数据都存放在 <code>Off Page</code>中，如图所示：</p> 
<p><img src="https://images2.imgbox.com/b2/7d/Rv71JIHb_o.png" alt="image-20211224144035646"></p> 
<h1>
<a id="_273"></a>四、不同数据类型的存储方式探究</h1> 
<h2>
<a id="1_varchar_275"></a>1. varchar</h2> 
<p>MySQL 数据库的 varchar 类型可以存放 <code>65532</code> 个 <code>latin字符集编码</code> 的字符，可以存放<code>21845</code>个<code>utf8字符集编码</code>的字符，可以存放<code>32767</code>个<code>gbk字符集编码</code>的字符，这里的的存储上限是指<code>所有的 varchar 类型的列之和</code></p> 
<p>通过以下样例我们来看看 varchar 是如何存储的：</p> 
<ol><li>产生一个 <code>65532</code>大小的数据记录</li></ol> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> tt<span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> a <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65532</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">charset</span><span class="token operator">=</span>latin1<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.06</span> sec<span class="token punctuation">)</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> tt <span class="token keyword">select</span> <span class="token keyword">repeat</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">65532</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/e/宫瑞阳/计算机/GitHub开源项目/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py -v tt.ibd
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Space Header<span class="token operator">&gt;</span>
page offset 00000001, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Insert Buffer Bitmap<span class="token operator">&gt;</span>
page offset 00000002, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Segment inode<span class="token operator">&gt;</span>
page offset 00000003, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000004, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Uncompressed BLOB Page<span class="token operator">&gt;</span>
page offset 00000005, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Uncompressed BLOB Page<span class="token operator">&gt;</span>
page offset 00000006, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Uncompressed BLOB Page<span class="token operator">&gt;</span>
page offset 00000007, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Uncompressed BLOB Page<span class="token operator">&gt;</span>
page offset 00000008, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Uncompressed BLOB Page<span class="token operator">&gt;</span>
Total number of page: <span class="token number">9</span>:
Insert Buffer Bitmap: <span class="token number">1</span>
Uncompressed BLOB Page: <span class="token number">5</span>
File Space Header: <span class="token number">1</span>
B-tree Node: <span class="token number">1</span>
File Segment inode: <span class="token number">1</span>
</code></pre> 
<blockquote> 
 <p>通过观察发现，只有一个数据页，但是多出来了 5 个 <code>Uncompressed BLOB Page（未压缩的二进制大对象页）</code></p> 
</blockquote> 
<ol start="2"><li>通过对页内数据分析发现数据页中只存放了这 65532 个字符的前 768 字节的前缀数据，剩下的（65532 - 768）个字节的数据存放在了 Uncompressed BLOB Page 中</li></ol> 
<p><img src="https://images2.imgbox.com/f0/b8/rosMNMWJ_o.png" alt="image-20211224162140347"></p> 
<p>那是不是说，只要 varchar 中存储的数据大于 768 个字节，多余的字节就一定会存储的未压缩的二进制大对象页中？如果是这样的话，就会导致 B+ 树失去了意义（因为只有一个数据页，剩下数据就往二进制大对象页中插入就行），成为了一个链表。</p> 
<p>如果一个数据页中恰好能放下两条记录，那么就不会把数据放到未压缩的二进制大对象页中去了，那么这个恰好放下两条记录的 varchar阈值 是多少呢？经过反复测试发现这个阈值为 8098 字节。</p> 
<ul><li>实验一：设置 varchar 为8098</li></ul> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> tt<span class="token punctuation">(</span>a <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">8098</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">charset</span><span class="token operator">=</span>latin1<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> tt <span class="token keyword">select</span> <span class="token keyword">repeat</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">8098</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> tt <span class="token keyword">select</span> <span class="token keyword">repeat</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">8098</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/e/宫瑞阳/计算机/GitHub开源项目/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py -v tt.ibd
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Space Header<span class="token operator">&gt;</span>
page offset 00000001, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Insert Buffer Bitmap<span class="token operator">&gt;</span>
page offset 00000002, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Segment inode<span class="token operator">&gt;</span>
page offset 00000003, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Freshly Allocated Page<span class="token operator">&gt;</span>
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Freshly Allocated Page<span class="token operator">&gt;</span>
Total number of page: <span class="token number">6</span>:
Freshly Allocated Page: <span class="token number">2</span>
Insert Buffer Bitmap: <span class="token number">1</span>
File Space Header: <span class="token number">1</span>
B-tree Node: <span class="token number">1</span>
File Segment inode: <span class="token number">1</span>
</code></pre> 
<p>插入第三条数据：</p> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> tt <span class="token keyword">select</span> <span class="token keyword">repeat</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">8098</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/e/宫瑞阳/计算机/GitHub开源项目/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py -v tt.ibd
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Space Header<span class="token operator">&gt;</span>
page offset 00000001, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Insert Buffer Bitmap<span class="token operator">&gt;</span>
page offset 00000002, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Segment inode<span class="token operator">&gt;</span>
page offset 00000003, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
page offset 00000004, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000005, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
Total number of page: <span class="token number">6</span>:
Insert Buffer Bitmap: <span class="token number">1</span>
File Space Header: <span class="token number">1</span>
B-tree Node: <span class="token number">3</span>
File Segment inode: <span class="token number">1</span>
</code></pre> 
<blockquote> 
 <p>此时可以发现，插入两条数据时只有一个数据页，当插入第三条数据时出现了 B+ 树的分裂操作，产生了两个数据页</p> 
</blockquote> 
<ul><li>实验二：设置 varchar 为8099</li></ul> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">select</span> <span class="token keyword">repeat</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">8099</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/e/宫瑞阳/计算机/GitHub开源项目/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py -v t.ibd
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Space Header<span class="token operator">&gt;</span>
page offset 00000001, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Insert Buffer Bitmap<span class="token operator">&gt;</span>
page offset 00000002, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Segment inode<span class="token operator">&gt;</span>
page offset 00000003, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000004, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Uncompressed BLOB Page<span class="token operator">&gt;</span>
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Freshly Allocated Page<span class="token operator">&gt;</span>
Total number of page: <span class="token number">6</span>:
Insert Buffer Bitmap: <span class="token number">1</span>
Freshly Allocated Page: <span class="token number">1</span>
File Segment inode: <span class="token number">1</span>
B-tree Node: <span class="token number">1</span>
File Space Header: <span class="token number">1</span>
Uncompressed BLOB Page: <span class="token number">1</span>
</code></pre> 
<blockquote> 
 <p>才插入一条记录，就发现已经产生了 Uncompressed BLOB Page ，说明已经将部分数据插入到了 Uncompressed BLOB Page 中</p> 
</blockquote> 
<p>总结：所以 varchar 的存储方式如图所示</p> 
<p><img src="https://images2.imgbox.com/b0/d7/txMuhIGK_o.png" alt="image-20211224165214105"></p> 
<h2>
<a id="2_char_409"></a>2. char</h2> 
<p>我们使用 <code>CHAR(N)</code>来定义一个存储 N 个字节定长字段，那么它真的只能存 N 个嘛？看以下实验：</p> 
<p>定义一个 GBK 字符集编码的 char(2) 属性，并插入三条数据：ab、我们、a</p> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t<span class="token punctuation">(</span>a <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">charset</span><span class="token operator">=</span>GBK<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">select</span> <span class="token string">'ab'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">select</span> <span class="token string">'我们'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">select</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> a<span class="token punctuation">,</span> CHAR_LENGTH<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> LENGTH<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">from</span> tG<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
             a: ab
CHAR_LENGTH<span class="token punctuation">(</span>a<span class="token punctuation">)</span>: <span class="token number">2</span>
     LENGTH<span class="token punctuation">(</span>a<span class="token punctuation">)</span>: <span class="token number">2</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">2.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
             a: 我们
CHAR_LENGTH<span class="token punctuation">(</span>a<span class="token punctuation">)</span>: <span class="token number">2</span>
     LENGTH<span class="token punctuation">(</span>a<span class="token punctuation">)</span>: <span class="token number">4</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">3.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
             a: a
CHAR_LENGTH<span class="token punctuation">(</span>a<span class="token punctuation">)</span>: <span class="token number">1</span>
     LENGTH<span class="token punctuation">(</span>a<span class="token punctuation">)</span>: <span class="token number">1</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>我们发现：</p> 
 <p>‘ab’ 和 ‘我们’ 的长度都是 2，‘a’ 的长度是 1</p> 
 <p>实际上在内部存储上：‘ab’ 占 2 个字节， ''我们’占 4 个字节，'a’占 1 个字节</p> 
</blockquote> 
<p>在 Compact/Redundant 行记录的格式中：如果 char(N) 中的并没有存够 N 个字符，则会使用 0x20 填充</p> 
<p><strong>总结：在多字节的字符编码中，char 类型不再代表固定长度的字符串，与 varchar 并没有什么区别，底层存储时都是按照变长对待的。</strong></p> 
<h1>
<a id="_457"></a>五、探究独立表空间大小变化过程</h1> 
<p>我们接下来来观察观察<code>独立表空间</code>的空间变化：</p> 
<ol><li>我们创建一个新的表：</li></ol> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> test<span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> a <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> b <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>看看 test 表的独立表空间大小：</li></ol> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/c/ProgramData/MySQL/MySQL Server <span class="token number">5.7</span>/Data/gongruiyang$ <span class="token function">ls</span> -lh
total 144K
-rwxrwxrwx <span class="token number">1</span> gongruiyang gongruiyang  <span class="token number">65</span> Dec <span class="token number">22</span> <span class="token number">14</span>:53 db.opt
-rwxrwxrwx <span class="token number">1</span> gongruiyang gongruiyang 13K Dec <span class="token number">23</span> <span class="token number">14</span>:59 test.frm
-rwxrwxrwx <span class="token number">1</span> gongruiyang gongruiyang 96K Dec <span class="token number">23</span> <span class="token number">14</span>:59 test.ibd
</code></pre> 
<blockquote> 
 <p>发现刚刚建立的表的独立表空间大小为 96K</p> 
 <p>疑惑：不是说好的一个区的大小恒为 1M 吗？这个<code>test.ibd</code>至少也应该是 1M 呀？</p> 
</blockquote> 
<ol start="3"><li>看看 test.ibd 中页的分配情况：</li></ol> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/e/宫瑞阳/计算机/GitHub开源项目/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py -v test.ibd
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Space Header<span class="token operator">&gt;</span>
page offset 00000001, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Insert Buffer Bitmap<span class="token operator">&gt;</span>
page offset 00000002, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Segment inode<span class="token operator">&gt;</span>
page offset 00000003, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Freshly Allocated Page<span class="token operator">&gt;</span>
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Freshly Allocated Page<span class="token operator">&gt;</span>
Total number of page: <span class="token number">6</span>:
Freshly Allocated Page: <span class="token number">2</span>
Insert Buffer Bitmap: <span class="token number">1</span>
File Space Header: <span class="token number">1</span>
B-tree Node: <span class="token number">1</span>
File Segment inode: <span class="token number">1</span>
</code></pre> 
<blockquote> 
 <p>发现只分配一个一个数据页 <code>page offset 00000003, page type &lt;B-tree Node&gt;, page level &lt;0000&gt;</code>，这里的&lt;000&gt;表示是叶子节点</p> 
</blockquote> 
<ol start="4"><li>插入两条记录看看页变化情况：</li></ol> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> test <span class="token keyword">select</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">REPEAT</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token keyword">select</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">REPEAT</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/e/宫瑞阳/计算机/GitHub开源项目/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py -v test.ibd
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Space Header<span class="token operator">&gt;</span>
page offset 00000001, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Insert Buffer Bitmap<span class="token operator">&gt;</span>
page offset 00000002, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Segment inode<span class="token operator">&gt;</span>
page offset 00000003, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Freshly Allocated Page<span class="token operator">&gt;</span>
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Freshly Allocated Page<span class="token operator">&gt;</span>
Total number of page: <span class="token number">6</span>:
Freshly Allocated Page: <span class="token number">2</span>
Insert Buffer Bitmap: <span class="token number">1</span>
File Space Header: <span class="token number">1</span>
B-tree Node: <span class="token number">1</span>
File Segment inode: <span class="token number">1</span>
</code></pre> 
<blockquote> 
 <p>据观察，插入两条数据后，页的分配并无任何变化，依然是只有一个数据页</p> 
</blockquote> 
<ol start="5"><li>再插入一条记录观察页变化情况</li></ol> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token keyword">select</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">REPEAT</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> a <span class="token keyword">from</span> testG<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
a: <span class="token number">1</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">2.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
a: <span class="token number">2</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">3.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
a: <span class="token number">3</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/e/宫瑞阳/计算机/GitHub开源项目/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py -v test.ibd
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Space Header<span class="token operator">&gt;</span>
page offset 00000001, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Insert Buffer Bitmap<span class="token operator">&gt;</span>
page offset 00000002, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Segment inode<span class="token operator">&gt;</span>
page offset 00000003, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
page offset 00000004, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000005, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
Total number of page: <span class="token number">6</span>:
Insert Buffer Bitmap: <span class="token number">1</span>
File Space Header: <span class="token number">1</span>
B-tree Node: <span class="token number">3</span>
File Segment inode: <span class="token number">1</span>
</code></pre> 
<blockquote> 
 <p><strong>&lt;000&gt;表示叶子节点</strong>，<strong>&lt;001&gt;表示非叶子节点</strong>，再插入一条新的数据后产生了 B+ 数的分裂操作</p> 
 <p>此时 B+ 树的结构如下：共有两个叶子节点&lt;000&gt;，一个非叶子节点&lt;001&gt;<img src="https://images2.imgbox.com/8c/64/YLNVM5AH_o.png" alt="image-20211223152220370">由此可以看出，每两条记录就占据一个数据页</p> 
</blockquote> 
<ol start="6"><li>我们一直增加到 63 条记录看看变化情况：</li></ol> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">delimiter</span> $$
MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">procedure</span> load_test<span class="token punctuation">(</span>count <span class="token keyword">int</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">BEGIN</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">declare</span> s <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">declare</span> c <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">repeat</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">while</span> s <span class="token operator">&lt;=</span> count <span class="token keyword">do</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token keyword">select</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> c<span class="token punctuation">;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">END</span><span class="token punctuation">;</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> $$
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">call</span> load_test<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.55</span> sec<span class="token punctuation">)</span>
MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> testG<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>: <span class="token number">63</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>使用存储过程再插入 60 条记录，此时有 63 条数据，我们再看看独立表空间变化情况：</p> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/c/ProgramData/MySQL/MySQL Server <span class="token number">5.7</span>/Data/gongruiyang$ <span class="token function">ls</span> -lh
total 656K
-rwxrwxrwx <span class="token number">1</span> gongruiyang gongruiyang   <span class="token number">65</span> Dec <span class="token number">22</span> <span class="token number">14</span>:53 db.opt
-rwxrwxrwx <span class="token number">1</span> gongruiyang gongruiyang  13K Dec <span class="token number">23</span> <span class="token number">14</span>:59 test.frm
-rwxrwxrwx <span class="token number">1</span> gongruiyang gongruiyang 592K Dec <span class="token number">23</span> <span class="token number">15</span>:34 test.ibd

gongruiyang@gongruiyang:/mnt/e/宫瑞阳/计算机/GitHub开源项目/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py -v test.ibd
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Space Header<span class="token operator">&gt;</span>
page offset 00000001, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Insert Buffer Bitmap<span class="token operator">&gt;</span>
page offset 00000002, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>File Segment inode<span class="token operator">&gt;</span>
page offset 00000003, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
page offset 00000004, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000005, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000006, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000007, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000008, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000009, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000000a, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000000b, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000000c, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000000d, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000000e, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000000f, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000010, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000011, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000012, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000013, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000014, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000015, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000016, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000017, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000018, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000019, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000001a, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000001b, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000001c, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000001d, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000001e, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 0000001f, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000020, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000021, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000022, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000023, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>B-tree Node<span class="token operator">&gt;</span>, page level <span class="token operator">&lt;</span>000<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
page offset 00000000, page <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>Freshly Allocated Page<span class="token operator">&gt;</span>
Total number of page: <span class="token number">37</span>:
Freshly Allocated Page: <span class="token number">1</span>
Insert Buffer Bitmap: <span class="token number">1</span>
File Space Header: <span class="token number">1</span>
B-tree Node: <span class="token number">33</span>
File Segment inode: <span class="token number">1</span>
</code></pre> 
<blockquote> 
 <p>此时 <code>test.ibd</code>大小为 592K ，依然小于 1M ，其中 B-tree Node 一共是 33 个，包含 1 个非叶节点页和 32 个叶节点页，对于数据段来说，此时已经有了 32 个数据页了</p> 
</blockquote> 
<ol start="7"><li>我们再插入一条数据，注意观察变化：</li></ol> 
<pre><code class="prism language-sql">MySQL <span class="token punctuation">[</span>gongruiyang<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token keyword">select</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">REPEAT</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">1</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre> 
<pre><code class="prism language-shell">gongruiyang@gongruiyang:/mnt/c/ProgramData/MySQL/MySQL Server <span class="token number">5.7</span>/Data/gongruiyang$ <span class="token function">ls</span> -lh
total <span class="token number">2</span>.1M
-rwxrwxrwx <span class="token number">1</span> gongruiyang gongruiyang   <span class="token number">65</span> Dec <span class="token number">22</span> <span class="token number">14</span>:53 db.opt
-rwxrwxrwx <span class="token number">1</span> gongruiyang gongruiyang  13K Dec <span class="token number">23</span> <span class="token number">14</span>:59 test.frm
-rwxrwxrwx <span class="token number">1</span> gongruiyang gongruiyang <span class="token number">2</span>.0M Dec <span class="token number">23</span> <span class="token number">15</span>:42 test.ibd

gongruiyang@gongruiyang:/mnt/e/宫瑞阳/计算机/GitHub开源项目/david-mysql-tools/py_innodb_page_type$ python py_innodb_page_info.py  test.ibd
Total number of page: <span class="token number">128</span>:
Freshly Allocated Page: <span class="token number">91</span>
Insert Buffer Bitmap: <span class="token number">1</span>
File Space Header: <span class="token number">1</span>
B-tree Node: <span class="token number">34</span>
File Segment inode: <span class="token number">1</span>
</code></pre> 
<blockquote> 
 <p>此时 test 表的独立表空间文件大小已经变成了 2M 的大小，所以此时应该是申请了（32 + 64）个数据页以供使用</p> 
</blockquote>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Spark&#43;Kafka构建Dashboard实训&#43;踩坑笔记 - 编程小白</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程小白" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程小白</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spark&#43;Kafka构建Dashboard实训&#43;踩坑笔记</h1>
			
		</header>
		<div class="content post__content clearfix">
			


                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    
                        
                    
                    <h1>
<a id="_0"></a>项目简介</h1> 
<blockquote> 
 <p>项目通过spark和kafka构建实时分析平台，设计消息预处理、消息队列发送、接收消息、数据实时处理、数据实时推送和实时展示等数据处理全流程</p> 
</blockquote> 
<h1>
<a id="_2"></a>涉及技术</h1> 
<blockquote> 
 <p>linux：操作系统<br> Spark：专为大规模数据处理而设计的快速通用搜索引擎，由scala语言编写 Kafka：是一种高吞吐量的分布式订阅消息分发系统，由scala和Java编写，处理大量的用户访问流记录<br> Flask.socketIO：是一个消息双工即使模块<br> Flask：python编写的轻量级web框架，主要包括两个核心库：werkzeug和jinja2，功能分别是处理业务和负责安全<br> Highchart.js：是一个由javascript编写的图标库<br> Pycharm：python编译器</p> 
</blockquote> 
<h1>
<a id="_9"></a>实现思路</h1> 
<blockquote> 
 <p>部署<strong>hadoop</strong>–&gt;安装<strong>spark</strong>–&gt;编写<strong>scala</strong>独立应用程序–&gt;安装<strong>kafka</strong>–&gt;安装<strong>python</strong>–&gt;<strong>python</strong>操作<strong>kafka</strong>数据预处理–&gt;编写<strong>sparksteaming</strong>程序和<strong>producer</strong>和<strong>consumer</strong>程序处理数据</p> 
</blockquote> 
<h2>
<a id="_12"></a>项目体系</h2> 
<p><img src="https://images2.imgbox.com/4c/ba/K3Uotl2B_o.png" alt="spark+kafka流程图"></p> 
<h2>
<a id="_14"></a>&lt;项目实现&gt;</h2> 
<h1>
<a id="1spark_15"></a>1、部署spark</h1> 
<h3>
<a id="11hadoop_16"></a>1.1、部署hadoop</h3> 
<p>//创建用户并设置权限</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo useradd <span class="token operator">-</span>m hadoop <span class="token operator">-</span>s <span class="token operator">/</span>bin<span class="token operator">/</span>bash
<span class="token operator">~</span>$<span class="token operator">:</span> sudo passwd hadoop
<span class="token operator">~</span>$<span class="token operator">:</span> sudo adduser hadoop sudo     <span class="token comment">//授权</span>
</code></pre> 
<p>//更新apt</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo apt<span class="token operator">-</span><span class="token keyword">get</span> updata
</code></pre> 
<p>//配置SSH免密登录<br> ubuntu默认有client，这里还需要安装ssh server</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo apt<span class="token operator">-</span><span class="token keyword">get</span> install openssh<span class="token operator">-</span>server
<span class="token operator">~</span>$<span class="token operator">:</span> ssh localhost    <span class="token comment">//看完后记得exit一下</span>
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">~</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.ssh</span><span class="token regex-delimiter">/</span></span>
<span class="token operator">~</span>$<span class="token operator">:</span> ssh<span class="token operator">-</span>keygen <span class="token operator">-</span>t rsa  <span class="token comment">//-t指秘钥类型 rsa指SSH2，，提示时，直接回车</span>
<span class="token operator">~</span>$<span class="token operator">:</span> cat <span class="token punctuation">.</span><span class="token operator">/</span>id_rsa<span class="token punctuation">.</span>pub <span class="token operator">&gt;&gt;</span> <span class="token punctuation">.</span><span class="token operator">/</span>authroized_keys
</code></pre> 
<p><img src="https://images2.imgbox.com/fc/04/hwrwa1Qg_o.png" alt="ssh免密登录示例图"></p> 
<h3>
<a id="12java_41"></a>1.2、部署java环境</h3> 
<p>官网链接: <a href="https://www.csdn.net/">https://www.oracle.com/java/technologies/downloads/</a><br> <img src="https://images2.imgbox.com/4f/0f/o0luD9HH_o.png" alt="jdk"><br> //下载好对应的压缩包后解压到相应目录并设置环境变量</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo tar <span class="token operator">-</span>zxvf <span class="token punctuation">.</span><span class="token operator">/</span>jdk<span class="token operator">-</span><span class="token number">8</span>u162<span class="token operator">-</span>linux<span class="token operator">-</span>x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span><span class="token constant">C</span> <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>jvm
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">~</span>            <span class="token comment">//cd /进入跟目录    cd ~进入用户家目录</span>
<span class="token operator">~</span>$<span class="token operator">:</span> cat <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>bashrc
<span class="token keyword">export</span> <span class="token constant">JAVA_HOME</span><span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>jvm<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0_162</span>
<span class="token keyword">export</span> <span class="token constant">JRE_HOME</span><span class="token operator">=</span>$<span class="token punctuation">{<!-- --></span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>jre
<span class="token keyword">export</span> <span class="token constant">CLASSPATH</span><span class="token operator">=</span><span class="token punctuation">.</span><span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span><span class="token constant">JRE_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>lib
<span class="token keyword">export</span> <span class="token constant">PATH</span><span class="token operator">=</span>$<span class="token punctuation">{<!-- --></span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">:</span>$<span class="token constant">PATH</span>
<span class="token operator">~</span>$<span class="token operator">:</span> source <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>bashrc    <span class="token comment">//环境变量生效</span>
<span class="token operator">~</span>$<span class="token operator">:</span> java <span class="token operator">-</span>version
</code></pre> 
<p><img src="https://images2.imgbox.com/a5/b0/VILtYiZx_o.png" alt="Java"></p> 
<h3>
<a id="13hadoop2_58"></a>1.3、安装hadoop2</h3> 
<p>hadoop2下载地址: <a href="https://www.csdn.net/">http://mirrors.cnnic.cn/apache/hadoop/common/ </a><br> //有的同学下载包时会遇到两个都感觉可以下载的情况，一脸懵逼不知下载哪个？？？？这里解释一下，binary是编译好的可以直接使用，source是源码，需要编译之后使用。<br> chown 修改文件和文件夹的用户和用户组属性<br> chmod 修改文件和文件夹读写执行属性</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo tar <span class="token operator">-</span>zxvf <span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">2.6</span><span class="token number">.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span><span class="token constant">C</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local  <span class="token comment">//解压到local</span>
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local
<span class="token operator">~</span>$<span class="token operator">:</span> sudo mv <span class="token punctuation">.</span><span class="token operator">/</span>hadoop<span class="token operator">-</span><span class="token number">2.6</span><span class="token number">.0</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token operator">/</span>hadoop   <span class="token comment">//为了方便后期使用，改个短一点的命</span>
<span class="token operator">~</span>$<span class="token operator">:</span> sudo chown <span class="token operator">-</span><span class="token constant">R</span> hadoop <span class="token punctuation">.</span><span class="token operator">/</span>hadoop  <span class="token comment">//chown 修改文件和文件夹的用户和用户组属性  chmod 修改文件和文件夹读写执行属性</span>
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>hadoop<span class="token operator">/</span>bin   <span class="token comment">//bin目录下存放二进制可执行文件</span>
<span class="token operator">~</span>$<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>hadoop version
</code></pre> 
<h3>
<a id="14hadoop_72"></a>1.4、hadoop伪分布式</h3> 
<p>//修改配置文件，文件位于hadoop包的/etc/hadoop下<br> (注意：configuration 标签原文已有，不可重复)<br> core-site.xml</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop<span class="token punctuation">.</span>tmp<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>file<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>hadoop<span class="token operator">/</span>tmp<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>Abase <span class="token keyword">for</span> other temporary directories<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>description<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>fs<span class="token punctuation">.</span>defaultFS<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>hdfs<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9000</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<p>hdfs-site.xml</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>replication<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>name<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>file<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>hadoop<span class="token operator">/</span>tmp<span class="token operator">/</span>dfs<span class="token operator">/</span>name<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs<span class="token punctuation">.</span>datanode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>file<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>hadoop<span class="token operator">/</span>tmp<span class="token operator">/</span>dfs<span class="token operator">/</span>data<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<p>//到hadoop的bin 目录下执行namenode格式化</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>hdfs namenode <span class="token operator">-</span>format
</code></pre> 
<p><img src="https://images2.imgbox.com/9e/66/BW4mBufC_o.png" alt="namenode格式化"><br> 格式化过程中出现y/n询问，输y回车即可</p> 
<p><strong>// 开启namenode和datanode。</strong><br> NameNode：是Master节点，有点类似Linux里的根目录。管理数据块映射；处理客户端的读写请求；配置副本策略；管理HDFS的名称空间；<br> DataNode：负责存储client发来的数据块block；执行数据块的读写操作。是NameNode的小弟。</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>hadoop
<span class="token operator">~</span>$<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>sbin<span class="token operator">/</span>start<span class="token operator">-</span>dfs<span class="token punctuation">.</span>sh
<span class="token operator">~</span>$<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>sbin<span class="token operator">/</span>stop<span class="token operator">-</span>dfs<span class="token punctuation">.</span>sh
</code></pre> 
<p>下面图片有很多进程，是我做实验开着后没关的，启动start-dfs.sh只要有<br> jps + secondarynamenode + namenode + datanode即可<br> <img src="https://images2.imgbox.com/41/c0/esVQQIBF_o.png" alt="在这里插入图片描述"></p> 
<p>访问浏览器页面出现下图即可<br> （拓展：localhost:9000后面跟着一个词active，这括号后面有两种状态，一种是active状态，一种是standby状态，active状态意味着提供服务，standby状态意味着处于休眠状态，只进行数据同步，时刻准备着提供服务，两者可以切换。）<br> <img src="https://images2.imgbox.com/60/ac/PEoQK7DS_o.png" alt="在这里插入图片描述"><br> 至此，我们的铺垫，有就是hadoop就部署完成了，接下来就开始部署spark<br> +++++++++++++++++++++++++++++++++++++++++++++++++++++++</p> 
<h1>
<a id="2spark_136"></a>2.部署spark</h1> 
<h3>
<a id="21_137"></a>2.1、安装与修改配置</h3> 
<p>spark官网: <a href="https://www.csdn.net/">http://spark.apache.org/downloads.html</a><br> choose a package type选择如图所示，这个是属于hadoop free版本，下载到的saprk可以用到任何一个hadoop版本<br> spark四种安装模式：<br> 1.local模式（单机模式）<strong>（本次使用的模式）</strong><br> 2.standlone模式（使用spark自带的集群管理器）<br> 3.yarn模式（使用yarn作为集群管理器）<br> 4.mesos模式（使用mesos作为集群管理器）<br> <img src="https://images2.imgbox.com/5f/b3/A9LIWH19_o.png" alt="在这里插入图片描述"><br> // 接着走一遍与安装hadoop2一样的步骤<br> （解压到指定目录 + cd 到解压目录 + 改名 + 授权）</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo tar <span class="token operator">-</span>zxvf spark<span class="token operator">-</span><span class="token number">2.1</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>without<span class="token operator">-</span>hadoop<span class="token punctuation">.</span>tgz <span class="token operator">-</span><span class="token constant">C</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local
<span class="token operator">~</span>$<span class="token operator">:</span> sudo mv <span class="token punctuation">.</span><span class="token operator">/</span>spark<span class="token operator">-</span><span class="token number">2.1</span><span class="token number">.0</span><span class="token operator">-</span>bin<span class="token operator">-</span>without<span class="token operator">-</span>hadoop<span class="token operator">/</span> <span class="token punctuation">.</span><span class="token operator">/</span>spark
<span class="token operator">~</span>$<span class="token operator">:</span> sudo chown <span class="token operator">-</span><span class="token constant">R</span> hadoop<span class="token operator">:</span>hadoop <span class="token punctuation">.</span><span class="token operator">/</span>spark 
</code></pre> 
<p>// 修改spark配置文件spark-env.sh.template<br> 配置作用：配置后Spark就可以把数据存储到Hadoop分布式文件系统HDFS中，也可以从HDFS中读取数据</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>spark
<span class="token operator">~</span>$<span class="token operator">:</span> cat <span class="token punctuation">.</span><span class="token operator">/</span>conf<span class="token operator">/</span>spark<span class="token operator">-</span>env<span class="token punctuation">.</span>sh
<span class="token keyword">export</span> <span class="token constant">SPARK_DIST_CLASSPATH</span><span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>hadoop<span class="token operator">/</span>bin<span class="token operator">/</span>hadoop classpath<span class="token punctuation">)</span>
</code></pre> 
<p>// 验证spark是否安装成功----/spark目录下</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>run<span class="token operator">-</span>example SparkPi <span class="token number">2</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span><span class="token number">1</span> <span class="token operator">|</span> grep <span class="token string">"Pi is"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/15/30/tCvfWTvC_o.png" alt="Pi is"></p> 
<h3>
<a id="22spark_170"></a>2.2、运行spark程序</h3> 
<p>需要退出时输入quit即可</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>spark<span class="token operator">-</span>shell
</code></pre> 
<p><img src="https://images2.imgbox.com/cb/1e/v5MgwkB3_o.png" alt="在这里插入图片描述"><br> +++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p> 
<h1>
<a id="3scala_180"></a>3、scala独立应用程序编写</h1> 
<h3>
<a id="31sbt_181"></a>3.1、安装sbt</h3> 
<p>首先先安装sbt，sbt是scala的编译工具<br> sbt下载链接: <a href="https://www.csdn.net/">http://www/scala-sbt.org</a></p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo mkdir <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>sbt    <span class="token comment">//创建安装目录</span>
<span class="token operator">~</span>$<span class="token operator">:</span> sudo tar <span class="token operator">-</span>zxvf sbt<span class="token operator">-</span><span class="token number">1.3</span><span class="token number">.8</span><span class="token punctuation">.</span>tgz <span class="token operator">-</span><span class="token constant">C</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>sbt
<span class="token operator">~</span>$<span class="token operator">:</span> sudo chown <span class="token operator">-</span><span class="token constant">R</span> hadoop <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>sbt
<span class="token operator">~</span>$<span class="token operator">:</span> cp <span class="token punctuation">.</span><span class="token operator">/</span>bin<span class="token operator">/</span>sbt<span class="token operator">-</span>launch<span class="token punctuation">.</span>jar <span class="token punctuation">.</span><span class="token operator">/</span>    <span class="token comment">//将bin下的launch.jar复制到当下目录</span>
<span class="token operator">~</span>$<span class="token operator">:</span> vi <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>sbt<span class="token operator">/</span>sbt     <span class="token comment">//创建shell脚本用于启动sbt</span>
#<span class="token operator">!</span><span class="token operator">/</span>bin<span class="token operator">/</span>bash
<span class="token constant">SBT_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms512M -Xmx1536M -Xss1M -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256M"</span>
java $<span class="token constant">SBT_OPTS</span> <span class="token operator">-</span>jar <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dirname $0</span><span class="token template-punctuation string">`</span></span><span class="token operator">/</span>sbt<span class="token operator">-</span>launch<span class="token punctuation">.</span>jar <span class="token string">"$@"</span>
</code></pre> 
<p>// 为shell脚本授予权限</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> chmod u<span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>lcoal<span class="token operator">/</span>sbt<span class="token operator">/</span>sbt     <span class="token comment">//u指所有者，+x值赋予可执行权限</span>
</code></pre> 
<h3>
<a id="32scala_203"></a>3.2、编写并打包scala应用程序</h3> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">~</span>
<span class="token operator">~</span>$<span class="token operator">:</span> mkdir <span class="token punctuation">.</span><span class="token operator">/</span>sparkapp   <span class="token comment">//创建应用程序根目录</span>
<span class="token operator">~</span>$<span class="token operator">:</span> mkdir <span class="token operator">-</span>p <span class="token punctuation">.</span><span class="token operator">/</span>sparkapp<span class="token operator">/</span>src<span class="token operator">/</span>main<span class="token operator">/</span>scala   <span class="token comment">//-p值递归创建，也就是同时创建层层嵌套文件夹</span>
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token punctuation">.</span><span class="token operator">/</span>sparkapp<span class="token operator">/</span>src<span class="token operator">/</span>main<span class="token operator">/</span>scala
<span class="token operator">~</span>$<span class="token operator">:</span> vi SimpleApp<span class="token punctuation">.</span>scala
 <span class="token comment">/* SimpleApp.scala */</span>
    <span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>SparkContext
    <span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>SparkContext<span class="token punctuation">.</span>_
    <span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>SparkConf
 
    object SimpleApp <span class="token punctuation">{<!-- --></span>
        def <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token operator">:</span> Array<span class="token punctuation">[</span>String<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            val logFile <span class="token operator">=</span> <span class="token string">"file:///usr/local/spark/README.md"</span> <span class="token comment">// Should be some file on your system</span>
            val conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparkConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAppName</span><span class="token punctuation">(</span><span class="token string">"Simple Application"</span><span class="token punctuation">)</span>
            val sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparkContext</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
            val logData <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">textFile</span><span class="token punctuation">(</span>logFile<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            val numAs <span class="token operator">=</span> logData<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">line</span> <span class="token operator">=&gt;</span> line<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            val numBs <span class="token operator">=</span> logData<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">line</span> <span class="token operator">=&gt;</span> line<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Lines with a: %s, Lines with b: %s"</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>numAs<span class="token punctuation">,</span> numBs<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>// 打包scala程序<br> 注意：每次编写脚本时都要注意版本差异</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> vi <span class="token punctuation">.</span><span class="token operator">/</span>sparkapp<span class="token operator">/</span>simple<span class="token punctuation">.</span>sbt
name <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"Simple Project"</span>
version <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"1.0"</span>
scalaVersion <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"2.11.8"</span>
libraryDependencies <span class="token operator">+=</span> <span class="token string">"org.apache.spark"</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token string">"spark-core"</span> <span class="token operator">%</span> <span class="token string">"2.1.0"</span>
</code></pre> 
<p>// 首次运行需要下载依赖包</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>sbt<span class="token operator">/</span>sbt <span class="token keyword">package</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0f/23/Ey5QNp1s_o.png" alt="在这里插入图片描述"><br> // 通过submit运行程序</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>spark<span class="token operator">/</span>bin<span class="token operator">/</span>spark<span class="token operator">-</span>submit <span class="token operator">--</span><span class="token keyword">class</span> <span class="token string">"SimpleApp"</span> <span class="token operator">~</span><span class="token operator">/</span>sparkapp<span class="token operator">/</span>target<span class="token operator">/</span>scala<span class="token operator">-</span><span class="token number">2.11</span><span class="token operator">/</span>simple<span class="token operator">-</span>project_2<span class="token punctuation">.</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">.</span>jar <span class="token number">2</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span><span class="token number">1</span> <span class="token operator">|</span> grep <span class="token string">"Lines with a:"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/cf/19/BtulNvXI_o.png" alt="在这里插入图片描述"></p> 
<h1>
<a id="4kafka_252"></a>4、部署kafka</h1> 
<h3>
<a id="41kafka_253"></a>4.1、安装kafka</h3> 
<p>kafka官网: <a href="https://www.csdn.net/">https://kafka.apache.org/downloads</a><br> <img src="https://images2.imgbox.com/ad/c8/zxhQzfnj_o.png" alt="在这里插入图片描述"><br> 核心概念</p> 
<ol>
<li>Broker<br> Kafka集群包含一个或多个服务器，这种服务器被称为broker</li>
<li>Topic<br> 每条发布到Kafka集群的消息都有一个类别，这个类别被称为Topic。（物理上不同Topic的消息分开存储，逻辑上一个Topic的消息虽然保存于一个或多个broker上但用户只需指定消息的Topic即可生产或消费数据而不必关心数据存于何处）</li>
<li>Partition<br> Partition是物理上的概念，每个Topic包含一个或多个Partition.</li>
<li>Producer<br> 负责发布消息到Kafka broker</li>
<li>Consumer<br> 消息消费者，向Kafka broker读取消息的客户端。</li>
<li>Consumer Group<br> 每个Consumer属于一个特定的Consumer Group（可为每个Consumer指定group name，若不指定group name则属于默认的group）<br> // 解压安装包</li>
</ol> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo tar <span class="token operator">-</span>zxvf kafka_2<span class="token punctuation">.</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">0.10</span><span class="token number">.1</span><span class="token number">.0</span><span class="token punctuation">.</span>tgz <span class="token operator">-</span><span class="token constant">C</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local
<span class="token operator">~</span>$<span class="token operator">:</span> sudo mv afka_2<span class="token punctuation">.</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">0.10</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token operator">/</span>kafka
<span class="token operator">~</span>$<span class="token operator">:</span> sudo chown <span class="token operator">-</span><span class="token constant">R</span> hadoop <span class="token punctuation">.</span><span class="token operator">/</span>kafka
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>lcoal<span class="token operator">/</span>kafka
<span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>zookeeper<span class="token operator">-</span>server<span class="token operator">-</span>start<span class="token punctuation">.</span>sh config<span class="token operator">/</span>zookeeper<span class="token punctuation">.</span>properties <span class="token comment">//运行实例</span>
</code></pre> 
<h3>
<a id="42_279"></a>4.2、测试</h3> 
<p><img src="https://images2.imgbox.com/76/b9/h70Sr64j_o.png" alt="在这里插入图片描述"><br> 注意：启动完后会保持上图状态，一定不要关闭他，启动新的终端（终端2）</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>lcoal<span class="token operator">/</span>kafka
<span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>kafka<span class="token operator">-</span>server<span class="token operator">-</span>start<span class="token punctuation">.</span>sh config<span class="token operator">/</span>server<span class="token punctuation">.</span>properties
</code></pre> 
<p><img src="https://images2.imgbox.com/a2/de/2BCw4gZE_o.png" alt="在这里插入图片描述"><br> // 上图已经完成kafka服务端的启动了，不要关闭他，启动终端3输入命令如下</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>kafka
<span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>kafka<span class="token operator">-</span>topics<span class="token punctuation">.</span>sh <span class="token operator">--</span>create <span class="token operator">--</span>zookeeper localhost<span class="token operator">:</span><span class="token number">2181</span> <span class="token operator">--</span>replication<span class="token operator">-</span>factor <span class="token number">1</span> <span class="token operator">--</span>partitions <span class="token number">1</span> <span class="token operator">--</span>topic dblab
</code></pre> 
<p>用list列出所有创建的topics,来查看刚才创建的主题是否存在。</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>kafka<span class="token operator">-</span>topics<span class="token punctuation">.</span>sh <span class="token operator">--</span>list <span class="token operator">--</span>zookeeper localhost<span class="token operator">:</span><span class="token number">2181</span>
<span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>kafka<span class="token operator">-</span>console<span class="token operator">-</span>producer<span class="token punctuation">.</span>sh <span class="token operator">--</span>broker<span class="token operator">-</span>list localhost<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>topic dblab
</code></pre> 
<p>CTRL+C退出，然后使用consumer来接收数据,输入如下命令：</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>kafka<span class="token operator">-</span>console<span class="token operator">-</span>consumer<span class="token punctuation">.</span>sh <span class="token operator">--</span>zookeeper localhost<span class="token operator">:</span><span class="token number">2181</span> <span class="token operator">--</span>topic dblab <span class="token operator">--</span><span class="token keyword">from</span><span class="token operator">-</span>beginning 
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/72/GYceteFW_o.png" alt="在这里插入图片描述"><br> 至此，kafka就安装成功了！<br> +++++++++++++++++++++++++++++++++++++++++++++++++++++++</p> 
<h1>
<a id="4python_312"></a>4、安装python</h1> 
<h3>
<a id="41python_313"></a>4.1、python下载</h3> 
<p>案例用到的python第三方库，flask和socketio，pip管理第三方库<br> 注意自己下载到哪个路径下</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo apt<span class="token operator">-</span><span class="token keyword">get</span> install python3<span class="token operator">-</span>pip
<span class="token operator">~</span>$<span class="token operator">:</span> pip3 install flask    <span class="token comment">//安装需要的库flask和socketio</span>
<span class="token operator">~</span>$<span class="token operator">:</span> pip3 install flask<span class="token operator">-</span>socketio
<span class="token operator">~</span>$<span class="token operator">:</span> pip3 install kafka<span class="token operator">-</span>python
</code></pre> 
<p>pycharm的安装<br> pycharm官网: <a href="https://www.csdn.net/">https://www.jetbrains.com/pycharm/download/#section=linux</a><br> 接下来就是万年不变的解压安装步骤</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> cd 
<span class="token operator">~</span>$<span class="token operator">:</span> sudo tar <span class="token operator">-</span>zxvf pycharm<span class="token operator">-</span>community<span class="token operator">-</span><span class="token number">2021.2</span><span class="token number">.3</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span><span class="token constant">C</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local  
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local
<span class="token operator">~</span>$<span class="token operator">:</span> sudo mv pycharm<span class="token operator">-</span>community<span class="token operator">-</span><span class="token number">2021.2</span><span class="token number">.3</span> pycharm 
<span class="token operator">~</span>$<span class="token operator">:</span> sudo chown <span class="token operator">-</span><span class="token constant">R</span> hadoop <span class="token punctuation">.</span><span class="token operator">/</span>pycharm 
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>pycharm
<span class="token operator">~</span>$<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>bin<span class="token operator">/</span>pycharm<span class="token punctuation">.</span>sh    <span class="token comment">//启动pycharm</span>
</code></pre> 
<h3>
<a id="42python_338"></a>4.2、更换python版本（可选）</h3> 
<p>ubuntu16.04自带有python2.7和python3.5，直接使用python3.5即可<br> 若需要更换python 版本,例如3.7，则操作如下：</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo apt<span class="token operator">-</span><span class="token keyword">get</span> install zlib1g<span class="token operator">-</span>dev libbz2<span class="token operator">-</span>dev libssl<span class="token operator">-</span>dev libncurses5<span class="token operator">-</span>dev libsqlite3<span class="token operator">-</span>dev libreadline<span class="token operator">-</span>dev tk<span class="token operator">-</span>dev libgdbm<span class="token operator">-</span>dev libdb<span class="token operator">-</span>dev libpcap<span class="token operator">-</span>dev xz<span class="token operator">-</span>utils libexpat1<span class="token operator">-</span>dev liblzma<span class="token operator">-</span>dev libffi<span class="token operator">-</span>dev libc6<span class="token operator">-</span>dev
<span class="token operator">~</span>$<span class="token operator">:</span> wget https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>python<span class="token punctuation">.</span>org<span class="token operator">/</span>ftp<span class="token operator">/</span>python<span class="token operator">/</span><span class="token number">3.7</span><span class="token number">.5</span><span class="token operator">/</span>Python<span class="token operator">-</span><span class="token number">3.7</span><span class="token number">.5</span><span class="token punctuation">.</span>tgz
<span class="token operator">~</span>$<span class="token operator">:</span> tar <span class="token operator">-</span>xzvf Python<span class="token operator">-</span><span class="token number">3.7</span><span class="token number">.5</span><span class="token punctuation">.</span>tgz
<span class="token operator">~</span>$<span class="token operator">:</span> cd Python3<span class="token punctuation">.</span><span class="token number">7.5</span>
<span class="token operator">~</span>$<span class="token operator">:</span> sudo mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>python3
<span class="token operator">~</span>$<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>prefix<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>python3  <span class="token operator">--</span>enable<span class="token operator">-</span>optimizations
<span class="token operator">~</span>$<span class="token operator">:</span> make
<span class="token operator">~</span>$<span class="token operator">:</span> sudo make install
<span class="token operator">~</span>$<span class="token operator">:</span> ln <span class="token operator">-</span>s <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>python3<span class="token operator">/</span>bin<span class="token operator">/</span>python3<span class="token punctuation">.</span><span class="token number">7</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>python
<span class="token operator">~</span>$<span class="token operator">:</span> ln <span class="token operator">-</span>s <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>python3<span class="token operator">/</span>bin<span class="token operator">/</span>pip3<span class="token punctuation">.</span><span class="token number">7</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>pip
<span class="token operator">~</span>$<span class="token operator">:</span> python <span class="token operator">-</span><span class="token constant">V</span>
</code></pre> 
<h3>
<a id="43pycharm_357"></a>4.3、pycharm目录结构：</h3> 
<p><img src="https://images2.imgbox.com/ce/d2/VRKGBAS1_o.png" alt="在这里插入图片描述"></p> 
<p><strong>目录介绍</strong><br> data目录存放的是用户日志数据；<br> scripts目录存放的是Kafka生产者和消费者；<br> static/js目录存放的是前端所需要的js框架；<br> templates目录存放的是html页面；<br> app.py为web服务器，接收Spark Streaming处理后的结果，并推送实时数据给浏览器；<br> External Libraries是本项目所依赖的Python库，是PyCharm自动生成。</p> 
<p>至此，开发环境就部署完成了<br> ++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p> 
<h1>
<a id="5python_kafka_371"></a>5、python 操作kafka</h1> 
<p>数据集: <a href="https://www.csdn.net/">https://pan.baidu.com/s/1cs02Nc</a><br> 该数据集压缩包是淘宝2015年双11前6个月(包含双11)的交易数据(交易数据有偏移，但是不影响实验的结果)，里面包含3个文件，分别是用户行为日志文件user_log.csv 、回头客训练集train.csv 、回头客测试集test.csv. 在这个案例中只是用user_log.csv</p> 
<h3>
<a id="51_376"></a>5.1、创建工程文件</h3> 
<p>pycharm中按照上面工程项目图定位新建一个文件名为producer.py</p> 
<pre><code class="prism language-javascript"># coding<span class="token operator">:</span> utf<span class="token operator">-</span><span class="token number">8</span>
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> time
<span class="token keyword">from</span> kafka <span class="token keyword">import</span> KafkaProducer
 
# 实例化一个KafkaProducer示例，用于向Kafka投递消息
producer <span class="token operator">=</span> <span class="token function">KafkaProducer</span><span class="token punctuation">(</span>bootstrap_servers<span class="token operator">=</span><span class="token string">'localhost:9092'</span><span class="token punctuation">)</span>
# 打开数据文件
csvfile <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"../data/user_log.csv"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>
# 生成一个可用于读取csv文件的reader
reader <span class="token operator">=</span> csv<span class="token punctuation">.</span><span class="token function">reader</span><span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
 
<span class="token keyword">for</span> line <span class="token keyword">in</span> reader<span class="token operator">:</span>
    gender <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> # 性别在每行日志代码的第<span class="token number">9</span>个元素
    <span class="token keyword">if</span> gender <span class="token operator">==</span> <span class="token string">'gender'</span><span class="token operator">:</span>
        <span class="token keyword">continue</span> # 去除第一行表头
    time<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span> # 每隔<span class="token number">0.1</span>秒发送一行数据
    # 发送数据，topic为<span class="token string">'sex'</span>
    producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'sex'</span><span class="token punctuation">,</span>line<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>pycharm中按照上面工程项目图定位新建一个文件名为consumer.py</p> 
<pre><code class="prism language-javascript"><span class="token keyword">from</span> kafka <span class="token keyword">import</span> KafkaConsumer
 
consumer <span class="token operator">=</span> <span class="token function">KafkaConsumer</span><span class="token punctuation">(</span><span class="token string">'sex'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> msg <span class="token keyword">in</span> consumer<span class="token operator">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行上面两个文件前先开启kafka</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>kafka
<span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>zookeeper<span class="token operator">-</span>server<span class="token operator">-</span>start<span class="token punctuation">.</span>sh config<span class="token operator">/</span>zookeeper<span class="token punctuation">.</span>properties <span class="token operator">&amp;</span>
<span class="token operator">~</span>$<span class="token operator">:</span> bin<span class="token operator">/</span>kafka<span class="token operator">-</span>server<span class="token operator">-</span>start<span class="token punctuation">.</span>sh config<span class="token operator">/</span>server<span class="token punctuation">.</span>properties
</code></pre> 
<h3>
<a id="52_419"></a>5.2、测试</h3> 
<p>kafka开启后直接在pycharm中右键运行producer.py和consumer.py，运行出来是数据流则正确<br> <img src="https://images2.imgbox.com/6e/a8/PF4fqLjm_o.png" alt="在这里插入图片描述"></p> 
<h1>
<a id="6sparkkafka_423"></a>6、配置spark开发kafka环境</h1> 
<h3>
<a id="61sparkkafka_424"></a>6.1、下载spark连接kafka的代码库</h3> 
<p>将下载到的代码库放到/usr/local/spark/jars目录下</p> 
<pre><code class="prism language-javascript"><span class="token operator">~</span>$<span class="token operator">:</span> sudo mv <span class="token operator">~</span><span class="token operator">/</span>下载<span class="token operator">/</span>spark<span class="token operator">-</span>streaming<span class="token operator">-</span>kafka<span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">8_2.11</span><span class="token operator">-</span><span class="token number">2.1</span><span class="token number">.0</span><span class="token punctuation">.</span>jar <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>spark<span class="token operator">/</span>jars
<span class="token operator">~</span>$<span class="token operator">:</span> cd <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>spark<span class="token operator">/</span>jars
<span class="token operator">~</span>$<span class="token operator">:</span> mkdir kafka
<span class="token operator">~</span>$<span class="token operator">:</span> cd kafka
<span class="token operator">~</span>$<span class="token operator">:</span> cp <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>kafka<span class="token operator">/</span>libs<span class="token comment">/* .
</span></code></pre> 
<p>OK，spark开发kafka环境完成</p> 
<h3>
<a id="62scala_436"></a>6.2、创建scala工程项目</h3> 
<p>在/usr/local/spark/mycode下新建kafka项目目录，接着在kafka目录下新建src/main/scala两个文件：StreamingExamples.scala和KafkaTest.scala<br> 代码如下</p> 
<pre><code class="prism language-javascript">ackage org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>streaming
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>Logging
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span><span class="token punctuation">{<!-- --></span>Level<span class="token punctuation">,</span> Logger<span class="token punctuation">}</span>
<span class="token comment">/** Utility functions for Spark Streaming examples. */</span>
object StreamingExamples <span class="token keyword">extends</span> <span class="token class-name">Logging</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">/** Set reasonable logging levels for streaming if the user has not configured log4j. */</span>
  def <span class="token function">setStreamingLogLevels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    val log4jInitialized <span class="token operator">=</span> Logger<span class="token punctuation">.</span>getRootLogger<span class="token punctuation">.</span>getAllAppenders<span class="token punctuation">.</span>hasMoreElements
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>log4jInitialized<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// We first log something to initialize Spark's default logging, then we override the</span>
      <span class="token comment">// logging level.</span>
      <span class="token function">logInfo</span><span class="token punctuation">(</span><span class="token string">"Setting log level to [WARN] for streaming example."</span> <span class="token operator">+</span>
        <span class="token string">" To override add a custom log4j.properties to the classpath."</span><span class="token punctuation">)</span>
      Logger<span class="token punctuation">.</span>getRootLogger<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span>Level<span class="token punctuation">.</span><span class="token constant">WARN</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>streaming
 
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span><span class="token punctuation">{<!-- --></span>KafkaProducer<span class="token punctuation">,</span> ProducerConfig<span class="token punctuation">,</span> ProducerRecord<span class="token punctuation">}</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>json4s<span class="token punctuation">.</span>_
<span class="token keyword">import</span> org<span class="token punctuation">.</span>json4s<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>Serialization
<span class="token keyword">import</span> org<span class="token punctuation">.</span>json4s<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>Serialization<span class="token punctuation">.</span>write
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>SparkConf
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>_
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>Interval
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>_
 
object KafkaWordCount <span class="token punctuation">{<!-- --></span>
  implicit val formats <span class="token operator">=</span> DefaultFormats<span class="token comment">//数据格式化时需要</span>
  def <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Unit<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Usage: KafkaWordCount &lt;zkQuorum&gt; &lt;group&gt; &lt;topics&gt; &lt;numThreads&gt;"</span><span class="token punctuation">)</span>
      System<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    StreamingExamples<span class="token punctuation">.</span><span class="token function">setStreamingLogLevels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">/* 输入的四个参数分别代表着
    * 1. zkQuorum 为zookeeper地址
    * 2. group为消费者所在的组
    * 3. topics该消费者所消费的topics
    * 4. numThreads开启消费topic线程的个数
    */</span>
    val <span class="token function">Array</span><span class="token punctuation">(</span>zkQuorum<span class="token punctuation">,</span> group<span class="token punctuation">,</span> topics<span class="token punctuation">,</span> numThreads<span class="token punctuation">)</span> <span class="token operator">=</span> args
    val sparkConf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparkConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAppName</span><span class="token punctuation">(</span><span class="token string">"KafkaWordCount"</span><span class="token punctuation">)</span>
    val ssc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamingContext</span><span class="token punctuation">(</span>sparkConf<span class="token punctuation">,</span> <span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ssc<span class="token punctuation">.</span><span class="token function">checkpoint</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>  <span class="token comment">//这里表示把检查点文件写入分布式文件系统HDFS，所以要启动Hadoop</span>
    <span class="token comment">// 将topics转换成topic--&gt;numThreads的哈稀表</span>
    val topicMap <span class="token operator">=</span> topics<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> numThreads<span class="token punctuation">.</span>toInt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toMap
    <span class="token comment">// 创建连接Kafka的消费者链接</span>
    val lines <span class="token operator">=</span> KafkaUtils<span class="token punctuation">.</span><span class="token function">createStream</span><span class="token punctuation">(</span>ssc<span class="token punctuation">,</span> zkQuorum<span class="token punctuation">,</span> group<span class="token punctuation">,</span> topicMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>
    val words <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//将输入的每行用空格分割成一个个word</span>
    <span class="token comment">// 对每一秒的输入数据进行reduce，然后将reduce后的数据发送给Kafka</span>
    val wordCounts <span class="token operator">=</span> words<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">reduceByKeyAndWindow</span><span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">,</span>_<span class="token operator">-</span>_<span class="token punctuation">,</span> <span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foreachRDD</span><span class="token punctuation">(</span><span class="token parameter">rdd</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>count <span class="token operator">!=</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
               val props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">[</span>String<span class="token punctuation">,</span> Object<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ProducerConfig<span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9092"</span><span class="token punctuation">)</span>
               props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ProducerConfig<span class="token punctuation">.</span><span class="token constant">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span>
               <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span>
               props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ProducerConfig<span class="token punctuation">.</span><span class="token constant">KEY_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span>
               <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span>
               <span class="token comment">// 实例化一个Kafka生产者</span>
               val producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token punctuation">[</span>String<span class="token punctuation">,</span> String<span class="token punctuation">]</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
               <span class="token comment">// rdd.colect即将rdd中数据转化为数组，然后write函数将rdd内容转化为json格式</span>
               val str <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>collect<span class="token punctuation">)</span>
               <span class="token comment">// 封装成Kafka消息，topic为"result"</span>
               val message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token punctuation">[</span>String<span class="token punctuation">,</span> String<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span>
               <span class="token comment">// 给Kafka发送消息</span>
               producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    ssc<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    ssc<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>注意</strong>：如果没有启动hdfs就运行的话，会报错“拒绝连接”，所以运行前先启动hdfs，命令：cd /usr/local/hadoop<br> ./sbin/start-dfs.sh（前面有一点）</p> 
<h3>
<a id="63_525"></a>6.3、打包以及编译</h3> 
<p>// 在/usr/local/spark/mycode/kafka目录下新建simple.sbt打包，代码如下</p> 
<pre><code class="prism language-javascript">name <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"Simple Project"</span>
version <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"1.0"</span>
scalaVersion <span class="token operator">:</span><span class="token operator">=</span> <span class="token string">"2.11.8"</span>
libraryDependencies <span class="token operator">+=</span> <span class="token string">"org.apache.spark"</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token string">"spark-core"</span> <span class="token operator">%</span> <span class="token string">"2.1.0"</span>
libraryDependencies <span class="token operator">+=</span> <span class="token string">"org.apache.spark"</span> <span class="token operator">%</span> <span class="token string">"spark-streaming_2.11"</span> <span class="token operator">%</span> <span class="token string">"2.1.0"</span>
libraryDependencies <span class="token operator">+=</span> <span class="token string">"org.apache.spark"</span> <span class="token operator">%</span> <span class="token string">"spark-streaming-kafka-0-8_2.11"</span> <span class="token operator">%</span> <span class="token string">"2.1.0"</span>
libraryDependencies <span class="token operator">+=</span> <span class="token string">"org.json4s"</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token string">"json4s-jackson"</span> <span class="token operator">%</span> <span class="token string">"3.2.11"</span>
</code></pre> 
<p>// 编译打包程序：/usr/local/sbt/sbt packag<br> 接着在在/usr/local/spark/mycode/kafka目录下新建startup.sh文件，代码如下</p> 
<pre><code class="prism language-javascript"> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>spark<span class="token operator">/</span>bin<span class="token operator">/</span>spark<span class="token operator">-</span>submit <span class="token operator">--</span>driver<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>path <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>spark<span class="token operator">/</span>jars<span class="token comment">/*:/usr/local/spark/jars/kafka/* --class "org.apache.spark.examples.streaming.KafkaWordCount" /usr/local/spark/mycode/kafka/target/scala-2.11/simple-project_2.11-1.0.jar 127.0.0.1:2181 1 sex 1
</span></code></pre> 
<h3>
<a id="64_547"></a>6.4、测试</h3> 
<p>运行：sh startup.sh</p> 
<p>Consumer中接收的topic改为result<br> 运行producer.py和consumer.py<br> <img src="https://images2.imgbox.com/f0/17/8ozvJinu_o.png" alt="在这里插入图片描述"></p> 
<h1>
<a id="7_553"></a>7、步骤展示（可视化技术）</h1> 
<p>利用Flask-SocketIO实时推送数据<br> socket.io.js实时获取数据<br> highlights.js展示数据</p> 
<h3>
<a id="71_558"></a>7.1、创建工程文件</h3> 
<p>创建app.py文件</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> json
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template
<span class="token keyword">from</span> flask_socketio <span class="token keyword">import</span> SocketIO
<span class="token keyword">from</span> kafka <span class="token keyword">import</span> KafkaConsumer
#因为第一步骤安装好了flask，所以这里可以引用
 
app <span class="token operator">=</span> <span class="token function">Flask</span><span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'secret!'</span>
socketio <span class="token operator">=</span> <span class="token function">SocketIO</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
thread <span class="token operator">=</span> None
# 实例化一个consumer，接收topic为result的消息
consumer <span class="token operator">=</span> <span class="token function">KafkaConsumer</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">)</span>
 
# 一个后台线程，持续接收Kafka消息，并发送给客户端浏览器
def <span class="token function">background_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    girl <span class="token operator">=</span> <span class="token number">0</span>
    boy <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> msg <span class="token keyword">in</span> consumer<span class="token operator">:</span>
        data_json <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
        data_list <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">loads</span><span class="token punctuation">(</span>data_json<span class="token punctuation">)</span>
        <span class="token keyword">for</span> data <span class="token keyword">in</span> data_list<span class="token operator">:</span>
            <span class="token keyword">if</span> <span class="token string">'0'</span> <span class="token keyword">in</span> data<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
                girl <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'0'</span><span class="token punctuation">]</span>
            elif <span class="token string">'1'</span> <span class="token keyword">in</span> data<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
                boy <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token operator">:</span>
                <span class="token keyword">continue</span>
        result <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>boy<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        socketio<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'test_message'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'data'</span><span class="token operator">:</span>result<span class="token punctuation">}</span><span class="token punctuation">)</span>
 
# 客户端发送connect事件时的处理函数
@socketio<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'test_connect'</span><span class="token punctuation">)</span>
def <span class="token function">connect</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    global thread
    <span class="token keyword">if</span> thread is None<span class="token operator">:</span>
        # 单独开启一个线程给客户端发送数据
        thread <span class="token operator">=</span> socketio<span class="token punctuation">.</span><span class="token function">start_background_task</span><span class="token punctuation">(</span>target<span class="token operator">=</span>background_thread<span class="token punctuation">)</span>
    socketio<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'data'</span><span class="token operator">:</span> <span class="token string">'Connected'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
 
# 通过访问http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">5000</span><span class="token operator">/</span>访问index<span class="token punctuation">.</span>html
@app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
def <span class="token function">handle_mes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token function">render_template</span><span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span>
 
# main函数
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token operator">:</span>
    socketio<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span>debug<span class="token operator">=</span>True<span class="token punctuation">)</span>
</code></pre> 
<p>// 创建index页面</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>DashBoard<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"static/js/socket.io.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"static/js/jquery-3.1.1.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"static/js/highcharts.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"static/js/exporting.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">&gt;</span>
    <span class="token keyword">var</span> socket <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'http://'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>domain <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> location<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'test_connect'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>data<span class="token operator">:</span> <span class="token string">'I'm connected!'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'test_message'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#girl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#boy'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'disconnect'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'disconnect'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>b<span class="token operator">&gt;</span>Girl<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span>b id<span class="token operator">=</span><span class="token string">"girl"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>b<span class="token operator">&gt;</span>Boy<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span><span class="token operator">&lt;</span>b id<span class="token operator">=</span><span class="token string">"boy"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"container"</span> style<span class="token operator">=</span><span class="token string">"width: 600px;height:400px;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>
    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Highcharts<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        global<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            useUTC<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    Highcharts<span class="token punctuation">.</span><span class="token function">chart</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
        chart<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            type<span class="token operator">:</span> <span class="token string">'spline'</span><span class="token punctuation">,</span>
            animation<span class="token operator">:</span> Highcharts<span class="token punctuation">.</span>svg<span class="token punctuation">,</span> <span class="token comment">// don't animate in old IE</span>
            marginRight<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            events<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function-variable function">load</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 
                    <span class="token comment">// set up the updating of the chart each second</span>
                    <span class="token keyword">var</span> series1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>series<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">var</span> series2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>series<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// current time</span>
                        count1 <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#girl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        y <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>count1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        series1<span class="token punctuation">.</span><span class="token function">addPoint</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                        count2 <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#boy'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        z <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>count2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        series2<span class="token punctuation">.</span><span class="token function">addPoint</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> z<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        title<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            text<span class="token operator">:</span> <span class="token string">'男女生购物人数实时分析'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        xAxis<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            type<span class="token operator">:</span> <span class="token string">'datetime'</span><span class="token punctuation">,</span>
            tickPixelInterval<span class="token operator">:</span> <span class="token number">50</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        yAxis<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            title<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                text<span class="token operator">:</span> <span class="token string">'数量'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            plotLines<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
                value<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                width<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                color<span class="token operator">:</span> <span class="token string">'#808080'</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        tooltip<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function-variable function">formatter</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token string">'&lt;b&gt;'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>series<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'&lt;/b&gt;&lt;br/&gt;'</span> <span class="token operator">+</span>
                    Highcharts<span class="token punctuation">.</span><span class="token function">dateFormat</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&lt;br/&gt;'</span> <span class="token operator">+</span>
                    Highcharts<span class="token punctuation">.</span><span class="token function">numberFormat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        legend<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            enabled<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        exporting<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            enabled<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        series<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
            name<span class="token operator">:</span> <span class="token string">'女生购物人数'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// generate an array of random data</span>
                <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    time <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    i<span class="token punctuation">;</span>
 
                <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">19</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                        x<span class="token operator">:</span> time <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
                        y<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> data<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
            name<span class="token operator">:</span> <span class="token string">'男生购物人数'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// generate an array of random data</span>
                <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    time <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    i<span class="token punctuation">;</span>
 
                <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">19</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                        x<span class="token operator">:</span> time <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
                        y<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> data<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<h3>
<a id="72_758"></a>7.2、按照工程项目图创建下列文件：</h3> 
<p>socket.io.js链接: <a href="https://www.csdn.net/">https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js</a></p> 
<p>socket.io.js.map链接: <a href="https://www.csdn.net/">https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js.map</a></p> 
<p>highchart.js链接: <a href="https://www.csdn.net/">https://www.highcharts.com/download</a></p> 
<p>exporting.js：Highcharts-6.0.7.zip解压缩后，可以看到里面有个code子目录，在code子目录下面就可以找到一个js子目录，在js子目录下可以找到一个modules子目录，在modules子目录中就可以找到库文件exporting.js。</p> 
<p>jquery.js链接: <a href="https://www.csdn.net/">http://jquery.com/download/</a></p> 
<h3>
<a id="73_770"></a>7.3、测试结果数据</h3> 
<p>// 运行app.py，打开浏览器127.0.0.1:5000即可展示数据<br> <img src="https://images2.imgbox.com/da/26/6CKLapX5_o.png" alt="在这里插入图片描述"></p> 
<h1>
<a id="8_775"></a>8、入坑笔记</h1> 
<h1>
<a id="sparkkafkadashboard_776"></a>部署spark+kafka构建实时分析dashboard入坑笔记</h1> 
<p>ubuntu系统<br> 1.<strong>问题</strong>：在使用xshell连接ubuntu时一直连接不上？</p> 
<p><strong>解决</strong>：连接不上是因为ubuntu系统并没有ssh协议，此时通过以下命令解决<br> rpm -qa | grep ssh //查看是否安装了ssh<br> sudo apt-get install ssh //如无安装执行<br> ps -ef | grep ssh //启动<br> service sshd start //或者也可以重启</p> 
<p>============================================================================</p> 
<p>2.<strong>问题</strong>：在sudo apt-get update时出现无法获得锁/var/lib/dpkg/lock-open(11：资源暂时不可用)报错</p> 
<p><strong>解决</strong>：ps -A | grep apt：查看哪些进程占用着apt<br> 发现进程后，sudo kill -9 xx（进程号）：杀死进程<br> 再删除锁文件：sudo rm /var/lib/pdkg/lock</p> 
<p>============================================================================</p> 
<p>3.<strong>问题</strong>：昨晚使用ubuntu虚拟机时，屏幕真的好小，我用着简直难受死，一时搞tools又搞不了！！</p> 
<p><strong>解决</strong>：点击”虚拟机“–”安装vm tools“–然后在iso文件处会被替换成vm tools–点击他–有个压缩包–复制到桌面上，然后解压他，然后cd 到解压后的文件中，执行sudo ./vmware-install.pl，一路回车或者按照提示完成。</p> 
<p>============================================================================</p> 
<p>4.<strong>问题</strong>：安装java环境时报错–格式执行错误</p> 
<p><strong>解决</strong>：调试了两节课才发现，我jdk的64位的，系统是32位的，不兼容，真是吐血，将jdk更换为32位后一次就成功了。</p> 
<p>============================================================================</p> 
<p>5.<strong>问题</strong>：xshell上传文件一直失败</p> 
<p><strong>解决</strong>：将aisen账户换成hadoop账户，搞定。</p> 
<p>============================================================================<br> 6.<strong>问题</strong>：在安装sbt的时候，出现错误，sbtVersion一直失败</p> 
<p><strong>解决</strong>：重装了64位系统配置了64位jdk后就能正常安装了。</p> 
<p>============================================================================</p> 
<p>7.<strong>问题</strong>：在执行python文件时，在from spark.xx import sprk.yy处报错</p> 
<p><strong>解决</strong>：在设置处将原本是python2.7换成python3.5编译器就可以正常编译了。</p> 
<p>============================================================================</p> 
<p>8.<strong>问题</strong>：在执行最后的pycharm的两个文件时无法正常接收sparksteaming数据，运行不出数据</p> 
<p><strong>解决</strong>：是需要同时执行sparksteaming和producer和consumer，也就是执行sparksteaming时终端会处于执行中状态，不可中断执行，让它保持执行状态，然后运行producer后再运行consumer即可正常接收sparksteaming数据。</p> 
<p>============================================================================</p> 
<p>9.<strong>问题</strong>：在ubuntu16中下载pycharm后，我用的是python3.5的编译器，后来报错：python 3.5 has reached its end-of-life date and it is no longer support in pycharm</p> 
<p><strong>解决</strong>：报错翻译为：Python3.5已经到了生命周期的尽头，pycharm不再支持它。原因是pycharm已不再兼容python3.5。通过如下命令安装python3.9：<br> cd /usr/local/share<br> wget https://www.python.org/ftp/python/3.9.5/Python-3.9.5.tgz<br> tar zxvf Python-3.9.5.tgz<br> cd Python-3.9.5<br> ./configure --with-ssl --enable-optimizations --enable-shared --enable-unicode=ucs4<br> make<br> make install<br> mv /usr/bin/python3 /usr/bin/python3.bak<br> ln -s /usr/local/bin/python3 /usr/bin/python3</p> 
<p>============================================================================</p> 
<p>10.<strong>问题</strong>：ubuntu系统安装python3版本</p> 
<p><strong>解决</strong>：1.准备<br> 在安装之前，请使用以下命令安装Python的先决条件。</p> 
<pre><code>     sudo apt-get install build-essential checkinstall
     sudo apt-get install libreadline-gplv2-dev libncursesw5-dev libssl-dev 
     libsqlite3-dev tk-dev libgdbm-dev libc6-dev libbz2-dev
     2.安装
     使用python官方站点的以下命令下载Python。您也可以下载最新版本代替下面指定的版本。

     cd /usr/src
     sudo wget https://www.python.org/ftp/python/3.7.0/Python-3.7.0.tgz

     sudo tar xzf Python-3.7.0.tgz

     3. 编译
     使用下面的命令集来使用altinstall在您的系统上编译python源代码。

     cd Python-3.7.0
     sudo ./configure --enable-optimizations
     sudo make altinstall
     make altinstall用于防止替换默认的python二进制文件/ usr / bin / python。

     4.检查Python版本

     python3.7 -V
</code></pre> 
<p>============================================================================</p> 
<p>11.<strong>问题</strong>：将终端输入python显示版本的指令有原本的指向2.7更改为指向3.7操作</p> 
<p><strong>解决</strong>：输入lias python=python3.7 即可</p> 
<p>============================================================================</p> 
<p>12.<strong>问题</strong>：pycharm中使用python3.7版本出现{from flask-socketio import socketio}报错，无法导包</p> 
<p><strong>解决</strong>：在终端执行 pip install eventlet<br> pip install flask-socketio</p> 
<p>============================================================================</p> 
<p>13.<strong>问题</strong>：python3.7运行编写的生产者和消费者时报错（SimpleProducer。。。。。。）</p> 
<p><strong>解决</strong>：报错是因为python3.7新增了关键字async,await；kafka-python用到关键字async，由此带来了兼容问题，使用python3.6版本即可正常运行</p> 
<p>============================================================================</p> 
<p>注：项目来源于厦门大学林子雨实验室！<br> 项目原文链接: <a href="https://www.csdn.net/">http://dblab.xmu.edu.cn/post/8274/</a></p>
                </div>
                
                

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程小白.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://www.w3counter.com/tracker.js?id=150625"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>